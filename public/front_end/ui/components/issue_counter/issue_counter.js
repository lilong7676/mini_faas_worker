import*as e from"../../../core/common/common.js";import*as s from"../../../core/i18n/i18n.js";import*as i from"../../../models/issues_manager/issues_manager.js";import*as t from"../helpers/helpers.js";import*as o from"../../lit-html/lit-html.js";import*as n from"../icon_button/icon_button.js";import*as r from"../render_coordinator/render_coordinator.js";const a=new CSSStyleSheet;a.replaceSync(":host{white-space:normal;display:inline-block}\n/*# sourceURL=issueCounter.css */\n");const l={pageErrors:"{issueCount, plural, =1 {# page error} other {# page errors}}",breakingChanges:"{issueCount, plural, =1 {# breaking change} other {# breaking changes}}",possibleImprovements:"{issueCount, plural, =1 {# possible improvement} other {# possible improvements}}"},u=s.i18n.registerUIStrings("ui/components/issue_counter/IssueCounter.ts",l),c=s.i18n.getLocalizedString.bind(void 0,u);function h(e){switch(e){case i.Issue.IssueKind.PageError:return{iconName:"issue-cross-icon",color:"var(--issue-color-red)",width:"16px",height:"16px"};case i.Issue.IssueKind.BreakingChange:return{iconName:"issue-exclamation-icon",color:"var(--issue-color-yellow)",width:"16px",height:"16px"};case i.Issue.IssueKind.Improvement:return{iconName:"issue-text-icon",color:"var(--issue-color-blue)",width:"16px",height:"16px"}}}function d({iconName:e,color:s,width:i,height:t},o){return o?{iconName:e,iconColor:s,iconWidth:o,iconHeight:o}:{iconName:e,iconColor:s,iconWidth:i,iconHeight:t}}const m=new Intl.ListFormat(navigator.language,{type:"unit",style:"short"});class p extends HTMLElement{static litTagName=o.literal`issue-counter`;#e=this.attachShadow({mode:"open"});#s=void 0;#i=void 0;#t="";#o;#n=[0,0,0];#r="OmitEmpty";#a=void 0;#l=void 0;#u;#c=!1;scheduleUpdate(){this.#o?this.#o.schedule((async()=>this.render())):this.render()}connectedCallback(){this.#e.adoptedStyleSheets=[a]}set data(s){this.#s=s.clickHandler,this.#t=s.leadingText??"",this.#i=s.tooltipCallback,this.#r=s.displayMode??"OmitEmpty",this.#l=s.accessibleName,this.#u=s.throttlerTimeout,this.#c=Boolean(s.compact),this.#a!==s.issuesManager&&(this.#a?.removeEventListener("IssuesCountUpdated",this.scheduleUpdate,this),this.#a=s.issuesManager,this.#a.addEventListener("IssuesCountUpdated",this.scheduleUpdate,this)),0!==s.throttlerTimeout?this.#o=new e.Throttler.Throttler(s.throttlerTimeout??100):this.#o=void 0,this.scheduleUpdate()}get data(){return{clickHandler:this.#s,leadingText:this.#t,tooltipCallback:this.#i,displayMode:this.#r,accessibleName:this.#l,throttlerTimeout:this.#u,compact:this.#c,issuesManager:this.#a}}render(){if(!this.#a)return;this.#n=[this.#a.numberOfIssues(i.Issue.IssueKind.PageError),this.#a.numberOfIssues(i.Issue.IssueKind.BreakingChange),this.#a.numberOfIssues(i.Issue.IssueKind.Improvement)];const e=[i.Issue.IssueKind.PageError,i.Issue.IssueKind.BreakingChange,i.Issue.IssueKind.Improvement][this.#n.findIndex((e=>e>0))??2],s=(s,i)=>{switch(this.#r){case"OmitEmpty":return i>0?`${i}`:void 0;case"ShowAlways":return`${i}`;case"OnlyMostImportant":return s===e?`${i}`:void 0}},t="2ex",n={groups:[{...d(h(i.Issue.IssueKind.PageError),t),text:s(i.Issue.IssueKind.PageError,this.#n[0])},{...d(h(i.Issue.IssueKind.BreakingChange),t),text:s(i.Issue.IssueKind.BreakingChange,this.#n[1])},{...d(h(i.Issue.IssueKind.Improvement),t),text:s(i.Issue.IssueKind.Improvement,this.#n[2])}],clickHandler:this.#s,leadingText:this.#t,accessibleName:this.#l,compact:this.#c};o.render(o.html` <icon-button .data="${n}" .accessibleName="${this.#l}"></icon-button> `,this.#e,{host:this}),this.#i?.()}}t.CustomElements.defineComponent("issue-counter",p);var I=Object.freeze({__proto__:null,getIssueKindIconData:h,getIssueCountsEnumeration:function(e,s=!0){const t=[e.numberOfIssues(i.Issue.IssueKind.PageError),e.numberOfIssues(i.Issue.IssueKind.BreakingChange),e.numberOfIssues(i.Issue.IssueKind.Improvement)],o=[c(l.pageErrors,{issueCount:t[0]}),c(l.breakingChanges,{issueCount:t[1]}),c(l.possibleImprovements,{issueCount:t[2]})];return m.format(o.filter(((e,i)=>!s||t[i]>0)))},IssueCounter:p});const g=new CSSStyleSheet;g.replaceSync(":host{display:inline-block;white-space:nowrap;color:inherit;font-size:inherit;font-family:inherit}devtools-icon{vertical-align:middle}.link{cursor:pointer}.link span{color:var(--color-link)}\n/*# sourceURL=issueLinkIcon.css */\n");const v={clickToShowIssue:"Click to show issue in the issues tab",clickToShowIssueWithTitle:"Click to open the issue tab and show issue: {title}",issueUnavailable:"Issue unavailable at this time"},k=s.i18n.registerUIStrings("ui/components/issue_counter/IssueLinkIcon.ts",v),C=s.i18n.getLocalizedString.bind(void 0,k),b=r.RenderCoordinator.RenderCoordinator.instance();class T extends HTMLElement{static litTagName=o.literal`devtools-issue-link-icon`;#e=this.attachShadow({mode:"open"});#h;#d=null;#m=Promise.resolve(void 0);#p;#I;#g;#v=e.Revealer.reveal;#k=Promise.resolve(void 0);set data(e){if(this.#h=e.issue,this.#p=e.issueId,!this.#h&&!this.#p)throw new Error("Either `issue` or `issueId` must be provided");this.#I=e.issueResolver,this.#g=e.additionalOnClickAction,e.revealOverride&&(this.#v=e.revealOverride),!this.#h&&this.#p?(this.#k=this.resolveIssue(this.#p),this.#m=this.#k.then((()=>this.fetchIssueTitle()))):this.#m=this.fetchIssueTitle(),this.render()}async fetchIssueTitle(){const e=this.#h?.getDescription();if(!e)return;const s=await i.MarkdownIssueDescription.getIssueTitleFromMarkdownDescription(e);s&&(this.#d=s)}connectedCallback(){this.#e.adoptedStyleSheets=[g]}resolveIssue(e){if(!this.#I)throw new Error("An `IssueResolver` must be provided if an `issueId` is provided.");return this.#I.waitFor(e).then((e=>{this.#h=e})).catch((()=>{this.#h=null}))}get data(){return{issue:this.#h,issueId:this.#p,issueResolver:this.#I,additionalOnClickAction:this.#g,revealOverride:this.#v!==e.Revealer.reveal?this.#v:void 0}}iconData(){return this.#h?h(this.#h.getKind()):{iconName:"issue-questionmark-icon",color:"var(--color-text-secondary)",width:"16px",height:"16px"}}handleClick(e){0===e.button&&(this.#h&&this.#v(this.#h),this.#g?.())}getTooltip(){return this.#d?C(v.clickToShowIssueWithTitle,{title:this.#d}):this.#h?C(v.clickToShowIssue):C(v.issueUnavailable)}render(){return b.write((()=>{o.render(o.html` ${o.Directives.until(this.#m.then((()=>this.renderComponent())),this.#k.then((()=>this.renderComponent())),this.renderComponent())} `,this.#e,{host:this})}))}renderComponent(){return o.html` <span class="${o.Directives.classMap({link:Boolean(this.#h)})}" tabindex="0" @click="${this.handleClick}"> <${n.Icon.Icon.litTagName} .data="${this.iconData()}" title="${this.getTooltip()}"></${n.Icon.Icon.litTagName}> </span>`}}t.CustomElements.defineComponent("devtools-issue-link-icon",T);var w=Object.freeze({__proto__:null,extractShortPath:e=>(/[^/]+$/.exec(e)||/[^/]+\/$/.exec(e)||[""])[0],IssueLinkIcon:T});export{I as IssueCounter,w as IssueLinkIcon};
