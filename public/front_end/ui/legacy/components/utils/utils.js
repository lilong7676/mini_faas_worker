import*as e from"../../../../core/common/common.js";import*as t from"../../../../core/host/host.js";import*as n from"../../../../core/i18n/i18n.js";import*as i from"../../../../core/platform/platform.js";import*as o from"../../../../core/sdk/sdk.js";import*as r from"../../../../models/bindings/bindings.js";import*as a from"../../legacy.js";import*as s from"../../../../models/text_utils/text_utils.js";import*as c from"../../../../models/workspace/workspace.js";const l=new CSSStyleSheet;l.replaceSync(".image-preview-container{background:0 0;text-align:center;border-spacing:0}.image-preview-container img{margin:6px 0;max-width:100px;max-height:100px;background-image:var(--image-file-checker);user-select:text;vertical-align:top;-webkit-user-drag:auto}.image-container{padding:0}.image-container>div{min-height:50px;display:flex;align-items:center;justify-content:center;cursor:pointer}.image-preview-container .row{line-height:1.2;vertical-align:baseline}.image-preview-container .title{padding-right:.5em;text-align:right;color:var(--color-text-secondary);white-space:nowrap}.image-preview-container .description{white-space:nowrap;text-align:left;color:var(--color-text-primary)}.image-preview-container .description-link{max-width:20em}.image-preview-container .source-link{white-space:normal;word-break:break-all;color:var(--color-link);cursor:pointer}\n/*# sourceURL=imagePreview.css */\n");const d={unknownSource:"unknown source",imageFromS:"Image from {PH1}",fileSize:"File size:",intrinsicSize:"Intrinsic size:",renderedSize:"Rendered size:",currentSource:"Current source:",renderedAspectRatio:"Rendered aspect ratio:",intrinsicAspectRatio:"Intrinsic aspect ratio:"},u=n.i18n.registerUIStrings("ui/legacy/components/utils/ImagePreview.ts",d),m=n.i18n.getLocalizedString.bind(void 0,u);function p(t){return null!==t&&t.resourceType()===e.ResourceType.resourceTypes.Image}var g=Object.freeze({__proto__:null,ImagePreview:class{static async build(e,n,r,a={precomputedFeatures:void 0,imageAltText:void 0}){const{precomputedFeatures:s,imageAltText:c}=a,u=e.model(o.ResourceTreeModel.ResourceTreeModel);if(!u)return null;let g=u.resourceForURL(n),h=n;if(!p(g)&&s&&s.currentSrc&&(h=s.currentSrc,g=u.resourceForURL(h)),!g||!p(g))return null;const L=g,k=g.displayName,b=g.content?g.content:g.url.split("base64,")[1],v=g.contentSize(),C=v||i.StringUtilities.base64ToSize(b),f=C>0?i.NumberUtilities.bytesToString(C):"";return new Promise((e=>{const n=document.createElement("img");n.addEventListener("load",(function(){const o=document.createElement("div"),a=o.attachShadow({mode:"open"});a.adoptedStyleSheets=[l];const c=a.createChild("table");c.className="image-preview-container";const u=c.createChild("tr").createChild("td","image-container");u.colSpan=2;const p=u.createChild("div");p.title=k,p.appendChild(n),p.addEventListener("click",(()=>{t.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(h)}));const g=n.naturalWidth,L=n.naturalHeight,b=s?s.renderedWidth:g,v=s?s.renderedHeight:L;if(r){const e=c.createChild("tr","row");e.createChild("td","title").textContent=m(d.renderedSize),e.createChild("td","description").textContent=`${b} × ${v} px`;const t=c.createChild("tr","row");if(t.createChild("td","title").textContent=m(d.renderedAspectRatio),t.createChild("td","description").textContent=i.NumberUtilities.aspectRatio(b,v),v!==L||b!==g){const e=c.createChild("tr","row");e.createChild("td","title").textContent=m(d.intrinsicSize),e.createChild("td","description").textContent=`${g} × ${L} px`;const t=c.createChild("tr","row");t.createChild("td","title").textContent=m(d.intrinsicAspectRatio),t.createChild("td","description").textContent=i.NumberUtilities.aspectRatio(g,L)}}const C=c.createChild("tr","row");C.createChild("td","title").textContent=m(d.fileSize),C.createChild("td","description").textContent=f;const w=c.createChild("tr","row");w.createChild("td","title").textContent=m(d.currentSource);const S=i.StringUtilities.trimMiddle(h,100),I=w.createChild("td","description description-link").createChild("span","source-link");I.textContent=S,I.addEventListener("click",(()=>{t.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(h)})),e(o)}),!1),n.addEventListener("error",(()=>e(null)),!1),c&&(n.alt=c),L.populateImageSource(n)}))}static async loadDimensionsForNode(e){if(!e.nodeName()||"img"!==e.nodeName().toLowerCase())return;const t=await e.resolveToObject("");if(!t)return;const n=t.callFunctionJSON((function(){return{renderedWidth:this.width,renderedHeight:this.height,currentSrc:this.currentSrc}}),void 0);return t.release(),n}static defaultAltTextForImageURL(t){const n=new e.ParsedURL.ParsedURL(t),i=n.isValid?n.displayName:m(d.unknownSource);return m(d.imageFromS,{PH1:i})}}});const h={unknown:"(unknown)",auto:"auto",revealInS:"Reveal in {PH1}",reveal:"Reveal",openUsingS:"Open using {PH1}",linkHandling:"Link handling:"},L=n.i18n.registerUIStrings("ui/legacy/components/utils/Linkifier.ts",h),k=n.i18n.getLocalizedString.bind(void 0,L),b=new Set;let v=null;const C=new WeakMap,f=new WeakMap,w=new WeakMap,S=new Map;let I;class y{maxLength;anchorsByTarget;locationPoolByTarget;onLiveLocationUpdate;useLinkDecorator;constructor(e,t,n=(()=>{})){this.maxLength=e||a.UIUtils.MaxLengthForDisplayedURLs,this.anchorsByTarget=new Map,this.locationPoolByTarget=new Map,this.onLiveLocationUpdate=n,this.useLinkDecorator=Boolean(t),b.add(this),o.TargetManager.TargetManager.instance().observeTargets(this)}static setLinkDecorator(e){console.assert(!v,"Cannot re-register link decorator."),v=e,e.addEventListener(x.Events.LinkIconChanged,(function(e){const t=e.data,n=C.get(t)||[];for(const e of n)y.updateLinkDecorations(e)}));for(const e of b)e.updateAllAnchorDecorations()}updateAllAnchorDecorations(){for(const e of this.anchorsByTarget.values())for(const t of e)y.updateLinkDecorations(t)}static bindUILocation(e,t){const n=y.linkInfo(e);if(!n)return;if(n.uiLocation=t,!t)return;const i=t.uiSourceCode;let o=C.get(i);o||(o=new Set,C.set(i,o)),o.add(e)}static unbindUILocation(e){const t=y.linkInfo(e);if(!t||!t.uiLocation)return;const n=t.uiLocation.uiSourceCode;t.uiLocation=null;const i=C.get(n);i&&i.delete(e)}targetAdded(e){this.anchorsByTarget.set(e,[]),this.locationPoolByTarget.set(e,new r.LiveLocation.LiveLocationPool)}targetRemoved(e){const t=this.locationPoolByTarget.get(e);if(this.locationPoolByTarget.delete(e),!t)return;t.disposeAll();const n=this.anchorsByTarget.get(e);if(n){this.anchorsByTarget.delete(e);for(const e of n){const t=y.linkInfo(e);if(!t)continue;t.liveLocation=null,y.unbindUILocation(e);const n=t.fallback;n&&e.replaceWith(n)}}}maybeLinkifyScriptLocation(e,t,n,i,a){let s=null;const c={lineNumber:i,maxLength:this.maxLength,columnNumber:a?a.columnNumber:void 0,showColumnNumber:Boolean(a?.showColumnNumber),className:a?a.className:void 0,tabStop:a?a.tabStop:void 0,inlineFrameIndex:a?a.inlineFrameIndex:0,text:void 0,preventClick:void 0,bypassURLTrimming:void 0},{columnNumber:l,className:d=""}=c;if(n&&(s=y.linkifyURL(n,c)),!e||e.isDisposed())return s;const u=e.model(o.DebuggerModel.DebuggerModel);if(!u)return s;const m=t?u.createRawLocationByScriptId(t,i||0,l,c.inlineFrameIndex):u.createRawLocationByURL(n,i||0,l,c.inlineFrameIndex);if(!m)return s;const p={maxLength:void 0,title:void 0,href:void 0,preventClick:void 0,bypassURLTrimming:void 0,tabStop:a?a.tabStop:void 0},{link:g,linkInfo:h}=y.createLink(s&&s.textContent?s.textContent:"​",d,p);h.enableDecorator=this.useLinkDecorator,h.fallback=s;const L=this.locationPoolByTarget.get(m.debuggerModel.target());if(!L)return s;const k={showColumnNumber:c.showColumnNumber},b=this.onLiveLocationUpdate;r.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().createLiveLocation(m,this.updateAnchor.bind(this,g,k),L).then((e=>{e&&(h.liveLocation=e,b())}));return this.anchorsByTarget.get(m.debuggerModel.target()).push(g),g}linkifyScriptLocation(e,t,n,i,o){const r=this.maybeLinkifyScriptLocation(e,t,n,i,o),a={lineNumber:i,maxLength:this.maxLength,className:o?o.className:void 0,columnNumber:o?o.columnNumber:void 0,showColumnNumber:Boolean(o?.showColumnNumber),inlineFrameIndex:o?o.inlineFrameIndex:0,tabStop:o?o.tabStop:void 0,text:void 0,preventClick:void 0,bypassURLTrimming:void 0};return r||y.linkifyURL(n,a)}linkifyRawLocation(e,t,n){return this.linkifyScriptLocation(e.debuggerModel.target(),e.scriptId,t,e.lineNumber,{columnNumber:e.columnNumber,className:n,tabStop:void 0,inlineFrameIndex:e.inlineFrameIndex})}maybeLinkifyConsoleCallFrame(e,t,n){const i={columnNumber:t.columnNumber,showColumnNumber:Boolean(n?.showColumnNumber),inlineFrameIndex:n?n.inlineFrameIndex:0,tabStop:n?n.tabStop:void 0,className:n?n.className:void 0};return this.maybeLinkifyScriptLocation(e,t.scriptId,t.url,t.lineNumber,i)}linkifyStackTraceTopFrame(e,t,n){console.assert(t.callFrames.length>0);const{url:i,lineNumber:a,columnNumber:s}=t.callFrames[0],c=y.linkifyURL(i,{className:n,lineNumber:a,columnNumber:s,showColumnNumber:!1,inlineFrameIndex:0,maxLength:this.maxLength,text:void 0,preventClick:!0,tabStop:void 0,bypassURLTrimming:void 0}),l=this.locationPoolByTarget.get(e);if(!l)return console.assert(e.isDisposed()),c;console.assert(!e.isDisposed());const d=e.model(o.DebuggerModel.DebuggerModel),{link:u,linkInfo:m}=y.createLink("​",n??"");m.enableDecorator=this.useLinkDecorator,m.fallback=c;const p=this.onLiveLocationUpdate;r.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().createStackTraceTopFrameLiveLocation(d.createRawLocationsByStackTrace(t),this.updateAnchor.bind(this,u,{showColumnNumber:!1}),l).then((e=>{m.liveLocation=e,p()}));return this.anchorsByTarget.get(e).push(u),u}linkifyCSSLocation(e,t){const n={maxLength:void 0,title:void 0,href:void 0,preventClick:void 0,bypassURLTrimming:void 0,tabStop:!0},{link:i,linkInfo:o}=y.createLink("​",t||"",n);o.enableDecorator=this.useLinkDecorator;const a=this.locationPoolByTarget.get(e.cssModel().target());if(!a)return i;const s=this.onLiveLocationUpdate;r.CSSWorkspaceBinding.CSSWorkspaceBinding.instance().createLiveLocation(e,this.updateAnchor.bind(this,i,{showColumnNumber:!1}),a).then((e=>{o.liveLocation=e,s()}));return this.anchorsByTarget.get(e.cssModel().target()).push(i),i}reset(){for(const e of[...this.anchorsByTarget.keys()])this.targetRemoved(e),this.targetAdded(e)}dispose(){for(const e of[...this.anchorsByTarget.keys()])this.targetRemoved(e);o.TargetManager.TargetManager.instance().unobserveTargets(this),b.delete(this)}async updateAnchor(t,n,i){y.unbindUILocation(t);const o=await i.uiLocation();if(!o){if(i instanceof r.CSSWorkspaceBinding.LiveLocation){const n=i.header();n&&n.ownerNode&&(t.addEventListener("click",(t=>{t.consume(!0),e.Revealer.reveal(n.ownerNode||null)}),!1),y.setTrimmedText(t,"<style>"))}return}y.bindUILocation(t,o);const s=o.linkText(!0,n.showColumnNumber);y.setTrimmedText(t,s,this.maxLength);let c=o.uiSourceCode.url();"application/wasm"===o.uiSourceCode.mimeType()?"number"==typeof o.columnNumber&&(c+=`:0x${o.columnNumber.toString(16)}`):(c+=":"+(o.lineNumber+1),n.showColumnNumber&&"number"==typeof o.columnNumber&&(c+=":"+(o.columnNumber+1))),a.Tooltip.Tooltip.install(t,c),t.classList.toggle("ignore-list-link",await i.isIgnoreListed()),y.updateLinkDecorations(t)}setLiveLocationUpdateCallback(e){this.onLiveLocationUpdate=e}static updateLinkDecorations(e){const t=y.linkInfo(e);if(!t||!t.enableDecorator)return;if(!v||!t.uiLocation)return;t.icon&&t.icon.parentElement&&e.removeChild(t.icon);const n=v.linkIcon(t.uiLocation.uiSourceCode);n&&(n.style.setProperty("margin-right","2px"),e.insertBefore(n,e.firstChild)),t.icon=n}static linkifyURL(e,t){const n=(t=t||{text:void 0,className:void 0,lineNumber:void 0,columnNumber:void 0,showColumnNumber:!1,inlineFrameIndex:0,preventClick:void 0,maxLength:void 0,tabStop:void 0,bypassURLTrimming:void 0}).text,i=t.className||"",o=t.lineNumber,s=t.columnNumber,c=t.showColumnNumber,l=t.preventClick,d=t.maxLength||a.UIUtils.MaxLengthForDisplayedURLs,u=t.bypassURLTrimming;if(!e||e.trim().toLowerCase().startsWith("javascript:")){const t=document.createElement("span");return i&&(t.className=i),t.textContent=n||e||k(h.unknown),t}let m=n||r.ResourceUtils.displayNameForURL(e);"number"!=typeof o||n||(m+=":"+(o+1),c&&"number"==typeof s&&(m+=":"+(s+1)));const p={maxLength:d,title:m!==e?e:"",href:e,preventClick:l,tabStop:t.tabStop,bypassURLTrimming:u},{link:g,linkInfo:L}=y.createLink(m,i,p);return o&&(L.lineNumber=o),s&&(L.columnNumber=s),g}static linkifyRevealable(e,t,n,i,o){const r={maxLength:a.UIUtils.MaxLengthForDisplayedURLs,href:n,title:i,preventClick:void 0,tabStop:void 0,bypassURLTrimming:void 0},{link:s,linkInfo:c}=y.createLink(t,o||"",r);return c.revealable=e,s}static createLink(e,t,n){n=n||{maxLength:void 0,title:void 0,href:void 0,preventClick:void 0,tabStop:void 0,bypassURLTrimming:void 0};const{maxLength:i,title:o,href:r,preventClick:s,tabStop:c,bypassURLTrimming:l}=n,d=document.createElement("span");t&&(d.className=t),d.classList.add("devtools-link"),o&&a.Tooltip.Tooltip.install(d,o),r&&(d.href=r),e instanceof HTMLElement?d.appendChild(e):l?(d.classList.add("devtools-link-styled-trim"),y.appendTextWithoutHashes(d,e)):y.setTrimmedText(d,e,i);const u={icon:null,enableDecorator:!1,uiLocation:null,liveLocation:null,url:r||null,lineNumber:null,columnNumber:null,inlineFrameIndex:0,revealable:null,fallback:null};return f.set(d,u),s?d.classList.add("devtools-link-prevent-click"):(d.addEventListener("click",(e=>{y.handleClick(e)&&e.consume(!0)}),!1),d.addEventListener("keydown",(e=>{"Enter"===e.key&&y.handleClick(e)&&e.consume(!0)}),!1)),a.ARIAUtils.markAsLink(d),d.tabIndex=c?0:-1,{link:d,linkInfo:u}}static setTrimmedText(e,t,n){if(e.removeChildren(),n&&t.length>n){const i=function(e,t){let n=Math.floor(t/2),i=e.length-Math.ceil(t/2)+1;const o=e.codePointAt(i-1);void 0!==o&&o>=65536&&(i++,n++);const r=e.codePointAt(n-1);void 0!==r&&n>0&&r>=65536&&n--;return[e.substring(0,n),e.substring(n,i),e.substring(i)]}(t,n);y.appendTextWithoutHashes(e,i[0]),y.appendHiddenText(e,i[1]),y.appendTextWithoutHashes(e,i[2])}else y.appendTextWithoutHashes(e,t)}static appendTextWithoutHashes(e,t){const n=s.TextUtils.Utils.splitStringByRegexes(t,[/[a-f0-9]{20,}/g]);for(const t of n)-1===t.regexIndex?a.UIUtils.createTextChild(e,t.value):(a.UIUtils.createTextChild(e,t.value.substring(0,7)),y.appendHiddenText(e,t.value.substring(7)))}static appendHiddenText(e,t){const n=a.UIUtils.createTextChild(e.createChild("span","devtools-link-ellipsis"),"…");w.set(n,t)}static untruncatedNodeText(e){return w.get(e)||e.textContent||""}static linkInfo(e){return e&&f.get(e)||null}static handleClick(e){const t=e.currentTarget;if(a.UIUtils.isBeingEdited(e.target)||t.hasSelection())return!1;const n=y.linkInfo(t);return!!n&&y.invokeFirstAction(n)}static handleClickFromNewComponentLand(e){y.invokeFirstAction(e)}static invokeFirstAction(e){const t=y.linkActions(e);return!!t.length&&(t[0].handler.call(null),!0)}static linkHandlerSetting(){return I||(I=e.Settings.Settings.instance().createSetting("openLinkHandler",k(h.auto))),I}static registerLinkHandler(e,t){S.set(e,t),F.instance().update()}static unregisterLinkHandler(e){S.delete(e),F.instance().update()}static uiLocation(e){const t=y.linkInfo(e);return t?t.uiLocation:null}static linkActions(n){const i=[];if(!n)return i;let o="",s=null;if(n.uiLocation)s=n.uiLocation,o=s.uiSourceCode.contentURL();else if(n.url){o=n.url;const t=c.Workspace.WorkspaceImpl.instance().uiSourceCodeForURL(o)||c.Workspace.WorkspaceImpl.instance().uiSourceCodeForURL(e.ParsedURL.ParsedURL.urlWithoutHash(o));s=t?t.uiLocation(n.lineNumber||0,n.columnNumber||0):null}const l=o?r.ResourceUtils.resourceForURL(o):null,d=s?s.uiSourceCode:l,u=n.revealable||s||l;if(u){const t=e.Revealer.revealDestination(u);i.push({section:"reveal",title:t?k(h.revealInS,{PH1:t}):k(h.reveal),handler:()=>e.Revealer.reveal(u)})}if(d){const e=s?s.lineNumber:n.lineNumber||0;for(const t of S.keys()){const n=S.get(t);if(!n)continue;const o={section:"reveal",title:k(h.openUsingS,{PH1:t}),handler:n.bind(null,d,e)};t===y.linkHandlerSetting().get()?i.unshift(o):i.push(o)}}if((l||n.url)&&(i.push({section:"reveal",title:a.UIUtils.openLinkExternallyLabel(),handler:()=>t.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(o)}),i.push({section:"clipboard",title:a.UIUtils.copyLinkAddressLabel(),handler:()=>t.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(o)})),s&&s.uiSourceCode){const e=s.uiSourceCode;i.push({section:"clipboard",title:a.UIUtils.copyFileNameLabel(),handler:()=>t.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(e.displayName())})}return i}}var x;let T,U;!function(e){let t;!function(e){e.LinkIconChanged="LinkIconChanged"}(t=e.Events||(e.Events={}))}(x||(x={}));class N{static instance(e={forceNew:null}){const{forceNew:t}=e;return T&&!t||(T=new N),T}appendApplicableItems(e,t,n){let i=n;for(;i&&!f.get(i);)i=i.parentNodeOrShadowHost();const o=i,r=y.linkInfo(o);if(!r)return;const a=y.linkActions(r);for(const e of a)t.section(e.section).appendItem(e.title,e.handler)}}class F{element;constructor(){this.element=document.createElement("select"),this.element.classList.add("chrome-select"),this.element.addEventListener("change",this.onChange.bind(this),!1),this.update()}static instance(e={forceNew:null}){const{forceNew:t}=e;return U&&!t||(U=new F),U}update(){this.element.removeChildren();const e=[...S.keys()];e.unshift(k(h.auto));for(const t of e){const e=document.createElement("option");e.textContent=t,e.selected=t===y.linkHandlerSetting().get(),this.element.appendChild(e)}this.element.disabled=e.length<=1}onChange(e){if(!e.target)return;const t=e.target.value;y.linkHandlerSetting().set(t)}settingElement(){return a.SettingsUI.createCustomSetting(k(h.linkHandling),this.element)}}let D,R=!1;R||(R=!0,window.addEventListener("linkifieractivated",(function(e){const t=e;y.handleClickFromNewComponentLand(t.data)})));class H{static instance(e={forceNew:null}){const{forceNew:t}=e;return D&&!t||(D=new H),D}appendApplicableItems(e,n,i){const r=i,s=r.contentURL();if(s){n.revealSection().appendItem(a.UIUtils.openLinkExternallyLabel(),(()=>t.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(s.endsWith(":formatted")?s.slice(0,s.lastIndexOf(":")):s)));for(const e of S.keys()){const t=S.get(e);t&&n.revealSection().appendItem(k(h.openUsingS,{PH1:e}),t.bind(null,r,0))}r instanceof o.NetworkRequest.NetworkRequest||(n.clipboardSection().appendItem(a.UIUtils.copyLinkAddressLabel(),(()=>t.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(s))),n.clipboardSection().appendItem(a.UIUtils.copyFileNameLabel(),(()=>t.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(r.displayName()))))}}}var M=Object.freeze({__proto__:null,Linkifier:y,get LinkDecorator(){return x},LinkContextMenuProvider:N,LinkHandlerSettingUI:F,ContentProviderContextMenuProvider:H});const B=new CSSStyleSheet;B.replaceSync(":host{display:inline}.stack-preview-async-description{padding:3px 0 1px;font-style:italic}.stack-preview-container .ignore-list-link{opacity:60%}.stack-preview-container>tr{height:16px;line-height:16px}.stack-preview-container td{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.stack-preview-container .function-name{max-width:80em}.stack-preview-container:not(.show-hidden-rows)>tr.hidden-row{display:none}.stack-preview-container>tr.show-all-link{font-style:italic}.stack-preview-container.show-hidden-rows>tr.show-all-link{display:none}\n/*# sourceURL=jsUtils.css */\n");const A={removeFromIgnore:"Remove from ignore list",addToIgnore:"Add script to ignore list",showSMoreFrames:"{n, plural, =1 {Show # more frame} other {Show # more frames}}",unknownSource:"unknown"},P=n.i18n.registerUIStrings("ui/legacy/components/utils/JSPresentationUtils.ts",A),E=n.i18n.getLocalizedString.bind(void 0,P);function W(e,t){const n=new a.ContextMenu.ContextMenu(t);t.consume(!0);const i=y.uiLocation(e);i&&r.IgnoreListManager.IgnoreListManager.instance().canIgnoreListUISourceCode(i.uiSourceCode)&&(r.IgnoreListManager.IgnoreListManager.instance().isIgnoreListedUISourceCode(i.uiSourceCode)?n.debugSection().appendItem(E(A.removeFromIgnore),(()=>r.IgnoreListManager.IgnoreListManager.instance().unIgnoreListUISourceCode(i.uiSourceCode))):n.debugSection().appendItem(E(A.addToIgnore),(()=>r.IgnoreListManager.IgnoreListManager.instance().ignoreListUISourceCode(i.uiSourceCode)))),n.appendApplicableItems(t),n.show()}function _(t,n,i,o,s){const c=[];let l=0;if(s){const t=new e.Throttler.Throttler(100);i.setLiveLocationUpdateCallback((()=>t.schedule((async()=>function(e,t){let n=0,i=t.length;for(let e=t.length-1;e>=0;e--){const o=t[e];if("link"in o&&o.link){const e=y.uiLocation(o.link);e&&r.IgnoreListManager.IgnoreListManager.instance().isIgnoreListedUISourceCode(e.uiSourceCode)&&(o.ignoreListHide=!0),(o.rowCountHide||o.ignoreListHide)&&n++}"asyncDescription"in o&&(n>0&&n===i-e-1&&(t[e+1].rowCountHide?o.rowCountHide=!0:o.ignoreListHide=!0),i=e,n=0)}e(t)}(s,c)))))}function d(e,t){let s=null;t&&(s={asyncDescription:a.UIUtils.asyncStackTraceLabel(e.description,t),ignoreListHide:!1,rowCountHide:!1},c.push(s));let d=0;for(const t of e.callFrames){l++;const s=l>30&&e.callFrames.length>31;let u=!1;const m=a.UIUtils.beautifyFunctionName(t.functionName),p=i.maybeLinkifyConsoleCallFrame(n,t,{tabStop:Boolean(o),className:void 0,columnNumber:void 0,inlineFrameIndex:0});if(p){p.addEventListener("contextmenu",W.bind(null,p));const e=y.uiLocation(p);e&&r.IgnoreListManager.IgnoreListManager.instance().isIgnoreListedUISourceCode(e.uiSourceCode)&&(u=!0),p.textContent&&"​"!==p.textContent||(p.textContent=E(A.unknownSource))}(s||u)&&++d,c.push({functionName:m,link:p,ignoreListHide:u,rowCountHide:s})}s&&d>0&&d===e.callFrames.length&&(c[1].rowCountHide?s.rowCountHide=!0:s.ignoreListHide=!0)}d(t);let u=t.callFrames;for(let e=t.parent;e;e=e.parent)e.callFrames.length&&d(e,u),u=e.callFrames;return c}function z(e,t){e.removeChildren();let n=0;const i=[];for(const o of t){const t=e.createChild("tr");"asyncDescription"in o?(t.createChild("td").textContent="\n",t.createChild("td","stack-preview-async-description").textContent=o.asyncDescription,t.createChild("td"),t.createChild("td")):(t.createChild("td").textContent="\n",t.createChild("td","function-name").textContent=o.functionName,t.createChild("td").textContent=" @ ",o.link&&(t.createChild("td").appendChild(o.link),i.push(o.link)),(o.rowCountHide||o.ignoreListHide)&&++n),(o.rowCountHide||o.ignoreListHide)&&t.classList.add("hidden-row"),e.appendChild(t)}if(n){const t=e.createChild("tr","show-all-link");t.createChild("td").textContent="\n";const i=t.createChild("td");i.colSpan=4;const o=i.createChild("span","link");o.textContent=E(A.showSMoreFrames,{n:n}),o.addEventListener("click",(()=>{e.classList.add("show-hidden-rows")}),!1)}return i}var j=Object.freeze({__proto__:null,buildStackTraceRows:_,buildStackTracePreviewContents:function(e,t,n={stackTrace:void 0,tabStops:void 0}){const{stackTrace:i,tabStops:o}=n,r=document.createElement("span");r.classList.add("monospace"),r.style.display="inline-block";const s=a.Utils.createShadowRootWithCoreStyles(r,{cssFile:[B],delegatesFocus:void 0}).createChild("table","stack-preview-container");if(!i)return{element:r,links:[]};const c=z.bind(null,s);return{element:r,links:z(s,_(i,e,t,o,c))}}});var O=Object.freeze({__proto__:null,reload:function(){a.DockController.DockController.instance().canDock()&&"undocked"===a.DockController.DockController.instance().dockSide()&&t.InspectorFrontendHost.InspectorFrontendHostInstance.setIsDocked(!0,(function(){})),t.InspectorFrontendHost.InspectorFrontendHostInstance.reattach((()=>window.location.reload()))}});const $={websocketDisconnected:"WebSocket disconnected"},K=n.i18n.registerUIStrings("ui/legacy/components/utils/TargetDetachedDialog.ts",$),q=n.i18n.getLocalizedString.bind(void 0,K);class J extends o.SDKModel.SDKModel{static hideCrashedDialog;constructor(e){super(e),e.registerInspectorDispatcher(this),e.inspectorAgent().invoke_enable(),e.parentTarget()?.type()===o.Target.Type.Browser&&J.hideCrashedDialog&&(J.hideCrashedDialog.call(null),J.hideCrashedDialog=null)}detached({reason:e}){a.RemoteDebuggingTerminatedScreen.RemoteDebuggingTerminatedScreen.show(e)}static webSocketConnectionLost(){a.RemoteDebuggingTerminatedScreen.RemoteDebuggingTerminatedScreen.show(q($.websocketDisconnected))}targetCrashed(){if(J.hideCrashedDialog)return;const e=this.target().parentTarget();if(e&&e.type()!==o.Target.Type.Browser)return;const t=new a.Dialog.Dialog;t.setSizeBehavior("MeasureContent"),t.addCloseButton(),t.setDimmed(!0),J.hideCrashedDialog=t.hide.bind(t),new a.TargetCrashedScreen.TargetCrashedScreen((()=>{J.hideCrashedDialog=null})).show(t.contentElement),t.show()}targetReloadedAfterCrash(){this.target().runtimeAgent().invoke_runIfWaitingForDebugger(),J.hideCrashedDialog&&(J.hideCrashedDialog.call(null),J.hideCrashedDialog=null)}}o.SDKModel.SDKModel.register(J,{capabilities:o.Target.Capability.Inspector,autostart:!0});var V=Object.freeze({__proto__:null,TargetDetachedDialog:J});export{g as ImagePreview,j as JSPresentationUtils,M as Linkifier,O as Reload,V as TargetDetachedDialog};
