import*as t from"../../../../core/common/common.js";import*as e from"../../../../core/host/host.js";import*as o from"../../../../core/i18n/i18n.js";import*as s from"../../../../core/platform/platform.js";import*as r from"../../../../core/root/root.js";import*as i from"../../legacy.js";import*as a from"../../../../core/sdk/sdk.js";import*as n from"../../../components/icon_button/icon_button.js";const l={noContrastInformationAvailable:"No contrast information available",contrastRatio:"Contrast ratio",showMore:"Show more",pickBackgroundColor:"Pick background color",toggleBackgroundColorPicker:"Toggle background color picker",useSuggestedColorStoFixLow:"Use suggested color {PH1}to fix low contrast",apca:"APCA",aa:"AA",placeholderWithColon:": {PH1}",aaa:"AAA",showLess:"Show less"},c=o.i18n.registerUIStrings("ui/legacy/components/color_picker/ContrastDetails.ts",l),h=o.i18n.getLocalizedString.bind(void 0,c);class d extends t.ObjectWrapper.ObjectWrapper{contrastInfo;elementInternal;toggleMainColorPicker;expandedChangedCallback;colorSelectedCallback;expandedInternal;passesAA;contrastUnknown;visibleInternal;noContrastInfoAvailable;contrastValueBubble;contrastValue;contrastValueBubbleIcons;expandButton;expandedDetails;contrastThresholds;contrastAA;contrastPassFailAA;contrastAAA;contrastPassFailAAA;contrastAPCA;contrastPassFailAPCA;chooseBgColor;bgColorPickerButton;bgColorPickedBound;bgColorSwatch;constructor(t,e,o,s,r){super(),this.contrastInfo=t,this.elementInternal=e.createChild("div","spectrum-contrast-details collapsed"),this.toggleMainColorPicker=o,this.expandedChangedCallback=s,this.colorSelectedCallback=r,this.expandedInternal=!1,this.passesAA=!0,this.contrastUnknown=!1,this.visibleInternal=!1,this.noContrastInfoAvailable=e.createChild("div","no-contrast-info-available"),this.noContrastInfoAvailable.textContent=h(l.noContrastInformationAvailable),this.noContrastInfoAvailable.classList.add("hidden");const a=this.elementInternal.createChild("div");a.addEventListener("click",this.topRowClicked.bind(this));const n=a.createChild("div","container");i.UIUtils.createTextChild(n,h(l.contrastRatio)),this.contrastValueBubble=n.createChild("span","contrast-details-value"),this.contrastValue=this.contrastValueBubble.createChild("span"),this.contrastValueBubbleIcons=[],this.contrastValueBubbleIcons.push(this.contrastValueBubble.appendChild(i.Icon.Icon.create("smallicon-checkmark-square"))),this.contrastValueBubbleIcons.push(this.contrastValueBubble.appendChild(i.Icon.Icon.create("smallicon-checkmark-behind"))),this.contrastValueBubbleIcons.push(this.contrastValueBubble.appendChild(i.Icon.Icon.create("smallicon-no"))),this.contrastValueBubbleIcons.forEach((t=>t.addEventListener("click",(t=>{d.showHelp(),t.consume(!1)}))));const c=new i.Toolbar.Toolbar("expand",n);this.expandButton=new i.Toolbar.ToolbarButton(h(l.showMore),"smallicon-expand-more"),this.expandButton.addEventListener(i.Toolbar.ToolbarButton.Events.Click,this.expandButtonClicked.bind(this)),i.ARIAUtils.setExpanded(this.expandButton.element,!1),c.appendToolbarItem(this.expandButton),this.expandedDetails=this.elementInternal.createChild("div","expanded-details"),i.ARIAUtils.setControls(this.expandButton.element,this.expandedDetails),this.contrastThresholds=this.expandedDetails.createChild("div","contrast-thresholds"),this.contrastAA=this.contrastThresholds.createChild("div","contrast-threshold"),this.contrastPassFailAA=this.contrastAA.createChild("div","contrast-pass-fail"),this.contrastAAA=this.contrastThresholds.createChild("div","contrast-threshold"),this.contrastPassFailAAA=this.contrastAAA.createChild("div","contrast-pass-fail"),this.contrastAPCA=this.contrastThresholds.createChild("div","contrast-threshold"),this.contrastPassFailAPCA=this.contrastAPCA.createChild("div","contrast-pass-fail"),this.chooseBgColor=this.expandedDetails.createChild("div","contrast-choose-bg-color"),this.chooseBgColor.textContent=h(l.pickBackgroundColor);const u=this.expandedDetails.createChild("div","background-color"),g=new i.Toolbar.Toolbar("spectrum-eye-dropper",u);this.bgColorPickerButton=new i.Toolbar.ToolbarToggle(h(l.toggleBackgroundColorPicker),"largeicon-eyedropper"),this.bgColorPickerButton.addEventListener(i.Toolbar.ToolbarButton.Events.Click,this.toggleBackgroundColorPickerInternal.bind(this,void 0,!0)),g.appendToolbarItem(this.bgColorPickerButton),this.bgColorPickedBound=this.bgColorPicked.bind(this),this.bgColorSwatch=new p(u),this.contrastInfo.addEventListener("ContrastInfoUpdated",this.update.bind(this))}showNoContrastInfoAvailableMessage(){this.noContrastInfoAvailable.classList.remove("hidden")}hideNoContrastInfoAvailableMessage(){this.noContrastInfoAvailable.classList.add("hidden")}computeSuggestedColor(e){const o=this.contrastInfo.color(),s=this.contrastInfo.bgColor();if(!o||!s)return;if("APCA"===e){const e=this.contrastInfo.contrastRatioAPCAThreshold();if(null===e)return;return t.Color.Color.findFgColorForContrastAPCA(o,s,e+1)}const r=this.contrastInfo.contrastRatioThreshold(e);return r?t.Color.Color.findFgColorForContrast(o,s,r+.1):void 0}onSuggestColor(t){const e=this.computeSuggestedColor(t);e&&this.colorSelectedCallback(e)}createFixColorButton(e,o){const s=e.createChild("button","contrast-fix-button"),r=this.contrastInfo.colorFormat(),a=r&&r!==t.Color.Format.Nickname&&r!==t.Color.Format.Original?r:t.Color.Format.HEXA,n=o.asString(a),c=n?n+" ":"",d=h(l.useSuggestedColorStoFixLow,{PH1:c});return i.ARIAUtils.setAccessibleName(s,d),i.Tooltip.Tooltip.install(s,d),s.tabIndex=0,s.style.backgroundColor=c,s}update(){if(this.contrastInfo.isNull())return this.showNoContrastInfoAvailableMessage(),void this.setVisible(!1);this.setVisible(!0),this.hideNoContrastInfoAvailableMessage();const t=r.Runtime.experiments.isEnabled("APCA"),e=this.contrastInfo.color(),o=this.contrastInfo.bgColor();if(t){const t=this.contrastInfo.contrastRatioAPCA();if(null===t||!o||!e)return this.contrastUnknown=!0,this.contrastValue.textContent="",this.contrastValueBubble.classList.add("contrast-unknown"),this.chooseBgColor.classList.remove("hidden"),this.contrastThresholds.classList.add("hidden"),void this.showNoContrastInfoAvailableMessage();this.contrastUnknown=!1,this.chooseBgColor.classList.add("hidden"),this.contrastThresholds.classList.remove("hidden"),this.contrastValueBubble.classList.remove("contrast-unknown"),this.contrastValue.textContent=`${s.NumberUtilities.floor(t,2)}%`;const r=this.contrastInfo.contrastRatioAPCAThreshold(),a=!(!t||!r)&&Math.abs(t)>=r;this.contrastPassFailAPCA.removeChildren();const n=this.contrastPassFailAPCA.createChild("span","contrast-link-label");if(n.textContent=h(l.apca),null!==r&&(this.contrastPassFailAPCA.createChild("span").textContent=`: ${r.toFixed(2)}%`),a)this.contrastPassFailAPCA.appendChild(i.Icon.Icon.create("smallicon-checkmark-square"));else{this.contrastPassFailAPCA.appendChild(i.Icon.Icon.create("smallicon-no"));const t=this.computeSuggestedColor("APCA");if(t){this.createFixColorButton(this.contrastPassFailAPCA,t).addEventListener("click",(()=>this.onSuggestColor("APCA")))}}return n.addEventListener("click",(t=>d.showHelp())),this.elementInternal.classList.toggle("contrast-fail",!a),void this.contrastValueBubble.classList.toggle("contrast-aa",a)}const a=this.contrastInfo.contrastRatio();if(!a||!o||!e)return this.contrastUnknown=!0,this.contrastValue.textContent="",this.contrastValueBubble.classList.add("contrast-unknown"),this.chooseBgColor.classList.remove("hidden"),this.contrastThresholds.classList.add("hidden"),void this.showNoContrastInfoAvailableMessage();this.contrastUnknown=!1,this.chooseBgColor.classList.add("hidden"),this.contrastThresholds.classList.remove("hidden"),this.contrastValueBubble.classList.remove("contrast-unknown"),this.contrastValue.textContent=String(s.NumberUtilities.floor(a,2)),this.bgColorSwatch.setColors(e,o);const n=this.contrastInfo.contrastRatioThreshold("aa")||0;this.passesAA=(this.contrastInfo.contrastRatio()||0)>=n,this.contrastPassFailAA.removeChildren();const c=this.contrastPassFailAA.createChild("span","contrast-link-label");if(c.textContent=h(l.aa),this.contrastPassFailAA.createChild("span").textContent=h(l.placeholderWithColon,{PH1:n.toFixed(1)}),this.passesAA)this.contrastPassFailAA.appendChild(i.Icon.Icon.create("smallicon-checkmark-square"));else{this.contrastPassFailAA.appendChild(i.Icon.Icon.create("smallicon-no"));const t=this.computeSuggestedColor("aa");if(t){this.createFixColorButton(this.contrastPassFailAA,t).addEventListener("click",(()=>this.onSuggestColor("aa")))}}const p=this.contrastInfo.contrastRatioThreshold("aaa")||0,u=(this.contrastInfo.contrastRatio()||0)>=p;this.contrastPassFailAAA.removeChildren();const g=this.contrastPassFailAAA.createChild("span","contrast-link-label");if(g.textContent=h(l.aaa),this.contrastPassFailAAA.createChild("span").textContent=h(l.placeholderWithColon,{PH1:p.toFixed(1)}),u)this.contrastPassFailAAA.appendChild(i.Icon.Icon.create("smallicon-checkmark-square"));else{this.contrastPassFailAAA.appendChild(i.Icon.Icon.create("smallicon-no"));const t=this.computeSuggestedColor("aaa");if(t){this.createFixColorButton(this.contrastPassFailAAA,t).addEventListener("click",(()=>this.onSuggestColor("aaa")))}}[c,g].forEach((t=>t.addEventListener("click",(()=>d.showHelp())))),this.elementInternal.classList.toggle("contrast-fail",!this.passesAA),this.contrastValueBubble.classList.toggle("contrast-aa",this.passesAA),this.contrastValueBubble.classList.toggle("contrast-aaa",u)}static showHelp(){e.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(i.UIUtils.addReferrerToURL("https://web.dev/color-and-contrast-accessibility/"))}setVisible(t){this.visibleInternal=t,this.elementInternal.classList.toggle("hidden",!t)}visible(){return this.visibleInternal}element(){return this.elementInternal}expandButtonClicked(){const t=this.contrastValueBubble.getComponentSelection();t&&t.empty(),this.toggleExpanded()}topRowClicked(t){const e=this.contrastValueBubble.getComponentSelection();e&&e.empty(),this.toggleExpanded(),t.consume(!0)}toggleExpanded(){this.expandedInternal=!this.expandedInternal,i.ARIAUtils.setExpanded(this.expandButton.element,this.expandedInternal),this.elementInternal.classList.toggle("collapsed",!this.expandedInternal),this.expandedInternal?(this.toggleMainColorPicker(!1),this.expandButton.setGlyph("smallicon-expand-less"),this.expandButton.setTitle(h(l.showLess)),this.contrastUnknown&&this.toggleBackgroundColorPickerInternal(!0)):(this.toggleBackgroundColorPickerInternal(!1),this.expandButton.setGlyph("smallicon-expand-more"),this.expandButton.setTitle(h(l.showMore))),this.expandedChangedCallback()}collapse(){this.elementInternal.classList.remove("expanded"),this.toggleBackgroundColorPickerInternal(!1),this.toggleMainColorPicker(!1)}expanded(){return this.expandedInternal}backgroundColorPickerEnabled(){return this.bgColorPickerButton.toggled()}toggleBackgroundColorPicker(t){this.toggleBackgroundColorPickerInternal(t,!1)}toggleBackgroundColorPickerInternal(t,o=!0){void 0===t&&(t=!this.bgColorPickerButton.toggled()),this.bgColorPickerButton.setToggled(t),o&&this.dispatchEventToListeners("BackgroundColorPickerWillBeToggled",t),e.InspectorFrontendHost.InspectorFrontendHostInstance.setEyeDropperActive(t),t?e.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(e.InspectorFrontendHostAPI.Events.EyeDropperPickedColor,this.bgColorPickedBound):e.InspectorFrontendHost.InspectorFrontendHostInstance.events.removeEventListener(e.InspectorFrontendHostAPI.Events.EyeDropperPickedColor,this.bgColorPickedBound)}bgColorPicked({data:o}){const s=[o.r,o.g,o.b,(o.a/2.55|0)/100],r=t.Color.Color.fromRGBA(s);this.contrastInfo.setBgColor(r),this.toggleBackgroundColorPickerInternal(!1),e.InspectorFrontendHost.InspectorFrontendHostInstance.bringToFront()}}class p{parentElement;swatchElement;swatchInnerElement;textPreview;constructor(t){this.parentElement=t,this.swatchElement=t.createChild("span","swatch contrast swatch-inner-white"),this.swatchInnerElement=this.swatchElement.createChild("span","swatch-inner"),this.textPreview=this.swatchElement.createChild("div","text-preview"),this.textPreview.textContent="Aa"}setColors(e,o){this.textPreview.style.color=e.asString(t.Color.Format.RGBA),this.swatchInnerElement.style.backgroundColor=o.asString(t.Color.Format.RGBA),this.swatchElement.classList.toggle("swatch-inner-white",o.hsla()[2]>.9)}}var u=Object.freeze({__proto__:null,ContrastDetails:d,Swatch:p});class g extends t.ObjectWrapper.ObjectWrapper{isNullInternal;contrastRatioInternal;contrastRatioAPCAInternal;contrastRatioThresholds;contrastRationAPCAThreshold;fgColor;bgColorInternal;colorFormatInternal;constructor(e){if(super(),this.isNullInternal=!0,this.contrastRatioInternal=null,this.contrastRatioAPCAInternal=null,this.contrastRatioThresholds=null,this.contrastRationAPCAThreshold=0,this.fgColor=null,this.bgColorInternal=null,!e)return;if(!e.computedFontSize||!e.computedFontWeight||!e.backgroundColors||1!==e.backgroundColors.length)return;this.isNullInternal=!1,this.contrastRatioThresholds=t.ColorUtils.getContrastThreshold(e.computedFontSize,e.computedFontWeight),this.contrastRationAPCAThreshold=t.ColorUtils.getAPCAThreshold(e.computedFontSize,e.computedFontWeight);const o=e.backgroundColors[0],s=t.Color.Color.parse(o);s&&this.setBgColorInternal(s)}isNull(){return this.isNullInternal}setColor(t,e){this.fgColor=t,this.colorFormatInternal=e,this.updateContrastRatio(),this.dispatchEventToListeners("ContrastInfoUpdated")}colorFormat(){return this.colorFormatInternal}color(){return this.fgColor}contrastRatio(){return this.contrastRatioInternal}contrastRatioAPCA(){return this.contrastRatioAPCAInternal}contrastRatioAPCAThreshold(){return this.contrastRationAPCAThreshold}setBgColor(t){this.setBgColorInternal(t),this.dispatchEventToListeners("ContrastInfoUpdated")}setBgColorInternal(e){if(this.bgColorInternal=e,!this.fgColor)return;const o=this.fgColor.rgba();if(e.hasAlpha()){const s=t.ColorUtils.blendColors(e.rgba(),o);this.bgColorInternal=new t.Color.Color(s,t.Color.Format.RGBA)}this.contrastRatioInternal=t.ColorUtils.contrastRatio(o,this.bgColorInternal.rgba()),this.contrastRatioAPCAInternal=t.ColorUtils.contrastRatioAPCA(this.fgColor.rgba(),this.bgColorInternal.rgba())}bgColor(){return this.bgColorInternal}updateContrastRatio(){this.bgColorInternal&&this.fgColor&&(this.contrastRatioInternal=t.ColorUtils.contrastRatio(this.fgColor.rgba(),this.bgColorInternal.rgba()),this.contrastRatioAPCAInternal=t.ColorUtils.contrastRatioAPCA(this.fgColor.rgba(),this.bgColorInternal.rgba()))}contrastRatioThreshold(t){return this.contrastRatioThresholds?this.contrastRatioThresholds[t]:null}}var m=Object.freeze({__proto__:null,ContrastInfo:g});class C{contrastInfo;visible;contrastRatioSVG;contrastRatioLines;width;height;contrastRatioLineBuilder;contrastRatioLinesThrottler;drawContrastRatioLinesBound;constructor(e,o){this.contrastInfo=e,this.visible=!1,this.contrastRatioSVG=i.UIUtils.createSVGChild(o,"svg","spectrum-contrast-container fill"),this.contrastRatioLines=new Map,r.Runtime.experiments.isEnabled("APCA")?this.contrastRatioLines.set("APCA",i.UIUtils.createSVGChild(this.contrastRatioSVG,"path","spectrum-contrast-line")):(this.contrastRatioLines.set("aa",i.UIUtils.createSVGChild(this.contrastRatioSVG,"path","spectrum-contrast-line")),this.contrastRatioLines.set("aaa",i.UIUtils.createSVGChild(this.contrastRatioSVG,"path","spectrum-contrast-line"))),this.width=0,this.height=0,this.contrastRatioLineBuilder=new b(this.contrastInfo),this.contrastRatioLinesThrottler=new t.Throttler.Throttler(0),this.drawContrastRatioLinesBound=this.drawContrastRatioLines.bind(this),this.contrastInfo.addEventListener("ContrastInfoUpdated",this.update.bind(this))}update(){this.visible&&!this.contrastInfo.isNull()&&(r.Runtime.experiments.isEnabled("APCA")&&null===this.contrastInfo.contrastRatioAPCA()||this.contrastInfo.contrastRatio()&&this.contrastRatioLinesThrottler.schedule(this.drawContrastRatioLinesBound))}setDimensions(t,e){this.width=t,this.height=e,this.update()}setVisible(t){this.visible=t,this.contrastRatioSVG.classList.toggle("hidden",!t),this.update()}async drawContrastRatioLines(){for(const[t,e]of this.contrastRatioLines){const o=this.contrastRatioLineBuilder.drawContrastRatioLine(this.width,this.height,t);o?e.setAttribute("d",o):e.removeAttribute("d")}}}class b{contrastInfo;constructor(t){this.contrastInfo=t}drawContrastRatioLine(e,o,s){const i=r.Runtime.experiments.isEnabled("APCA"),a=i?this.contrastInfo.contrastRatioAPCAThreshold():this.contrastInfo.contrastRatioThreshold(s);if(!e||!o||null===a)return null;const n=.02,l=this.contrastInfo.color(),c=this.contrastInfo.bgColor();if(!l||!c)return null;const h=l.rgba(),d=l.hsva(),p=c.rgba(),u=t.ColorUtils.luminance(p);let g=t.ColorUtils.blendColors(h,p);const m=t.ColorUtils.luminance(g)>u,C=i?t.ColorUtils.desiredLuminanceAPCA(u,a,m):t.Color.Color.desiredLuminance(u,a,m);if(i&&Math.abs(Math.round(t.ColorUtils.contrastRatioByLuminanceAPCA(C,u)))<a)return null;let b=d[2],v=0;const f=[d[0],0,0,d[3]];let x=[];const A=[];t.Color.Color.hsva2rgba(f,A),g=t.ColorUtils.blendColors(A,p);let w,E=e=>t.ColorUtils.luminance(t.ColorUtils.blendColors(t.Color.Color.fromHSVA(e).rgba(),p));for(r.Runtime.experiments.isEnabled("APCA")&&(E=e=>t.ColorUtils.luminanceAPCA(t.ColorUtils.blendColors(t.Color.Color.fromHSVA(e).rgba(),p))),w=0;w<1.02;w+=n){w=Math.min(1,w),f[1]=w,f[2]=b+v*n;const s=t.Color.Color.approachColorValue(f,p,2,C,E);if(null===s)break;v=0===w?0:(s-b)/n,b=s,x.push(x.length?"L":"M"),x.push((w*e).toFixed(2)),x.push(((1-s)*o).toFixed(2))}return w<1.02&&(w-=n,f[2]=1,w=t.Color.Color.approachColorValue(f,p,1,C,E),null!==w&&(x=x.concat(["L",(w*e).toFixed(2),"-0.1"]))),0===x.length?null:x.join(" ")}}var v=Object.freeze({__proto__:null,ContrastOverlay:C,ContrastRatioLineBuilder:b});const f=new CSSStyleSheet;f.replaceSync(':host{width:232px;height:319px;user-select:none;overflow:hidden}:selection{background-color:var(--color-primary);color:var(--color-background)}.spectrum-color{position:relative;width:232px;height:127px;border-radius:2px 2px 0 0;overflow:hidden;flex:none}.spectrum-dragger,.spectrum-slider{user-select:none}.spectrum-dragger{border-radius:12px;height:12px;width:12px;border:1px solid var(--color-background);cursor:pointer;position:absolute;top:0;left:0;background:var(--color-background-inverted);box-shadow:var(--drop-shadow)}.spectrum-slider{position:absolute;top:-1px;cursor:pointer;width:13px;height:13px;border-radius:13px;background-color:var(--color-background-elevation-1);box-shadow:var(--drop-shadow)}.spectrum-color:focus .spectrum-dragger{border:1px solid var(--legacy-accent-color-hover)}.spectrum-tools{position:relative;height:110px;width:100%;flex:none}.spectrum-hue{top:16px;background:linear-gradient(to left,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red 100%)}.spectrum-alpha{top:35px;background-image:var(--image-file-checker);background-size:12px 11px}.spectrum-alpha-background{height:100%;border-radius:2px}.spectrum-alpha,.spectrum-hue{position:absolute;left:86px;width:130px;height:11px;border-radius:2px}.spectrum-alpha:focus-visible .spectrum-slider,.spectrum-hue:focus-visible .spectrum-slider{border:1px solid var(--legacy-accent-color-hover);width:14px;height:14px;border-radius:14px}.-theme-preserve,.spectrum-sat{background-image:linear-gradient(to right,#fff,rgb(204 154 129 / 0%))}.-theme-preserve,.spectrum-val{background-image:linear-gradient(to top,#000,rgb(204 154 129 / 0%))}.spectrum-contrast-details{position:relative;background-color:var(--color-background);width:100%;height:83px;top:0;font-size:13px;color:var(--color-text-primary);border-top:var(--legacy-divider-border);line-height:initial;overflow:hidden;flex:none}.spectrum-contrast-details.collapsed{height:36px;flex:none}.spectrum-contrast-details div.toolbar.expand{position:absolute;right:6px;top:6px;margin:0}.spectrum-contrast-details.visible{display:initial}.spectrum-contrast-details div.container{margin:10px}.spectrum-contrast-details .expanded-details{display:flex;margin:12px 12px 0 4px}.spectrum-contrast-details.collapsed .expanded-details{display:none}.contrast-pass-fail{margin-left:.5em;display:flex;align-items:center}.contrast-choose-bg-color{margin:8px 0 0 5px;font-style:italic}.spectrum-contrast-details .contrast-choose-bg-color,.spectrum-contrast-details .contrast-thresholds{width:150px}.contrast-threshold:first-child{margin-bottom:5px}.contrast-fix-button{cursor:pointer;font-size:13px;padding:0;margin:0 0 0 10px;background:0;width:12px;height:12px;border:1px solid rgb(0 0 0 / 10%);display:inline-block;position:relative}.contrast-fix-button::after{content:" ";width:13px;height:13px;background-image:var(--image-file-ic_suggest_color);background-size:contain;position:absolute;left:5.5px;top:3.5px;background-color:var(--color-background);border-radius:50%}.contrast-fix-button:focus,.contrast-fix-button:hover{border:1px solid var(--legacy-accent-color-hover);transform:scale(1.2)}.contrast-link-label{cursor:pointer}.contrast-link-label:hover{text-decoration:underline}.spectrum-contrast-details .background-color{position:absolute;flex:none;right:12px}.spectrum-eye-dropper{width:32px;height:24px;position:relative;left:8px;top:17px;cursor:pointer}.spectrum-contrast-details .spectrum-eye-dropper{top:2px;right:34px;position:absolute;left:auto}.contrast-details-value{color:var(--color-text-primary);margin:1px 5px;user-select:text}.contrast-details-value [is=ui-icon]{display:none;margin-left:5px;background-color:var(--color-text-primary)}.spectrum-contrast-details .toolbar-state-on [is=ui-icon]{background-color:var(--color-text-secondary)}[is=ui-icon].smallicon-no{background-color:var(--color-accent-red)}.contrast-pass-fail span[is=ui-icon]{margin-left:5px}[is=ui-icon].smallicon-checkmark-behind,[is=ui-icon].smallicon-checkmark-square{background-color:var(--color-accent-green)}.spectrum-contrast-details .contrast-details-value.contrast-unknown{background-color:var(--color-background);color:var(--color-text-primary);width:3em;text-align:center}.contrast-details-value .smallicon-checkmark-behind{margin-left:-6px}.contrast-details-value .smallicon-checkmark-behind,.contrast-details-value .smallicon-checkmark-square,.contrast-details-value .smallicon-no{cursor:pointer}.contrast-details-value.contrast-aa .smallicon-checkmark-square,.contrast-details-value.contrast-aaa .smallicon-checkmark-behind,.spectrum-contrast-details.contrast-fail .contrast-details-value .smallicon-no{display:inline-block}.swatch{width:32px;height:32px;margin:0;position:absolute;top:15px;left:44px;background-image:var(--image-file-checker);border-radius:16px}.swatch-inner,.swatch-overlay{position:absolute;width:100%;height:100%;display:inline-block;border-radius:16px}.swatch-inner-white{border:1px solid var(--color-background-elevation-2)}.swatch-overlay{cursor:pointer;opacity:0%;padding:4px}.swatch-overlay:focus-visible,.swatch-overlay:hover{background-color:var(--color-background-inverted-opacity-30);opacity:100%}.swatch-overlay:active{background-color:var(--color-background-inverted-opacity-50)}[is=ui-icon].icon-mask.copy-color-icon{background-color:var(--color-background)}.spectrum-text{position:absolute;top:60px;left:16px}.spectrum-text-value{display:inline-block;width:40px;overflow:hidden;text-align:center;margin-right:6px;line-height:20px;padding:0;color:var(--color-text-primary);white-space:nowrap;box-shadow:var(--legacy-focus-ring-inactive-shadow)}.spectrum-text-label{letter-spacing:39.5px;margin-top:8px;display:block;color:var(--color-text-disabled);margin-left:16px;width:174px}.spectrum-text-hex>.spectrum-text-value{width:178px}.spectrum-text-hex>.spectrum-text-label{letter-spacing:normal;margin-left:0;text-align:center}.spectrum-switcher{border-radius:2px;height:20px;width:20px;padding:2px}.spectrum-display-switcher{top:72px;position:absolute;right:10px}.spectrum-switcher:hover{background-color:var(--color-background-elevation-2)}.spectrum-switcher:focus-visible{background-color:var(--legacy-focus-bg-color)}.spectrum-palette-container{border-top:var(--legacy-divider-border);position:relative;width:100%;padding:6px 24px 6px 6px;display:flex;flex-wrap:wrap}.spectrum-palette{display:flex;flex-wrap:wrap;width:198px}.spectrum-palette-color{width:12px;height:12px;flex:0 0 12px;border-radius:2px;margin:6px;cursor:pointer;position:relative;border:1px solid var(--color-details-hairline);background-position:-1px!important;z-index:14}.spectrum-palette-color-shadow{position:absolute;opacity:0%;margin:0;top:-5px;left:3px;border:0;border-radius:1px;width:11px;height:11px}.spectrum-palette-color:focus:not(.spectrum-shades-shown)>.spectrum-palette-color-shadow,.spectrum-palette-color:hover:not(.spectrum-shades-shown)>.spectrum-palette-color-shadow{opacity:20%}.spectrum-palette-color:focus:not(.spectrum-shades-shown)>.spectrum-palette-color-shadow:first-child,.spectrum-palette-color:hover:not(.spectrum-shades-shown)>.spectrum-palette-color-shadow:first-child{opacity:60%;top:-3px;left:1px}.palette-color-shades{position:absolute;background-color:var(--color-background);height:228px;width:28px;box-shadow:var(--drop-shadow);z-index:14;border-radius:2px;transform-origin:0 228px;margin-top:16px;margin-left:-8px}.spectrum-palette>.spectrum-palette-color.spectrum-shades-shown{z-index:15}.palette-color-shades>.spectrum-palette-color{margin:8px 0 0;margin-left:8px;width:12px}.spectrum-palette>.spectrum-palette-color{transition:transform .1s cubic-bezier(0, 0, .2, 1);will-change:transform;z-index:13}.palette-preview>.spectrum-palette-color{margin-top:1px}.spectrum-palette>.spectrum-palette-color.empty-color{border-color:transparent}.spectrum-palette-color:not(.has-material-shades):focus{border:1px solid var(--legacy-accent-color-hover);transform:scale(1.4)}.palette-color-shades>.spectrum-palette-color:not(.empty-color):hover,.spectrum-palette>.spectrum-palette-color:not(.empty-color):not(.has-material-shades):hover{transform:scale(1.15)}.add-color-toolbar{margin-left:-3px;margin-top:-1px}.spectrum-palette-switcher{right:10px;top:0;margin-top:9px;position:absolute}.palette-panel{width:100%;position:absolute;top:100%;display:flex;flex-direction:column;background-color:var(--color-background);z-index:14;transition:transform .2s cubic-bezier(0, 0, .2, 1),visibility 0s .2s;border-top:var(--legacy-divider-border);visibility:hidden}.palette-panel-showing>.palette-panel{transform:translateY(-100%);transition-delay:0s;visibility:visible}.palette-panel>div.toolbar{position:absolute;right:6px;top:6px}.palette-panel>div:not(.toolbar){flex:0 0 38px;border-bottom:var(--legacy-divider-border);padding:12px;line-height:14px;color:var(--color-text-primary)}.palette-panel>div.palette-title{font-size:14px;line-height:16px;color:var(--color-text-primary);flex-basis:40px}div.palette-preview{display:flex;cursor:pointer}.palette-preview-title{flex:0 0 84px}.palette-preview:focus-visible,.palette-preview:hover{background-color:var(--color-background-elevation-1)}.spectrum-overlay{z-index:13;visibility:hidden;background-color:hsl(0deg 0% 0% / 50%);opacity:0%;transition:opacity .1s cubic-bezier(0, 0, .2, 1),visibility 0s .1s}.palette-panel-showing>.spectrum-overlay{transition-delay:0s;visibility:visible;opacity:100%}.spectrum-contrast-container{width:100%;height:100%}.spectrum-contrast-line,:host-context(.-theme-with-dark-background) .spectrum-contrast-line{fill:none;stroke:#fff;opacity:70%;stroke-width:1.5px}.delete-color-toolbar{position:absolute;right:0;top:0;background-color:var(--color-background-elevation-1);visibility:hidden;z-index:3;width:36px;display:flex;align-items:center;padding-left:4px;bottom:2px;border-bottom-right-radius:2px}@keyframes showDeleteToolbar{from{opacity:0%}to{opacity:100%}}.delete-color-toolbar.dragging{visibility:visible;animation:showDeleteToolbar .1s 150ms cubic-bezier(0,0,.2,1) backwards}.delete-color-toolbar-active{background-color:var(--color-background-elevation-2);color:var(--color-background)}.swatch.contrast{width:30px;height:30px;position:absolute;top:0;right:0;left:auto;background-image:var(--image-file-checker);border-radius:15px;display:flex;align-items:center;justify-content:center}.swatch.contrast .swatch-overlay{padding:0}.background-color .text-preview{color:var(--color-background-inverted);font-size:16px;position:relative;padding-bottom:2px}.swatch.contrast [is=ui-icon]{margin:-2px}.no-contrast-info-available{border-top:var(--legacy-divider-border);position:relative;width:100%;padding:10px;justify-content:center;display:flex;flex-wrap:wrap}@media (forced-colors:active){:host{border:1px solid canvastext!important}.spectrum-color{forced-color-adjust:none}.spectrum-switcher:focus-visible,.spectrum-switcher:hover{forced-color-adjust:none;background-color:Highlight!important}:host-context(.-theme-with-dark-background) .spectrum-switcher{filter:unset}.spectrum-switcher:focus-visible svg,.spectrum-switcher:hover svg{fill:HighlightText}.swatch{forced-color-adjust:none}.swatch-inner,.swatch-inner-white,.swatch-overlay{border:1px solid ButtonText}.swatch-overlay:focus-visible,.swatch-overlay:hover{background-color:canvas!important}.spectrum-slider{forced-color-adjust:none;background-color:ButtonText!important;box-shadow:0 1px 4px 0 ButtonFace!important}}\n/*# sourceURL=spectrum.css */\n');const x={toggleColorPicker:"Toggle color picker",changeHue:"Change hue",changeAlpha:"Change alpha",hex:"HEX",changeColorFormat:"Change color format",previewPalettes:"Preview palettes",addToPalette:"Add to palette",colorPalettes:"Color Palettes",returnToColorPicker:"Return to color picker",colorS:"Color {PH1}",longclickOrLongpressSpaceToShow:"Long-click or long-press space to show alternate shades of {PH1}",removeColor:"Remove color",removeAllToTheRight:"Remove all to the right",clearPalette:"Clear palette",sInS:"{PH1} in {PH2}",copyColorToClipboard:"Copy color to clipboard",pressArrowKeysMessage:"Press arrow keys with or without modifiers to move swatch position. Arrow key with Shift key moves position largely, with Ctrl key it is less and with Alt key it is even less"},A=o.i18n.registerUIStrings("ui/legacy/components/color_picker/Spectrum.ts",x),w=o.i18n.getLocalizedString.bind(void 0,A),E=new WeakMap,k=new WeakMap;class I extends(t.ObjectWrapper.eventMixin(i.Widget.VBox)){colorElement;colorDragElement;dragX;dragY;colorPickerButton;swatch;hueElement;hueSlider;alphaElement;alphaElementBackground;alphaSlider;displayContainer;textValues;textLabels;hexContainer;hexValue;contrastInfo;contrastOverlay;contrastDetails;contrastDetailsBackgroundColorPickedToggledBound;palettes;palettePanel;palettePanelShowing;paletteSectionContainer;paletteContainer;shadesContainer;deleteIconToolbar;deleteButton;addColorToolbar;colorPickedBound;hsv;hueAlphaWidth;dragWidth;dragHeight;colorDragElementHeight;slideHelperWidth;numPaletteRowsShown;selectedColorPalette;customPaletteSetting;colorOffset;closeButton;paletteContainerMutable;shadesCloseHandler;dragElement;dragHotSpotX;dragHotSpotY;originalFormat;colorNameInternal;colorStringInternal;colorFormat;constructor(t){super(!0),this.contentElement.tabIndex=0,this.colorElement=this.contentElement.createChild("div","spectrum-color"),this.colorElement.tabIndex=0,this.setDefaultFocusedElement(this.colorElement),this.colorElement.addEventListener("keydown",this.onSliderKeydown.bind(this,m.bind(this)));const e=w(x.pressArrowKeysMessage);i.ARIAUtils.setAccessibleName(this.colorElement,e),i.ARIAUtils.markAsApplication(this.colorElement),this.colorDragElement=this.colorElement.createChild("div","spectrum-sat fill").createChild("div","spectrum-val fill").createChild("div","spectrum-dragger"),this.dragX=0,this.dragY=0;const o=this.contentElement.createChild("div","spectrum-tools"),r=new i.Toolbar.Toolbar("spectrum-eye-dropper",o);this.colorPickerButton=new i.Toolbar.ToolbarToggle(w(x.toggleColorPicker),"largeicon-eyedropper"),this.colorPickerButton.setToggled(!0),this.colorPickerButton.addEventListener(i.Toolbar.ToolbarButton.Events.Click,this.toggleColorPicker.bind(this,void 0)),r.appendToolbarItem(this.colorPickerButton),this.swatch=new D(o),this.hueElement=o.createChild("div","spectrum-hue"),this.hueElement.tabIndex=0,this.hueElement.addEventListener("keydown",this.onSliderKeydown.bind(this,u.bind(this))),i.ARIAUtils.setAccessibleName(this.hueElement,w(x.changeHue)),i.ARIAUtils.markAsSlider(this.hueElement,0,360),this.hueSlider=this.hueElement.createChild("div","spectrum-slider"),this.alphaElement=o.createChild("div","spectrum-alpha"),this.alphaElement.tabIndex=0,this.alphaElement.addEventListener("keydown",this.onSliderKeydown.bind(this,g.bind(this))),i.ARIAUtils.setAccessibleName(this.alphaElement,w(x.changeAlpha)),i.ARIAUtils.markAsSlider(this.alphaElement,0,1),this.alphaElementBackground=this.alphaElement.createChild("div","spectrum-alpha-background"),this.alphaSlider=this.alphaElement.createChild("div","spectrum-slider"),this.displayContainer=o.createChild("div","spectrum-text source-code"),i.ARIAUtils.markAsPoliteLiveRegion(this.displayContainer,!0),this.textValues=[];for(let t=0;t<4;++t){const t=i.UIUtils.createInput("spectrum-text-value");this.displayContainer.appendChild(t),t.maxLength=4,this.textValues.push(t),t.addEventListener("keydown",this.inputChanged.bind(this),!1),t.addEventListener("input",this.inputChanged.bind(this),!1),t.addEventListener("wheel",this.inputChanged.bind(this),!1),t.addEventListener("paste",this.pasted.bind(this),!1)}this.textLabels=this.displayContainer.createChild("div","spectrum-text-label"),this.hexContainer=o.createChild("div","spectrum-text spectrum-text-hex source-code"),i.ARIAUtils.markAsPoliteLiveRegion(this.hexContainer,!0),this.hexValue=i.UIUtils.createInput("spectrum-text-value"),this.hexContainer.appendChild(this.hexValue),this.hexValue.maxLength=9,this.hexValue.addEventListener("keydown",this.inputChanged.bind(this),!1),this.hexValue.addEventListener("input",this.inputChanged.bind(this),!1),this.hexValue.addEventListener("wheel",this.inputChanged.bind(this),!1),this.hexValue.addEventListener("paste",this.pasted.bind(this),!1);const a=this.hexContainer.createChild("div","spectrum-text-label");a.textContent=w(x.hex),i.ARIAUtils.setAccessibleName(this.hexValue,a.textContent);const l=o.createChild("div","spectrum-display-switcher spectrum-switcher");b(l),i.UIUtils.setTitle(l,w(x.changeColorFormat)),l.tabIndex=0,self.onInvokeElement(l,(t=>{this.formatViewSwitch(),t.consume(!0)})),i.ARIAUtils.markAsButton(l),i.UIUtils.installDragHandle(this.hueElement,this.dragStart.bind(this,u.bind(this)),u.bind(this),null,"pointer","default"),i.UIUtils.installDragHandle(this.alphaElement,this.dragStart.bind(this,g.bind(this)),g.bind(this),null,"pointer","default"),i.UIUtils.installDragHandle(this.colorElement,this.dragStart.bind(this,m.bind(this)),m.bind(this),null,"pointer","default"),t&&(this.contrastInfo=t,this.contrastOverlay=new C(this.contrastInfo,this.colorElement),this.contrastDetails=new d(this.contrastInfo,this.contentElement,this.toggleColorPicker.bind(this),this.contrastPanelExpanded.bind(this),this.colorSelected.bind(this)),this.contrastDetailsBackgroundColorPickedToggledBound=this.contrastDetailsBackgroundColorPickedToggled.bind(this)),this.element.classList.add("flex-none"),this.palettes=new Map,this.palettePanel=this.contentElement.createChild("div","palette-panel"),this.palettePanelShowing=!1,this.paletteSectionContainer=this.contentElement.createChild("div","spectrum-palette-container"),this.paletteContainer=this.paletteSectionContainer.createChild("div","spectrum-palette"),this.paletteContainer.addEventListener("contextmenu",this.showPaletteColorContextMenu.bind(this,-1)),this.shadesContainer=this.contentElement.createChild("div","palette-color-shades hidden"),i.UIUtils.installDragHandle(this.paletteContainer,this.paletteDragStart.bind(this),this.paletteDrag.bind(this),this.paletteDragEnd.bind(this),"default");const c=this.paletteSectionContainer.createChild("div","spectrum-palette-switcher spectrum-switcher");b(c),i.UIUtils.setTitle(c,w(x.previewPalettes)),i.ARIAUtils.markAsButton(c),c.tabIndex=0,self.onInvokeElement(c,(t=>{this.togglePalettePanel(!0),t.consume(!0)})),this.deleteIconToolbar=new i.Toolbar.Toolbar("delete-color-toolbar"),this.deleteButton=new i.Toolbar.ToolbarButton("","largeicon-trash-bin"),this.deleteIconToolbar.appendToolbarItem(this.deleteButton);this.contentElement.createChild("div","spectrum-overlay fill").addEventListener("click",this.togglePalettePanel.bind(this,!1)),this.addColorToolbar=new i.Toolbar.Toolbar("add-color-toolbar");const h=new i.Toolbar.ToolbarButton(w(x.addToPalette),"largeicon-add");function p(t,e){const o=e,s=t.getBoundingClientRect();switch(o.key){case"ArrowLeft":case"ArrowDown":return s.left-1;case"ArrowRight":case"ArrowUp":return s.right+1;default:return e.x}}function u(t){const e=this.hsv.slice(),o=1-(p(this.hueSlider,t)-this.hueElement.getBoundingClientRect().left)/this.hueAlphaWidth;e[0]=s.NumberUtilities.clamp(o,0,1),this.innerSetColor(e,"",void 0,void 0,F.Other);const r=this.color().canonicalHSLA();i.ARIAUtils.setValueNow(this.hueElement,r[0])}function g(t){const e=this.hsv.slice(),o=(p(this.alphaSlider,t)-this.hueElement.getBoundingClientRect().left)/this.hueAlphaWidth,r=Math.round(100*o)/100;e[3]=s.NumberUtilities.clamp(r,0,1),this.innerSetColor(e,"",void 0,void 0,F.Other);const a=this.color().canonicalHSLA();i.ARIAUtils.setValueText(this.alphaElement,a[3])}function m(t){const e=this.hsv.slice(),o=function(t,e){const o=t.getBoundingClientRect(),s=o.x+o.width/2,r=o.y+o.width/2,i=function(t,e){const o=e;o.altKey?t=1:o.ctrlKey?t=10:o.shiftKey&&(t=20);return t}(o.width/4,e);switch(e.key){case"ArrowLeft":return{x:o.left-i,y:r};case"ArrowRight":return{x:o.right+i,y:r};case"ArrowDown":return{x:s,y:o.bottom+i};case"ArrowUp":return{x:s,y:o.top-i};default:return{x:e.x,y:e.y}}}(this.colorDragElement,t);this.colorOffset=this.colorElement.totalOffset(),e[1]=s.NumberUtilities.clamp((o.x-this.colorOffset.left)/this.dragWidth,0,1),e[2]=s.NumberUtilities.clamp(1-(o.y-this.colorOffset.top)/this.dragHeight,0,1),this.innerSetColor(e,"",void 0,void 0,F.Other)}function b(t){const e=new n.Icon.Icon;e.data={iconName:"switcherIcon",color:"var(--color-text-primary)",width:"16px",height:"16px"},t.appendChild(e)}h.addEventListener(i.Toolbar.ToolbarButton.Events.Click,this.onAddColorMousedown.bind(this)),h.element.addEventListener("keydown",this.onAddColorKeydown.bind(this)),this.addColorToolbar.appendToolbarItem(h),this.colorPickedBound=this.colorPicked.bind(this),this.numPaletteRowsShown=-1,this.loadPalettes(),new T((t=>{t.colors.length?this.addPalette(t):this.selectedColorPalette.get()===t.title&&this.paletteSelected(R)}))}dragStart(t,e){return this.colorOffset=this.colorElement.totalOffset(),t(e),!0}contrastDetailsBackgroundColorPickedToggled(t){t.data&&this.toggleColorPicker(!1)}contrastPanelExpanded(){this.contrastOverlay&&this.contrastDetails&&(this.contrastOverlay.setVisible(this.contrastDetails.expanded()),this.resizeForSelectedPalette(!0))}updatePalettePanel(){this.palettePanel.removeChildren();this.palettePanel.createChild("div","palette-title").textContent=w(x.colorPalettes);const t=new i.Toolbar.Toolbar("",this.palettePanel);this.closeButton=new i.Toolbar.ToolbarButton(w(x.returnToColorPicker),"largeicon-delete"),this.closeButton.addEventListener(i.Toolbar.ToolbarButton.Events.Click,this.togglePalettePanel.bind(this,!1)),this.closeButton.element.addEventListener("keydown",this.onCloseBtnKeydown.bind(this)),t.appendToolbarItem(this.closeButton);for(const t of this.palettes.values())this.palettePanel.appendChild(this.createPreviewPaletteElement(t))}togglePalettePanel(t){this.palettePanelShowing!==t&&(t&&this.updatePalettePanel(),this.palettePanelShowing=t,this.contentElement.classList.toggle("palette-panel-showing",t),this.focusInternal())}onCloseBtnKeydown(t){(isEscKey(t)||isEnterOrSpaceKey(t))&&(this.togglePalettePanel(!1),t.consume(!0))}onSliderKeydown(t,e){switch(e.key){case"ArrowLeft":case"ArrowRight":case"ArrowDown":case"ArrowUp":t(e),e.consume(!0)}}focusInternal(){this.isShowing()&&(this.palettePanelShowing&&this.closeButton?this.closeButton.element.focus({preventScroll:!0}):this.contentElement.focus())}createPaletteColor(t,e,o){const r=document.createElement("div");return r.classList.add("spectrum-palette-color"),r.style.background=s.StringUtilities.sprintf("linear-gradient(%s, %s), var(--image-file-checker)",t,t),o&&r.animate([{opacity:0},{opacity:1}],{duration:100,delay:o,fill:"backwards"}),i.Tooltip.Tooltip.install(r,e||t),r}showPalette(t,e,o){this.resizeForSelectedPalette(),this.paletteContainer.removeChildren();for(let o=0;o<t.colors.length;o++){const s=e?100*o/t.colors.length:0,r=this.createPaletteColor(t.colors[o],t.colorNames[o],s);if(i.ARIAUtils.markAsButton(r),i.ARIAUtils.setAccessibleName(r,w(x.colorS,{PH1:t.colors[o]})),r.tabIndex=-1,r.addEventListener("mousedown",this.paletteColorSelected.bind(this,t.colors[o],t.colorNames[o],Boolean(t.matchUserFormat))),r.addEventListener("focus",this.paletteColorSelected.bind(this,t.colors[o],t.colorNames[o],Boolean(t.matchUserFormat))),r.addEventListener("keydown",this.onPaletteColorKeydown.bind(this,o)),t.mutable)E.set(r,!0),k.set(r,t.colors[o]),r.addEventListener("contextmenu",this.showPaletteColorContextMenu.bind(this,o));else if(t===R){r.classList.add("has-material-shades");let e=r.createChild("div","spectrum-palette-color spectrum-palette-color-shadow");e.style.background=t.colors[o],e=r.createChild("div","spectrum-palette-color spectrum-palette-color-shadow"),e.style.background=t.colors[o];const s=w(x.longclickOrLongpressSpaceToShow,{PH1:t.colors[o]});i.Tooltip.Tooltip.install(r,s),i.ARIAUtils.setAccessibleName(r,s),new i.UIUtils.LongClickController(r,this.showLightnessShades.bind(this,r,t.colors[o]))}this.paletteContainer.appendChild(r)}this.paletteContainer.childNodes.length>0&&(this.paletteContainer.childNodes[0].tabIndex=0),this.paletteContainerMutable=t.mutable,t.mutable?(this.paletteContainer.appendChild(this.addColorToolbar.element),this.paletteContainer.appendChild(this.deleteIconToolbar.element)):(this.addColorToolbar.element.remove(),this.deleteIconToolbar.element.remove()),this.togglePalettePanel(!1),this.focusInternal()}showLightnessShades(t,e,o){this.shadesCloseHandler&&this.shadesCloseHandler(),this.shadesContainer.classList.remove("hidden"),this.shadesContainer.removeChildren(),this.shadesContainer.animate([{transform:"scaleY(0)",opacity:"0"},{transform:"scaleY(1)",opacity:"1"}],{duration:200,easing:"cubic-bezier(0.4, 0, 0.2, 1)"});let s=this.paletteContainer.offsetTop+t.offsetTop+(t.parentElement?t.parentElement.offsetTop:0);this.contrastDetails&&(s+=this.contrastDetails.element().offsetHeight),this.shadesContainer.style.top=s+"px",this.shadesContainer.style.left=t.offsetLeft+"px",t.classList.add("spectrum-shades-shown");const r=L.get(e);if(void 0!==r)for(let e=r.length-1;e>=0;e--){const o=this.createPaletteColor(r[e],void 0,200*e/r.length+100);i.ARIAUtils.markAsButton(o),i.ARIAUtils.setAccessibleName(o,w(x.colorS,{PH1:r[e]})),o.tabIndex=-1,o.addEventListener("mousedown",this.paletteColorSelected.bind(this,r[e],r[e],!1)),o.addEventListener("focus",this.paletteColorSelected.bind(this,r[e],r[e],!1)),o.addEventListener("keydown",this.onShadeColorKeydown.bind(this,t)),this.shadesContainer.appendChild(o)}this.shadesContainer.childNodes.length>0&&this.shadesContainer.childNodes[this.shadesContainer.childNodes.length-1].focus(),this.shadesCloseHandler=function(t){this.shadesContainer.classList.add("hidden"),t.classList.remove("spectrum-shades-shown"),this.shadesCloseHandler&&this.shadesContainer.ownerDocument.removeEventListener("mousedown",this.shadesCloseHandler,!0),delete this.shadesCloseHandler}.bind(this,t),this.shadesContainer.ownerDocument.addEventListener("mousedown",this.shadesCloseHandler,!0)}slotIndexForEvent(t){const e=t,o=e.pageX-this.paletteContainer.totalOffsetLeft(),s=e.pageY-this.paletteContainer.totalOffsetTop(),r=Math.min(o/B|0,y-1),i=s/B|0;return Math.min(i*y+r,this.customPaletteSetting.get().colors.length-1)}isDraggingToBin(t){return t.pageX>this.deleteIconToolbar.element.totalOffsetLeft()}paletteDragStart(t){const e=i.UIUtils.deepElementFromEvent(t);if(!e||!E.get(e))return!1;const o=this.slotIndexForEvent(t);this.dragElement=e;const s=t;return this.dragHotSpotX=s.pageX-o%y*B,this.dragHotSpotY=s.pageY-(o/y|0)*B,!0}paletteDrag(t){const e=t;if(e.pageX<this.paletteContainer.totalOffsetLeft()||e.pageY<this.paletteContainer.totalOffsetTop())return;if(!this.dragElement||void 0===this.dragHotSpotX||void 0===this.dragHotSpotY)return;const o=this.slotIndexForEvent(t),s=e.pageX-o%y*B,r=e.pageY-(o/y|0)*B,i=this.isDraggingToBin(t);this.deleteIconToolbar.element.classList.add("dragging"),this.deleteIconToolbar.element.classList.toggle("delete-color-toolbar-active",i);const a="translateX("+(s-this.dragHotSpotX)+"px) translateY("+(r-this.dragHotSpotY)+"px)";this.dragElement.style.transform=i?a+" scale(0.8)":a;const n=Array.prototype.slice.call(this.paletteContainer.children),l=n.indexOf(this.dragElement),c=new Map;for(const t of n)c.set(t,t.totalOffset());l!==o&&this.paletteContainer.insertBefore(this.dragElement,n[o>l?o+1:o]);for(const t of n){if(t===this.dragElement)continue;const e=c.get(t),o=t.totalOffset();!e||e.left===o.left&&e.top===o.top||t.animate([{transform:"translateX("+(e.left-o.left)+"px) translateY("+(e.top-o.top)+"px)"},{transform:"none"}],{duration:100,easing:"cubic-bezier(0, 0, 0.2, 1)"})}}paletteDragEnd(t){if(!this.dragElement)return;this.isDraggingToBin(t)&&this.dragElement.remove(),this.dragElement.style.removeProperty("transform");const e=this.paletteContainer.children,o=[];for(let t=0;t<e.length;++t){const s=k.get(e[t]);s&&o.push(s)}const s=this.customPaletteSetting.get();s.colors=o,this.customPaletteSetting.set(s),this.showPalette(s,!1),this.deleteIconToolbar.element.classList.remove("dragging"),this.deleteIconToolbar.element.classList.remove("delete-color-toolbar-active")}loadPalettes(){this.palettes.set(R.title,R);const e={title:"Custom",colors:[],colorNames:[],mutable:!0,matchUserFormat:void 0};this.customPaletteSetting=t.Settings.Settings.instance().createSetting("customColorPalette",e);const o=this.customPaletteSetting.get();o.colorNames=o.colorNames||[],this.palettes.set(o.title,o),this.selectedColorPalette=t.Settings.Settings.instance().createSetting("selectedColorPalette",S);const s=this.palettes.get(this.selectedColorPalette.get());s&&this.showPalette(s,!0)}addPalette(t){this.palettes.set(t.title,t),this.selectedColorPalette.get()===t.title&&this.showPalette(t,!0)}createPreviewPaletteElement(t){const e=document.createElement("div");e.classList.add("palette-preview"),i.ARIAUtils.markAsButton(e),e.tabIndex=0;let o;for(e.createChild("div","palette-preview-title").textContent=t.title,o=0;o<5&&o<t.colors.length;o++)e.appendChild(this.createPaletteColor(t.colors[o],t.colorNames[o]));for(;o<5;o++)e.createChild("div","spectrum-palette-color empty-color");return self.onInvokeElement(e,(e=>{this.paletteSelected(t),e.consume(!0)})),e}paletteSelected(t){this.selectedColorPalette.set(t.title),this.showPalette(t,!0)}resizeForSelectedPalette(t){const e=this.palettes.get(this.selectedColorPalette.get());if(!e)return;let o=e.colors.length;e===this.customPaletteSetting.get()&&o++;const s=Math.max(1,Math.ceil(o/y));if(this.numPaletteRowsShown===s&&!t)return;this.numPaletteRowsShown=s;let r=236;this.contrastDetails&&(this.contrastDetails.expanded()?r+=78:r+=36),this.element.style.height=r+12+24*s+"px",this.dispatchEventToListeners(P.SizeChanged)}paletteColorSelected(e,o,s){const r=t.Color.Color.parse(e);r&&this.innerSetColor(r.hsva(),e,o,s?this.colorFormat:r.format(),F.Other)}onPaletteColorKeydown(t,e){let o;switch(e.key){case"ArrowLeft":o=t-1;break;case"ArrowRight":o=t+1;break;case"ArrowUp":o=t-y;break;case"ArrowDown":o=t+y}void 0!==o&&o>-1&&o<this.paletteContainer.childNodes.length&&this.paletteContainer.childNodes[o].focus()}onShadeColorKeydown(t,e){const o=e,s=o.target;isEscKey(e)||"Tab"===o.key?(t.focus(),this.shadesCloseHandler&&this.shadesCloseHandler(),e.consume(!0)):"ArrowUp"===o.key&&s.previousElementSibling?(s.previousElementSibling.focus(),e.consume(!0)):"ArrowDown"===o.key&&s.nextElementSibling&&(s.nextElementSibling.focus(),e.consume(!0))}onAddColorMousedown(){this.addColorToCustomPalette()}onAddColorKeydown(t){isEnterOrSpaceKey(t)&&(this.addColorToCustomPalette(),t.consume(!0))}addColorToCustomPalette(){const t=this.customPaletteSetting.get();t.colors.push(this.colorString()),this.customPaletteSetting.set(t),this.showPalette(t,!1);const e=this.paletteContainer.querySelectorAll(".spectrum-palette-color");e[e.length-1].focus()}showPaletteColorContextMenu(t,e){if(!this.paletteContainerMutable)return;const o=new i.ContextMenu.ContextMenu(e);-1!==t&&(o.defaultSection().appendItem(w(x.removeColor),this.deletePaletteColors.bind(this,t,!1)),o.defaultSection().appendItem(w(x.removeAllToTheRight),this.deletePaletteColors.bind(this,t,!0))),o.defaultSection().appendItem(w(x.clearPalette),this.deletePaletteColors.bind(this,-1,!0)),o.show()}deletePaletteColors(t,e){const o=this.customPaletteSetting.get();e?o.colors.splice(t+1,o.colors.length-t-1):o.colors.splice(t,1),this.customPaletteSetting.set(o),this.showPalette(o,!1)}setColor(t,e){this.originalFormat=e,this.innerSetColor(t.hsva(),"",void 0,e,F.Model);const o=this.color().canonicalHSLA();i.ARIAUtils.setValueNow(this.hueElement,o[0]),i.ARIAUtils.setValueText(this.alphaElement,o[3])}colorSelected(t){this.innerSetColor(t.hsva(),"",void 0,void 0,F.Other)}innerSetColor(e,o,s,r,i){if(void 0!==e&&(this.hsv=e),this.colorNameInternal=s,void 0!==o&&(this.colorStringInternal=o),void 0!==r){const e=t.Color.Format;console.assert(r!==e.Original,"Spectrum's color format cannot be Original"),r===e.RGBA?r=e.RGB:r===e.HSLA?r=e.HSL:r===e.HEXA?r=e.HEX:r===e.ShortHEXA&&(r=e.ShortHEX),this.colorFormat=r}this.contrastInfo&&this.contrastInfo.setColor(t.Color.Color.fromHSVA(this.hsv),this.colorFormat),this.updateHelperLocations(),this.updateUI(),i!==F.Input&&this.updateInput(),i!==F.Model&&this.dispatchEventToListeners(P.ColorChanged,this.colorString())}color(){return t.Color.Color.fromHSVA(this.hsv)}colorName(){return this.colorNameInternal}colorString(){if(this.colorStringInternal)return this.colorStringInternal;const e=t.Color.Format,o=this.color();let s=o.asString(this.colorFormat);return s||(s=this.colorFormat===e.Nickname?o.asString(o.hasAlpha()?e.HEXA:e.HEX):this.colorFormat===e.ShortHEX?o.asString(o.detectHEXFormat()):this.colorFormat===e.HEX?o.asString(e.HEXA):this.colorFormat===e.HSL?o.asString(e.HSLA):o.asString(e.RGBA),console.assert(Boolean(s)),s||"")}updateHelperLocations(){const t=this.hsv[0],e=this.hsv[1],o=this.hsv[2],s=this.hsv[3];this.dragX=e*this.dragWidth,this.dragY=this.dragHeight-o*this.dragHeight;const r=Math.max(-this.colorDragElementHeight,Math.min(this.dragWidth-this.colorDragElementHeight,this.dragX-this.colorDragElementHeight)),i=Math.max(-this.colorDragElementHeight,Math.min(this.dragHeight-this.colorDragElementHeight,this.dragY-this.colorDragElementHeight));this.colorDragElement.positionAt(r,i);const a=(1-t)*this.hueAlphaWidth-this.slideHelperWidth;this.hueSlider.style.left=a+"px";const n=s*this.hueAlphaWidth-this.slideHelperWidth;this.alphaSlider.style.left=n+"px"}updateInput(){const e=t.Color.Format;if(this.colorFormat===e.HEX||this.colorFormat===e.ShortHEX||this.colorFormat===e.Nickname)this.hexContainer.hidden=!1,this.displayContainer.hidden=!0,this.colorFormat===e.ShortHEX?this.hexValue.value=String(this.color().asString(this.color().detectHEXFormat())):this.hexValue.value=String(this.color().asString(this.color().hasAlpha()?e.HEXA:e.HEX));else{this.hexContainer.hidden=!0,this.displayContainer.hidden=!1;const t=this.colorFormat===e.RGB;this.textLabels.textContent=t?"RGBA":"HSLA";const o=t?this.color().canonicalRGBA():this.color().canonicalHSLA();for(let e=0;e<3;++e)i.ARIAUtils.setAccessibleName(this.textValues[e],w(x.sInS,{PH1:this.textLabels.textContent.charAt(e),PH2:this.textLabels.textContent})),this.textValues[e].value=String(o[e]),t||1!==e&&2!==e||(this.textValues[e].value+="%");i.ARIAUtils.setAccessibleName(this.textValues[3],w(x.sInS,{PH1:this.textLabels.textContent.charAt(3),PH2:this.textLabels.textContent})),this.textValues[3].value=String(Math.round(100*o[3])/100)}}updateUI(){const e=t.Color.Color.fromHSVA([this.hsv[0],1,1,1]);this.colorElement.style.backgroundColor=e.asString(t.Color.Format.RGB),this.contrastOverlay&&this.contrastOverlay.setDimensions(this.dragWidth,this.dragHeight),this.swatch.setColor(this.color(),this.colorString()),this.colorDragElement.style.backgroundColor=this.color().asString(t.Color.Format.RGBA);const o=t.Color.Color.fromHSVA(this.hsv.slice(0,3).concat(1));this.alphaElementBackground.style.backgroundImage=s.StringUtilities.sprintf("linear-gradient(to right, rgba(0,0,0,0), %s)",o.asString(t.Color.Format.RGB))}formatViewSwitch(){const e=t.Color.Format;let o=e.RGB;this.colorFormat===e.RGB?o=e.HSL:this.colorFormat===e.HSL&&(o=this.originalFormat===e.ShortHEX||this.originalFormat===e.ShortHEXA?e.ShortHEX:e.HEX),this.innerSetColor(void 0,"",void 0,o,F.Other)}pasted(e){if(!e.clipboardData)return;const o=e.clipboardData.getData("text"),s=t.Color.Color.parse(o);s&&(this.innerSetColor(s.hsva(),o,void 0,void 0,F.Other),e.preventDefault())}inputChanged(e){function o(t){return t.value}const r=e.currentTarget,a=i.UIUtils.createReplacementString(r.value,e);a&&(r.value=a,r.selectionStart=0,r.selectionEnd=a.length,e.consume(!0));const n=t.Color.Format;let l;if(this.colorFormat===n.Nickname||this.colorFormat===n.HEX||this.colorFormat===n.ShortHEX)l=this.hexValue.value;else{const t=this.colorFormat===n.RGB?"rgb":"hsl",e=this.textValues.slice(0,-1).map(o).join(" "),r=this.textValues.slice(-1).map(o).join(" ");l=s.StringUtilities.sprintf("%s(%s)",t,[e,r].join(" / "))}const c=t.Color.Color.parse(l);if(!c)return;let h;this.colorFormat!==n.HEX&&this.colorFormat!==n.ShortHEX||(h=c.detectHEXFormat()),this.innerSetColor(c.hsva(),l,void 0,h,F.Input)}wasShown(){this.registerCSSFiles([f]),this.hueAlphaWidth=this.hueElement.offsetWidth,this.slideHelperWidth=this.hueSlider.offsetWidth/2,this.dragWidth=this.colorElement.offsetWidth,this.dragHeight=this.colorElement.offsetHeight,this.colorDragElementHeight=this.colorDragElement.offsetHeight/2,this.innerSetColor(void 0,void 0,void 0,void 0,F.Model),this.toggleColorPicker(!0),this.contrastDetails&&this.contrastDetailsBackgroundColorPickedToggledBound&&this.contrastDetails.addEventListener("BackgroundColorPickerWillBeToggled",this.contrastDetailsBackgroundColorPickedToggledBound)}willHide(){this.toggleColorPicker(!1),this.contrastDetails&&this.contrastDetailsBackgroundColorPickedToggledBound&&this.contrastDetails.removeEventListener("BackgroundColorPickerWillBeToggled",this.contrastDetailsBackgroundColorPickedToggledBound)}toggleColorPicker(t){void 0===t&&(t=!this.colorPickerButton.toggled()),this.colorPickerButton.setToggled(t),this.contrastDetails&&t&&this.contrastDetails.backgroundColorPickerEnabled()&&this.contrastDetails.toggleBackgroundColorPicker(!1),e.InspectorFrontendHost.InspectorFrontendHostInstance.setEyeDropperActive(t),t?e.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(e.InspectorFrontendHostAPI.Events.EyeDropperPickedColor,this.colorPickedBound):e.InspectorFrontendHost.InspectorFrontendHostInstance.events.removeEventListener(e.InspectorFrontendHostAPI.Events.EyeDropperPickedColor,this.colorPickedBound)}colorPicked({data:o}){const s=[o.r,o.g,o.b,(o.a/2.55|0)/100],r=t.Color.Color.fromRGBA(s);this.innerSetColor(r.hsva(),"",void 0,void 0,F.Other),e.InspectorFrontendHost.InspectorFrontendHostInstance.bringToFront()}}const F={Input:"Input",Model:"Model",Other:"Other"};var P;!function(t){t.ColorChanged="ColorChanged",t.SizeChanged="SizeChanged"}(P||(P={}));const B=24,y=8,S="Page colors";class T{callback;frequencyMap;constructor(t){this.callback=t,this.frequencyMap=new Map;const e=[];for(const t of a.TargetManager.TargetManager.instance().models(a.CSSModel.CSSModel))for(const o of t.allStyleSheets())e.push(this.processStylesheet(o));Promise.all(e).catch((t=>{console.error(t)})).then(this.finish.bind(this))}frequencyComparator(t,e){return this.frequencyMap.get(e)-this.frequencyMap.get(t)}finish(){let e=[...this.frequencyMap.keys()];e=e.sort(this.frequencyComparator.bind(this));const o=new Map;for(;o.size<24&&e.length;){const s=e.shift(),r=t.Color.Color.parse(s);r&&"white"!==r.nickname()&&"black"!==r.nickname()&&o.set(s,r)}this.callback({title:S,colors:[...o.keys()].sort((function(t,e){const s=o.get(t).hsva(),r=o.get(e).hsva();return r[1]<.12&&s[1]<.12?r[2]*r[3]-s[2]*s[3]:r[1]<.12?-1:s[1]<.12?1:r[0]===s[0]?r[1]*r[3]-s[1]*s[3]:(r[0]+.94)%1-(s[0]+.94)%1})),colorNames:[],mutable:!1,matchUserFormat:void 0})}async processStylesheet(t){let e=(await t.requestContent()).content||"";e=e.toLowerCase();const o=e.match(/((?:rgb|hsl)a?\([^)]+\)|#[0-9a-f]{6}|#[0-9a-f]{3})/g)||[];for(const t of o){let e=this.frequencyMap.get(t)||0;this.frequencyMap.set(t,++e)}}}const L=new Map([["#F44336",["#FFEBEE","#FFCDD2","#EF9A9A","#E57373","#EF5350","#F44336","#E53935","#D32F2F","#C62828","#B71C1C"]],["#E91E63",["#FCE4EC","#F8BBD0","#F48FB1","#F06292","#EC407A","#E91E63","#D81B60","#C2185B","#AD1457","#880E4F"]],["#9C27B0",["#F3E5F5","#E1BEE7","#CE93D8","#BA68C8","#AB47BC","#9C27B0","#8E24AA","#7B1FA2","#6A1B9A","#4A148C"]],["#673AB7",["#EDE7F6","#D1C4E9","#B39DDB","#9575CD","#7E57C2","#673AB7","#5E35B1","#512DA8","#4527A0","#311B92"]],["#3F51B5",["#E8EAF6","#C5CAE9","#9FA8DA","#7986CB","#5C6BC0","#3F51B5","#3949AB","#303F9F","#283593","#1A237E"]],["#2196F3",["#E3F2FD","#BBDEFB","#90CAF9","#64B5F6","#42A5F5","#2196F3","#1E88E5","#1976D2","#1565C0","#0D47A1"]],["#03A9F4",["#E1F5FE","#B3E5FC","#81D4FA","#4FC3F7","#29B6F6","#03A9F4","#039BE5","#0288D1","#0277BD","#01579B"]],["#00BCD4",["#E0F7FA","#B2EBF2","#80DEEA","#4DD0E1","#26C6DA","#00BCD4","#00ACC1","#0097A7","#00838F","#006064"]],["#009688",["#E0F2F1","#B2DFDB","#80CBC4","#4DB6AC","#26A69A","#009688","#00897B","#00796B","#00695C","#004D40"]],["#4CAF50",["#E8F5E9","#C8E6C9","#A5D6A7","#81C784","#66BB6A","#4CAF50","#43A047","#388E3C","#2E7D32","#1B5E20"]],["#8BC34A",["#F1F8E9","#DCEDC8","#C5E1A5","#AED581","#9CCC65","#8BC34A","#7CB342","#689F38","#558B2F","#33691E"]],["#CDDC39",["#F9FBE7","#F0F4C3","#E6EE9C","#DCE775","#D4E157","#CDDC39","#C0CA33","#AFB42B","#9E9D24","#827717"]],["#FFEB3B",["#FFFDE7","#FFF9C4","#FFF59D","#FFF176","#FFEE58","#FFEB3B","#FDD835","#FBC02D","#F9A825","#F57F17"]],["#FFC107",["#FFF8E1","#FFECB3","#FFE082","#FFD54F","#FFCA28","#FFC107","#FFB300","#FFA000","#FF8F00","#FF6F00"]],["#FF9800",["#FFF3E0","#FFE0B2","#FFCC80","#FFB74D","#FFA726","#FF9800","#FB8C00","#F57C00","#EF6C00","#E65100"]],["#FF5722",["#FBE9E7","#FFCCBC","#FFAB91","#FF8A65","#FF7043","#FF5722","#F4511E","#E64A19","#D84315","#BF360C"]],["#795548",["#EFEBE9","#D7CCC8","#BCAAA4","#A1887F","#8D6E63","#795548","#6D4C41","#5D4037","#4E342E","#3E2723"]],["#9E9E9E",["#FAFAFA","#F5F5F5","#EEEEEE","#E0E0E0","#BDBDBD","#9E9E9E","#757575","#616161","#424242","#212121"]],["#607D8B",["#ECEFF1","#CFD8DC","#B0BEC5","#90A4AE","#78909C","#607D8B","#546E7A","#455A64","#37474F","#263238"]]]),R={title:"Material",mutable:!1,matchUserFormat:!0,colors:[...L.keys()],colorNames:[]};class D{colorString;swatchInnerElement;swatchOverlayElement;swatchCopyIcon;constructor(t){const e=t.createChild("span","swatch");this.swatchInnerElement=e.createChild("span","swatch-inner"),this.swatchOverlayElement=e.createChild("span","swatch-overlay"),i.ARIAUtils.markAsButton(this.swatchOverlayElement),i.ARIAUtils.setPressed(this.swatchOverlayElement,!1),this.swatchOverlayElement.tabIndex=0,self.onInvokeElement(this.swatchOverlayElement,this.onCopyText.bind(this)),this.swatchOverlayElement.addEventListener("mouseout",this.onCopyIconMouseout.bind(this)),this.swatchOverlayElement.addEventListener("blur",this.onCopyIconMouseout.bind(this)),this.swatchCopyIcon=i.Icon.Icon.create("largeicon-copy","copy-color-icon"),i.Tooltip.Tooltip.install(this.swatchCopyIcon,w(x.copyColorToClipboard)),this.swatchOverlayElement.appendChild(this.swatchCopyIcon),i.ARIAUtils.setAccessibleName(this.swatchOverlayElement,this.swatchCopyIcon.title)}setColor(e,o){this.swatchInnerElement.style.backgroundColor=e.asString(t.Color.Format.RGBA),this.swatchInnerElement.classList.toggle("swatch-inner-white",e.hsla()[2]>.9),this.colorString=o||null,this.swatchOverlayElement.hidden=!o}onCopyText(t){this.swatchCopyIcon.setIconType("largeicon-checkmark"),e.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(this.colorString),i.ARIAUtils.setPressed(this.swatchOverlayElement,!0),t.consume()}onCopyIconMouseout(){this.swatchCopyIcon.setIconType("largeicon-copy"),i.ARIAUtils.setPressed(this.swatchOverlayElement,!1)}}var H=Object.freeze({__proto__:null,Spectrum:I,ChangeSource:F,get Events(){return P},PaletteGenerator:T,MaterialPalette:R,Swatch:D});export{u as ContrastDetails,m as ContrastInfo,v as ContrastOverlay,H as Spectrum};
