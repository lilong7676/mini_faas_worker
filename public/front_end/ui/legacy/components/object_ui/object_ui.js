import*as e from"../../../../core/common/common.js";import*as t from"../../../../core/i18n/i18n.js";import*as n from"../../legacy.js";import*as i from"../../../../core/host/host.js";import*as o from"../../../components/linear_memory_inspector/linear_memory_inspector.js";import*as r from"../../../../core/platform/platform.js";import*as s from"../../../../core/sdk/sdk.js";import*as a from"../../../../models/text_utils/text_utils.js";import*as l from"../../../components/icon_button/icon_button.js";import*as c from"../../../components/text_editor/text_editor.js";import*as p from"../utils/utils.js";const d={emptyD:"empty × {PH1}",empty:"empty",thePropertyIsComputedWithAGetter:"The property is computed with a getter"},h=t.i18n.registerUIStrings("ui/legacy/components/object_ui/RemoteObjectPreviewFormatter.ts",d),u=t.i18n.getLocalizedString.bind(void 0,h);class m{static objectPropertyComparator(e,t){return n(e)-n(t);function n(e){return"[[PromiseState]]"===e.name?1:"[[PromiseResult]]"===e.name?2:"[[GeneratorState]]"===e.name||"[[PrimitiveValue]]"===e.name?3:"function"===e.type||e.name.startsWith("#")?5:4}}appendObjectPreview(e,t,i){const o=t.description,r=new Set(["arraybuffer","dataview","error","null","regexp","webassemblymemory","internal#entry","trustedtype"]);if("object"!==t.type||t.subtype&&r.has(t.subtype)||i)return void e.appendChild(this.renderPropertyPreview(t.type,t.subtype,void 0,o));const a="array"===t.subtype||"typedarray"===t.subtype;if(o){let n;if(a){const e=s.RemoteObject.RemoteObject.arrayLength(t),i=e>1?"("+e+")":"",r=s.RemoteObject.RemoteObject.arrayNameFromDescription(o);n="Array"===r?i:r+i}else{n="Object"===o?"":o}n.length>0&&(e.createChild("span","object-description").textContent=n+" ")}const l=e.createChild("span","object-properties-preview");if(n.UIUtils.createTextChild(l,a?"[":"{"),t.entries?this.appendEntriesPreview(l,t):a?this.appendArrayPropertiesPreview(l,t):this.appendObjectPropertiesPreview(l,t),t.overflow){const e=l.textContent&&l.textContent.length>1?", …":"…";l.createChild("span").textContent=e}n.UIUtils.createTextChild(l,a?"]":"}")}abbreviateFullQualifiedClassName(e){const t=e.split(".");for(let e=0;e<t.length-1;++e)t[e]=r.StringUtilities.trimMiddle(t[e],3);return t.join(".")}appendObjectPropertiesPreview(e,t){const i=t.properties.filter((e=>"accessor"!==e.type)).sort(m.objectPropertyComparator);for(let o=0;o<i.length;++o){o>0&&n.UIUtils.createTextChild(e,", ");const r=i[o],s=r.name;if("promise"===t.subtype&&"[[PromiseState]]"===s){e.appendChild(this.renderDisplayName("<"+r.value+">"));const t=o+1<i.length?i[o+1]:null;t&&"[[PromiseResult]]"===t.name&&("pending"!==r.value&&(n.UIUtils.createTextChild(e,": "),e.appendChild(this.renderPropertyPreviewOrAccessor([t]))),o++)}else"generator"===t.subtype&&"[[GeneratorState]]"===s?e.appendChild(this.renderDisplayName("<"+r.value+">")):("[[PrimitiveValue]]"===s||(e.appendChild(this.renderDisplayName(s)),n.UIUtils.createTextChild(e,": ")),e.appendChild(this.renderPropertyPreviewOrAccessor([r])))}}appendArrayPropertiesPreview(e,t){const i=s.RemoteObject.RemoteObject.arrayLength(t),o=t.properties.filter((e=>-1!==a(e.name))).sort((function(e,t){return a(e.name)-a(t.name)})),r=t.properties.filter((e=>-1===a(e.name))).sort(m.objectPropertyComparator);function a(e){const t=Number(e)>>>0;return String(t)===e&&t<i?t:-1}const l=!t.overflow;let c=-1,p=!1;for(let t=0;t<o.length;++t){p&&n.UIUtils.createTextChild(e,", ");const i=o[t],r=a(i.name);l&&r-c>1&&(h(r),n.UIUtils.createTextChild(e,", ")),l||t===r||(e.appendChild(this.renderDisplayName(i.name)),n.UIUtils.createTextChild(e,": ")),e.appendChild(this.renderPropertyPreviewOrAccessor([i])),c=r,p=!0}l&&i-c>1&&(p&&n.UIUtils.createTextChild(e,", "),h(i));for(let t=0;t<r.length;++t){p&&n.UIUtils.createTextChild(e,", ");const i=r[t];e.appendChild(this.renderDisplayName(i.name)),n.UIUtils.createTextChild(e,": "),e.appendChild(this.renderPropertyPreviewOrAccessor([i])),p=!0}function h(t){const n=e.createChild("span","object-value-undefined"),i=t-c-1;n.textContent=1!==i?u(d.emptyD,{PH1:i}):u(d.empty),p=!0}}appendEntriesPreview(e,t){if(t.entries)for(let i=0;i<t.entries.length;++i){i>0&&n.UIUtils.createTextChild(e,", ");const o=t.entries[i];o.key&&(this.appendObjectPreview(e,o.key,!0),n.UIUtils.createTextChild(e," => ")),this.appendObjectPreview(e,o.value,!0)}}renderDisplayName(e){const t=document.createElement("span");t.classList.add("name");const n=/^\s|\s$|^$|\n/.test(e);return t.textContent=n?'"'+e.replace(/\n/g,"↵")+'"':e,t}renderPropertyPreviewOrAccessor(e){const t=e[e.length-1];if(!t)throw new Error("Could not find property");return this.renderPropertyPreview(t.type,t.subtype,t.name,t.value)}renderPropertyPreview(e,t,i,o){const s=document.createElement("span");if(s.classList.add("object-value-"+(t||e)),o=o||"","accessor"===e)return s.textContent="(...)",n.Tooltip.Tooltip.install(s,u(d.thePropertyIsComputedWithAGetter)),s;if("function"===e)return s.textContent="ƒ",s;if("object"===e&&"trustedtype"===t&&i)return v(s,o,i),s;if("object"===e&&"node"===t&&o)return b(s,o),s;if("string"===e)return n.UIUtils.createTextChildren(s,r.StringUtilities.formatAsJSLiteral(o)),s;if("object"===e&&!t){let e=this.abbreviateFullQualifiedClassName(o);return"Object"===e&&(e="{…}"),s.textContent=e,n.Tooltip.Tooltip.install(s,o),s}return s.textContent=o,s}}const b=function(e,t){const n=t.match(/([^#.]+)(#[^.]+)?(\..*)?/);n&&(e.createChild("span","webkit-html-tag-name").textContent=n[1],n[2]&&(e.createChild("span","webkit-html-attribute-value").textContent=n[2]),n[3]&&(e.createChild("span","webkit-html-attribute-name").textContent=n[3]))},v=function(e,t,i){n.UIUtils.createTextChildren(e,`${i} `);const o=document.createElement("span");o.classList.add("object-value-string"),n.UIUtils.createTextChildren(o,'"',t.replace(/\n/g,"↵"),'"'),e.appendChild(o)};var y=Object.freeze({__proto__:null,RemoteObjectPreviewFormatter:m,createSpansForNodeTitle:b,createSpanForTrustedType:v});class x{static wrapObjectLiteral(e){if(!/^\s*\{/.test(e)||!/\}\s*$/.test(e))return e;const t=(async()=>0).constructor;try{t("return "+e+";");const n="("+e+")";return t(n),n}catch(t){return e}}static preprocessExpression(e){return x.wrapObjectLiteral(e)}static async evaluateAndBuildPreview(e,t,i,o,r,a,l=!1){const c=n.Context.Context.instance().flavor(s.RuntimeModel.ExecutionContext),p=e.length>f;if(!e||!c||t&&p)return{preview:document.createDocumentFragment(),result:null};const d={expression:x.preprocessExpression(e),generatePreview:!0,includeCommandLineAPI:!0,throwOnSideEffect:t,timeout:o,objectGroup:a,disableBreaks:!0,replMode:i,silent:void 0,returnByValue:void 0,allowUnsafeEvalBlockedByCSP:void 0},h=await c.evaluate(d,!1,l);return{preview:x.buildEvaluationPreview(h,r),result:h}}static buildEvaluationPreview(e,t){const n=document.createDocumentFragment();if("error"in e)return n;if(e.exceptionDetails&&e.exceptionDetails.exception&&e.exceptionDetails.exception.description){const i=e.exceptionDetails.exception.description;return(i.startsWith("TypeError: ")||t)&&(n.createChild("span").textContent=e.exceptionDetails.text+" "+i),n}const i=new m,{preview:o,type:s,subtype:a,className:l,description:c}=e.object;if(o&&"object"===s&&"node"!==a&&"trustedtype"!==a)i.appendObjectPreview(n,o,!1);else{const e=i.renderPropertyPreview(s,a,l,r.StringUtilities.trimEndWithMaxLength(c||"",400));n.appendChild(e)}return n}}let f=2e3;var g=Object.freeze({__proto__:null,JavaScriptREPL:x,setMaxLengthForEvaluation:function(e){f=e},getMaxLengthForEvaluation:function(){return f}});const w=new CSSStyleSheet;w.replaceSync(".value.object-value-node:hover{background-color:var(--item-hover-color)}.object-value-boolean,.object-value-function-prefix{color:var(--color-syntax-3)}.object-value-function{font-style:italic}.object-value-function.linkified:hover{--override-linkified-hover-background:rgb(0 0 0 / 10%);background-color:var(--override-linkified-hover-background);cursor:pointer}.-theme-with-dark-background .object-value-function.linkified:hover,:host-context(.-theme-with-dark-background) .object-value-function.linkified:hover{--override-linkified-hover-background:rgb(230 230 230 / 10%)}.object-value-number{color:var(--color-syntax-3)}.object-value-bigint{color:var(--color-syntax-6)}.object-value-regexp,.object-value-string,.object-value-symbol{white-space:pre;unicode-bidi:-webkit-isolate;color:var(--color-syntax-1)}.object-value-node{position:relative;vertical-align:baseline;color:var(--color-syntax-7);display:inline-block}.object-value-with-memory-icon{display:inline-flex}.object-value-arraybuffer devtools-icon,.object-value-dataview devtools-icon,.object-value-typedarray devtools-icon,.object-value-webassemblymemory devtools-icon{cursor:pointer}.object-value-null,.object-value-undefined{color:var(--color-text-disabled)}.object-value-calculate-value-button:hover{text-decoration:underline}.object-properties-section-custom-section{display:inline-flex;flex-direction:column}.-theme-with-dark-background .object-value-boolean,.-theme-with-dark-background .object-value-number,:host-context(.-theme-with-dark-background) .object-value-boolean,:host-context(.-theme-with-dark-background) .object-value-number{--override-primitive-dark-mode-color:hsl(252deg 100% 75%);color:var(--override-primitive-dark-mode-color)}.object-properties-section .object-description{color:var(--color-text-secondary)}.value .object-properties-preview{white-space:nowrap}.name{color:var(--color-syntax-2);flex-shrink:0}.object-properties-preview .name{color:var(--color-text-secondary)}@media (forced-colors:active){.object-value-calculate-value-button:hover{forced-color-adjust:none;color:Highlight}}\n/*# sourceURL=objectValue.css */\n");const E=new CSSStyleSheet;E.replaceSync(".object-properties-section-dimmed{opacity:60%}.object-properties-section{padding:0;color:var(--color-text-primary);display:flex;flex-direction:column}.object-properties-section li{user-select:text}.object-properties-section li::before{top:-1px}.object-properties-section li.editing-sub-part{padding:3px 12px 8px 6px;margin:-1px -6px -8px;text-overflow:clip}.object-properties-section li.editing{margin-left:10px;text-overflow:clip}.tree-outline ol.title-less-mode{padding-left:0}.object-properties-section .own-property{font-weight:700}.object-properties-section .synthetic-property{color:var(--color-text-secondary)}.object-properties-section .private-property-hash{color:var(--color-text-primary)}.object-properties-section-root-element{display:flex;flex-direction:row}.object-properties-section .editable-div{overflow:hidden}.name-and-value{overflow:hidden;line-height:16px}.editing-sub-part .name-and-value{overflow:visible;display:inline-flex}.property-prompt{margin-left:4px}.tree-outline.hide-selection-when-blurred .selected:focus-visible{background:0 0}.tree-outline.hide-selection-when-blurred .selected:focus-visible .gray-info-message,.tree-outline.hide-selection-when-blurred .selected:focus-visible .name-and-value,.tree-outline.hide-selection-when-blurred .selected:focus-visible .tree-element-title,.tree-outline.hide-selection-when-blurred .selected:focus-visible ::slotted(*){background:var(--legacy-focus-bg-color);border-radius:2px;box-shadow:0 0 0 2px var(--legacy-focus-bg-color)}@media (forced-colors:active){.object-properties-section-dimmed{opacity:100%}.tree-outline.hide-selection-when-blurred .selected:focus-visible{background:Highlight}.tree-outline li.selected .tree-element-title,.tree-outline li:hover .tree-element-title{color:ButtonText}.tree-outline.hide-selection-when-blurred .selected:focus-visible .name-and-value,.tree-outline.hide-selection-when-blurred .selected:focus-visible .tree-element-title{background:0 0;box-shadow:none}.tree-outline.hide-selection-when-blurred .selected:focus-visible .gray-info-message,.tree-outline.hide-selection-when-blurred .selected:focus-visible span{color:HighlightText}.tree-outline-disclosure:hover li.parent::before{background-color:ButtonText}}\n/*# sourceURL=objectPropertiesSection.css */\n");const C={exceptionS:"[Exception: {PH1}]",unknown:"unknown",expandRecursively:"Expand recursively",collapseChildren:"Collapse children",noProperties:"No properties",dots:"(...)",invokePropertyGetter:"Invoke property getter",showAllD:"Show all {PH1}",unreadable:"<unreadable>",noPropertyGetter:"No property getter",copyValue:"Copy value",copyPropertyPath:"Copy property path",stringIsTooLargeToEdit:"<string is too large to edit>",showMoreS:"Show more ({PH1})",longTextWasTruncatedS:"long text was truncated ({PH1})",copy:"Copy"},j=t.i18n.registerUIStrings("ui/legacy/components/object_ui/ObjectPropertiesSection.ts",C),P=t.i18n.getLocalizedString.bind(void 0,j),T=new WeakMap,O=new WeakMap;class S extends n.TreeOutline.TreeOutlineInShadow{object;editable;objectTreeElementInternal;titleElement;skipProtoInternal;constructor(e,t,n,i){super(),this.object=e,this.editable=!0,i||this.hideOverflow(),this.setFocusable(!0),this.setShowSelectionOnKeyboardFocus(!0),this.objectTreeElementInternal=new k(e,n),this.appendChild(this.objectTreeElementInternal),"string"!=typeof t&&t?(this.titleElement=t,this.element.appendChild(t)):(this.titleElement=this.element.createChild("span"),this.titleElement.textContent=t||""),this.titleElement instanceof HTMLElement&&!this.titleElement.hasAttribute("tabIndex")&&(this.titleElement.tabIndex=-1),O.set(this.element,this),this.registerCSSFiles([w,E]),this.rootElement().childrenListElement.classList.add("source-code","object-properties-section")}static defaultObjectPresentation(e,t,n,i){const o=S.defaultObjectPropertiesSection(e,t,n,i);return e.hasChildren?o.element:o.titleElement}static defaultObjectPropertiesSection(e,t,i,o){const r=document.createElement("span");r.classList.add("source-code");const s=n.Utils.createShadowRootWithCoreStyles(r,{cssFile:[w],delegatesFocus:void 0}),a=S.createPropertyValue(e,!1,!0);s.appendChild(a.element);const l=new S(e,r,t);return l.editable=!1,i&&l.skipProto(),o&&l.setEditable(!1),l}static compareProperties(e,t){if(!e.synthetic&&t.synthetic)return 1;if(!t.synthetic&&e.synthetic)return-1;if(!e.isOwn&&t.isOwn)return 1;if(!t.isOwn&&e.isOwn)return-1;if(!e.enumerable&&t.enumerable)return 1;if(!t.enumerable&&e.enumerable)return-1;if(e.symbol&&!t.symbol)return 1;if(t.symbol&&!e.symbol)return-1;if(e.private&&!t.private)return 1;if(t.private&&!e.private)return-1;const n=e.name,i=t.name;return n.startsWith("_")&&!i.startsWith("_")?1:i.startsWith("_")&&!n.startsWith("_")?-1:r.StringUtilities.naturalOrderComparator(n,i)}static createNameElement(e,t){return null===e?n.Fragment.html`<span class="name"></span>`:/^\s|\s$|^$|\n/.test(e)?n.Fragment.html`<span class="name">"${e.replace(/\n/g,"↵")}"</span>`:t?n.Fragment.html`<span class="name"> <span class="private-property-hash">${e[0]}</span>${e.substring(1)} </span>`:n.Fragment.html`<span class="name">${e}</span>`}static valueElementForFunctionDescription(e,t,i){const o=document.createElement("span");o.classList.add("object-value-function");const s=(e=e||"").replace(/^function [gs]et /,"function ").replace(/^function [gs]et\(/,"function(").replace(/^[gs]et /,"");i=i||"";const a=s.match(/^(async\s+function)/),l=s.startsWith("function*"),c=s.startsWith("*"),p=!l&&s.startsWith("function"),d=s.startsWith("class ")||s.startsWith("class{"),h=s.indexOf("=>"),u=!a&&!l&&!p&&!d&&h>0;let m;if(d){m=s.substring("class".length);const e=/^[^{\s]+/.exec(m.trim());let t=i;e&&(t=e[0].trim()||i),v("class",m,t)}else if(a)m=s.substring(a[1].length),v("async ƒ",m,b(m));else if(l)m=s.substring("function*".length),v("ƒ*",m,b(m));else if(c)m=s.substring("*".length),v("ƒ*",m,b(m));else if(p)m=s.substring("function".length),v("ƒ",m,b(m));else if(u){const e=60;let t=s;i?t=i+"()":s.length>e&&(t=s.substring(0,h+2)+" {…}"),v("",s,t)}else v("ƒ",s,b(s));return n.Tooltip.Tooltip.install(o,r.StringUtilities.trimEndWithMaxLength(e,500)),o;function b(e){const t=e.indexOf("("),n=e.match(/\)\s*{/);if(-1!==t&&n&&void 0!==n.index&&n.index>t){return(e.substring(0,t).trim()||i)+e.substring(t,n.index+1)}return i+"()"}function v(e,i,s){e.length&&(o.createChild("span","object-value-function-prefix").textContent=e+" "),t?n.UIUtils.createTextChild(o,r.StringUtilities.trimEndWithMaxLength(i.trim(),200)):n.UIUtils.createTextChild(o,s.replace(/\n/g," "))}}static createPropertyValueWithCustomSupport(e,t,n,i,o){if(e.customPreview()){const t=new z(e).element;return t.classList.add("object-properties-section-custom-section"),new _(t)}return S.createPropertyValue(e,t,n,i,o)}static appendMemoryIcon(e,t){if("object"!==t.type||"arraybuffer"!==t.subtype&&"webassemblymemory"!==t.subtype)return;const r=new l.Icon.Icon;r.data={iconName:"ic_memory_16x16",color:"var(--color-text-secondary)",width:"13px",height:"13px"},r.onclick=e=>{i.userMetrics.linearMemoryInspectorRevealedFrom(i.UserMetrics.LinearMemoryInspectorRevealedFrom.MemoryIcon),o.LinearMemoryInspectorController.LinearMemoryInspectorController.instance().openInspectorView(t),e.stopPropagation()},n.Tooltip.Tooltip.install(r,"Reveal in Memory Inspector panel"),e.classList.add("object-value-with-memory-icon"),e.appendChild(r)}static createPropertyValue(i,o,r,a,l){let c;const p=i.type,d=i.subtype,h=i.description||"",u=i.className;if("object"===p&&"internal#location"===d){const e=i.debuggerModel().createRawLocationByScriptId(i.value.scriptId,i.value.lineNumber,i.value.columnNumber);if(e&&l)return new _(l.linkifyRawLocation(e,""));c=new _(function(){const e=document.createElement("span");return e.textContent="<"+P(C.unknown)+">",n.Tooltip.Tooltip.install(e,h||""),e}())}else if("string"===p&&"string"==typeof h)c=v();else if("object"===p&&"trustedtype"===d)c=function(){const e=document.createElement("span");e.classList.add("object-value-trustedtype");const t=`${u} "${h}"`;let i;if(t.length>I)i=new V(e,t,50);else{const o=v();n.UIUtils.createTextChild(e,`${u} `),e.appendChild(o.element),i=new _(e),n.Tooltip.Tooltip.install(e,t)}return i}();else if("function"===p)c=new _(S.valueElementForFunctionDescription(h));else if("object"===p&&"node"===d&&h)c=new _(function(){const t=document.createElement("span");return t.classList.add("object-value-node"),b(t,h),t.addEventListener("click",(t=>{e.Revealer.reveal(i),t.consume(!0)}),!1),t.addEventListener("mousemove",(()=>s.OverlayModel.OverlayModel.highlightObjectAsDOMNode(i)),!1),t.addEventListener("mouseleave",(()=>s.OverlayModel.OverlayModel.hideDOMNodeHighlight()),!1),t}());else{const e=document.createElement("span");if(e.classList.add("object-value-"+(d||p)),i.preview&&r){(new m).appendObjectPreview(e,i.preview,!1),c=new _(e),n.Tooltip.Tooltip.install(c.element,h||"")}else h.length>I?c=new V(e,h,50):(c=new _(e),c.element.textContent=h,n.Tooltip.Tooltip.install(c.element,h));this.appendMemoryIcon(e,i)}if(o){const e=document.createElement("span");e.classList.add("error"),e.classList.add("value"),e.appendChild(t.i18n.getFormatLocalizedString(j,C.exceptionS,{PH1:c.element})),c.element=e}return c.element.classList.add("value"),c;function v(){const e=document.createElement("span");e.classList.add("object-value-string");const t=JSON.stringify(h);let i;return h.length>I?i=new V(e,t,50):(n.UIUtils.createTextChild(e,t),i=new _(e),n.Tooltip.Tooltip.install(e,h)),i}}static formatObjectAsFunction(t,n,i,o){return t.debuggerModel().functionDetailsPromise(t).then((function(r){i&&r&&r.location&&(n.classList.add("linkified"),n.addEventListener("click",(()=>(e.Revealer.reveal(r.location),!1))));let s=o?"":"anonymous";r&&r.functionName&&(s=r.functionName);const a=S.valueElementForFunctionDescription(t.description,o,s);n.appendChild(a)}))}static isDisplayableProperty(e,t){if(!t||!t.synthetic)return!0;const n=e.name;return!("[[Entries]]"===t.name&&("length"===n||"__proto__"===n))}skipProto(){this.skipProtoInternal=!0}expand(){this.objectTreeElementInternal.expand()}setEditable(e){this.editable=e}objectTreeElement(){return this.objectTreeElementInternal}enableContextMenu(){this.element.addEventListener("contextmenu",this.contextMenuEventFired.bind(this),!1)}contextMenuEventFired(e){const t=new n.ContextMenu.ContextMenu(e);t.appendApplicableItems(this.object),this.object instanceof s.RemoteObject.LocalJSONObject&&(t.viewSection().appendItem(P(C.expandRecursively),this.objectTreeElementInternal.expandRecursively.bind(this.objectTreeElementInternal,Number.MAX_VALUE)),t.viewSection().appendItem(P(C.collapseChildren),this.objectTreeElementInternal.collapseChildren.bind(this.objectTreeElementInternal))),t.show()}titleLessMode(){this.objectTreeElementInternal.listItemElement.classList.add("hidden"),this.objectTreeElementInternal.childrenListElement.classList.add("title-less-mode"),this.objectTreeElementInternal.expand()}}let I=1e4;class L extends n.TreeOutline.TreeOutlineInShadow{editable;constructor(e){super(),this.registerCSSFiles([w,E]),this.editable=!(e&&e.readOnly),this.contentElement.classList.add("source-code"),this.contentElement.classList.add("object-properties-section"),this.hideOverflow()}}class k extends n.TreeOutline.TreeElement{object;linkifier;emptyPlaceholder;propertiesMode;extraProperties;targetObject;toggleOnClick;constructor(e,t,n,i=1,o=[],r=e){super(document.createElement("slot")),this.object=e,this.linkifier=t,this.emptyPlaceholder=n,this.propertiesMode=i,this.extraProperties=o,this.targetObject=r,this.setExpandable(!0),this.selectable=!0,this.toggleOnClick=!0,this.listItemElement.classList.add("object-properties-section-root-element"),this.listItemElement.addEventListener("contextmenu",this.onContextMenu.bind(this),!1)}onexpand(){this.treeOutline&&this.treeOutline.element.classList.add("expanded")}oncollapse(){this.treeOutline&&this.treeOutline.element.classList.remove("expanded")}ondblclick(e){return!0}onContextMenu(e){const t=new n.ContextMenu.ContextMenu(e);if(t.appendApplicableItems(this.object),this.object instanceof s.RemoteObject.LocalJSONObject){const{value:e}=this.object,n="object"==typeof e?JSON.stringify(e,null,2):e,o=()=>{i.userMetrics.actionTaken(i.UserMetrics.Action.NetworkPanelCopyValue),i.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(n)};t.clipboardSection().appendItem(P(C.copyValue),o)}t.viewSection().appendItem(P(C.expandRecursively),this.expandRecursively.bind(this,Number.MAX_VALUE)),t.viewSection().appendItem(P(C.collapseChildren),this.collapseChildren.bind(this)),t.show()}async onpopulate(){const e=this.treeOutline,t=!!e&&Boolean(e.skipProtoInternal);return M.populate(this,this.object,t,!1,this.linkifier,this.emptyPlaceholder,this.propertiesMode,this.extraProperties,this.targetObject)}}class M extends n.TreeOutline.TreeElement{property;toggleOnClick;highlightChanges;linkifier;maxNumPropertiesToShow;nameElement;valueElement;rowContainer;readOnly;prompt;editableDiv;propertyValue;expandedValueElement;constructor(e,t){super(),this.property=e,this.toggleOnClick=!0,this.highlightChanges=[],this.linkifier=t,this.maxNumPropertiesToShow=200,this.listItemElement.addEventListener("contextmenu",this.contextMenuFired.bind(this),!1),this.listItemElement.dataset.objectPropertyNameForTest=e.name}static async populate(e,t,n,i,o,r,a=1,l,c){if(t.arrayLength()>100)return e.removeChildren(),void A.populateArray(e,t,0,t.arrayLength()-1,o);let p,d=null;switch(a){case 0:({properties:p}=await t.getAllProperties(!1,!0));break;case 1:({properties:p,internalProperties:d}=await s.RemoteObject.RemoteObject.loadFromObjectPerProto(t,!0))}e.removeChildren(),p&&(void 0!==l&&p.push(...l),M.populateWithProperties(e,p,d,n,i,c||t,o,r))}static populateWithProperties(e,t,n,i,o,r,a,l){t.sort(S.compareProperties);const c=(n=n||[]).find((e=>"[[Entries]]"===e.name));if(c){T.set(c,r);const t=new M(c,a);t.setExpandable(!0),t.expand(),e.appendChild(t)}const p=[];for(let n=0;n<t.length;++n){const i=t[n];if(T.set(i,r),!S.isDisplayableProperty(i,e.property))continue;if(i.isOwn&&!o){if(i.getter){const e=new s.RemoteObject.RemoteObjectProperty("get "+i.name,i.getter,!1);T.set(e,r),p.push(e)}if(i.setter){const e=new s.RemoteObject.RemoteObjectProperty("set "+i.name,i.setter,!1);T.set(e,r),p.push(e)}}if(i.getter||!i.isAccessorProperty()){const t=new M(i,a);"memories"===i.name&&"Memories"===i.value?.className&&(t.updateExpandable(),t.isExpandable()&&t.expand()),e.appendChild(t)}}for(let t=0;t<p.length;++t)e.appendChild(new M(p[t],a));for(const t of n){T.set(t,r);const n=new M(t,a);"[[Entries]]"!==t.name&&("[[Prototype]]"===t.name&&i||e.appendChild(n))}M.appendEmptyPlaceholderIfNeeded(e,l)}static appendEmptyPlaceholderIfNeeded(e,t){if(e.childCount())return;const i=document.createElement("div");i.classList.add("gray-info-message"),i.textContent=t||P(C.noProperties);const o=new n.TreeOutline.TreeElement(i);e.appendChild(o)}static createRemoteObjectAccessorPropertySpan(e,t,i){const o=document.createElement("span"),r=o.createChild("span");if(r.textContent=P(C.dots),!e)return o;function s(e){let t=this;const n=JSON.parse(e);for(let e=0,i=n.length;e<i;++e)t=t[n[e]];return t}return r.classList.add("object-value-calculate-value-button"),n.Tooltip.Tooltip.install(r,P(C.invokePropertyGetter)),r.addEventListener("click",(function(n){n.consume(),e&&e.callFunction(s,[{value:JSON.stringify(t)}]).then(i)}),!1),o}setSearchRegex(e,t){let i=n.UIUtils.highlightedSearchResultClassName;if(t&&(i+=" "+t),this.revertHighlightChanges(),this.applySearch(e,this.nameElement,i),this.property.value){"object"!==this.property.value.type&&this.applySearch(e,this.valueElement,i)}return Boolean(this.highlightChanges.length)}applySearch(e,t,i){const o=[],r=t.textContent||"";e.lastIndex=0;let s=e.exec(r);for(;s;)o.push(new a.TextRange.SourceRange(s.index,s[0].length)),s=e.exec(r);o.length&&n.UIUtils.highlightRangesWithStyleClass(t,o,i,this.highlightChanges)}showAllPropertiesElementSelected(e){return this.removeChild(e),this.children().forEach((e=>{e.hidden=!1})),!1}createShowAllPropertiesButton(){const e=document.createElement("div");e.classList.add("object-value-calculate-value-button"),e.textContent=P(C.dots),n.Tooltip.Tooltip.install(e,P(C.showAllD,{PH1:this.childCount()}));const t=this.children();for(let e=this.maxNumPropertiesToShow;e<this.childCount();++e)t[e].hidden=!0;const i=new n.TreeOutline.TreeElement(e);i.onselect=this.showAllPropertiesElementSelected.bind(this,i),this.appendChild(i)}revertHighlightChanges(){n.UIUtils.revertDomChanges(this.highlightChanges),this.highlightChanges=[]}async onpopulate(){const e=this.property.value;console.assert(void 0!==e);const t=this.treeOutline,n=!!t&&Boolean(t.skipProtoInternal),i="[[Prototype]]"!==this.property.name?e:T.get(this.property);i&&(await M.populate(this,e,n,!1,this.linkifier,void 0,void 0,void 0,i),this.childCount()>this.maxNumPropertiesToShow&&this.createShowAllPropertiesButton())}ondblclick(e){const t=e.target,n=t.isSelfOrDescendant(this.valueElement)||this.expandedValueElement&&t.isSelfOrDescendant(this.expandedValueElement);return this.property.value&&!this.property.value.customPreview()&&n&&(this.property.writable||this.property.setter)&&this.startEditing(),!1}onenter(){return!(!this.property.value||this.property.value.customPreview()||!this.property.writable&&!this.property.setter)&&(this.startEditing(),!0)}onattach(){this.update(),this.updateExpandable()}onexpand(){this.showExpandedValueElement(!0)}oncollapse(){this.showExpandedValueElement(!1)}showExpandedValueElement(e){this.expandedValueElement&&(e?this.rowContainer.replaceChild(this.expandedValueElement,this.valueElement):this.rowContainer.replaceChild(this.valueElement,this.expandedValueElement))}createExpandedValueElement(e){if(!(e.hasChildren&&!e.customPreview()&&"node"!==e.subtype&&"function"!==e.type&&("object"!==e.type||e.preview)))return null;const t=document.createElement("span");return t.classList.add("value"),"Object"===e.description?t.textContent="":t.setTextContentTruncatedIfNeeded(e.description||""),t.classList.add("object-value-"+(e.subtype||e.type)),n.Tooltip.Tooltip.install(t,e.description||""),S.appendMemoryIcon(t,e),t}update(){this.nameElement=S.createNameElement(this.property.name,this.property.private),this.property.enumerable||this.nameElement.classList.add("object-properties-section-dimmed"),this.property.isOwn&&this.nameElement.classList.add("own-property"),this.property.synthetic&&this.nameElement.classList.add("synthetic-property"),this.updatePropertyPath();const e=this.property.synthetic&&"[[Entries]]"===this.property.name;if(e)this.valueElement=document.createElement("span"),this.valueElement.classList.add("value");else if(this.property.value){const e="[[Prototype]]"!==this.property.name;this.propertyValue=S.createPropertyValueWithCustomSupport(this.property.value,this.property.wasThrown,e,this.listItemElement,this.linkifier),this.valueElement=this.propertyValue.element}else this.property.getter?this.valueElement=M.createRemoteObjectAccessorPropertySpan(T.get(this.property),[this.property.name],this.onInvokeGetterClick.bind(this)):(this.valueElement=document.createElement("span"),this.valueElement.classList.add("object-value-undefined"),this.valueElement.textContent=P(C.unreadable),n.Tooltip.Tooltip.install(this.valueElement,P(C.noPropertyGetter)));const t=this.valueElement.textContent;let i;this.property.value&&t&&!this.property.wasThrown&&(this.expandedValueElement=this.createExpandedValueElement(this.property.value)),this.listItemElement.removeChildren(),i=e?n.Fragment.html`<span class="name-and-value">${this.nameElement}</span>`:n.Fragment.html`<span class="name-and-value">${this.nameElement}: ${this.valueElement}</span>`,this.rowContainer=i,this.listItemElement.appendChild(this.rowContainer)}updatePropertyPath(){if(this.nameElement.title)return;const e=this.property.name;if(this.property.synthetic)return void n.Tooltip.Tooltip.install(this.nameElement,e);const t=this.parent instanceof M&&this.parent.nameElement&&!this.parent.property.synthetic?this.parent.nameElement.title:"";this.property.private||/^(?:[$_\p{ID_Start}])(?:[$_\u200C\u200D\p{ID_Continue}])*$/u.test(e)?n.Tooltip.Tooltip.install(this.nameElement,t?`${t}.${e}`:e):/^(?:0|[1-9]\d*)$/.test(e)?n.Tooltip.Tooltip.install(this.nameElement,`${t}[${e}]`):n.Tooltip.Tooltip.install(this.nameElement,`${t}[${JSON.stringify(e)}]`)}contextMenuFired(e){const t=new n.ContextMenu.ContextMenu(e);if(t.appendApplicableItems(this),this.property.symbol&&t.appendApplicableItems(this.property.symbol),this.property.value&&(t.appendApplicableItems(this.property.value),T.get(this.property)instanceof s.RemoteObject.LocalJSONObject)){const{value:{value:e}}=this.property,n="object"==typeof e?JSON.stringify(e,null,2):e,o=()=>{i.userMetrics.actionTaken(i.UserMetrics.Action.NetworkPanelCopyValue),i.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(n)};t.clipboardSection().appendItem(P(C.copyValue),o)}if(!this.property.synthetic&&this.nameElement&&this.nameElement.title){const e=i.InspectorFrontendHost.InspectorFrontendHostInstance.copyText.bind(i.InspectorFrontendHost.InspectorFrontendHostInstance,this.nameElement.title);t.clipboardSection().appendItem(P(C.copyPropertyPath),e)}T.get(this.property)instanceof s.RemoteObject.LocalJSONObject&&(t.viewSection().appendItem(P(C.expandRecursively),this.expandRecursively.bind(this,Number.MAX_VALUE)),t.viewSection().appendItem(P(C.collapseChildren),this.collapseChildren.bind(this))),this.propertyValue&&this.propertyValue.appendApplicableItems(e,t,{}),t.show()}startEditing(){const e=this.treeOutline;if(this.prompt||!e||!e.editable||this.readOnly)return;if(this.editableDiv=this.rowContainer.createChild("span","editable-div"),this.property.value){let e=this.property.value.description;"string"===this.property.value.type&&"string"==typeof e&&(e=`"${e}"`),this.editableDiv.setTextContentTruncatedIfNeeded(e,P(C.stringIsTooLargeToEdit))}const t=this.editableDiv.textContent||"";this.setExpandable(!1),this.listItemElement.classList.add("editing-sub-part"),this.valueElement.classList.add("hidden"),this.prompt=new U;const n=this.prompt.attachAndStartEditing(this.editableDiv,this.editingCommitted.bind(this,t));n.classList.add("property-prompt");const i=this.listItemElement.getComponentSelection();i&&i.selectAllChildren(this.editableDiv),n.addEventListener("keydown",this.promptKeyDown.bind(this,t),!1)}editingEnded(){this.prompt&&(this.prompt.detach(),delete this.prompt),this.editableDiv.remove(),this.updateExpandable(),this.listItemElement.scrollLeft=0,this.listItemElement.classList.remove("editing-sub-part"),this.select()}editingCancelled(){this.valueElement.classList.remove("hidden"),this.editingEnded()}async editingCommitted(e){const t=this.prompt?this.prompt.text():"";t!==e?(this.editingEnded(),await this.applyExpression(t)):this.editingCancelled()}promptKeyDown(e,t){const n=t;return"Enter"===n.key?(n.consume(),void this.editingCommitted(e)):n.key===r.KeyboardUtilities.ESCAPE_KEY?(n.consume(),void this.editingCancelled()):void 0}async applyExpression(e){const t=s.RemoteObject.RemoteObject.toCallArgument(this.property.symbol||this.property.name);if(e=x.wrapObjectLiteral(e.trim()),this.property.synthetic){let t=!1;if(e&&(t=await this.property.setSyntheticValue(e)),t){const e=this.parent;e&&(e.invalidateChildren(),e.onpopulate())}else this.update();return}const n=T.get(this.property),i=e?n.setPropertyValue(t,e):n.deleteProperty(t);if(await i)this.update();else if(e){const e=this.parent;e&&(e.invalidateChildren(),e.onpopulate())}else this.parent&&this.parent.removeChild(this)}onInvokeGetterClick(e){e.object&&(this.property.value=e.object,this.property.wasThrown=e.wasThrown||!1,this.update(),this.invalidateChildren(),this.updateExpandable())}updateExpandable(){this.property.value?this.setExpandable(!this.property.value.customPreview()&&this.property.value.hasChildren&&!this.property.wasThrown):this.setExpandable(!1)}path(){return this.nameElement.title}}class A extends n.TreeOutline.TreeElement{toggleOnClick;fromIndex;toIndex;object;readOnly;propertyCount;linkifier;constructor(e,t,n,i,o){super(r.StringUtilities.sprintf("[%d … %d]",t,n),!0),this.toggleOnClick=!0,this.fromIndex=t,this.toIndex=n,this.object=e,this.readOnly=!0,this.propertyCount=i,this.linkifier=o}static async populateArray(e,t,n,i,o){await A.populateRanges(e,t,n,i,!0,o)}static async populateRanges(e,t,n,i,o,r){const s=await t.callFunctionJSON((function(e,t,n,i){if(void 0===e||void 0===t||void 0===i||void 0===n)return;let o=null;const r=t-e>=i&&ArrayBuffer.isView(this);function*s(n){if(void 0!==e&&void 0!==t&&void 0!==i)if(t-e<i)for(let i=e;i<=t;++i)i in n&&(yield i);else{o=o||Object.getOwnPropertyNames(n);for(let n=0;n<o.length;++n){const i=o[n],r=Number(i)>>>0;String(r)===i&&e<=r&&r<=t&&(yield r)}}}let a=0;if(r)a=t-e+1;else for(const e of s(this))++a;let l=a;l=a<=n?a:Math.pow(n,Math.ceil(Math.log(a)/Math.log(n))-1);const c=[];if(r)for(let n=e;n<=t;n+=l){const e=n;let i=e+l-1;i>t&&(i=t),c.push([e,i,i-e+1])}else{a=0;let e=-1,t=0;for(const n of s(this))-1===e&&(e=n),t=n,++a===l&&(c.push([e,t,a]),a=0,e=-1);a>0&&c.push([e,t,a])}return{ranges:c}}),[{value:n},{value:i},{value:A.bucketThreshold},{value:A.sparseIterationThreshold}]);await async function(n){if(!n)return;const i=n.ranges;if(1===i.length)await A.populateAsFragment(e,t,i[0][0],i[0][1],r);else for(let n=0;n<i.length;++n){const o=i[n][0],s=i[n][1],a=i[n][2];o===s?await A.populateAsFragment(e,t,o,s,r):e.appendChild(new A(t,o,s,a,r))}o&&await A.populateNonIndexProperties(e,t,r)}(s)}static async populateAsFragment(e,t,n,i,o){const r=await t.callFunction((function(e,t,n){const i=Object.create(null);if(void 0===e||void 0===t||void 0===n)return;if(t-e<n)for(let n=e;n<=t;++n)n in this&&(i[n]=this[n]);else{const n=Object.getOwnPropertyNames(this);for(let o=0;o<n.length;++o){const r=n[o],s=Number(r)>>>0;String(s)===r&&e<=s&&s<=t&&(i[s]=this[s])}}return i}),[{value:n},{value:i},{value:A.sparseIterationThreshold}]);if(!r.object||r.wasThrown)return;const s=r.object,a=await s.getAllProperties(!1,!0);s.release();const l=a.properties;if(l){l.sort(S.compareProperties);for(let t=0;t<l.length;++t){T.set(l[t],this.object);const n=new M(l[t],o);n.readOnly=!0,e.appendChild(n)}}}static async populateNonIndexProperties(e,t,n){const{properties:i,internalProperties:o}=await s.RemoteObject.RemoteObject.loadFromObjectPerProto(t,!0,!0);i&&M.populateWithProperties(e,i,o,!1,!1,t,n)}async onpopulate(){this.propertyCount>=A.bucketThreshold?await A.populateRanges(this,this.object,this.fromIndex,this.toIndex,!1,this.linkifier):await A.populateAsFragment(this,this.object,this.fromIndex,this.toIndex,this.linkifier)}onattach(){this.listItemElement.classList.add("object-properties-section-name")}static bucketThreshold=100;static sparseIterationThreshold=25e4}class U extends n.TextPrompt.TextPrompt{constructor(){super(),this.initialize(c.JavaScript.completeInContext)}}const N=new Map,R=new Map;let F;class D{static instance(e={forceNew:!1}){const{forceNew:t}=e;return F&&!t||(F=new D),F}render(e,t){if(!(e instanceof s.RemoteObject.RemoteObject))return Promise.reject(new Error("Can't render "+e));const n=(t=t||{title:void 0,editable:void 0}).title,i=new S(e,n);return n||i.titleLessMode(),i.editable=Boolean(t.editable),Promise.resolve({node:i.element,tree:i})}}class _{element;constructor(e){this.element=e}appendApplicableItems(e,t,n){}}class V extends _{text;maxLength;expandElement;maxDisplayableTextLength;expandElementText;copyButtonText;constructor(e,t,i){super(e);const o=e.createChild("span");this.text=t,this.maxLength=i,o.textContent=t.slice(0,i),n.Tooltip.Tooltip.install(o,`${t.slice(0,i)}…`),this.expandElement=o.createChild("span"),this.maxDisplayableTextLength=1e7;const s=r.StringUtilities.countWtf8Bytes(t),a=r.NumberUtilities.bytesToString(s);this.text.length<this.maxDisplayableTextLength?(this.expandElementText=P(C.showMoreS,{PH1:a}),this.expandElement.setAttribute("data-text",this.expandElementText),this.expandElement.classList.add("expandable-inline-button"),this.expandElement.addEventListener("click",this.expandText.bind(this)),this.expandElement.addEventListener("keydown",(e=>{const t=e;"Enter"!==t.key&&" "!==t.key||this.expandText()})),n.ARIAUtils.markAsButton(this.expandElement)):(this.expandElement.setAttribute("data-text",P(C.longTextWasTruncatedS,{PH1:a})),this.expandElement.classList.add("undisplayable-text")),this.copyButtonText=P(C.copy);const l=o.createChild("span","expandable-inline-button");l.setAttribute("data-text",this.copyButtonText),l.addEventListener("click",this.copyText.bind(this)),l.addEventListener("keydown",(e=>{const t=e;"Enter"!==t.key&&" "!==t.key||this.copyText()})),n.ARIAUtils.markAsButton(l)}appendApplicableItems(e,t,n){this.text.length<this.maxDisplayableTextLength&&this.expandElement&&t.clipboardSection().appendItem(this.expandElementText||"",this.expandText.bind(this)),t.clipboardSection().appendItem(this.copyButtonText,this.copyText.bind(this))}expandText(){this.expandElement&&(this.expandElement.parentElement&&this.expandElement.parentElement.insertBefore(document.createTextNode(this.text.slice(this.maxLength)),this.expandElement),this.expandElement.remove(),this.expandElement=null)}copyText(){i.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(this.text)}}var H=Object.freeze({__proto__:null,getObjectPropertiesSectionFrom:e=>O.get(e),ObjectPropertiesSection:S,setMaxRenderableStringLength:function(e){I=e},getMaxRenderableStringLength:function(){return I},ObjectPropertiesSectionsTreeOutline:L,RootElement:k,InitialVisibleChildrenLimit:200,ObjectPropertyTreeElement:M,ArrayGroupingTreeElement:A,ObjectPropertyPrompt:U,ObjectPropertiesSectionsTreeExpandController:class{expandedProperties;constructor(e){this.expandedProperties=new Set,e.addEventListener(n.TreeOutline.Events.ElementAttached,this.elementAttached,this),e.addEventListener(n.TreeOutline.Events.ElementExpanded,this.elementExpanded,this),e.addEventListener(n.TreeOutline.Events.ElementCollapsed,this.elementCollapsed,this)}watchSection(e,t){N.set(t,e),this.expandedProperties.has(e)&&t.expand()}stopWatchSectionsWithId(e){for(const t of this.expandedProperties)t.startsWith(e+":")&&this.expandedProperties.delete(t)}elementAttached(e){const t=e.data;t.isExpandable()&&this.expandedProperties.has(this.propertyPath(t))&&t.expand()}elementExpanded(e){const t=e.data;this.expandedProperties.add(this.propertyPath(t))}elementCollapsed(e){const t=e.data;this.expandedProperties.delete(this.propertyPath(t))}propertyPath(e){const t=R.get(e);if(t)return t;let n=e,i=n;if(!e.treeOutline)throw new Error("No tree outline available");const o=e.treeOutline.rootElement();let r;for(;n!==o;){let e="";e=n.property?n.property.name:"string"==typeof n.title?n.title:n.title.textContent||"",r=e+(r?"."+r:""),i=n,n.parent&&(n=n.parent)}return r=N.get(i)+(r?":"+r:""),R.set(e,r),r}},Renderer:D,ObjectPropertyValue:_,ExpandableTextPropertyValue:V});const W=new CSSStyleSheet;W.replaceSync(".custom-expandable-section{display:inline-flex;flex-direction:column}.custom-expand-icon{user-select:none;opacity:50%;margin-right:4px;margin-bottom:-2px;background:var(--color-primary)}.custom-expandable-section-standard-section{display:inline-flex}\n/*# sourceURL=customPreviewComponent.css */\n");const B={showAsJavascriptObject:"Show as JavaScript object"},$=t.i18n.registerUIStrings("ui/legacy/components/object_ui/CustomPreviewComponent.ts",B),J=t.i18n.getLocalizedString.bind(void 0,$);class G{sectionElement;object;expanded;cachedContent;header;expandIcon;constructor(t){this.sectionElement=document.createElement("span"),this.sectionElement.classList.add("custom-expandable-section"),this.object=t,this.expanded=!1,this.cachedContent=null;const i=t.customPreview();if(!i)return;let o;try{o=JSON.parse(i.header)}catch(t){return void e.Console.Console.instance().error("Broken formatter: header is invalid json "+t)}this.header=this.renderJSONMLTag(o),this.header.nodeType!==Node.TEXT_NODE?(i.bodyGetterId&&(this.header instanceof Element&&this.header.classList.add("custom-expandable-section-header"),this.header.addEventListener("click",this.onClick.bind(this),!1),this.expandIcon=n.Icon.Icon.create("smallicon-triangle-right","custom-expand-icon"),this.header.insertBefore(this.expandIcon,this.header.firstChild)),this.sectionElement.appendChild(this.header)):e.Console.Console.instance().error("Broken formatter: header should be an element node.")}element(){return this.sectionElement}renderJSONMLTag(e){if(!Array.isArray(e))return document.createTextNode(String(e));const t=e;return"object"===t[0]?this.layoutObjectTag(t):this.renderElement(t)}renderElement(t){const n=t.shift();if(!G.allowedTags.has(n))return e.Console.Console.instance().error("Broken formatter: element "+n+" is not allowed!"),document.createElement("span");const i=document.createElement(n);if("object"==typeof t[0]&&!Array.isArray(t[0])){const e=t.shift();for(const t in e){const n=e[t];"style"===t&&"string"==typeof n&&i.setAttribute(t,n)}}return this.appendJsonMLTags(i,t),i}layoutObjectTag(e){e.shift();const t=e.shift(),n=this.object.runtimeModel().createRemoteObject(t);if(n.customPreview())return new G(n).element();const i=S.defaultObjectPresentation(n);return i.classList.toggle("custom-expandable-section-standard-section",n.hasChildren),i}appendJsonMLTags(e,t){for(let n=0;n<t.length;++n)e.appendChild(this.renderJSONMLTag(t[n]))}onClick(e){e.consume(!0),this.cachedContent?this.toggleExpand():this.loadBody()}toggleExpand(){this.expanded=!this.expanded,this.header instanceof Element&&this.header.classList.toggle("expanded",this.expanded),this.cachedContent instanceof Element&&this.cachedContent.classList.toggle("hidden",!this.expanded),this.expandIcon&&(this.expanded?this.expandIcon.setIconType("smallicon-triangle-down"):this.expandIcon.setIconType("smallicon-triangle-right"))}async loadBody(){const e=this.object.customPreview();if(e&&e.bodyGetterId){const t=await this.object.callFunctionJSON((e=>e()),[{objectId:e.bodyGetterId}]);if(!t)return;this.cachedContent=this.renderJSONMLTag(t),this.sectionElement.appendChild(this.cachedContent),this.toggleExpand()}}static allowedTags=new Set(["span","div","ol","li","table","tr","td"])}class z{object;customPreviewSection;element;constructor(e){this.object=e,this.customPreviewSection=new G(e),this.element=document.createElement("span"),this.element.classList.add("source-code");const t=n.Utils.createShadowRootWithCoreStyles(this.element,{cssFile:[W],delegatesFocus:void 0});this.element.addEventListener("contextmenu",this.contextMenuEventFired.bind(this),!1),t.appendChild(this.customPreviewSection.element())}expandIfPossible(){const e=this.object.customPreview();e&&e.bodyGetterId&&this.customPreviewSection&&this.customPreviewSection.loadBody()}contextMenuEventFired(e){const t=new n.ContextMenu.ContextMenu(e);this.customPreviewSection&&t.revealSection().appendItem(J(B.showAsJavascriptObject),this.disassemble.bind(this)),t.appendApplicableItems(this.object),t.show()}disassemble(){this.element.shadowRoot&&(this.element.shadowRoot.textContent="",this.customPreviewSection=null,this.element.shadowRoot.appendChild(S.defaultObjectPresentation(this.object)))}}var K=Object.freeze({__proto__:null,CustomPreviewSection:G,CustomPreviewComponent:z});const X=new CSSStyleSheet;X.replaceSync(".object-popover-content{display:block;position:relative;overflow:hidden;flex:1 1 auto}.object-popover-title{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-weight:700;padding-left:18px;padding-bottom:2px}.object-popover-tree{border-top:1px solid var(--color-details-hairline);overflow:auto;width:100%;height:calc(100% - 13px)}.object-popover-container{display:inline-block}.function-popover-title{border-bottom:1px solid var(--color-details-hairline);margin-bottom:3px;padding-bottom:2px;display:flex;justify-content:space-between;align-items:center}.function-popover-title .function-name{font-weight:700}.function-title-link-container{display:flex;align-items:center;position:relative;margin-left:10px}.function-title-link-container .devtools-link{white-space:nowrap;overflow:hidden}\n/*# sourceURL=objectPopover.css */\n");class Q{linkifier;resultHighlightedAsDOM;constructor(e,t){this.linkifier=e,this.resultHighlightedAsDOM=t}dispose(){this.resultHighlightedAsDOM&&s.OverlayModel.OverlayModel.hideDOMNodeHighlight(),this.linkifier&&this.linkifier.dispose()}static async buildObjectPopover(e,t){const i=r.StringUtilities.trimEndWithMaxLength(e.description||"",Y);let o=null;if("object"===e.type){let r=null,a=!1;if("node"===e.subtype&&(s.OverlayModel.OverlayModel.highlightObjectAsDOMNode(e),a=!0),e.customPreview()){const t=new z(e);t.expandIfPossible(),o=t.element}else{o=document.createElement("div"),o.classList.add("object-popover-content"),t.registerCSSFiles([X]);o.createChild("div","monospace object-popover-title").createChild("span").textContent=i,r=new p.Linkifier.Linkifier;const n=new S(e,"",r,!0);n.element.classList.add("object-popover-tree"),n.titleLessMode(),o.appendChild(n.element)}return o.dataset.stableNameForTest="object-popover-content",t.setMaxContentSize(new n.Geometry.Size(300,250)),t.setSizeBehavior("SetExactSize"),t.contentElement.appendChild(o),new Q(r,a)}o=document.createElement("span"),o.dataset.stableNameForTest="object-popover-content",t.registerCSSFiles([w,X]);const a=o.createChild("span","monospace object-value-"+e.type);if(a.style.whiteSpace="pre","string"===e.type?n.UIUtils.createTextChildren(a,`"${i}"`):"function"!==e.type&&(a.textContent=i),"function"!==e.type)return t.contentElement.appendChild(o),new Q(null,!1);S.formatObjectAsFunction(e,a,!0);const l=await e.debuggerModel().functionDetailsPromise(e);if(!l)return null;const c=document.createElement("div");c.classList.add("object-popover-container");const d=c.createChild("div","function-popover-title source-code");d.createChild("span","function-name").textContent=n.UIUtils.beautifyFunctionName(l.functionName);const h=l.location,u=d.createChild("div","function-title-link-container"),m=h&&h.script(),b=m&&m.sourceURL;let v=null;return b&&(v=new p.Linkifier.Linkifier(void 0,void 0,t.positionContent.bind(t)),u.appendChild(v.linkifyRawLocation(h,b))),c.appendChild(o),t.contentElement.appendChild(c),new Q(v,!1)}}const Y=1e4;var q=Object.freeze({__proto__:null,ObjectPopoverHelper:Q});export{K as CustomPreviewComponent,g as JavaScriptREPL,q as ObjectPopoverHelper,H as ObjectPropertiesSection,y as RemoteObjectPreviewFormatter};
