import*as e from"../../../../core/common/common.js";import*as t from"../../../../core/platform/platform.js";import*as i from"../../legacy.js";import*as n from"../../../../core/i18n/i18n.js";import*as s from"../../../components/helpers/helpers.js";import*as o from"../../../lit-html/lit-html.js";import*as r from"../../../../models/text_utils/text_utils.js";import*as a from"../../../../core/sdk/sdk.js";import*as l from"../../../components/icon_button/icon_button.js";import*as h from"../../../../panels/css_overview/css_overview.js";const d=new CSSStyleSheet;d.replaceSync(":host{width:270px;height:350px;user-select:none;padding:16px;overflow:hidden}.bezier-preset-selected>svg{background-color:var(--legacy-selection-bg-color)}.bezier-container{--override-bezier-control-color:#9c27b0;display:flex;margin-top:38px}.-theme-with-dark-background .bezier-container,:host-context(.-theme-with-dark-background) .bezier-container{--override-bezier-control-color:rgb(196 79 216)}.bezier-preset{width:50px;height:50px;padding:5px;margin:auto;background-color:var(--color-background-elevation-1);border-radius:3px}.bezier-preset line.bezier-control-line{stroke:var(--color-text-secondary);stroke-width:1;stroke-linecap:round;fill:none}.bezier-preset circle.bezier-control-circle{fill:var(--color-text-secondary)}.bezier-preset path.bezier-path{stroke:var(--color-background-inverted);stroke-width:2;stroke-linecap:round;fill:none}.bezier-preset-selected line.bezier-control-line,.bezier-preset-selected path.bezier-path{stroke:var(--color-background)}.bezier-preset-selected circle.bezier-control-circle{fill:var(--color-background)}.bezier-curve line.linear-line{stroke:var(--color-background-elevation-2);stroke-width:2;stroke-linecap:round;fill:none}.bezier-curve line.bezier-control-line{stroke:var(--override-bezier-control-color);stroke-width:2;stroke-linecap:round;fill:none;opacity:60%}.bezier-curve circle.bezier-control-circle{fill:var(--override-bezier-control-color);cursor:pointer}.bezier-curve path.bezier-path{stroke:var(--color-background-inverted);stroke-width:3;stroke-linecap:round;fill:none}.bezier-preview-container{position:relative;background-color:var(--color-background);overflow:hidden;border-radius:20px;width:200%;height:20px;z-index:2;flex-shrink:0;opacity:0%}.bezier-preview-animation{background-color:#9c27b0;width:20px;height:20px;border-radius:20px;position:absolute}.bezier-preview-onion{margin-top:-20px;position:relative;z-index:1}.bezier-preview-onion>.bezier-preview-animation{opacity:10%}svg.bezier-preset-modify{background-color:var(--color-background-elevation-1);border-radius:35px;display:inline-block;visibility:hidden;transition:transform .1s cubic-bezier(.4, 0, .2, 1);cursor:pointer;position:absolute}.bezier-preset:hover,svg.bezier-preset-modify:hover{background-color:var(--color-background-elevation-2)}.bezier-preset-selected .bezier-preset:hover{background-color:var(--legacy-selection-bg-color)}.bezier-preset-modify path{stroke-width:2;stroke:var(--color-background-inverted);fill:none}.bezier-preset-selected .bezier-preset-modify{opacity:100%}.bezier-preset-category{width:50px;margin:20px 0;cursor:pointer;transition:transform .1s cubic-bezier(.4, 0, .2, 1)}span.bezier-display-value{width:100%;user-select:text;display:block;text-align:center;line-height:20px;height:20px;cursor:text;white-space:nowrap!important}svg.bezier-curve{margin-left:32px;margin-top:-8px}svg.bezier-preset-modify.bezier-preset-plus{right:0}.bezier-header{margin-top:16px}svg.bezier-preset-modify:active{transform:scale(1.1);background-color:var(--legacy-selection-bg-color)}.bezier-preset-category:active{transform:scale(1.05)}.bezier-header-active>svg.bezier-preset-modify{visibility:visible}.bezier-preset-modify:active path{stroke:var(--color-background)}\n/*# sourceURL=bezierEditor.css */\n");class c{width;height;marginTop;radius;linearLine;constructor(e,t,i,n,s){this.width=e,this.height=t,this.marginTop=i,this.radius=n,this.linearLine=s}static drawVelocityChart(e,t,i){const n=u;let s=["M",0,n];const o=1/40;let r=e.evaluateAt(0);for(let t=o;t<1.025;t+=o){const o=e.evaluateAt(t);let a=(o.y-r.y)/(o.x-r.x);const l=r.x*(1-t)+o.x*t;a=Math.tanh(a/1.5),s=s.concat(["L",(l*i).toFixed(2),(n-a*n).toFixed(2)]),r=o}s=s.concat(["L",i.toFixed(2),n,"Z"]),t.setAttribute("d",s.join(" "))}curveWidth(){return this.width-2*this.radius}curveHeight(){return this.height-2*this.radius-2*this.marginTop}drawLine(e,t,n,s,o,r){const a=i.UIUtils.createSVGChild(e,"line",t);a.setAttribute("x1",String(n+this.radius)),a.setAttribute("y1",String(s+this.radius+this.marginTop)),a.setAttribute("x2",String(o+this.radius)),a.setAttribute("y2",String(r+this.radius+this.marginTop))}drawControlPoints(e,t,n,s,o){this.drawLine(e,"bezier-control-line",t,n,s,o);const r=i.UIUtils.createSVGChild(e,"circle","bezier-control-circle");r.setAttribute("cx",String(s+this.radius)),r.setAttribute("cy",String(o+this.radius+this.marginTop)),r.setAttribute("r",String(this.radius))}drawCurve(e,t){if(!e)return;const n=this.curveWidth(),s=this.curveHeight();t.setAttribute("width",String(this.width)),t.setAttribute("height",String(this.height)),t.removeChildren();const o=i.UIUtils.createSVGChild(t,"g");this.linearLine&&this.drawLine(o,"linear-line",0,s,n,0);const r=i.UIUtils.createSVGChild(o,"path","bezier-path"),a=[new i.Geometry.Point(e.controlPoints[0].x*n+this.radius,(1-e.controlPoints[0].y)*s+this.radius+this.marginTop),new i.Geometry.Point(e.controlPoints[1].x*n+this.radius,(1-e.controlPoints[1].y)*s+this.radius+this.marginTop),new i.Geometry.Point(n+this.radius,this.marginTop+this.radius)];r.setAttribute("d","M"+this.radius+","+(s+this.radius+this.marginTop)+" C"+a.join(" ")),this.drawControlPoints(o,0,s,e.controlPoints[0].x*n,(1-e.controlPoints[0].y)*s),this.drawControlPoints(o,n,0,e.controlPoints[1].x*n,(1-e.controlPoints[1].y)*s)}}const u=26;var p,m=Object.freeze({__proto__:null,BezierUI:c,Height:u});class g extends(e.ObjectWrapper.eventMixin(i.Widget.VBox)){bezierInternal;previewElement;previewOnion;outerContainer;selectedCategory;presetsContainer;presetUI;presetCategories;curveUI;curve;header;label;mouseDownPosition;controlPosition;selectedPoint;previewAnimation;constructor(e){super(!0),this.bezierInternal=e,this.contentElement.tabIndex=0,this.setDefaultFocusedElement(this.contentElement),this.previewElement=this.contentElement.createChild("div","bezier-preview-container"),this.previewElement.createChild("div","bezier-preview-animation"),this.previewElement.addEventListener("click",this.startPreviewAnimation.bind(this)),this.previewOnion=this.contentElement.createChild("div","bezier-preview-onion"),this.previewOnion.addEventListener("click",this.startPreviewAnimation.bind(this)),this.outerContainer=this.contentElement.createChild("div","bezier-container"),this.selectedCategory=null,this.presetsContainer=this.outerContainer.createChild("div","bezier-presets"),this.presetUI=new c(40,40,0,2,!1),this.presetCategories=[];for(let e=0;e<v.length;e++)this.presetCategories[e]=this.createCategory(v[e]),this.presetsContainer.appendChild(this.presetCategories[e].icon);this.curveUI=new c(150,250,50,7,!0),this.curve=i.UIUtils.createSVGChild(this.outerContainer,"svg","bezier-curve"),i.UIUtils.installDragHandle(this.curve,this.dragStart.bind(this),this.dragMove.bind(this),this.dragEnd.bind(this),"default"),this.header=this.contentElement.createChild("div","bezier-header");const t=this.createPresetModifyIcon(this.header,"bezier-preset-minus","M 12 6 L 8 10 L 12 14"),n=this.createPresetModifyIcon(this.header,"bezier-preset-plus","M 8 6 L 12 10 L 8 14");t.addEventListener("click",this.presetModifyClicked.bind(this,!1)),n.addEventListener("click",this.presetModifyClicked.bind(this,!0)),this.label=this.header.createChild("span","source-code bezier-display-value")}setBezier(e){e&&(this.bezierInternal=e,this.updateUI())}bezier(){return this.bezierInternal}wasShown(){this.registerCSSFiles([d]),this.unselectPresets();for(const e of this.presetCategories)for(let t=0;t<e.presets.length;t++)this.bezierInternal.asCSSText()===e.presets[t].value&&(e.presetIndex=t,this.presetCategorySelected(e));this.updateUI(),this.startPreviewAnimation()}onchange(){this.updateUI(),this.dispatchEventToListeners(p.BezierChanged,this.bezierInternal.asCSSText())}updateUI(){const e=this.selectedCategory?this.selectedCategory.presets[this.selectedCategory.presetIndex].name:this.bezierInternal.asCSSText().replace(/\s(-\d\.\d)/g,"$1");this.label.textContent=e,this.curveUI.drawCurve(this.bezierInternal,this.curve),this.previewOnion.removeChildren()}dragStart(e){this.mouseDownPosition=new i.Geometry.Point(e.x,e.y);const n=this.curveUI;this.controlPosition=new i.Geometry.Point(t.NumberUtilities.clamp((e.offsetX-n.radius)/n.curveWidth(),0,1),(n.curveHeight()+n.marginTop+n.radius-e.offsetY)/n.curveHeight());const s=this.controlPosition.distanceTo(this.bezierInternal.controlPoints[0])<this.controlPosition.distanceTo(this.bezierInternal.controlPoints[1]);return this.selectedPoint=s?0:1,this.bezierInternal.controlPoints[this.selectedPoint]=this.controlPosition,this.unselectPresets(),this.onchange(),e.consume(!0),!0}updateControlPosition(e,n){if(void 0===this.mouseDownPosition||void 0===this.controlPosition||void 0===this.selectedPoint)return;const s=(e-this.mouseDownPosition.x)/this.curveUI.curveWidth(),o=(n-this.mouseDownPosition.y)/this.curveUI.curveHeight(),r=new i.Geometry.Point(t.NumberUtilities.clamp(this.controlPosition.x+s,0,1),this.controlPosition.y-o);this.bezierInternal.controlPoints[this.selectedPoint]=r}dragMove(e){this.updateControlPosition(e.x,e.y),this.onchange()}dragEnd(e){this.updateControlPosition(e.x,e.y),this.onchange(),this.startPreviewAnimation()}createCategory(e){const t=document.createElement("div");t.classList.add("bezier-preset-category");const n=i.UIUtils.createSVGChild(t,"svg","bezier-preset monospace"),s={presets:e,presetIndex:0,icon:t};return this.presetUI.drawCurve(i.Geometry.CubicBezier.parse(s.presets[0].value),n),n.addEventListener("click",this.presetCategorySelected.bind(this,s)),s}createPresetModifyIcon(e,t,n){const s=i.UIUtils.createSVGChild(e,"svg","bezier-preset-modify "+t);s.setAttribute("width","20"),s.setAttribute("height","20");return i.UIUtils.createSVGChild(s,"path").setAttribute("d",n),s}unselectPresets(){for(const e of this.presetCategories)e.icon.classList.remove("bezier-preset-selected");this.selectedCategory=null,this.header.classList.remove("bezier-header-active")}presetCategorySelected(e,t){if(this.selectedCategory===e)return;this.unselectPresets(),this.header.classList.add("bezier-header-active"),this.selectedCategory=e,this.selectedCategory.icon.classList.add("bezier-preset-selected");const n=i.Geometry.CubicBezier.parse(e.presets[e.presetIndex].value);n&&(this.setBezier(n),this.onchange(),this.startPreviewAnimation()),t&&t.consume(!0)}presetModifyClicked(e,t){if(null===this.selectedCategory)return;const n=this.selectedCategory.presets.length;this.selectedCategory.presetIndex=(this.selectedCategory.presetIndex+(e?1:-1)+n)%n;const s=i.Geometry.CubicBezier.parse(this.selectedCategory.presets[this.selectedCategory.presetIndex].value);s&&(this.setBezier(s),this.onchange(),this.startPreviewAnimation())}startPreviewAnimation(){this.previewAnimation&&this.previewAnimation.cancel();const e=1600,t=[{offset:0,transform:"translateX(0px)",easing:this.bezierInternal.asCSSText(),opacity:1},{offset:.9,transform:"translateX(218px)",opacity:1},{offset:1,transform:"translateX(218px)",opacity:0}];this.previewAnimation=this.previewElement.animate(t,e),this.previewOnion.removeChildren();for(let t=0;t<=20;t++){const i=this.previewOnion.createChild("div","bezier-preview-animation").animate([{transform:"translateX(0px)",easing:this.bezierInternal.asCSSText()},{transform:"translateX(218px)"}],{duration:e,fill:"forwards"});i.pause(),i.currentTime=e*t/20}}}(p||(p={})).BezierChanged="BezierChanged";const v=[[{name:"ease-in-out",value:"ease-in-out"},{name:"In Out · Sine",value:"cubic-bezier(0.45, 0.05, 0.55, 0.95)"},{name:"In Out · Quadratic",value:"cubic-bezier(0.46, 0.03, 0.52, 0.96)"},{name:"In Out · Cubic",value:"cubic-bezier(0.65, 0.05, 0.36, 1)"},{name:"Fast Out, Slow In",value:"cubic-bezier(0.4, 0, 0.2, 1)"},{name:"In Out · Back",value:"cubic-bezier(0.68, -0.55, 0.27, 1.55)"}],[{name:"Fast Out, Linear In",value:"cubic-bezier(0.4, 0, 1, 1)"},{name:"ease-in",value:"ease-in"},{name:"In · Sine",value:"cubic-bezier(0.47, 0, 0.75, 0.72)"},{name:"In · Quadratic",value:"cubic-bezier(0.55, 0.09, 0.68, 0.53)"},{name:"In · Cubic",value:"cubic-bezier(0.55, 0.06, 0.68, 0.19)"},{name:"In · Back",value:"cubic-bezier(0.6, -0.28, 0.74, 0.05)"}],[{name:"ease-out",value:"ease-out"},{name:"Out · Sine",value:"cubic-bezier(0.39, 0.58, 0.57, 1)"},{name:"Out · Quadratic",value:"cubic-bezier(0.25, 0.46, 0.45, 0.94)"},{name:"Out · Cubic",value:"cubic-bezier(0.22, 0.61, 0.36, 1)"},{name:"Linear Out, Slow In",value:"cubic-bezier(0, 0, 0.2, 1)"},{name:"Out · Back",value:"cubic-bezier(0.18, 0.89, 0.32, 1.28)"}]];var f=Object.freeze({__proto__:null,BezierEditor:g,get Events(){return p},Presets:v});const x=new CSSStyleSheet;x.replaceSync(":host{white-space:nowrap}.color-swatch{position:relative;margin-left:1px;margin-right:2px;width:10px;height:10px;top:1px;display:inline-block;user-select:none;background-image:var(--image-file-checker);line-height:10px}.color-swatch-inner{width:100%;height:100%;display:inline-block;border:1px solid rgb(128 128 128 / 60%);box-sizing:border-box;cursor:pointer}.color-swatch:not(.read-only) .color-swatch-inner:hover{border:1px solid rgb(64 64 64 / 80%)}@media (forced-colors:active){.color-swatch{forced-color-adjust:none}}\n/*# sourceURL=colorSwatch.css */\n");const b={shiftclickToChangeColorFormat:"Shift-click to change color format"},w=n.i18n.registerUIStrings("ui/legacy/components/inline_editor/ColorSwatch.ts",b),S=n.i18n.getLocalizedString.bind(void 0,w);class y extends Event{static eventName="formatchanged";data;constructor(e,t){super(y.eventName,{}),this.data={format:e,text:t}}}class I extends Event{static eventName="swatchclick";constructor(){super(I.eventName,{})}}class C extends HTMLElement{static litTagName=o.literal`devtools-color-swatch`;shadow=this.attachShadow({mode:"open"});tooltip=S(b.shiftclickToChangeColorFormat);text=null;color=null;format=null;constructor(){super(),this.shadow.adoptedStyleSheets=[x]}static isColorSwatch(e){return"devtools-color-swatch"===e.localName}getColor(){return this.color}getFormat(){return this.format}get anchorBox(){const e=this.shadow.querySelector(".color-swatch");return e?e.boxInWindow():null}renderColor(t,i,n){if("string"==typeof t){if(this.color=e.Color.Color.parse(t),this.text=t,!this.color)return void this.renderTextOnly()}else this.color=t;this.format="boolean"==typeof i&&i?e.Settings.detectColorFormat(this.color):"string"==typeof i?i:this.color.format(),this.text=this.color.asString(this.format),n&&(this.tooltip=n),this.render()}renderTextOnly(){o.render(this.text,this.shadow,{host:this})}render(){o.render(o.html`<span class="color-swatch" title="${this.tooltip}"><span class="color-swatch-inner" style="background-color: ${this.text};" @click="${this.onClick}" @mousedown="${this.consume}" @dblclick="${this.consume}"></span></span><slot><span>${this.text}</span></slot>`,this.shadow,{host:this})}onClick(e){e.stopPropagation(),e.shiftKey?this.toggleNextFormat():this.dispatchEvent(new I)}consume(e){e.stopPropagation()}toggleNextFormat(){if(!this.color||!this.format)return;let e;do{this.format=k(this.color,this.format),e=this.color.asString(this.format)}while(e===this.text);e&&(this.text=e,this.render(),this.dispatchEvent(new y(this.format,this.text)))}}function k(t,i){const n=e.Color.Format;switch(i){case n.Original:return t.hasAlpha()?n.RGBA:n.RGB;case n.RGB:case n.RGBA:return t.hasAlpha()?n.HSLA:n.HSL;case n.HSL:case n.HSLA:return t.nickname()?n.Nickname:t.detectHEXFormat();case n.ShortHEX:return n.HEX;case n.ShortHEXA:return n.HEXA;case n.HEXA:case n.HEX:return n.Original;case n.Nickname:return t.detectHEXFormat();default:return n.RGBA}}s.CustomElements.defineComponent("devtools-color-swatch",C);var E=Object.freeze({__proto__:null,FormatChangedEvent:y,ClickEvent:I,ColorSwatch:C});const z=new CSSStyleSheet;z.replaceSync(".css-angle{display:inline-block;position:relative;outline:0}devtools-css-angle-swatch{display:inline-block;margin-right:2px;user-select:none}devtools-css-angle-editor{--override-dial-color:#a3a3a3;position:fixed;z-index:2}.preview{display:inline-block}\n/*# sourceURL=cssAngle.css */\n");const P=/(?<value>[+-]?\d*\.?\d+)(?<unit>deg|grad|rad|turn)/,T=e=>{const t=e.match(P);return t&&t.groups?{value:Number(t.groups.value),unit:t.groups.unit}:null},L=(e,t)=>{let n=e;switch(t){case"grad":n=i.Geometry.radiansToGradians(e);break;case"deg":n=i.Geometry.radiansToDegrees(e);break;case"turn":n=i.Geometry.radiansToTurns(e)}return{value:n,unit:t}},U=e=>{switch(e.unit){case"deg":return i.Geometry.degreesToRadians(e.value);case"grad":return i.Geometry.gradiansToRadians(e.value);case"turn":return i.Geometry.turnsToRadians(e.value)}return e.value},M=(e,t)=>{const i=U(e);return{translateX:Math.sin(i)*t,translateY:-Math.cos(i)*t}},A=e=>{let i=e.value;switch(e.unit){case"deg":case"grad":i=Math.round(e.value);break;case"rad":i=Math.round(1e4*e.value)/1e4;break;case"turn":i=Math.round(100*e.value)/100;break;default:t.assertNever(e.unit,`Unknown angle unit: ${e.unit}`)}return{value:i,unit:e.unit}},F=e=>{switch(e){case"deg":return"grad";case"grad":return"rad";case"rad":return"turn";default:return"deg"}},B=(e,t)=>{if(e.unit===t)return e;const i=U(e);return L(i,t)},R=(e,t)=>{const n=i.UIUtils.getValueModificationDirection(t);if(null===n)return;let s="Up"===n?Math.PI/180:-Math.PI/180;t.shiftKey&&(s*=10);const o=U(e);return L(o+s,e.unit)};var O=Object.freeze({__proto__:null,CSSAngleRegex:P,parseText:T,getAngleFromRadians:L,getRadiansFromAngle:U,get2DTranslationsForAngle:M,roundAngleByUnit:A,getNextUnit:F,convertAngleUnit:B,getNewAngleFromEvent:R});class N extends Event{static eventName="valuechanged";data;constructor(e){super(N.eventName,{}),this.data={value:e}}}var V=Object.freeze({__proto__:null,ValueChangedEvent:N});const _=new CSSStyleSheet;_.replaceSync('.editor.interacting::before{content:"";position:fixed;inset:0}.center,.clock,.dial,.hand,.pointer{position:absolute}.clock{top:6px;width:6em;height:6em;background-color:var(--color-background);border:.5em solid var(--color-background-elevation-1);border-radius:9em;box-shadow:var(--drop-shadow),inset 0 0 15px var(--box-shadow-outline-color);transform:translateX(-3em)}.center,.hand{box-shadow:0 0 2px var(--box-shadow-outline-color)}.pointer{margin:auto;top:0;left:-.4em;right:0;width:0;height:0;border-style:solid;border-width:0 .9em .9em;border-color:transparent transparent var(--color-background-elevation-1) transparent}.center,.dial,.hand{margin:auto;top:0;left:0;right:0;bottom:0}.center{width:.7em;height:.7em;border-radius:10px}.dial{width:2px;height:var(--clock-dial-length);background-color:var(--override-dial-color);border-radius:1px}.hand{height:50%;width:.3em;background:var(--legacy-accent-fg-color)}.hand::before{content:"";display:inline-block;position:absolute;top:-.6em;left:-.35em;width:1em;height:1em;border-radius:50%;cursor:pointer;box-shadow:0 0 5px var(--box-shadow-outline-color)}.center,.hand::before{background-color:var(--legacy-accent-fg-color)}:host-context(.-theme-with-dark-background) .hand::before{box-shadow:0 0 5px hsl(0deg 0% 0% / 80%)}:host-context(.-theme-with-dark-background) .center,:host-context(.-theme-with-dark-background) .hand{box-shadow:0 0 2px hsl(0deg 0% 0% / 60%)}:host-context(.-theme-with-dark-background) .clock{background-color:hsl(225deg 5% 27%)}\n/*# sourceURL=cssAngleEditor.css */\n');const{render:H,html:D}=o,$=o.Directives.styleMap;class X extends HTMLElement{static litTagName=o.literal`devtools-css-angle-editor`;shadow=this.attachShadow({mode:"open"});angle={value:0,unit:"rad"};onAngleUpdate;background="";clockRadius=38.5;dialTemplates;mousemoveThrottler=new e.Throttler.Throttler(16.67);mousemoveListener=this.onMousemove.bind(this);connectedCallback(){this.shadow.adoptedStyleSheets=[_],s.SetCSSProperty.set(this,"--clock-dial-length","6px")}set data(e){this.angle=e.angle,this.onAngleUpdate=e.onAngleUpdate,this.background=e.background,this.render()}updateAngleFromMousePosition(e,t,i){const n=this.shadow.querySelector(".clock");if(!n||!this.onAngleUpdate)return;const{top:s,right:o,bottom:r,left:a}=n.getBoundingClientRect();this.clockRadius=(o-a)/2;const l=(a+o)/2,h=(r+s)/2,d=-Math.atan2(e-l,t-h)+Math.PI;if(i){const e=U({value:15,unit:"deg"}),t=Math.round(d/e)*e;this.onAngleUpdate(L(t,this.angle.unit))}else this.onAngleUpdate(L(d,this.angle.unit))}onEditorMousedown(e){e.stopPropagation(),this.updateAngleFromMousePosition(e.pageX,e.pageY,e.shiftKey);const t=e.target instanceof Node&&e.target.ownerDocument,i=this.shadow.querySelector(".editor");t&&i&&(t.addEventListener("mousemove",this.mousemoveListener,{capture:!0}),i.classList.add("interacting"),t.addEventListener("mouseup",(()=>{t.removeEventListener("mousemove",this.mousemoveListener,{capture:!0}),i.classList.remove("interacting")}),{once:!0}))}onMousemove(e){1===e.buttons&&(e.preventDefault(),this.mousemoveThrottler.schedule((()=>(this.updateAngleFromMousePosition(e.pageX,e.pageY,e.shiftKey),Promise.resolve()))))}onEditorWheel(e){if(!this.onAngleUpdate)return;const t=R(this.angle,e);t&&this.onAngleUpdate(t),e.preventDefault()}render(){const e={background:this.background},{translateX:t,translateY:i}=M(this.angle,this.clockRadius/2),n={transform:`translate(${t}px, ${i}px) rotate(${this.angle.value}${this.angle.unit})`};H(D` <div class="editor"> <span class="pointer"></span> <div class="clock" style="${$(e)}" @mousedown="${this.onEditorMousedown}" @wheel="${this.onEditorWheel}"> ${this.renderDials()} <div class="hand" style="${$(n)}"></div> <span class="center"></span> </div> </div> `,this.shadow,{host:this})}renderDials(){return this.dialTemplates||(this.dialTemplates=[0,45,90,135,180,225,270,315].map((e=>{const t=this.clockRadius-6-3,{translateX:i,translateY:n}=M({value:e,unit:"deg"},t);return D`<span class="dial" style="${$({transform:`translate(${i}px, ${n}px) rotate(${e}deg)`})}"></span>`}))),this.dialTemplates}}s.CustomElements.defineComponent("devtools-css-angle-editor",X);const G=new CSSStyleSheet;G.replaceSync(".swatch{position:relative;display:inline-block;margin-bottom:-2px;width:1em;height:1em;border:1px solid var(--legacy-selection-inactive-fg-color);border-radius:50%;overflow:hidden;cursor:pointer;background-color:var(--color-background-elevation-1)}.mini-hand{position:absolute;margin:auto;top:0;left:0;right:0;bottom:0;height:55%;width:2px;background-color:var(--legacy-accent-fg-color);border-radius:5px}\n/*# sourceURL=cssAngleSwatch.css */\n");const{render:j,html:Y}=o,K=o.Directives.styleMap;class W extends HTMLElement{static litTagName=o.literal`devtools-css-angle-swatch`;shadow=this.attachShadow({mode:"open"});angle={value:0,unit:"rad"};connectedCallback(){this.shadow.adoptedStyleSheets=[G]}set data(e){this.angle=e.angle,this.render()}render(){const{translateX:e,translateY:t}=M(this.angle,2.75),i={transform:`translate(${e}px, ${t}px) rotate(${this.angle.value}${this.angle.unit})`};j(Y` <div class="swatch"> <span class="mini-hand" style="${K(i)}"></span> </div> `,this.shadow,{host:this})}}s.CustomElements.defineComponent("devtools-css-angle-swatch",W);const{render:q,html:Z}=o,Q=o.Directives.styleMap,J=new Set(["color","background","background-color"]);class ee extends Event{static eventName="popovertoggled";data;constructor(e){super(ee.eventName,{}),this.data={open:e}}}class te extends Event{static eventName="unitchanged";data;constructor(e){super(te.eventName,{}),this.data={value:e}}}const ie={value:0,unit:"rad"};class ne extends HTMLElement{static litTagName=o.literal`devtools-css-angle`;shadow=this.attachShadow({mode:"open"});angle=ie;displayedAngle=ie;propertyName="";propertyValue="";containingPane;angleElement=null;swatchElement=null;popoverOpen=!1;popoverStyleTop="";popoverStyleLeft="";onMinifyingAction=this.minify.bind(this);onAngleUpdate=this.updateAngle.bind(this);connectedCallback(){this.shadow.adoptedStyleSheets=[z]}set data(e){const t=T(e.angleText);t&&(this.angle=t,this.displayedAngle={...t},this.propertyName=e.propertyName,this.propertyValue=e.propertyValue,this.containingPane=e.containingPane,this.render())}disconnectedCallback(){this.unbindMinifyingAction()}popover(){if(!this.containingPane)return;if(this.angleElement||(this.angleElement=this.shadow.querySelector(".css-angle")),this.swatchElement||(this.swatchElement=this.shadow.querySelector("devtools-css-angle-swatch")),!this.angleElement||!this.swatchElement)return;this.dispatchEvent(new ee(!0)),this.bindMinifyingAction();const e=this.swatchElement.getBoundingClientRect().bottom,t=this.swatchElement.getBoundingClientRect().left;if(e&&t){const i=this.containingPane.getBoundingClientRect().top,n=this.containingPane.getBoundingClientRect().left;this.popoverStyleTop=e-i+"px",this.popoverStyleLeft=t-n+"px"}this.popoverOpen=!0,this.render(),this.angleElement.focus()}minify(){!1!==this.popoverOpen&&(this.popoverOpen=!1,this.dispatchEvent(new ee(!1)),this.unbindMinifyingAction(),this.render())}updateProperty(e,t){this.propertyName=e,this.propertyValue=t,this.render()}updateAngle(e){this.displayedAngle=A(B(e,this.displayedAngle.unit)),this.angle=this.displayedAngle,this.dispatchEvent(new N(`${this.angle.value}${this.angle.unit}`))}displayNextUnit(){const e=F(this.displayedAngle.unit);this.displayedAngle=A(B(this.angle,e)),this.dispatchEvent(new te(`${this.displayedAngle.value}${this.displayedAngle.unit}`))}bindMinifyingAction(){document.addEventListener("mousedown",this.onMinifyingAction),this.containingPane&&this.containingPane.addEventListener("scroll",this.onMinifyingAction)}unbindMinifyingAction(){document.removeEventListener("mousedown",this.onMinifyingAction),this.containingPane&&this.containingPane.removeEventListener("scroll",this.onMinifyingAction)}onMiniIconClick(e){e.stopPropagation(),!e.shiftKey||this.popoverOpen?this.popoverOpen?this.minify():this.popover():this.displayNextUnit()}consume(e){e.stopPropagation()}onKeydown(e){if(this.popoverOpen)switch(e.key){case"Escape":e.stopPropagation(),this.minify(),this.blur();break;case"ArrowUp":case"ArrowDown":{const t=R(this.angle,e);t&&this.updateAngle(t),e.preventDefault();break}}}render(){q(Z` <div class="css-angle" @keydown="${this.onKeydown}" tabindex="-1"> <div class="preview"> <${W.litTagName} @click="${this.onMiniIconClick}" @mousedown="${this.consume}" @dblclick="${this.consume}" .data="${{angle:this.angle}}"> </${W.litTagName}><slot></slot></div> ${this.popoverOpen?this.renderPopover():null} </div> `,this.shadow,{host:this})}renderPopover(){let e="";return J.has(this.propertyName)&&!this.propertyValue.match(/url\(.*\)/i)&&(e=this.propertyValue),Z` <${X.litTagName} class="popover popover-css-angle" style="${Q({top:this.popoverStyleTop,left:this.popoverStyleLeft})}" .data="${{angle:this.angle,onAngleUpdate:this.onAngleUpdate,background:e}}"></${X.litTagName}> `}}s.CustomElements.defineComponent("devtools-css-angle",ne);var se=Object.freeze({__proto__:null,PopoverToggledEvent:ee,UnitChangedEvent:te,CSSAngle:ne});const oe=new CSSStyleSheet;oe.replaceSync('.css-length{display:inline-block;position:relative;outline:0}.value{cursor:ew-resize}.unit-dropdown{display:none}.unit-dropdown select{all:unset;cursor:pointer;opacity:0%;width:.8em}.icon{position:absolute;display:inline-block;-webkit-mask-image:var(--image-file-chevrons);-webkit-mask-position:-12px 4px;-webkit-mask-size:19px 6px;-webkit-mask-repeat:no-repeat;background-color:var(--color-text-primary);content:"";height:1em;width:1em}:host(:not(:last-child)){margin-right:.1em}:host(:not(:last-child)) .unit-dropdown{position:absolute}.css-length:hover .unit-dropdown{display:inline-block}:host(:last-child) .unit-dropdown select{width:.6em}\n/*# sourceURL=cssLength.css */\n');const re=["px","cm","mm","in","pc","pt","ch","em","rem","vh","vw","vmin","vmax"],ae=new RegExp(`(?<value>[+-]?\\d*\\.?\\d+)(?<unit>${re.join("|")})`),le=e=>{const t=e.match(ae);return t&&t.groups?{value:Number(t.groups.value),unit:t.groups.unit}:null};var he=Object.freeze({__proto__:null,LENGTH_UNITS:re,CSSLengthRegex:ae,parseText:le});const{render:de,html:ce}=o;class ue extends Event{static eventName="draggingfinished";constructor(){super(ue.eventName,{})}}const pe={value:0,unit:"px"};class me extends HTMLElement{static litTagName=o.literal`devtools-css-length`;shadow=this.attachShadow({mode:"open"});onDraggingValue=this.dragValue.bind(this);length=pe;isEditingSlot=!1;isDraggingValue=!1;currentMouseClientX=0;set data(e){const t=le(e.lengthText);t&&(this.length=t,this.render())}connectedCallback(){this.shadow.adoptedStyleSheets=[oe]}onUnitChange(e){this.length.unit=e.target.value,this.dispatchEvent(new N(`${this.length.value}${this.length.unit}`)),this.dispatchEvent(new ue),this.render()}dragValue(e){e.preventDefault(),e.stopPropagation(),this.isDraggingValue=!0;let t=e.clientX-this.currentMouseClientX;this.currentMouseClientX=e.clientX,e.shiftKey&&(t*=10),e.altKey&&(t*=.1),this.length.value=this.length.value+t,this.dispatchEvent(new N(`${this.length.value}${this.length.unit}`)),this.render()}onValueMousedown(e){if(0!==e.button)return;this.currentMouseClientX=e.clientX;const t=e.target instanceof Node&&e.target.ownerDocument;t&&(t.addEventListener("mousemove",this.onDraggingValue,{capture:!0}),t.addEventListener("mouseup",(e=>{t.removeEventListener("mousemove",this.onDraggingValue,{capture:!0}),this.isDraggingValue&&(e.preventDefault(),e.stopPropagation(),this.isDraggingValue=!1,this.dispatchEvent(new ue))}),{once:!0,capture:!0}))}onValueMouseup(){this.isDraggingValue||(this.isEditingSlot=!0,this.render())}onUnitMouseup(e){e.preventDefault(),e.stopPropagation()}render(){de(ce` <div class="css-length"> ${this.renderContent()} </div> `,this.shadow,{host:this})}renderContent(){if(this.isEditingSlot)return ce`<slot></slot>`;const e=re.map((e=>ce` <option value="${e}" .selected="${this.length.unit===e}">${e}</option> `));return ce` <span class="value" @mousedown="${this.onValueMousedown}" @mouseup="${this.onValueMouseup}">${this.length.value}</span><span class="unit">${this.length.unit}</span><div class="unit-dropdown"> <span class="icon"></span> <select @mouseup="${this.onUnitMouseup}" @change="${this.onUnitChange}"> ${e} </select> </div> `}}s.CustomElements.defineComponent("devtools-css-length",me);var ge=Object.freeze({__proto__:null,DraggingFinishedEvent:ue,CSSLength:me});class ve{isBoxShadowInternal;insetInternal;offsetXInternal;offsetYInternal;blurRadiusInternal;spreadRadiusInternal;colorInternal;format;important;constructor(t){this.isBoxShadowInternal=t,this.insetInternal=!1,this.offsetXInternal=fe.zero(),this.offsetYInternal=fe.zero(),this.blurRadiusInternal=fe.zero(),this.spreadRadiusInternal=fe.zero(),this.colorInternal=e.Color.Color.parse("black"),this.format=["X","Y"],this.important=!1}static parseTextShadow(e){return ve.parseShadow(e,!1)}static parseBoxShadow(e){return ve.parseShadow(e,!0)}static parseShadow(t,i){const n=[],s=r.TextUtils.Utils.splitStringByRegexes(t,[e.Color.Regex,/,/g]);let o=0;for(let e=0;e<s.length;e++)if(1===s[e].regexIndex){const i=s[e];n.push(t.substring(o,i.position)),o=i.position+1}n.push(t.substring(o,t.length));const a=[];for(let t=0;t<n.length;t++){const s=new ve(i);s.format=[];let o=!0;const h=[/!important/gi,/inset/gi,e.Color.Regex,fe.Regex],d=r.TextUtils.Utils.splitStringByRegexes(n[t],h);for(let t=0;t<d.length;t++){const i=d[t];if(-1===i.regexIndex){if(/\S/.test(i.value))return[];o=!0}else{if(!o)return[];if(o=!1,0===i.regexIndex)s.important=!0,s.format.push("M");else if(1===i.regexIndex)s.insetInternal=!0,s.format.push("I");else if(2===i.regexIndex){const t=e.Color.Color.parse(i.value);if(!t)return[];s.colorInternal=t,s.format.push("C")}else if(3===i.regexIndex){const e=fe.parse(i.value);if(!e)return[];const t=s.format.length>0?s.format[s.format.length-1]:"";"X"===t?(s.offsetYInternal=e,s.format.push("Y")):"Y"===t?(s.blurRadiusInternal=e,s.format.push("B")):"B"===t?(s.spreadRadiusInternal=e,s.format.push("S")):(s.offsetXInternal=e,s.format.push("X"))}}}if(l(s,"X",1,1)||l(s,"Y",1,1)||l(s,"C",0,1)||l(s,"B",0,1)||l(s,"I",0,i?1:0)||l(s,"S",0,i?1:0)||l(s,"M",0,1))return[];a.push(s)}return a;function l(e,t,i,n){let s=0;for(let i=0;i<e.format.length;i++)e.format[i]===t&&s++;return s<i||s>n}}setInset(e){this.insetInternal=e,-1===this.format.indexOf("I")&&this.format.unshift("I")}setOffsetX(e){this.offsetXInternal=e}setOffsetY(e){this.offsetYInternal=e}setBlurRadius(e){if(this.blurRadiusInternal=e,-1===this.format.indexOf("B")){const e=this.format.indexOf("Y");this.format.splice(e+1,0,"B")}}setSpreadRadius(e){if(this.spreadRadiusInternal=e,-1===this.format.indexOf("S")){this.setBlurRadius(this.blurRadiusInternal);const e=this.format.indexOf("B");this.format.splice(e+1,0,"S")}}setColor(e){this.colorInternal=e,-1===this.format.indexOf("C")&&this.format.push("C")}isBoxShadow(){return this.isBoxShadowInternal}inset(){return this.insetInternal}offsetX(){return this.offsetXInternal}offsetY(){return this.offsetYInternal}blurRadius(){return this.blurRadiusInternal}spreadRadius(){return this.spreadRadiusInternal}color(){return this.colorInternal}asCSSText(){const e=[];for(let t=0;t<this.format.length;t++){const i=this.format[t];"I"===i&&this.insetInternal?e.push("inset"):"X"===i?e.push(this.offsetXInternal.asCSSText()):"Y"===i?e.push(this.offsetYInternal.asCSSText()):"B"===i?e.push(this.blurRadiusInternal.asCSSText()):"S"===i?e.push(this.spreadRadiusInternal.asCSSText()):"C"===i?e.push(this.colorInternal.asString(this.colorInternal.format())):"M"===i&&this.important&&e.push("!important")}return e.join(" ")}}class fe{amount;unit;constructor(e,t){this.amount=e,this.unit=t}static parse(e){const t=new RegExp("^(?:"+fe.Regex.source+")$","i"),i=e.match(t);return i?i.length>2&&i[2]?new fe(parseFloat(i[1]),i[2]):fe.zero():null}static zero(){return new fe(0,"")}asCSSText(){return this.amount+this.unit}static Regex=function(){return new RegExp("([+-]?(?:[0-9]*[.])?[0-9]+(?:[eE][+-]?[0-9]+)?)(ch|cm|em|ex|in|mm|pc|pt|px|rem|vh|vmax|vmin|vw)|[+-]?(?:0*[.])?0+(?:[eE][+-]?[0-9]+)?","gi")}()}var xe=Object.freeze({__proto__:null,CSSShadowModel:ve,CSSLength:fe});const be=new CSSStyleSheet;be.replaceSync(":host{user-select:none;padding:4px 12px 12px;border:1px solid transparent}.shadow-editor-field{height:24px;margin-top:8px;font-size:12px;flex-shrink:0}.shadow-editor-field:last-of-type{margin-bottom:8px}.shadow-editor-flex-field{display:flex;align-items:center;flex-direction:row}.shadow-editor-field.shadow-editor-blur-field{margin-top:40px}.shadow-editor-2D-slider{position:absolute;height:88px;width:88px;border:1px solid var(--divider-line);border-radius:2px}.shadow-editor-label{display:inline-block;width:52px;height:24px;line-height:24px;margin-right:8px;text-align:right}.shadow-editor-button-left,.shadow-editor-button-right{width:74px;height:24px;padding:3px 7px;line-height:16px;border:1px solid var(--divider-line);color:var(--color-text-primary);background-color:var(--color-background);text-align:center;font-weight:500}.shadow-editor-button-left{border-radius:2px 0 0 2px}.shadow-editor-button-right{border-radius:0 2px 2px 0;border-left-width:0}.shadow-editor-button-left:hover,.shadow-editor-button-right:hover{box-shadow:0 1px 1px var(--color-background-elevation-1)}.shadow-editor-button-left:focus,.shadow-editor-button-right:focus{background-color:var(--color-background-elevation-1)}.shadow-editor-button-left.enabled,.shadow-editor-button-right.enabled{--override-button-text-color:#fff;background-color:var(--color-primary);color:var(--override-button-text-color)}.shadow-editor-button-left.enabled:focus,.shadow-editor-button-right.enabled:focus{background-color:var(--color-primary-variant)}.shadow-editor-text-input{width:52px;margin-right:8px;text-align:right;box-shadow:var(--legacy-focus-ring-inactive-shadow)}@media (forced-colors:active){.shadow-editor-button-left.enabled:focus,.shadow-editor-button-left:hover,.shadow-editor-button-right.enabled,.shadow-editor-button-right.enabled:focus,.shadow-editor-button-right:hover .shadow-editor-button-left.enabled{forced-color-adjust:none;background-color:Highlight;color:HighlightText}}\n/*# sourceURL=cssShadowEditor.css */\n");const we={type:"Type",xOffset:"X offset",yOffset:"Y offset",blur:"Blur",spread:"Spread"},Se=n.i18n.registerUIStrings("ui/legacy/components/inline_editor/CSSShadowEditor.ts",we),ye=n.i18n.getLocalizedString.bind(void 0,Se);class Ie extends(e.ObjectWrapper.eventMixin(i.Widget.VBox)){typeField;outsetButton;insetButton;xInput;yInput;xySlider;halfCanvasSize;innerCanvasSize;blurInput;blurSlider;spreadField;spreadInput;spreadSlider;model;canvasOrigin;changedElement;constructor(){super(!0),this.contentElement.tabIndex=0,this.setDefaultFocusedElement(this.contentElement),this.typeField=this.contentElement.createChild("div","shadow-editor-field shadow-editor-flex-field"),this.typeField.createChild("label","shadow-editor-label").textContent=ye(we.type),this.outsetButton=this.typeField.createChild("button","shadow-editor-button-left"),this.outsetButton.textContent=n.i18n.lockedString("Outset"),this.outsetButton.addEventListener("click",this.onButtonClick.bind(this),!1),this.insetButton=this.typeField.createChild("button","shadow-editor-button-right"),this.insetButton.textContent=n.i18n.lockedString("Inset"),this.insetButton.addEventListener("click",this.onButtonClick.bind(this),!1);const e=this.contentElement.createChild("div","shadow-editor-field");this.xInput=this.createTextInput(e,ye(we.xOffset));const t=this.contentElement.createChild("div","shadow-editor-field");this.yInput=this.createTextInput(t,ye(we.yOffset)),this.xySlider=e.createChild("canvas","shadow-editor-2D-slider"),this.xySlider.width=88,this.xySlider.height=88,this.xySlider.tabIndex=-1,this.halfCanvasSize=44,this.innerCanvasSize=this.halfCanvasSize-6,i.UIUtils.installDragHandle(this.xySlider,this.dragStart.bind(this),this.dragMove.bind(this),null,"default"),this.xySlider.addEventListener("keydown",this.onCanvasArrowKey.bind(this),!1),this.xySlider.addEventListener("blur",this.onCanvasBlur.bind(this),!1);const s=this.contentElement.createChild("div","shadow-editor-field shadow-editor-flex-field shadow-editor-blur-field");this.blurInput=this.createTextInput(s,ye(we.blur)),this.blurSlider=this.createSlider(s),this.spreadField=this.contentElement.createChild("div","shadow-editor-field shadow-editor-flex-field"),this.spreadInput=this.createTextInput(this.spreadField,ye(we.spread)),this.spreadSlider=this.createSlider(this.spreadField)}createTextInput(e,t){const n=e.createChild("label","shadow-editor-label");n.textContent=t,n.setAttribute("for",t);const s=i.UIUtils.createInput("shadow-editor-text-input","text");return e.appendChild(s),s.id=t,s.addEventListener("keydown",this.handleValueModification.bind(this),!1),s.addEventListener("wheel",this.handleValueModification.bind(this),!1),s.addEventListener("input",this.onTextInput.bind(this),!1),s.addEventListener("blur",this.onTextBlur.bind(this),!1),s}createSlider(e){const t=i.UIUtils.createSlider(0,20,-1);return t.addEventListener("input",this.onSliderInput.bind(this),!1),e.appendChild(t),t}wasShown(){this.registerCSSFiles([be]),this.updateUI()}setModel(e){this.model=e,this.typeField.classList.toggle("hidden",!e.isBoxShadow()),this.spreadField.classList.toggle("hidden",!e.isBoxShadow()),this.updateUI()}updateUI(){this.updateButtons(),this.xInput.value=this.model.offsetX().asCSSText(),this.yInput.value=this.model.offsetY().asCSSText(),this.blurInput.value=this.model.blurRadius().asCSSText(),this.spreadInput.value=this.model.spreadRadius().asCSSText(),this.blurSlider.value=this.model.blurRadius().amount.toString(),this.spreadSlider.value=this.model.spreadRadius().amount.toString(),this.updateCanvas(!1)}updateButtons(){this.insetButton.classList.toggle("enabled",this.model.inset()),this.outsetButton.classList.toggle("enabled",!this.model.inset())}updateCanvas(e){const t=this.xySlider.getContext("2d");if(!t)throw new Error("Unable to obtain canvas context");t.clearRect(0,0,this.xySlider.width,this.xySlider.height),t.save(),t.setLineDash([1,1]),t.strokeStyle="rgba(210, 210, 210, 0.8)",t.beginPath(),t.moveTo(this.halfCanvasSize,0),t.lineTo(this.halfCanvasSize,88),t.moveTo(0,this.halfCanvasSize),t.lineTo(88,this.halfCanvasSize),t.stroke(),t.restore();const i=this.sliderThumbPosition();t.save(),t.translate(this.halfCanvasSize,this.halfCanvasSize),t.lineWidth=2,t.strokeStyle="rgba(130, 130, 130, 0.75)",t.beginPath(),t.moveTo(0,0),t.lineTo(i.x,i.y),t.stroke(),e&&(t.beginPath(),t.fillStyle="rgba(66, 133, 244, 0.4)",t.arc(i.x,i.y,8,0,2*Math.PI),t.fill()),t.beginPath(),t.fillStyle="#4285F4",t.arc(i.x,i.y,6,0,2*Math.PI),t.fill(),t.restore()}onButtonClick(e){const t=e.currentTarget===this.insetButton;t&&this.model.inset()||!t&&!this.model.inset()||(this.model.setInset(t),this.updateButtons(),this.dispatchEventToListeners(Ce.ShadowChanged,this.model))}handleValueModification(e){const t=e.currentTarget,n=i.UIUtils.createReplacementString(t.value,e,(function(e,t,i){i.length||(i="px");return e+t+i}));if(!n)return;const s=fe.parse(n);s&&(e.currentTarget===this.blurInput&&s.amount<0&&(s.amount=0),t.value=s.asCSSText(),t.selectionStart=0,t.selectionEnd=t.value.length,this.onTextInput(e),e.consume(!0))}onTextInput(e){const t=e.currentTarget;this.changedElement=t,this.changedElement.classList.remove("invalid");const i=fe.parse(t.value);!i||t===this.blurInput&&i.amount<0||(t===this.xInput?(this.model.setOffsetX(i),this.updateCanvas(!1)):t===this.yInput?(this.model.setOffsetY(i),this.updateCanvas(!1)):t===this.blurInput?(this.model.setBlurRadius(i),this.blurSlider.value=i.amount.toString()):t===this.spreadInput&&(this.model.setSpreadRadius(i),this.spreadSlider.value=i.amount.toString()),this.dispatchEventToListeners(Ce.ShadowChanged,this.model))}onTextBlur(){if(!this.changedElement)return;let e=this.changedElement.value.trim()?fe.parse(this.changedElement.value):fe.zero();if(e||(e=fe.parse(this.changedElement.value+"px")),!e)return this.changedElement.classList.add("invalid"),void(this.changedElement=null);this.changedElement===this.xInput?(this.model.setOffsetX(e),this.xInput.value=e.asCSSText(),this.updateCanvas(!1)):this.changedElement===this.yInput?(this.model.setOffsetY(e),this.yInput.value=e.asCSSText(),this.updateCanvas(!1)):this.changedElement===this.blurInput?(e.amount<0&&(e=fe.zero()),this.model.setBlurRadius(e),this.blurInput.value=e.asCSSText(),this.blurSlider.value=e.amount.toString()):this.changedElement===this.spreadInput&&(this.model.setSpreadRadius(e),this.spreadInput.value=e.asCSSText(),this.spreadSlider.value=e.amount.toString()),this.changedElement=null,this.dispatchEventToListeners(Ce.ShadowChanged,this.model)}onSliderInput(e){e.currentTarget===this.blurSlider?(this.model.setBlurRadius(new fe(Number(this.blurSlider.value),this.model.blurRadius().unit||"px")),this.blurInput.value=this.model.blurRadius().asCSSText(),this.blurInput.classList.remove("invalid")):e.currentTarget===this.spreadSlider&&(this.model.setSpreadRadius(new fe(Number(this.spreadSlider.value),this.model.spreadRadius().unit||"px")),this.spreadInput.value=this.model.spreadRadius().asCSSText(),this.spreadInput.classList.remove("invalid")),this.dispatchEventToListeners(Ce.ShadowChanged,this.model)}dragStart(e){this.xySlider.focus(),this.updateCanvas(!0),this.canvasOrigin=new i.Geometry.Point(this.xySlider.totalOffsetLeft()+this.halfCanvasSize,this.xySlider.totalOffsetTop()+this.halfCanvasSize);const t=new i.Geometry.Point(e.x-this.canvasOrigin.x,e.y-this.canvasOrigin.y),n=this.sliderThumbPosition();return t.distanceTo(n)>=6&&this.dragMove(e),!0}dragMove(e){let t=new i.Geometry.Point(e.x-this.canvasOrigin.x,e.y-this.canvasOrigin.y);e.shiftKey&&(t=this.snapToClosestDirection(t));const n=this.constrainPoint(t,this.innerCanvasSize),s=Math.round(n.x/this.innerCanvasSize*20),o=Math.round(n.y/this.innerCanvasSize*20);e.shiftKey?(this.model.setOffsetX(new fe(s,this.model.offsetX().unit||"px")),this.model.setOffsetY(new fe(o,this.model.offsetY().unit||"px"))):(e.altKey||this.model.setOffsetX(new fe(s,this.model.offsetX().unit||"px")),i.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(e)||this.model.setOffsetY(new fe(o,this.model.offsetY().unit||"px"))),this.xInput.value=this.model.offsetX().asCSSText(),this.yInput.value=this.model.offsetY().asCSSText(),this.xInput.classList.remove("invalid"),this.yInput.classList.remove("invalid"),this.updateCanvas(!0),this.dispatchEventToListeners(Ce.ShadowChanged,this.model)}onCanvasBlur(){this.updateCanvas(!1)}onCanvasArrowKey(e){const i=e;let n=0,s=0;if("ArrowRight"===i.key?n=1:"ArrowLeft"===i.key?n=-1:"ArrowUp"===i.key?s=-1:"ArrowDown"===i.key&&(s=1),n||s){if(e.consume(!0),n){const e=this.model.offsetX(),i=t.NumberUtilities.clamp(e.amount+n,-20,20);if(i===e.amount)return;this.model.setOffsetX(new fe(i,e.unit||"px")),this.xInput.value=this.model.offsetX().asCSSText(),this.xInput.classList.remove("invalid")}if(s){const e=this.model.offsetY(),i=t.NumberUtilities.clamp(e.amount+s,-20,20);if(i===e.amount)return;this.model.setOffsetY(new fe(i,e.unit||"px")),this.yInput.value=this.model.offsetY().asCSSText(),this.yInput.classList.remove("invalid")}this.updateCanvas(!0),this.dispatchEventToListeners(Ce.ShadowChanged,this.model)}}constrainPoint(e,t){return Math.abs(e.x)<=t&&Math.abs(e.y)<=t?new i.Geometry.Point(e.x,e.y):e.scale(t/Math.max(Math.abs(e.x),Math.abs(e.y)))}snapToClosestDirection(e){let t=Number.MAX_VALUE,n=e;const s=[new i.Geometry.Point(0,-1),new i.Geometry.Point(1,-1),new i.Geometry.Point(1,0),new i.Geometry.Point(1,1)];for(const i of s){const s=e.projectOn(i),o=e.distanceTo(s);o<t&&(t=o,n=s)}return n}sliderThumbPosition(){const e=this.model.offsetX().amount/20*this.innerCanvasSize,t=this.model.offsetY().amount/20*this.innerCanvasSize;return this.constrainPoint(new i.Geometry.Point(e,t),this.innerCanvasSize)}}var Ce;(Ce||(Ce={})).ShadowChanged="ShadowChanged";var ke=Object.freeze({__proto__:null,CSSShadowEditor:Ie,get Events(){return Ce}});const Ee=new CSSStyleSheet;Ee.replaceSync(".css-var-link:not(.undefined){cursor:pointer;text-underline-offset:2px;color:var(--color-link)}.css-var-link:hover:not(.undefined){text-decoration:underline}.css-var-link:focus:not(:focus-visible){outline:0}.css-var-link.undefined{--override-css-var-link-undefined-color:rgb(102 102 102);color:var(--override-css-var-link-undefined-color)}\n/*# sourceURL=cssVarSwatch.css */\n");const ze={sIsNotDefined:"{PH1} is not defined"},Pe=n.i18n.registerUIStrings("ui/legacy/components/inline_editor/CSSVarSwatch.ts",ze),Te=n.i18n.getLocalizedString.bind(void 0,Pe),{render:Le,html:Ue,Directives:Me}=o,Ae=/(var\()(\s*--[^,)]+)(.*)/;class Fe extends HTMLElement{static litTagName=o.literal`devtools-css-var-swatch`;shadow=this.attachShadow({mode:"open"});text="";computedValue=null;fromFallback=!1;onLinkActivate=()=>{};constructor(){super(),this.tabIndex=-1,this.addEventListener("focus",(()=>{const e=this.shadow.querySelector('[role="link"]');e&&e.focus()}))}connectedCallback(){this.shadow.adoptedStyleSheets=[Ee]}set data(e){this.text=e.text,this.computedValue=e.computedValue,this.fromFallback=e.fromFallback,this.onLinkActivate=(t,i)=>{i instanceof MouseEvent&&0!==i.button||i instanceof KeyboardEvent&&!isEnterOrSpaceKey(i)||(e.onLinkActivate(t),i.consume(!0))},this.render()}parseVariableFunctionParts(){const e=this.text.replace(/\s{2,}/g," ").match(Ae);return e?{pre:e[1],name:e[2],post:e[3]}:null}get variableName(){const e=this.text.match(/--[^,)]+/);return e?e[0]:""}renderLink(e){const t=this.computedValue&&!this.fromFallback,i=Me.classMap({"css-var-link":!0,undefined:!t}),n=t?this.computedValue:Te(ze.sIsNotDefined,{PH1:e}),s=t?this.onLinkActivate.bind(this,this.variableName.trim()):null;return Ue`<span class="${i}" title="${n}" @mousedown="${s}" @keydown="${s}" role="link" tabindex="-1">${e}</span>`}render(){const e=this.parseVariableFunctionParts();if(!e)return void Le("",this.shadow,{host:this});const t=this.renderLink(e.name);Le(Ue`<span title="${this.computedValue||""}">${e.pre}${t}${e.post}</span>`,this.shadow,{host:this})}}s.CustomElements.defineComponent("devtools-css-var-swatch",Fe);var Be=Object.freeze({__proto__:null,CSSVarSwatch:Fe});const Re=new CSSStyleSheet;Re.replaceSync(":host{user-select:none;padding:4px 12px 12px}.error-input{box-shadow:0 0 0 1px var(--color-accent-red)}.error-text{color:var(--color-accent-red);padding:6px 0}.warning-input{--override-warning-input-color:#ffdd9e;box-shadow:0 0 0 1px var(--override-warning-input-color)}.-theme-with-dark-background .warning-input,:host-context(.-theme-with-dark-background) .warning-input{--override-warning-input-color:rgb(97 63 0)}.hide-warning{display:none}.font-section-header{font-weight:400;font-size:17px;text-align:left}.font-section-subheader{font-size:12px;text-align:left;font-weight:700}.font-selector-section{overflow-y:auto;padding-bottom:10px}.font-selector-input{width:204px;text-align-last:center}.font-reset-button{width:100%;margin-top:10px}.font-section{border-top:1px solid var(--color-details-hairline)}.chrome-select.font-editor-select{min-width:50px;min-height:27px}input::-webkit-inner-spin-button,input::-webkit-outer-spin-button{display:none;margin:0}.preview-text{max-width:300px;word-break:break-word;display:block}.rendered-font-list-label{font-weight:700;font-size:12px}.rendered-font-list{padding:5px 0}.shadow-editor-field{height:24px;margin-top:8px;font-size:12px;flex-shrink:0}.shadow-editor-field:last-of-type{margin-bottom:8px}.shadow-editor-flex-field{display:flex;align-items:center;flex-direction:row}.shadow-editor-field.shadow-editor-blur-field{margin-top:40px}.shadow-editor-2D-slider{position:absolute;height:88px;width:88px;border:1px solid var(--divider-line);border-radius:2px}.shadow-editor-label{display:inline-block;width:70px;height:24px;line-height:24px;margin-right:8px;text-align:left}.shadow-editor-button-left,.shadow-editor-button-right{width:74px;height:24px;padding:3px 7px;line-height:16px;border:1px solid var(--divider-line);color:var(--color-text-primary);background-color:var(--color-background);text-align:center;font-weight:500}.shadow-editor-button-left{border-radius:2px 0 0 2px}.shadow-editor-button-right{border-radius:0 2px 2px 0;border-left-width:0}.shadow-editor-button-left:hover,.shadow-editor-button-right:hover{box-shadow:0 1px 1px var(--divider-line)}.shadow-editor-button-left:focus,.shadow-editor-button-right:focus{background-color:var(--color-background-elevation-1)}.shadow-editor-text-input{width:50px;margin:8px;text-align:center;box-shadow:var(--legacy-focus-ring-inactive-shadow)}.spectrum-switcher{border-radius:2px;height:20px;width:20px;padding:2px;margin-left:5px}.spectrum-switcher:hover{background-color:var(--color-background-elevation-1)}.spectrum-switcher:focus-visible{background-color:var(--legacy-focus-bg-color)}\n/*# sourceURL=fontEditor.css */\n");async function Oe(e){const t=i.Context.Context.instance().flavor(a.DOMModel.DOMNode);let n;if(t&&t.parentNode&&"HTML"!==t.nodeName()){const[i]=a.TargetManager.TargetManager.instance().models(h.CSSOverviewModel.CSSOverviewModel),s=e?t.parentNode.id:t.id,o=(await i.getComputedStyleForNode(s).then(Ne)).replace(/[a-z]/g,"");n=parseFloat(o)}else n=16;return n}function Ne(e){const t=e.computedStyle;let i=6;if(t[i].name&&"font-size"!==t[i].name)for(let e=0;e<t.length;e++)if("font-size"===t[e].name){i=e;break}return t[i].value}const Ve={expression:"window.innerWidth",objectGroup:void 0,includeCommandLineAPI:!1,silent:!0,contextId:void 0,returnByValue:!1,generatePreview:!1,userGesture:!1,awaitPromise:!0,throwOnSideEffect:!1,timeout:void 0,disableBreaks:!0,replMode:!1,allowUnsafeEvalBlockedByCSP:!1},_e={expression:"window.innerHeight",objectGroup:void 0,includeCommandLineAPI:!1,silent:!0,contextId:void 0,returnByValue:!1,generatePreview:!1,userGesture:!1,awaitPromise:!0,throwOnSideEffect:!1,timeout:void 0,disableBreaks:!0,replMode:!1,allowUnsafeEvalBlockedByCSP:!1};async function He(){const e=i.Context.Context.instance().flavor(a.RuntimeModel.ExecutionContext);let t,n;if(e){const i=await e.evaluate(Ve,!1,!1),s=await e.evaluate(_e,!1,!1);if("error"in i||"error"in s)return null;i.object&&(t=i.object.value),s.object&&(n=s.object.value)}if(void 0===t||void 0===n){const e=i.Context.Context.instance().flavor(a.DOMModel.DOMNode);if(!e)return null;const s=await e.domModel().target().pageAgent().invoke_getLayoutMetrics(),o=s.visualViewport.zoom?s.visualViewport.zoom:1;n=s.visualViewport.clientHeight/o,t=s.visualViewport.clientWidth/o}return{width:t,height:n}}const De=new Map;async function $e(e,t,i){let n,s;""===e&&(e="em"),""===t&&(t="em");const o=De.get(e),r=De.get(t);return o&&r?(n="em"===e||"%"===e?await o(i):await o(),s="em"===t||"%"===t?await r(i):await r(),n/s):1}De.set("px",(function(){return 1})),De.set("em",Oe),De.set("rem",(async function(){const e=function(e){let t=e;for(;t&&"HTML"!==t.nodeName()&&t.parentNode;)t=t.parentNode;return t}(i.Context.Context.instance().flavor(a.DOMModel.DOMNode));if(!e||!e.id)return 16;const[t]=a.TargetManager.TargetManager.instance().models(h.CSSOverviewModel.CSSOverviewModel),n=(await t.getComputedStyleForNode(e.id).then(Ne)).replace(/[a-z]/g,"");return parseFloat(n)})),De.set("%",(async function(e){return await Oe(e)/100})),De.set("vh",(async function(){const e=await He();return e?e.height/100:1})),De.set("vw",(async function(){const e=await He();return e?e.width/100:1})),De.set("vmin",(async function(){const e=await He();if(!e)return 1;const t=e.width,i=e.height;return Math.min(t,i)/100})),De.set("vmax",(async function(){const e=await He();if(!e)return 1;const t=e.width,i=e.height;return Math.max(t,i)/100})),De.set("cm",(function(){return 37.795})),De.set("mm",(function(){return 3.7795})),De.set("in",(function(){return 96})),De.set("pt",(function(){return 4/3})),De.set("pc",(function(){return 16}));var Xe=Object.freeze({__proto__:null,getUnitConversionMultiplier:$e});const Ge=new Set(["px","em","rem","%","vh","vw"]),je=new Set(["","px","em","%"]),Ye=new Set(["em","rem","px"]),Ke=["","xx-small","x-small","smaller","small","medium","large","larger","x-large","xx-large"],We=["","normal"],qe=["","lighter","normal","bold","bolder"],Ze=["","normal"],Qe=["inherit","initial","unset"];Ke.push(...Qe),We.push(...Qe),qe.push(...Qe),Ze.push(...Qe);const Je=new Set(Ke),et=new Set(We),tt=new Set(qe),it=new Set(Ze),nt=new Map([["px",{min:0,max:72,step:1}],["em",{min:0,max:4.5,step:.1}],["rem",{min:0,max:4.5,step:.1}],["%",{min:0,max:450,step:1}],["vh",{min:0,max:10,step:.1}],["vw",{min:0,max:10,step:.1}],["vmin",{min:0,max:10,step:.1}],["vmax",{min:0,max:10,step:.1}],["cm",{min:0,max:2,step:.1}],["mm",{min:0,max:20,step:.1}],["in",{min:0,max:1,step:.01}],["pt",{min:0,max:54,step:1}],["pc",{min:0,max:4.5,step:.1}]]),st=new Map([["",{min:0,max:2,step:.1}],["em",{min:0,max:2,step:.1}],["%",{min:0,max:200,step:1}],["px",{min:0,max:32,step:1}],["rem",{min:0,max:2,step:.1}],["vh",{min:0,max:4.5,step:.1}],["vw",{min:0,max:4.5,step:.1}],["vmin",{min:0,max:4.5,step:.1}],["vmax",{min:0,max:4.5,step:.1}],["cm",{min:0,max:1,step:.1}],["mm",{min:0,max:8.5,step:.1}],["in",{min:0,max:.5,step:.1}],["pt",{min:0,max:24,step:1}],["pc",{min:0,max:2,step:.1}]]),ot=new Map([["",{min:100,max:700,step:100}]]),rt=new Map([["px",{min:-10,max:10,step:.01}],["em",{min:-.625,max:.625,step:.001}],["rem",{min:-.625,max:.625,step:.001}],["%",{min:-62.5,max:62.5,step:.1}],["vh",{min:-1.5,max:1.5,step:.01}],["vw",{min:-1.5,max:1.5,step:.01}],["vmin",{min:-1.5,max:1.5,step:.01}],["vmax",{min:-1.5,max:1.5,step:.01}],["cm",{min:-.25,max:.025,step:.001}],["mm",{min:-2.5,max:2.5,step:.01}],["in",{min:-.1,max:.1,step:.001}],["pt",{min:-7.5,max:7.5,step:.01}],["pc",{min:-.625,max:.625,step:.001}]]),at={regex:/(^[\+\d\.]+)([a-zA-Z%]+)/,units:Ge,keyValues:Je,rangeMap:nt,defaultUnit:"px"},lt={regex:/(^[\+\d\.]+)([a-zA-Z%]*)/,units:je,keyValues:et,rangeMap:st,defaultUnit:""},ht={regex:/(^[\+\d\.]+)/,units:null,keyValues:tt,rangeMap:ot,defaultUnit:null},dt={regex:/([\+-0-9\.]+)([a-zA-Z%]+)/,units:Ye,keyValues:it,rangeMap:rt,defaultUnit:"em"},ct=["Arial","Bookman","Candara","Comic Sans MS","Courier New","Garamond","Georgia","Helvetica","Impact","Palatino","Roboto","Times New Roman","Verdana"],ut=["serif","sans-serif","monspace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"];async function pt(){const e=a.TargetManager.TargetManager.instance().models(h.CSSOverviewModel.CSSOverviewModel);if(e){const t=e[0];if(t){const{fontInfo:e}=await t.getNodeStyleStats();return Array.from(e.keys())}}return[]}function mt(e){switch(e){case 1:return 0;case.1:return 1;case.01:return 2;case.001:return 3;default:return 0}}var gt=Object.freeze({__proto__:null,FontPropertiesRegex:/^[^- ][a-zA-Z-]+|-?\+?(?:[0-9]+\.[0-9]+|\.[0-9]+|[0-9]+)[a-zA-Z%]{0,4}/,FontFamilyRegex:/(?:"[\w \,-]+",? ?|'[\w \,-]+',? ?|[\w \,-]+,? ?)+/,GlobalValues:Qe,FontSizeStaticParams:at,LineHeightStaticParams:lt,FontWeightStaticParams:ht,LetterSpacingStaticParams:dt,SystemFonts:ct,GenericFonts:ut,generateComputedFontArray:pt,getRoundingPrecision:mt});const vt={fontFamily:"Font Family",cssProperties:"CSS Properties",fontSize:"Font Size",lineHeight:"Line Height",fontWeight:"Font Weight",spacing:"Spacing",fallbackS:"Fallback {PH1}",thereIsNoValueToDeleteAtIndexS:"There is no value to delete at index: {PH1}",fontSelectorDeletedAtIndexS:"Font Selector deleted at index: {PH1}",deleteS:"Delete {PH1}",PleaseEnterAValidValueForSText:"* Please enter a valid value for {PH1} text input",thisPropertyIsSetToContainUnits:"This property is set to contain units but does not have a defined corresponding unitsArray: {PH1}",sSliderInput:"{PH1} Slider Input",sTextInput:"{PH1} Text Input",units:"Units",sUnitInput:"{PH1} Unit Input",sKeyValueSelector:"{PH1} Key Value Selector",sToggleInputType:"{PH1} toggle input type",selectorInputMode:"Selector Input Mode",sliderInputMode:"Slider Input Mode"},ft=n.i18n.registerUIStrings("ui/legacy/components/inline_editor/FontEditor.ts",vt),xt=n.i18n.getLocalizedString.bind(void 0,ft);class bt extends(e.ObjectWrapper.eventMixin(i.Widget.VBox)){selectedNode;propertyMap;fontSelectorSection;fontSelectors;fontsList;constructor(e){super(!0),this.selectedNode=i.Context.Context.instance().flavor(a.DOMModel.DOMNode),this.propertyMap=e,this.contentElement.tabIndex=0,this.setDefaultFocusedElement(this.contentElement),this.fontSelectorSection=this.contentElement.createChild("div","font-selector-section"),this.fontSelectorSection.createChild("h2","font-section-header").textContent=xt(vt.fontFamily),this.fontSelectors=[],this.fontsList=null;const t=this.propertyMap.get("font-family");this.createFontSelectorSection(t);const n=this.contentElement.createChild("div","font-section");n.createChild("h2","font-section-header").textContent=xt(vt.cssProperties);const s=this.getPropertyInfo("font-size",at.regex),o=this.getPropertyInfo("line-height",lt.regex),r=this.getPropertyInfo("font-weight",ht.regex),l=this.getPropertyInfo("letter-spacing",dt.regex);new St("font-size",xt(vt.fontSize),n,s,at,this.updatePropertyValue.bind(this),this.resizePopout.bind(this),!0),new St("line-height",xt(vt.lineHeight),n,o,lt,this.updatePropertyValue.bind(this),this.resizePopout.bind(this),!0),new St("font-weight",xt(vt.fontWeight),n,r,ht,this.updatePropertyValue.bind(this),this.resizePopout.bind(this),!1),new St("letter-spacing",xt(vt.spacing),n,l,dt,this.updatePropertyValue.bind(this),this.resizePopout.bind(this),!0)}wasShown(){this.registerCSSFiles([Re])}async createFontSelectorSection(e){if(e){const t=e.split(",");if(await this.createFontSelector(t[0],!0),!Qe.includes(t[0]))for(let e=1;e<t.length+1;e++)this.createFontSelector(t[e])}else this.createFontSelector("",!0);this.resizePopout()}async createFontsList(){const e=await pt(),t=new Map,i=this.splitComputedFontArray(e);t.set("Computed Fonts",i);const n=new Map;n.set("System Fonts",ct),n.set("Generic Families",ut);const s=[];return s.push(t),s.push(n),s}splitComputedFontArray(e){const t=[];for(const i of e)if(i.includes(",")){i.split(",").forEach((e=>{-1===t.findIndex((t=>t.toLowerCase()===e.trim().toLowerCase().replace(/"/g,"'")))&&t.push(e.trim().replace(/"/g,""))}))}else-1===t.findIndex((e=>e.toLowerCase()===i.toLowerCase().replace('"',"'")))&&t.push(i.replace(/"/g,""));return t}async createFontSelector(e,t){if(e=e?e.trim():""){const t=e.charAt(0);"'"===t?e=e.replace(/'/g,""):'"'===t&&(e=e.replace(/"/g,""))}const i=this.fontSelectorSection.createChild("div","shadow-editor-field shadow-editor-flex-field");let n;if(this.fontsList||(this.fontsList=await this.createFontsList()),t){n=xt(vt.fontFamily);const t=new Map([["Global Values",Qe]]),s=[...this.fontsList];s.push(t),this.createSelector(i,n,s,e.trim())}else n=xt(vt.fallbackS,{PH1:this.fontSelectors.length}),this.createSelector(i,n,this.fontsList,e.trim())}deleteFontSelector(e,t){let n=this.fontSelectors[e];const s=0===e;if(""===n.input.value&&!t)return void i.ARIAUtils.alert(xt(vt.thereIsNoValueToDeleteAtIndexS,{PH1:e}));if(s){const t=this.fontSelectors[1];let i="";t&&(i=t.input.value,n=t);this.fontSelectors[0].input.value=i,e=1}if(n.input.parentNode){const t=this.fontSelectors.length>1;if(!s||t){const t=n.input.parentElement;t&&(t.remove(),this.fontSelectors.splice(e,1),this.updateFontSelectorList())}i.ARIAUtils.alert(xt(vt.fontSelectorDeletedAtIndexS,{PH1:e}))}this.onFontSelectorChanged(),this.resizePopout();const o=s?0:e-1;this.fontSelectors[o].input.focus()}updateFontSelectorList(){for(let e=0;e<this.fontSelectors.length;e++){const t=this.fontSelectors[e];let n;n=0===e?xt(vt.fontFamily):xt(vt.fallbackS,{PH1:e}),t.label.textContent=n,i.ARIAUtils.setAccessibleName(t.input,n),t.deleteButton.setTitle(xt(vt.deleteS,{PH1:n})),t.index=e}}getPropertyInfo(e,t){const i=this.propertyMap.get(e);if(i){const e=i,n=e.match(t);if(n){return{value:"+"===n[1].charAt(0)?n[1].substr(1):n[1],units:n[2]?n[2]:""}}return{value:e,units:null}}return{value:null,units:null}}createSelector(e,t,n,s){const o=this.fontSelectors.length,r=i.UIUtils.createSelect(t,n);r.value=s;const a=i.UIUtils.createLabel(t,"shadow-editor-label",r);r.addEventListener("input",this.onFontSelectorChanged.bind(this),!1),r.addEventListener("keydown",(e=>{"Enter"===e.key&&e.consume()}),!1),e.appendChild(a),e.appendChild(r);const l=new i.Toolbar.Toolbar("",e),h=new i.Toolbar.ToolbarButton(xt(vt.deleteS,{PH1:t}),"largeicon-trash-bin");l.appendToolbarItem(h);const d={label:a,input:r,deleteButton:h,index:o};h.addEventListener(i.Toolbar.ToolbarButton.Events.Click,(()=>{this.deleteFontSelector(d.index)})),h.element.addEventListener("keydown",(e=>{isEnterOrSpaceKey(e)&&(this.deleteFontSelector(d.index),e.consume())}),!1),this.fontSelectors.push(d)}onFontSelectorChanged(){let e="";const t=Qe.includes(this.fontSelectors[0].input.value);if(t)for(let e=1;e<this.fontSelectors.length;e++)this.deleteFontSelector(e,!0);for(const t of this.fontSelectors){const i=t.input;""!==i.value&&(""===e?e=this.fontSelectors[0].input.value:e+=", "+i.value)}""!==this.fontSelectors[this.fontSelectors.length-1].input.value&&!t&&this.fontSelectors.length<10&&(this.createFontSelector(""),this.resizePopout()),this.updatePropertyValue("font-family",e)}updatePropertyValue(e,t){this.dispatchEventToListeners(wt.FontChanged,{propertyName:e,value:t})}resizePopout(){this.dispatchEventToListeners(wt.FontEditorResized)}}var wt;!function(e){e.FontChanged="FontChanged",e.FontEditorResized="FontEditorResized"}(wt||(wt={}));class St{showSliderMode;errorText;propertyInfo;propertyName;staticParams;hasUnits;units;addedUnit;initialRange;boundUpdateCallback;boundResizeCallback;selectedNode;sliderInput;textBoxInput;unitInput;selectorInput;applyNextInput;constructor(e,t,n,s,o,r,l,h){this.showSliderMode=!0;const d=n.createChild("div","shadow-editor-field shadow-editor-flex-field");if(this.errorText=n.createChild("div","error-text"),this.errorText.textContent=xt(vt.PleaseEnterAValidValueForSText,{PH1:e}),this.errorText.hidden=!0,i.ARIAUtils.markAsAlert(this.errorText),this.propertyInfo=s,this.propertyName=e,this.staticParams=o,this.hasUnits=h,this.hasUnits&&this.staticParams.units&&null!==this.staticParams.defaultUnit){const e=this.staticParams.defaultUnit;this.units=null!==s.units?s.units:e,this.addedUnit=!this.staticParams.units.has(this.units)}else{if(this.hasUnits)throw new Error(xt(vt.thisPropertyIsSetToContainUnits,{PH1:e}));this.units=""}this.initialRange=this.getUnitRange(),this.boundUpdateCallback=r,this.boundResizeCallback=l,this.selectedNode=i.Context.Context.instance().flavor(a.DOMModel.DOMNode);const c=i.UIUtils.createLabel(t,"shadow-editor-label");d.append(c),this.sliderInput=this.createSliderInput(d,t),this.textBoxInput=this.createTextBoxInput(d),i.ARIAUtils.bindLabelToControl(c,this.textBoxInput),this.unitInput=this.createUnitInput(d),this.selectorInput=this.createSelectorInput(d),this.createTypeToggle(d),this.checkSelectorValueAndToggle(),this.applyNextInput=!1}setInvalidTextBoxInput(e){e?this.errorText.hidden&&(this.errorText.hidden=!1,this.textBoxInput.classList.add("error-input"),this.boundResizeCallback()):this.errorText.hidden||(this.errorText.hidden=!0,this.textBoxInput.classList.remove("error-input"),this.boundResizeCallback())}checkSelectorValueAndToggle(){return!(!this.staticParams.keyValues||null===this.propertyInfo.value||!this.staticParams.keyValues.has(this.propertyInfo.value))&&(this.toggleInputType(),!0)}getUnitRange(){let e=0,t=100,i=1;if(null!==this.propertyInfo.value&&/\d/.test(this.propertyInfo.value))if(this.staticParams.rangeMap.get(this.units)){const n=this.staticParams.rangeMap.get(this.units);n&&(e=Math.min(n.min,parseFloat(this.propertyInfo.value)),t=Math.max(n.max,parseFloat(this.propertyInfo.value)),i=n.step)}else{const n=this.staticParams.rangeMap.get("px");n&&(e=Math.min(n.min,parseFloat(this.propertyInfo.value)),t=Math.max(n.max,parseFloat(this.propertyInfo.value)),i=n.step)}else{const n=this.staticParams.rangeMap.get(this.units);n&&(e=n.min,t=n.max,i=n.step)}return{min:e,max:t,step:i}}createSliderInput(e,t){const n=this.initialRange.min,s=this.initialRange.max,o=this.initialRange.step,r=i.UIUtils.createSlider(n,s,-1);if(r.sliderElement.step=o.toString(),r.sliderElement.tabIndex=0,this.propertyInfo.value)r.value=parseFloat(this.propertyInfo.value);else{const e=(n+s)/2;r.value=e}return r.addEventListener("input",(e=>{this.onSliderInput(e,!1)})),r.addEventListener("mouseup",(e=>{this.onSliderInput(e,!0)})),r.addEventListener("keydown",(e=>{"ArrowUp"!==e.key&&"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||(this.applyNextInput=!0)})),e.appendChild(r),i.ARIAUtils.setAccessibleName(r.sliderElement,xt(vt.sSliderInput,{PH1:this.propertyName})),r}createTextBoxInput(e){const t=i.UIUtils.createInput("shadow-editor-text-input","number");return t.step=this.initialRange.step.toString(),t.classList.add("font-editor-text-input"),null!==this.propertyInfo.value&&("+"===this.propertyInfo.value.charAt(0)&&(this.propertyInfo.value=this.propertyInfo.value.substr(1)),t.value=this.propertyInfo.value),t.step="any",t.addEventListener("input",this.onTextBoxInput.bind(this),!1),e.appendChild(t),i.ARIAUtils.setAccessibleName(t,xt(vt.sTextInput,{PH1:this.propertyName})),t}createUnitInput(e){let t;if(this.hasUnits&&this.staticParams.units){const e=this.propertyInfo.units,n=this.staticParams.units;t=i.UIUtils.createSelect(xt(vt.units),n),t.classList.add("font-editor-select"),this.addedUnit&&e&&t.add(new Option(e,e)),e&&(t.value=e),t.addEventListener("change",this.onUnitInput.bind(this),!1)}else t=i.UIUtils.createSelect(xt(vt.units),[]),t.classList.add("font-editor-select"),t.disabled=!0;return t.addEventListener("keydown",(e=>{"Enter"===e.key&&e.consume()}),!1),e.appendChild(t),i.ARIAUtils.setAccessibleName(t,xt(vt.sUnitInput,{PH1:this.propertyName})),t}createSelectorInput(e){const t=i.UIUtils.createSelect(xt(vt.sKeyValueSelector,{PH1:this.propertyName}),this.staticParams.keyValues);return t.classList.add("font-selector-input"),this.propertyInfo.value&&(t.value=this.propertyInfo.value),t.addEventListener("input",this.onSelectorInput.bind(this),!1),t.addEventListener("keydown",(e=>{"Enter"===e.key&&e.consume()}),!1),e.appendChild(t),t.hidden=!0,t}onSelectorInput(e){if(e.currentTarget){const t=e.currentTarget.value;this.textBoxInput.value="";const i=(parseFloat(this.sliderInput.sliderElement.min)+parseFloat(this.sliderInput.sliderElement.max))/2;this.sliderInput.value=i,this.setInvalidTextBoxInput(!1),this.boundUpdateCallback(this.propertyName,t)}}onSliderInput(e,t){const i=e.currentTarget;if(i){const e=i.value;this.textBoxInput.value=e,this.selectorInput.value="";const n=this.hasUnits?e+this.unitInput.value:e.toString();this.setInvalidTextBoxInput(!1),(t||this.applyNextInput)&&(this.boundUpdateCallback(this.propertyName,n),this.applyNextInput=!1)}}onTextBoxInput(e){const t=e.currentTarget;if(t){const e=t.value,i=e+(""===e?"":this.unitInput.value);this.staticParams.regex.test(i)||""===e&&!t.validationMessage.length?(parseFloat(e)>parseFloat(this.sliderInput.sliderElement.max)?this.sliderInput.sliderElement.max=e:parseFloat(e)<parseFloat(this.sliderInput.sliderElement.min)&&(this.sliderInput.sliderElement.min=e),this.sliderInput.value=parseFloat(e),this.selectorInput.value="",this.setInvalidTextBoxInput(!1),this.boundUpdateCallback(this.propertyName,i)):this.setInvalidTextBoxInput(!0)}}async onUnitInput(e){const t=e.currentTarget,i=t.hasFocus(),n=t.value;t.disabled=!0;const s=this.units,o=await $e(s,n,"font-size"===this.propertyName);this.setInputUnits(o,n),this.textBoxInput.value&&this.boundUpdateCallback(this.propertyName,this.textBoxInput.value+n),this.units=n,t.disabled=!1,i&&t.focus()}createTypeToggle(e){const t=e.createChild("div","spectrum-switcher"),n=new l.Icon.Icon;n.data={iconName:"switcherIcon",color:"var(--color-text-primary)",width:"16px",height:"16px"},t.appendChild(n),i.UIUtils.setTitle(t,xt(vt.sToggleInputType,{PH1:this.propertyName})),t.tabIndex=0,self.onInvokeElement(t,this.toggleInputType.bind(this)),i.ARIAUtils.markAsButton(t)}toggleInputType(e){e&&"Enter"===e.key&&e.consume(),this.showSliderMode?(this.sliderInput.hidden=!0,this.textBoxInput.hidden=!0,this.unitInput.hidden=!0,this.selectorInput.hidden=!1,this.showSliderMode=!1,i.ARIAUtils.alert(xt(vt.selectorInputMode))):(this.sliderInput.hidden=!1,this.textBoxInput.hidden=!1,this.unitInput.hidden=!1,this.selectorInput.hidden=!0,this.showSliderMode=!0,i.ARIAUtils.alert(xt(vt.sliderInputMode)))}setInputUnits(e,t){const i=this.staticParams.rangeMap.get(t);let n,s,o;i?(n=i.min,s=i.max,o=i.step):(n=0,s=100,o=1);let r=!1;const a=mt(o);let l=(n+s)/2;this.textBoxInput.value&&(r=!0,l=parseFloat((parseFloat(this.textBoxInput.value)*e).toFixed(a))),this.sliderInput.sliderElement.min=Math.min(l,n).toString(),this.sliderInput.sliderElement.max=Math.max(l,s).toString(),this.sliderInput.sliderElement.step=o.toString(),this.textBoxInput.step=o.toString(),r&&(this.textBoxInput.value=l.toString()),this.sliderInput.value=l}}var yt=Object.freeze({__proto__:null,FontEditor:bt,get Events(){return wt}});const It=new CSSStyleSheet;It.replaceSync(":host{white-space:nowrap;--override-bezier-icon-purple:#9c27b0;--override-bezier-icon-purple-hover:#800080}[is=ui-icon].icon-mask.bezier-swatch-icon{position:relative;margin-left:1px;margin-right:2px;top:1px;user-select:none;line-height:10px;background-color:var(--override-bezier-icon-purple);cursor:default}[is=ui-icon].icon-mask.bezier-swatch-icon:hover{background-color:var(--override-bezier-icon-purple-hover)}\n/*# sourceURL=bezierSwatch.css */\n");const Ct=new CSSStyleSheet;Ct.replaceSync(":host{white-space:nowrap}.shadow-swatch-icon{--override-swatch-background-color:#9c27b0;position:relative;margin-left:1px;margin-right:2px;top:1px;user-select:none;line-height:10px;background-color:var(--override-swatch-background-color)}.shadow-swatch-icon:hover{--override-swatch-background-color:#800080}.-theme-with-dark-background .shadow-swatch-icon,:host-context(.-theme-with-dark-background) .shadow-swatch-icon{--override-swatch-background-color:rgb(196 79 216)}.-theme-with-dark-background .shadow-swatch-icon:hover,:host-context(.-theme-with-dark-background) .shadow-swatch-icon:hover{--override-swatch-background-color:rgb(255 127 255)}\n/*# sourceURL=cssShadowSwatch.css */\n");class kt extends HTMLSpanElement{iconElementInternal;textElement;constructor(){super();const e=i.Utils.createShadowRootWithCoreStyles(this,{cssFile:[It],delegatesFocus:void 0});this.iconElementInternal=i.Icon.Icon.create("smallicon-bezier","bezier-swatch-icon"),e.appendChild(this.iconElementInternal),this.textElement=this.createChild("span"),e.createChild("slot")}static create(){let e=kt.constructorInternal;return e||(e=i.Utils.registerCustomElement("span","bezier-swatch",kt),kt.constructorInternal=e),e()}bezierText(){return this.textElement.textContent||""}setBezierText(e){this.textElement.textContent=e}hideText(e){this.textElement.hidden=e}iconElement(){return this.iconElementInternal}static constructorInternal=null}class Et extends HTMLSpanElement{iconElementInternal;contentElement;colorSwatchInternal;modelInternal;constructor(){super();const e=i.Utils.createShadowRootWithCoreStyles(this,{cssFile:[Ct],delegatesFocus:void 0});this.iconElementInternal=i.Icon.Icon.create("smallicon-shadow","shadow-swatch-icon"),e.appendChild(this.iconElementInternal),e.createChild("slot"),this.contentElement=this.createChild("span")}static create(){let e=Et.constructorInternal;return e||(e=i.Utils.registerCustomElement("span","css-shadow-swatch",Et),Et.constructorInternal=e),e()}model(){return this.modelInternal}setCSSShadow(t){this.modelInternal=t,this.contentElement.removeChildren();const i=r.TextUtils.Utils.splitStringByRegexes(t.asCSSText(),[/!important/g,/inset/g,e.Color.Regex]);for(let e=0;e<i.length;e++){const n=i[e];if(2===n.regexIndex){if(!this.colorSwatchInternal){this.colorSwatchInternal=new C;const e=this.colorSwatchInternal.createChild("span");this.colorSwatchInternal.addEventListener(y.eventName,(t=>{e.textContent=t.data.text}))}this.colorSwatchInternal.renderColor(t.color());const e=this.colorSwatchInternal.querySelector("span");e&&(e.textContent=t.color().asString()),this.contentElement.appendChild(this.colorSwatchInternal)}else this.contentElement.appendChild(document.createTextNode(n.value))}}hideText(e){this.contentElement.hidden=e}iconElement(){return this.iconElementInternal}colorSwatch(){return this.colorSwatchInternal}static constructorInternal=null}var zt=Object.freeze({__proto__:null,BezierSwatch:kt,CSSShadowSwatch:Et});const Pt=new CSSStyleSheet;Pt.replaceSync(".widget{display:flex;background:var(--color-background);box-shadow:var(--drop-shadow);border-radius:2px;overflow:auto;user-select:text;line-height:11px}\n/*# sourceURL=swatchPopover.css */\n");class Tt extends e.ObjectWrapper.ObjectWrapper{popover;hideProxy;boundOnKeyDown;boundFocusOut;isHidden;anchorElement;view;hiddenCallback;focusRestorer;constructor(){super(),this.popover=new i.GlassPane.GlassPane,this.popover.setSizeBehavior("MeasureContent"),this.popover.setMarginBehavior("Arrow"),this.popover.element.addEventListener("mousedown",(e=>e.consume()),!1),this.hideProxy=this.hide.bind(this,!0),this.boundOnKeyDown=this.onKeyDown.bind(this),this.boundFocusOut=this.onFocusOut.bind(this),this.isHidden=!0,this.anchorElement=null}onFocusOut(e){const t=e.relatedTarget;!this.isHidden&&t&&this.view&&!t.isSelfOrDescendant(this.view.contentElement)&&this.hideProxy()}setAnchorElement(e){this.anchorElement=e}isShowing(e){return this.popover.isShowing()&&(e&&this.view===e||!e)}show(e,t,i){if(this.popover.isShowing()){if(this.anchorElement===t)return;this.hide(!0)}this.popover.registerCSSFiles([Pt]),this.dispatchEventToListeners(Lt.WillShowPopover),this.isHidden=!1,this.anchorElement=t,this.view=e,this.hiddenCallback=i,this.reposition(),e.focus();const n=this.popover.element.ownerDocument;n.addEventListener("mousedown",this.hideProxy,!1),n.defaultView&&n.defaultView.addEventListener("resize",this.hideProxy,!1),this.view.contentElement.addEventListener("keydown",this.boundOnKeyDown,!1)}reposition(){if(!this.isHidden&&this.view){if(this.view.contentElement.removeEventListener("focusout",this.boundFocusOut,!1),this.view.show(this.popover.contentElement),this.anchorElement){let e=this.anchorElement.boxInWindow();if(C.isColorSwatch(this.anchorElement)){const t=this.anchorElement;if(!t.anchorBox)return;e=t.anchorBox}this.popover.setContentAnchorBox(e),this.popover.show(this.anchorElement.ownerDocument)}this.view.contentElement.addEventListener("focusout",this.boundFocusOut,!1),this.focusRestorer||(this.focusRestorer=new i.Widget.WidgetFocusRestorer(this.view))}}hide(e){if(this.isHidden)return;const t=this.popover.element.ownerDocument;this.isHidden=!0,this.popover.hide(),t.removeEventListener("mousedown",this.hideProxy,!1),t.defaultView&&t.defaultView.removeEventListener("resize",this.hideProxy,!1),this.hiddenCallback&&this.hiddenCallback.call(null,Boolean(e)),this.focusRestorer&&this.focusRestorer.restore(),this.anchorElement=null,this.view&&(this.view.detach(),this.view.contentElement.removeEventListener("keydown",this.boundOnKeyDown,!1),this.view.contentElement.removeEventListener("focusout",this.boundFocusOut,!1),delete this.view)}onKeyDown(e){if("Enter"===e.key)return this.hide(!0),void e.consume(!0);e.key===t.KeyboardUtilities.ESCAPE_KEY&&(this.hide(!1),e.consume(!0))}}var Lt;!function(e){e.WillShowPopover="WillShowPopover"}(Lt||(Lt={}));var Ut=Object.freeze({__proto__:null,SwatchPopoverHelper:Tt,get Events(){return Lt}});export{f as BezierEditor,m as BezierUI,se as CSSAngle,O as CSSAngleUtils,ge as CSSLength,he as CSSLengthUtils,ke as CSSShadowEditor,xe as CSSShadowModel,Be as CSSVarSwatch,E as ColorSwatch,yt as FontEditor,Xe as FontEditorUnitConverter,gt as FontEditorUtils,V as InlineEditorUtils,Ut as SwatchPopoverHelper,zt as Swatches};
