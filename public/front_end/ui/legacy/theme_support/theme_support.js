import*as e from"../../../core/common/common.js";import*as o from"../../../core/platform/platform.js";var t={cssContent:".webkit-css-property{color:var(--webkit-css-property-color,rgb(200 0 0))}.webkit-html-comment{color:rgb(35 110 37)}.webkit-html-tag{color:rgb(168 148 166)}.webkit-html-close-tag-name,.webkit-html-tag-name{color:var(--color-token-tag)}.webkit-html-pseudo-element{color:rgb(17 85 204)}.webkit-html-css-node,.webkit-html-js-node{white-space:pre-wrap}.webkit-html-text-node{unicode-bidi:-webkit-isolate}.webkit-html-entity-value{background-color:rgb(0 0 0 / 15%);unicode-bidi:-webkit-isolate}.webkit-html-doctype{color:rgb(192 192 192)}.webkit-html-attribute-name{color:var(--color-token-attribute);unicode-bidi:-webkit-isolate}.webkit-html-attribute-value{color:rgb(26 26 166);unicode-bidi:-webkit-isolate;word-break:break-all}.devtools-link{color:var(--color-link);text-decoration:underline}.elements-disclosure .devtools-link{color:var(--color-link)}.devtools-link [is=ui-icon]{vertical-align:middle}.devtools-link [is=ui-icon].icon-mask{background-color:var(--color-link)}:focus .selected .devtools-link [is=ui-icon].icon-mask{background-color:var(--legacy-item-selection-bg-color)}.devtools-link:focus-visible{outline-width:unset}.devtools-link:not(.devtools-link-prevent-click){cursor:pointer}@media (forced-colors:active){.devtools-link:not(.devtools-link-prevent-click){forced-color-adjust:none;color:linktext}.devtools-link:focus-visible{background:Highlight;color:HighlightText}}"},r={cssContent:".cm-js-atom{color:rgb(161 247 181)}.cm-js-attribute{color:rgb(97 148 198)}.cm-js-builtin{color:rgb(159 180 214)}.cm-js-comment{color:rgb(116 116 116)}.cm-js-def{color:var(--color-token-tag)}.cm-js-keyword{color:rgb(154 127 213)}.cm-js-link{color:rgb(159 180 214)}.cm-js-meta{color:rgb(221 251 85)}.cm-js-number{color:rgb(161 247 181)}.cm-js-operator{color:rgb(210 192 87)}.cm-js-property{color:rgb(210 192 87)}.cm-js-string{color:rgb(242 139 84)}.cm-js-string-2{color:rgb(242 139 84)}.cm-js-tag{color:var(--color-token-tag)}.cm-js-variable{color:rgb(217 217 217)}.cm-js-variable-2{color:rgb(217 217 217)}.cm-atom{color:rgb(161 247 181)}.cm-comment{color:rgb(116 116 116)}.cm-variable{color:rgb(217 217 217)}.cm-keyword{color:rgb(154 127 213)}.cm-number{color:rgb(161 247 181)}.cm-operator{color:rgb(210 192 87)}.cm-css-atom{color:rgb(217 217 217)}.cm-css-builtin{color:rgb(255 163 79)}.cm-css-def{color:rgb(255 163 79)}.cm-css-comment{color:rgb(116 116 116)}.cm-css-meta{color:rgb(132 240 255)}.cm-css-number{color:rgb(217 217 217)}.cm-css-operator{color:rgb(217 217 217)}.cm-css-property{color:rgb(132 240 255)}.cm-css-qualifier{color:rgb(255 163 79)}.cm-css-string{color:rgb(231 194 111)}.cm-css-string-2{color:rgb(217 217 217)}.cm-css-tag{color:rgb(255 163 79)}.cm-css-variable{color:rgb(255 163 79)}.cm-css-variable-2{color:rgb(255 163 79)}.cm-xml-comment{color:rgb(137 137 137)}.cm-xml-error{color:rgb(198 95 95)}.cm-xml-string{color:rgb(242 151 102)}.cm-xml-tag{color:var(--color-token-tag)}.cm-xml-attribute{color:var(--color-token-attribute)}.cm-xml-link{color:rgb(231 194 111)}.webkit-html-attribute-name{color:var(--color-token-attribute)}.webkit-html-attribute-value{color:rgb(242 151 102)}.webkit-html-comment{color:rgb(137 137 137)}.webkit-html-tag{color:var(--color-token-tag)}.webkit-html-tag-name{color:var(--color-token-tag)}.webkit-html-close-tag-name{color:var(--color-token-tag)}.webkit-html-text-node{color:rgb(207 208 208)}.webkit-html-css-node{color:rgb(207 208 208)}.webkit-html-js-node{color:rgb(207 208 208)}.webkit-html-pseudo-element{color:rgb(237 119 229)}.webkit-css-property{color:var(--webkit-css-property-color,rgb(53 212 199))}.cm-def{color:var(--color-token-tag)}.cm-header{color:var(--color-token-tag)}.cm-variable-2{color:#05a}.cm-type,.cm-variable-3{color:rgb(93 176 215)}.cm-string{color:rgb(242 139 84)}.cm-meta{color:rgb(221 251 85)}.cm-qualifier{color:rgb(255 163 79)}.cm-builtin{color:rgb(159 180 214)}.cm-bracket{color:#997}.cm-tag{color:var(--color-token-tag)}.cm-attribute{color:rgb(97 148 198)}.cm-hr{color:#999}.cm-link{color:rgb(159 180 214)}"};let c;class l{themeNameInternal;themableProperties;cachedThemePatches;setting;customSheets;computedRoot;injectingStyleSheet;constructor(o){const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"default";this.themeNameInternal="systemPreferred"===o.get()?t:o.get(),this.themableProperties=new Set(["color","box-shadow","text-shadow","outline-color","background-image","background-color","border-left-color","border-right-color","border-top-color","border-bottom-color","-webkit-border-image","fill","stroke"]),this.cachedThemePatches=new Map,this.setting=o,this.customSheets=new Set,this.computedRoot=e.Lazy.lazy((()=>window.getComputedStyle(document.documentElement)))}static hasInstance(){return void 0!==c}static instance(e={forceNew:null,setting:null}){const{forceNew:o,setting:t}=e;if(!c||o){if(!t)throw new Error(`Unable to create theme support: setting must be provided: ${(new Error).stack}`);c=new l(t)}return c}getComputedValue(e){const o=this.computedRoot();if("symbol"==typeof o)throw new Error(`Computed value for property (${e}) could not be found on :root.`);return o.getPropertyValue(e)}hasTheme(){return"default"!==this.themeNameInternal}themeName(){return this.themeNameInternal}injectHighlightStyleSheets(e){this.injectingStyleSheet=!0,this.appendStyle(e,t),"dark"===this.themeNameInternal&&this.appendStyle(e,r),this.injectingStyleSheet=!1}appendStyle(e,{cssContent:o}){const t=document.createElement("style");t.textContent=o,e.appendChild(t)}injectCustomStyleSheets(e){for(const o of this.customSheets){const t=document.createElement("style");t.textContent=o,e.appendChild(t)}}isForcedColorsMode(){return window.matchMedia("(forced-colors: active)").matches}addCustomStylesheet(e){this.customSheets.add(e)}applyTheme(e){if(!this.hasTheme()||this.isForcedColorsMode())return;"dark"===this.themeNameInternal&&e.documentElement.classList.add("-theme-with-dark-background");const o=e.styleSheets,t=[];for(let e=0;e<o.length;++e){const r=o[e].href;r&&t.push(this.patchForTheme(r,o[e]))}t.push("/*# sourceURL=inspector.css.theme */");const r=e.createElement("style");r.textContent=t.join("\n"),e.head.appendChild(r)}themeStyleSheet(e,o){if(!this.hasTheme()||this.injectingStyleSheet||this.isForcedColorsMode())return"";let t=this.cachedThemePatches.get(e);if(!t){const r=document.createElement("style");r.textContent=o,document.body.appendChild(r);const{sheet:c}=r;if(!c)throw new Error("No sheet in stylesheet object");t=this.patchForTheme(e,c),document.body.removeChild(r)}return t}patchForTheme(e,o){const t=this.cachedThemePatches.get(e);if(t)return t;try{const t=o.cssRules,r=[];for(let e=0;e<t.length;++e){const o=t[e];if(o instanceof CSSImportRule){r.push(this.patchForTheme(o.styleSheet.href||"",o.styleSheet));continue}if(!(o instanceof CSSStyleRule))continue;const c=[],l=o.style,s=o.selectorText;for(let e=0;l&&e<l.length;++e)this.patchProperty(s,l,l[e],c);c.length&&r.push(o.selectorText+"{"+c.join("")+"}")}const c=r.join("\n");return this.cachedThemePatches.set(e,c),c}catch(e){return this.setting.set("default"),""}}patchProperty(o,t,r,c){if(!this.themableProperties.has(r))return;const s=t.getPropertyValue(r);if(!s||"none"===s||"inherit"===s||"initial"===s||"transparent"===s)return;if("background-image"===r&&-1===s.indexOf("gradient"))return;if(-1!==o.indexOf("-theme-"))return;let n=l.ColorUsage.Unknown;if(0!==r.indexOf("background")&&0!==r.indexOf("border")||(n|=l.ColorUsage.Background),-1===r.indexOf("background")&&(n|=l.ColorUsage.Foreground),c.push(r),c.push(":"),/^var\(.*\)$/.test(s))c.push(s);else{const o=s.replace(e.Color.Regex,"\0$1\0").split("\0");for(const e of o)c.push(this.patchColorText(e,n))}t.getPropertyPriority(r)&&c.push(" !important"),c.push(";")}patchColorText(o,t){const r=e.Color.Color.parse(o);if(!r)return o;const c=this.patchColor(r,t);let l=c.asString(null);return l||(l=c.asString(c.hasAlpha()?e.Color.Format.RGBA:e.Color.Format.RGB)),l||o}patchColor(o,t){const r=o.hsla();this.patchHSLA(r,t);const c=[];return e.Color.Color.hsl2rgb(r,c),new e.Color.Color(c,o.format())}patchHSLA(e,t){const r=e[0],c=e[1];let s=e[2];const n=e[3];switch(this.themeNameInternal){case"dark":{const e=t&l.ColorUsage.Background?.14:0,o=t&l.ColorUsage.Foreground?.9:1;s=1-s,s<2*e?s=e+s/2:s>2*o-1&&(s=o-.5+s/2);break}}e[0]=o.NumberUtilities.clamp(r,0,1),e[1]=o.NumberUtilities.clamp(c,0,1),e[2]=o.NumberUtilities.clamp(s,0,1),e[3]=o.NumberUtilities.clamp(n,0,1)}}!function(e){let o;!function(e){e[e.Unknown=0]="Unknown",e[e.Foreground=1]="Foreground",e[e.Background=2]="Background"}(o=e.ColorUsage||(e.ColorUsage={}))}(l||(l={}));export{l as ThemeSupport};
