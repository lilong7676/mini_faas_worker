import*as e from"../../core/common/common.js";import*as t from"../../core/root/root.js";import*as n from"../../core/sdk/sdk.js";import*as i from"../../ui/legacy/legacy.js";import*as s from"../../core/host/host.js";import*as o from"../../core/i18n/i18n.js";import*as r from"../../models/extensions/extensions.js";import*as l from"../../ui/components/icon_button/icon_button.js";import*as a from"../../ui/legacy/components/utils/utils.js";import*as d from"../../ui/components/tree_outline/tree_outline.js";import*as h from"./components/components.js";import*as c from"../../ui/lit-html/lit-html.js";import*as p from"../../core/platform/platform.js";import*as u from"../../ui/legacy/components/inline_editor/inline_editor.js";import*as m from"../../models/bindings/bindings.js";import*as g from"../../models/text_utils/text_utils.js";import*as y from"../../ui/legacy/components/color_picker/color_picker.js";import*as f from"../../third_party/codemirror.next/codemirror.next.js";import*as S from"../../ui/components/adorners/adorners.js";import*as b from"../../ui/components/code_highlighter/code_highlighter.js";import*as v from"../../ui/components/text_editor/text_editor.js";import*as E from"../emulation/emulation.js";import*as C from"../event_listeners/event_listeners.js";import*as w from"../../ui/legacy/components/object_ui/object_ui.js";const x=new CSSStyleSheet;function M(e){const t=n.FrameManager.FrameManager.instance().getFrame(e)?.resourceTreeModel().target().model(n.AccessibilityModel.AccessibilityModel);if(!t)throw Error("Could not instantiate model for frameId");return t}async function T(e){const t=M(e),n=await t.requestRootNode(e);if(!n)throw Error("No accessibility root for frame");return n}function I(e){let t;if(t=e instanceof n.DOMModel.DOMDocument?e.body?.frameId():e.frameId(),!t)throw Error("No frameId for DOM node");return t}async function N(e){const t=e;return 0===(n=e).numChildren()&&"Iframe"!==n.role()?.value?[{treeNodeData:t,id:O(e)}]:[{treeNodeData:t,children:async()=>{const t=await async function(e){if("Iframe"===e.role()?.value){const t=await(e.deferredDOMNode()?.resolvePromise());if(!t)throw new Error("Could not find corresponding DOMNode");const n=t.frameOwnerFrameId();if(!n)throw Error("No owner frameId on iframe node");return[await T(n)]}if(e.hasUnloadedChildren()&&(await e.accessibilityModel().requestAXChildren(e.id(),e.getFrameId()||void 0),e.numChildren()!==e.children().length))throw new Error("Once loaded, number of children and length of children must match.");return e.children()}(e);return(await Promise.all(t.map((e=>N(e))))).flat(1)},id:O(e)}];var n}function P(e){const t=h.AccessibilityTreeNode.AccessibilityTreeNode.litTagName,n=e.treeNodeData,i=n.name()?.value||"",s=n.role()?.value||"",o=n.properties()||[],r=n.ignored();return c.html`<${t} .data="${{name:i,role:s,ignored:r,properties:o}}"></${t}>`}function O(e){return e.getFrameId()+"#"+e.id()}x.replaceSync("#elements-content{flex:1 1;overflow:auto;padding:2px 0 0}.style-panes-wrapper{overflow:hidden scroll;background-color:var(--color-background)}.style-panes-wrapper>div:not(:last-child){border-bottom:1px solid var(--color-details-hairline)}#elements-content:not(.elements-wrap)>div{display:inline-block;min-width:100%}#elements-crumbs{background-color:var(--color-background);border-top:1px solid var(--color-details-hairline);overflow:hidden;width:100%}.elements-tree-header{height:24px;border-top:1px solid var(--color-details-hairline);border-bottom:1px solid var(--color-details-hairline);display:flex;flex-direction:row;align-items:center}.elements-tree-header-frame{margin-left:6px;margin-right:6px;flex:none}devtools-adorner-settings-pane{margin-bottom:10px;border-bottom:1px solid var(--color-details-hairline);overflow:auto}devtools-tree-outline{overflow:auto}.axtree-button{position:absolute;padding:4px;top:16px;right:16px;display:flex;justify-content:center;align-items:center;z-index:1}\n/*# sourceURL=elementsPanel.css */\n");class k extends i.Widget.VBox{accessibilityTreeComponent=new d.TreeOutline.TreeOutline;toggleButton;inspectedDOMNode=null;root=null;constructor(e){super(),this.toggleButton=e,this.contentElement.appendChild(this.toggleButton),this.contentElement.appendChild(this.accessibilityTreeComponent),n.TargetManager.TargetManager.instance().observeModels(n.AccessibilityModel.AccessibilityModel,this),this.accessibilityTreeComponent.addEventListener("itemselected",(e=>{const t=e.data.node.treeNodeData;if(!t.isDOMNode())return;const n=t.deferredDOMNode();n&&n.resolve((e=>{e&&(this.inspectedDOMNode=e,an.instance().revealAndSelectNode(e,!0,!1))}))})),this.accessibilityTreeComponent.addEventListener("itemmouseover",(e=>{e.data.node.treeNodeData.highlightDOMNode()})),this.accessibilityTreeComponent.addEventListener("itemmouseout",(()=>{n.OverlayModel.OverlayModel.hideDOMNodeHighlight()}))}async wasShown(){await this.refreshAccessibilityTree(),this.inspectedDOMNode&&await this.loadSubTreeIntoAccessibilityModel(this.inspectedDOMNode)}async refreshAccessibilityTree(){if(!this.root){const e=n.FrameManager.FrameManager.instance().getTopFrame()?.id;if(!e)throw Error("No top frame");if(this.root=await T(e),!this.root)throw Error("No root")}await this.renderTree(),await this.accessibilityTreeComponent.expandRecursively(1)}async renderTree(){if(!this.root)return;const e=await N(this.root);this.accessibilityTreeComponent.data={defaultRenderer:P,tree:e,filter:e=>e.ignored()||"generic"===e.role()?.value&&!e.name()?.value?"FLATTEN":"SHOW"}}async loadSubTreeIntoAccessibilityModel(e){const t=await async function(e){let t=I(e);const i=M(t),s=await i.requestAndLoadSubTreeToNode(e);if(!s)throw Error("Could not retrieve accessibility node for inspected DOM node");const o=n.FrameManager.FrameManager.instance().getTopFrame()?.id;if(!o)return s;for(;t!==o;){const e=await(n.FrameManager.FrameManager.instance().getFrame(t)?.getOwnerDOMNodeOrDocument());if(!e)break;t=I(e);const i=M(t),o=await i.requestAndLoadSubTreeToNode(e);s.push(...o||[])}return s}(e),i=t.find((t=>t.backendDOMNodeId()===e.backendNodeId()));i&&(await this.accessibilityTreeComponent.expandNodeIds(t.map((e=>e.getFrameId()+"#"+e.id()))),await this.accessibilityTreeComponent.focusNodeId(O(i)))}async revealAndSelectNode(e){e!==this.inspectedDOMNode&&(this.inspectedDOMNode=e,this.isShowing()&&await this.loadSubTreeIntoAccessibilityModel(e))}async selectedNodeChanged(e){this.isShowing()||(!e.ownerDocument||"HTML"!==e.nodeName()&&"BODY"!==e.nodeName()||(e=e.ownerDocument),e!==this.inspectedDOMNode&&(this.inspectedDOMNode=e))}treeUpdated({data:e}){if(!e.root)return void this.renderTree();const t=n.FrameManager.FrameManager.instance().getTopFrame()?.id;e.root?.getFrameId()===t?(this.root=e.root,this.accessibilityTreeComponent.collapseAllNodes(),this.refreshAccessibilityTree()):this.renderTree()}modelAdded(e){e.addEventListener(n.AccessibilityModel.Events.TreeUpdated,this.treeUpdated,this)}modelRemoved(e){e.removeEventListener(n.AccessibilityModel.Events.TreeUpdated,this.treeUpdated,this)}}const L=new CSSStyleSheet;L.replaceSync(".computed-properties{user-select:text;flex-shrink:0}.styles-sidebar-pane-toolbar{border-bottom:1px solid var(--color-details-hairline-light);flex-shrink:0}.styles-sidebar-pane-filter-box{flex:auto;display:flex}.styles-sidebar-pane-filter-box>input{outline:0!important;border:none;width:100%;background:var(--color-background);padding-left:4px;margin:3px}.styles-sidebar-pane-filter-box>input:focus,.styles-sidebar-pane-filter-box>input:not(:placeholder-shown){box-shadow:var(--legacy-focus-ring-active-shadow)}.styles-sidebar-pane-filter-box>input::placeholder{color:var(--color-text-disabled)}@media (forced-colors:active){.styles-sidebar-pane-filter-box>input{border:1px solid ButtonText}}\n/*# sourceURL=computedStyleSidebarPane.css */\n");const D=new CSSStyleSheet;D.replaceSync(".alphabetical-list.render-flash{min-height:100vh}.tree-outline,.tree-outline ol{padding-left:0}.tree-outline li:hover{background-color:var(--legacy-focus-bg-color);cursor:pointer}.tree-outline li::before{margin:0 -1px 0 4px}.group-title{padding-right:16px}.tree-outline li.group-title:hover{background-color:transparent}.group-title>h1{margin:1px 0 0;padding:1em 0;width:100%;cursor:pointer;color:var(--color-text-secondary);font-size:11px;font-weight:400}.group-title:not(.first-group)>h1{border-top:1px solid var(--color-details-hairline)}.group-title+ol.children{margin-bottom:1em}@media (forced-colors:active){:host-context(.monospace.computed-properties) .tree-outline li:hover{forced-color-adjust:none;background-color:Highlight}:host-context(.monospace.computed-properties) .tree-outline-disclosure li.parent:hover::before,:host-context(.monospace.computed-properties) .tree-outline:not(.hide-selection-when-blurred) li.parent:hover.selected::before{background-color:HighlightText}:host-context(.monospace.computed-properties) .tree-outline li:hover *{color:HighlightText}}\n/*# sourceURL=computedStyleWidgetTree.css */\n");class A extends e.ObjectWrapper.ObjectWrapper{nodeInternal;cssModelInternal;eventListeners;frameResizedTimer;computedStylePromise;constructor(){super(),this.nodeInternal=i.Context.Context.instance().flavor(n.DOMModel.DOMNode),this.cssModelInternal=null,this.eventListeners=[],i.Context.Context.instance().addFlavorChangeListener(n.DOMModel.DOMNode,this.onNodeChanged,this)}node(){return this.nodeInternal}cssModel(){return this.cssModelInternal&&this.cssModelInternal.isEnabled()?this.cssModelInternal:null}onNodeChanged(e){this.nodeInternal=e.data,this.updateModel(this.nodeInternal?this.nodeInternal.domModel().cssModel():null),this.onComputedStyleChanged(null)}updateModel(t){if(this.cssModelInternal===t)return;e.EventTarget.removeEventListeners(this.eventListeners),this.cssModelInternal=t;const i=t?t.domModel():null,s=t?t.target().model(n.ResourceTreeModel.ResourceTreeModel):null;t&&i&&s&&(this.eventListeners=[t.addEventListener(n.CSSModel.Events.StyleSheetAdded,this.onComputedStyleChanged,this),t.addEventListener(n.CSSModel.Events.StyleSheetRemoved,this.onComputedStyleChanged,this),t.addEventListener(n.CSSModel.Events.StyleSheetChanged,this.onComputedStyleChanged,this),t.addEventListener(n.CSSModel.Events.FontsUpdated,this.onComputedStyleChanged,this),t.addEventListener(n.CSSModel.Events.MediaQueryResultChanged,this.onComputedStyleChanged,this),t.addEventListener(n.CSSModel.Events.PseudoStateForced,this.onComputedStyleChanged,this),t.addEventListener(n.CSSModel.Events.ModelWasEnabled,this.onComputedStyleChanged,this),i.addEventListener(n.DOMModel.Events.DOMMutated,this.onDOMModelChanged,this),s.addEventListener(n.ResourceTreeModel.Events.FrameResized,this.onFrameResized,this)])}onComputedStyleChanged(e){delete this.computedStylePromise,this.dispatchEventToListeners("ComputedStyleChanged",e?.data??null)}onDOMModelChanged(e){const t=e.data;this.nodeInternal&&(this.nodeInternal===t||t.parentNode===this.nodeInternal.parentNode||t.isAncestor(this.nodeInternal))&&this.onComputedStyleChanged(null)}onFrameResized(){this.frameResizedTimer&&clearTimeout(this.frameResizedTimer),this.frameResizedTimer=setTimeout(function(){this.onComputedStyleChanged(null),delete this.frameResizedTimer}.bind(this),100)}elementNode(){const e=this.node();return e?e.enclosingElementOrSelf():null}async fetchComputedStyle(){const e=this.elementNode(),t=this.cssModel();if(!e||!t)return null;const n=e.id;return n?(this.computedStylePromise||(this.computedStylePromise=t.computedStylePromise(n).then(function(e,t){return e===this.elementNode()&&t?new R(e,t):null}.bind(this,e))),this.computedStylePromise):null}}class R{node;computedStyle;constructor(e,t){this.node=e,this.computedStyle=t}}var F=Object.freeze({__proto__:null,ComputedStyleModel:A,ComputedStyle:R});class U{getLinkElement;getDOMNode;popover;constructor(e,t,n){this.getLinkElement=t,this.getDOMNode=n,this.popover=new i.PopoverHelper.PopoverHelper(e,this.handleRequest.bind(this)),this.popover.setHasPadding(!0),this.popover.setTimeout(0,100)}handleRequest(e){const t=this.getLinkElement(e);if(!t)return null;const n=H.get(t);return n?{box:t.boxInWindow(),hide:void 0,show:async e=>{const i=this.getDOMNode(t);if(!i)return!1;const s=await a.ImagePreview.ImagePreview.loadDimensionsForNode(i),o=await a.ImagePreview.ImagePreview.build(i.domModel().target(),n,!0,{imageAltText:void 0,precomputedFeatures:s});return o&&e.contentElement.appendChild(o),Boolean(o)}}:null}hide(){this.popover.hidePopover()}static setImageUrl(e,t){return H.set(e,t),e}static getImageURL(e){return H.get(e)}}const H=new WeakMap,B=new CSSStyleSheet;B.replaceSync(":host{user-select:text}.platform-fonts{flex-shrink:0}.font-name{font-weight:700}.font-usage{color:var(--color-text-secondary);padding-left:3px}.title{padding:0 5px;border-top:1px solid;border-bottom:1px solid;border-color:var(--color-background-elevation-2);white-space:nowrap;text-overflow:ellipsis;overflow:hidden;height:24px;background-color:var(--color-background-elevation-0);display:flex;align-items:center}.stats-section{margin:5px 0}.font-stats-item{padding-left:1em}.font-stats-item .font-delimeter{margin:0 1ex}\n/*# sourceURL=platformFontsWidget.css */\n");const V={renderedFonts:"Rendered Fonts",networkResource:"Network resource",localFile:"Local file",dGlyphs:"{n, plural, =1 {(# glyph)} other {(# glyphs)}}"},W=o.i18n.registerUIStrings("panels/elements/PlatformFontsWidget.ts",V),_=o.i18n.getLocalizedString.bind(void 0,W);class z extends i.ThrottledWidget.ThrottledWidget{sharedModel;sectionTitle;fontStatsSection;constructor(e){super(!0),this.sharedModel=e,this.sharedModel.addEventListener("ComputedStyleChanged",this.update,this),this.sectionTitle=document.createElement("div"),this.sectionTitle.classList.add("title"),this.contentElement.classList.add("platform-fonts"),this.contentElement.appendChild(this.sectionTitle),this.sectionTitle.textContent=_(V.renderedFonts),this.fontStatsSection=this.contentElement.createChild("div","stats-section")}doUpdate(){const e=this.sharedModel.cssModel(),t=this.sharedModel.node();return t&&e?e.platformFontsPromise(t.id).then(this.refreshUI.bind(this,t)):Promise.resolve()}refreshUI(e,t){if(this.sharedModel.node()!==e)return;this.fontStatsSection.removeChildren();const n=!t||!t.length;if(this.sectionTitle.classList.toggle("hidden",n),!n&&t){t.sort((function(e,t){return t.glyphCount-e.glyphCount}));for(let e=0;e<t.length;++e){const n=this.fontStatsSection.createChild("div","font-stats-item");n.createChild("span","font-name").textContent=t[e].familyName;n.createChild("span","font-delimeter").textContent="—";n.createChild("span").textContent=t[e].isCustomFont?_(V.networkResource):_(V.localFile);const i=n.createChild("span","font-usage"),s=t[e].glyphCount;i.textContent=_(V.dGlyphs,{n:s})}}}wasShown(){super.wasShown(),this.registerCSSFiles([B])}}var j=Object.freeze({__proto__:null,PlatformFontsWidget:z});const K=["Layout","Text","Appearance","Animation","CSS Variables","Grid","Flex","Table","Generated Content","Other"],G=new Map([["Layout",["display","margin","padding","height","width","position","top","right","bottom","left","z-index","float","clear","overflow","resize","clip","visibility","box-sizing","align-content","align-items","align-self","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","justify-content","order","inline-size","block-size","min-inline-size","min-block-size","max-inline-size","max-block-size","min-width","max-width","min-height","max-height"]],["Text",["font","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","font-smoothing","direction","tab-size","text-align","text-align-last","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-indent","text-justify","text-overflow","text-shadow","text-transform","text-size-adjust","line-height","vertical-align","letter-spacing","word-spacing","white-space","word-break","word-wrap"]],["Appearance",["color","outline","outline-color","outline-offset","outline-style","Outline-width","border","border-image","background","cursor","box-shadow","≈","tap-highlight-color"]],["Animation",["animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","transition","transition-delay","transition-duration","transition-property","transition-timing-function"]],["Grid",["grid","grid-column","grid-row","order","place-items","place-content","place-self"]],["Flex",["flex","order","place-items","place-content","place-self"]],["Table",["border-collapse","border-spacing","caption-side","empty-cells","table-layout"]],["Generated Content",["content","quotes","counter-reset","counter-increment"]]]),q=new Map;for(const[e,t]of G)for(const n of t){q.has(n)||q.set(n,[]);q.get(n).push(e)}const $=e=>q.has(e)?q.get(e):e.startsWith("--")?["CSS Variables"]:[],Q=e=>{const t=n.CSSMetadata.cssMetadata(),i=t.canonicalPropertyName(e),s=$(i);if(s.length>0)return s;const o=t.getShorthands(i);if(o)for(const e of o){const t=$(e);if(t.length>0)return t}return["Other"]},X={openCubicBezierEditor:"Open cubic bezier editor",openShadowEditor:"Open shadow editor"},J=o.i18n.registerUIStrings("panels/elements/ColorSwatchPopoverIcon.ts",X),Y=o.i18n.getLocalizedString.bind(void 0,J);class Z{treeElement;swatchPopoverHelper;swatch;boundBezierChanged;boundOnScroll;bezierEditor;scrollerElement;originalPropertyText;constructor(e,t,n){this.treeElement=e,this.swatchPopoverHelper=t,this.swatch=n,i.Tooltip.Tooltip.install(this.swatch.iconElement(),Y(X.openCubicBezierEditor)),this.swatch.iconElement().addEventListener("click",this.iconClick.bind(this),!1),this.swatch.iconElement().addEventListener("mousedown",(e=>e.consume()),!1),this.boundBezierChanged=this.bezierChanged.bind(this),this.boundOnScroll=this.onScroll.bind(this)}iconClick(t){if(t.consume(!0),this.swatchPopoverHelper.isShowing())return void this.swatchPopoverHelper.hide(!0);const n=i.Geometry.CubicBezier.parse(this.swatch.bezierText())||i.Geometry.CubicBezier.parse("linear");this.bezierEditor=new u.BezierEditor.BezierEditor(n),this.bezierEditor.setBezier(n),this.bezierEditor.addEventListener(u.BezierEditor.Events.BezierChanged,this.boundBezierChanged),this.swatchPopoverHelper.show(this.bezierEditor,this.swatch.iconElement(),this.onPopoverHidden.bind(this)),this.scrollerElement=this.swatch.enclosingNodeOrSelfWithClass("style-panes-wrapper"),this.scrollerElement&&this.scrollerElement.addEventListener("scroll",this.boundOnScroll,!1),this.originalPropertyText=this.treeElement.property.propertyText,this.treeElement.parentPane().setEditingStyle(!0);const s=m.CSSWorkspaceBinding.CSSWorkspaceBinding.instance().propertyUILocation(this.treeElement.property,!1);s&&e.Revealer.reveal(s,!0)}bezierChanged(e){this.swatch.setBezierText(e.data),this.treeElement.applyStyleText(this.treeElement.renderedPropertyText(),!1)}onScroll(e){this.swatchPopoverHelper.hide(!0)}onPopoverHidden(e){this.scrollerElement&&this.scrollerElement.removeEventListener("scroll",this.boundOnScroll,!1),this.bezierEditor&&this.bezierEditor.removeEventListener(u.BezierEditor.Events.BezierChanged,this.boundBezierChanged),this.bezierEditor=void 0;const t=e?this.treeElement.renderedPropertyText():this.originalPropertyText||"";this.treeElement.applyStyleText(t,!0),this.treeElement.parentPane().setEditingStyle(!1),delete this.originalPropertyText}}class ee{treeElement;swatchPopoverHelper;swatch;contrastInfo;boundSpectrumChanged;boundOnScroll;spectrum;scrollerElement;originalPropertyText;constructor(e,t,n){this.treeElement=e,this.swatchPopoverHelper=t,this.swatch=n,this.swatch.addEventListener(u.ColorSwatch.ClickEvent.eventName,this.iconClick.bind(this)),this.contrastInfo=null,this.boundSpectrumChanged=this.spectrumChanged.bind(this),this.boundOnScroll=this.onScroll.bind(this)}generateCSSVariablesPalette(){const t=this.treeElement.matchedStyles(),n=this.treeElement.property.ownerStyle,i=t.availableCSSVariables(n),s=[],o=[];for(const r of i){if(r===this.treeElement.property.name)continue;const i=t.computeCSSVariable(n,r);if(!i)continue;e.Color.Color.parse(i)&&(s.push(i),o.push(r))}return{title:"CSS Variables",mutable:!1,matchUserFormat:!0,colors:s,colorNames:o}}setContrastInfo(e){this.contrastInfo=e}iconClick(e){e.consume(!0),this.showPopover()}showPopover(){if(this.swatchPopoverHelper.isShowing())return void this.swatchPopoverHelper.hide(!0);const t=this.swatch.getColor();let n=this.swatch.getFormat();if(!t||!n)return;n===e.Color.Format.Original&&(n=t.format()),this.spectrum=new y.Spectrum.Spectrum(this.contrastInfo),this.spectrum.setColor(t,n),this.spectrum.addPalette(this.generateCSSVariablesPalette()),this.spectrum.addEventListener(y.Spectrum.Events.SizeChanged,this.spectrumResized,this),this.spectrum.addEventListener(y.Spectrum.Events.ColorChanged,this.boundSpectrumChanged),this.swatchPopoverHelper.show(this.spectrum,this.swatch,this.onPopoverHidden.bind(this)),this.scrollerElement=this.swatch.enclosingNodeOrSelfWithClass("style-panes-wrapper"),this.scrollerElement&&this.scrollerElement.addEventListener("scroll",this.boundOnScroll,!1),this.originalPropertyText=this.treeElement.property.propertyText,this.treeElement.parentPane().setEditingStyle(!0);const i=m.CSSWorkspaceBinding.CSSWorkspaceBinding.instance().propertyUILocation(this.treeElement.property,!1);i&&e.Revealer.reveal(i,!0)}spectrumResized(){this.swatchPopoverHelper.reposition()}spectrumChanged(t){const n=e.Color.Color.parse(t.data);if(!n)return;const i=this.spectrum?this.spectrum.colorName():void 0,s=i&&i.startsWith("--")?`var(${i})`:n.asString();this.swatch.renderColor(n);const o=this.swatch.firstElementChild;o&&(o.remove(),this.swatch.createChild("span").textContent=s),this.treeElement.applyStyleText(this.treeElement.renderedPropertyText(),!1)}onScroll(e){this.swatchPopoverHelper.hide(!0)}onPopoverHidden(e){this.scrollerElement&&this.scrollerElement.removeEventListener("scroll",this.boundOnScroll,!1),this.spectrum&&this.spectrum.removeEventListener(y.Spectrum.Events.ColorChanged,this.boundSpectrumChanged),this.spectrum=void 0;const t=e?this.treeElement.renderedPropertyText():this.originalPropertyText||"";this.treeElement.applyStyleText(t,!0),this.treeElement.parentPane().setEditingStyle(!1),delete this.originalPropertyText}}class te{treeElement;swatchPopoverHelper;shadowSwatch;iconElement;boundShadowChanged;boundOnScroll;cssShadowEditor;scrollerElement;originalPropertyText;constructor(e,t,n){this.treeElement=e,this.swatchPopoverHelper=t,this.shadowSwatch=n,this.iconElement=n.iconElement(),i.Tooltip.Tooltip.install(this.iconElement,Y(X.openShadowEditor)),this.iconElement.addEventListener("click",this.iconClick.bind(this),!1),this.iconElement.addEventListener("mousedown",(e=>e.consume()),!1),this.boundShadowChanged=this.shadowChanged.bind(this),this.boundOnScroll=this.onScroll.bind(this)}iconClick(e){e.consume(!0),this.showPopover()}showPopover(){if(this.swatchPopoverHelper.isShowing())return void this.swatchPopoverHelper.hide(!0);this.cssShadowEditor=new u.CSSShadowEditor.CSSShadowEditor,this.cssShadowEditor.setModel(this.shadowSwatch.model()),this.cssShadowEditor.addEventListener(u.CSSShadowEditor.Events.ShadowChanged,this.boundShadowChanged),this.swatchPopoverHelper.show(this.cssShadowEditor,this.iconElement,this.onPopoverHidden.bind(this)),this.scrollerElement=this.iconElement.enclosingNodeOrSelfWithClass("style-panes-wrapper"),this.scrollerElement&&this.scrollerElement.addEventListener("scroll",this.boundOnScroll,!1),this.originalPropertyText=this.treeElement.property.propertyText,this.treeElement.parentPane().setEditingStyle(!0);const t=m.CSSWorkspaceBinding.CSSWorkspaceBinding.instance().propertyUILocation(this.treeElement.property,!1);t&&e.Revealer.reveal(t,!0)}shadowChanged(e){this.shadowSwatch.setCSSShadow(e.data),this.treeElement.applyStyleText(this.treeElement.renderedPropertyText(),!1)}onScroll(e){this.swatchPopoverHelper.hide(!0)}onPopoverHidden(e){this.scrollerElement&&this.scrollerElement.removeEventListener("scroll",this.boundOnScroll,!1),this.cssShadowEditor&&this.cssShadowEditor.removeEventListener(u.CSSShadowEditor.Events.ShadowChanged,this.boundShadowChanged),this.cssShadowEditor=void 0;const t=e?this.treeElement.renderedPropertyText():this.originalPropertyText||"";this.treeElement.applyStyleText(t,!0),this.treeElement.parentPane().setEditingStyle(!1),delete this.originalPropertyText}}class ne{treeElementMap;swatchPopoverHelper;section;parentPane;fontEditor;scrollerElement;boundFontChanged;boundOnScroll;boundResized;constructor(e,t){this.treeElementMap=new Map,this.swatchPopoverHelper=e,this.section=t,this.parentPane=null,this.fontEditor=null,this.scrollerElement=null,this.boundFontChanged=this.fontChanged.bind(this),this.boundOnScroll=this.onScroll.bind(this),this.boundResized=this.fontEditorResized.bind(this)}fontChanged(e){const{propertyName:t,value:n}=e.data,i=this.treeElementMap.get(t);this.updateFontProperty(t,n,i)}async updateFontProperty(e,t,n){if(n&&n.treeOutline&&n.valueElement&&n.property.parsedOk&&n.property.range){let e,i=!1;n.valueElement.textContent=t,n.property.value=t;const s=n.property.name;t.length?e=n.renderedPropertyText():(e="",i=!0,this.fixIndex(n.property.index)),this.treeElementMap.set(s,n),await n.applyStyleText(e,!0),i&&this.treeElementMap.delete(s)}else if(t.length){const n=this.section.addNewBlankProperty();n&&(n.property.name=e,n.property.value=t,n.updateTitle(),await n.applyStyleText(n.renderedPropertyText(),!0),this.treeElementMap.set(n.property.name,n))}this.section.onpopulate(),this.swatchPopoverHelper.reposition()}fontEditorResized(){this.swatchPopoverHelper.reposition()}fixIndex(e){for(const t of this.treeElementMap.values())t.property.index>e&&(t.property.index-=1)}createPropertyValueMap(){const e=new Map;for(const t of this.treeElementMap){const n=t[0],i=t[1];i.property.value.length?e.set(n,i.property.value):this.treeElementMap.delete(n)}return e}registerFontProperty(e){const t=e.property.name;if(this.treeElementMap.has(t)){const n=this.treeElementMap.get(t);(!e.overloaded()||n&&n.overloaded())&&this.treeElementMap.set(t,e)}else this.treeElementMap.set(t,e)}async showPopover(e,t){if(this.swatchPopoverHelper.isShowing())return void this.swatchPopoverHelper.hide(!0);this.parentPane=t;const n=this.createPropertyValueMap();this.fontEditor=new u.FontEditor.FontEditor(n),this.fontEditor.addEventListener(u.FontEditor.Events.FontChanged,this.boundFontChanged),this.fontEditor.addEventListener(u.FontEditor.Events.FontEditorResized,this.boundResized),this.swatchPopoverHelper.show(this.fontEditor,e,this.onPopoverHidden.bind(this)),this.scrollerElement=e.enclosingNodeOrSelfWithClass("style-panes-wrapper"),this.scrollerElement&&this.scrollerElement.addEventListener("scroll",this.boundOnScroll,!1),this.parentPane.setEditingStyle(!0)}onScroll(){this.swatchPopoverHelper.hide(!0)}onPopoverHidden(){this.scrollerElement&&this.scrollerElement.removeEventListener("scroll",this.boundOnScroll,!1),this.section.onpopulate(),this.fontEditor&&this.fontEditor.removeEventListener(u.FontEditor.Events.FontChanged,this.boundFontChanged),this.fontEditor=null,this.parentPane&&this.parentPane.setEditingStyle(!1),this.section.resetToolbars(),this.section.onpopulate()}static treeElementSymbol=Symbol("FontEditorSectionManager._treeElementSymbol")}var ie=Object.freeze({__proto__:null,BezierPopoverIcon:Z,ColorSwatchPopoverIcon:ee,ShadowSwatchPopoverHelper:te,FontEditorSectionManager:ne});const se=new CSSStyleSheet;se.replaceSync(":host{display:inline}.node-link{cursor:pointer;display:inline;pointer-events:auto}.node-link:focus-visible{outline-width:unset}.node-label-name{color:var(--color-syntax-1)}.node-label-class,.node-label-pseudo{color:var(--color-syntax-4)}\n/*# sourceURL=domLinkifier.css */\n");const oe={node:"<node>"},re=o.i18n.registerUIStrings("panels/elements/DOMLinkifier.ts",oe),le=o.i18n.getLocalizedString.bind(void 0,re),ae=function(e,t,n){const s=e,o=e.nodeType()===Node.ELEMENT_NODE&&e.pseudoType();o&&e.parentNode&&(e=e.parentNode);let r=e.nodeNameInCorrectCase();const l=t.createChild("span","node-label-name");l.textContent=r;const a=e.getAttribute("id");if(a){const e=t.createChild("span","node-label-id"),n="#"+a;r+=n,i.UIUtils.createTextChild(e,n),l.classList.add("extra")}const d=e.getAttribute("class");if(d){const e=d.split(/\s+/);if(e.length){const n=new Set,s=t.createChild("span","extra node-label-class");for(let t=0;t<e.length;++t){const o=e[t];if(o&&!n.has(o)){const e="."+o;r+=e,i.UIUtils.createTextChild(s,e),n.add(o)}}}}if(o){const e=t.createChild("span","extra node-label-pseudo"),n="::"+s.pseudoType();i.UIUtils.createTextChild(e,n),r+=n}i.Tooltip.Tooltip.install(t,n||r)},de=function(t,s={tooltip:void 0,preventKeyboardFocus:void 0}){if(!t)return document.createTextNode(le(oe.node));const o=document.createElement("span");o.classList.add("monospace");const r=i.Utils.createShadowRootWithCoreStyles(o,{cssFile:[se],delegatesFocus:void 0}).createChild("div","node-link");return ae(t,r,s.tooltip),r.addEventListener("click",(()=>(e.Revealer.reveal(t,!1),!1)),!1),r.addEventListener("mouseover",t.highlight.bind(t,void 0),!1),r.addEventListener("mouseleave",(()=>n.OverlayModel.OverlayModel.hideDOMNodeHighlight()),!1),s.preventKeyboardFocus||(r.addEventListener("keydown",(n=>"Enter"===n.key&&e.Revealer.reveal(t,!1)&&!1)),r.tabIndex=0,i.ARIAUtils.markAsLink(r)),o},he=function(t,n={tooltip:void 0,preventKeyboardFocus:void 0}){const s=document.createElement("div"),o=i.Utils.createShadowRootWithCoreStyles(s,{cssFile:[se],delegatesFocus:void 0}).createChild("div","node-link");function r(t){e.Revealer.reveal(t)}return o.createChild("slot"),o.addEventListener("click",t.resolve.bind(t,r),!1),o.addEventListener("mousedown",(e=>e.consume()),!1),n.preventKeyboardFocus||(o.addEventListener("keydown",(e=>"Enter"===e.key&&t.resolve(r))),o.tabIndex=0,i.ARIAUtils.markAsLink(o)),s};let ce;class pe{static instance(e={forceNew:null}){const{forceNew:t}=e;return ce&&!t||(ce=new pe),ce}linkify(e,t){if(e instanceof n.DOMModel.DOMNode)return de(e,t);if(e instanceof n.DOMModel.DeferredDOMNode)return he(e,t);throw new Error("Can't linkify non-node")}}var ue=Object.freeze({__proto__:null,decorateNodeLabel:ae,linkifyNodeReference:de,linkifyDeferredNodeReference:he,Linkifier:pe});class me extends i.Widget.VBox{computedStyleModelInternal;updateThrottler;updateWhenVisible;constructor(t){super(!0,t),this.element.classList.add("flex-none"),this.computedStyleModelInternal=new A,this.computedStyleModelInternal.addEventListener("ComputedStyleChanged",this.onCSSModelChanged,this),this.updateThrottler=new e.Throttler.Throttler(100),this.updateWhenVisible=!1}node(){return this.computedStyleModelInternal.node()}cssModel(){return this.computedStyleModelInternal.cssModel()}computedStyleModel(){return this.computedStyleModelInternal}async doUpdate(){}update(){this.updateWhenVisible=!this.isShowing(),this.updateWhenVisible||this.updateThrottler.schedule(function(){return this.isShowing()?this.doUpdate():Promise.resolve()}.bind(this))}wasShown(){super.wasShown(),this.updateWhenVisible&&this.update()}onCSSModelChanged(e){}}var ge=Object.freeze({__proto__:null,ElementsSidebarPane:me});function ye(e){const{name:t,value:n}=e;return`${t.startsWith("--")?`'${t}'`:t.replace(/-([a-z])/gi,((e,t)=>t.toUpperCase()))}: ${`'${n.replaceAll("'","\\'")}'`}`}var fe=Object.freeze({__proto__:null,getCssDeclarationAsJavascriptProperty:ye});const Se=h.StylePropertyEditor.FlexboxEditor,be=h.StylePropertyEditor.GridEditor,ve={shiftClickToChangeColorFormat:"Shift + Click to change color format.",openColorPickerS:"Open color picker. {PH1}",valueForSettingSSIsOutsideThe:"Value for setting “{PH1}” {PH2} is outside the supported range [{PH3}, {PH4}] for font-family “{PH5}”.",togglePropertyAndContinueEditing:"Toggle property and continue editing",revealInSourcesPanel:"Reveal in Sources panel",copyDeclaration:"Copy declaration",copyProperty:"Copy property",copyValue:"Copy value",copyRule:"Copy rule",copyAllDeclarations:"Copy all declarations",viewComputedValue:"View computed value",flexboxEditorButton:"Open `flexbox` editor",gridEditorButton:"Open `grid` editor",copyCssDeclarationAsJs:"Copy declaration as JS",copyAllCssDeclarationsAsJs:"Copy all declarations as JS"},Ee=o.i18n.registerUIStrings("panels/elements/StylePropertyTreeElement.ts",ve),Ce=o.i18n.getLocalizedString.bind(void 0,Ee),we=new WeakMap;class xe extends i.TreeOutline.TreeElement{style;matchedStylesInternal;property;inheritedInternal;overloadedInternal;parentPaneInternal;isShorthand;applyStyleThrottler;newProperty;expandedDueToFilter;valueElement;nameElement;expandElement;originalPropertyText;hasBeenEditedIncrementally;prompt;lastComputedValue;contextForTest;constructor(t,n,i,s,o,r,l){super("",s),this.style=i.ownerStyle,this.matchedStylesInternal=n,this.property=i,this.inheritedInternal=o,this.overloadedInternal=r,this.selectable=!1,this.parentPaneInternal=t,this.isShorthand=s,this.applyStyleThrottler=new e.Throttler.Throttler(0),this.newProperty=l,this.newProperty&&(this.listItemElement.textContent=""),this.expandedDueToFilter=!1,this.valueElement=null,this.nameElement=null,this.expandElement=null,this.originalPropertyText="",this.hasBeenEditedIncrementally=!1,this.prompt=null,this.lastComputedValue=null}matchedStyles(){return this.matchedStylesInternal}editable(){return Boolean(this.style.styleSheetId&&this.style.range)}inherited(){return this.inheritedInternal}overloaded(){return this.overloadedInternal}setOverloaded(e){e!==this.overloadedInternal&&(this.overloadedInternal=e,this.updateState())}get name(){return this.property.name}get value(){return this.property.value}updateFilter(){const e=this.parentPaneInternal.filterRegex(),t=null!==e&&(e.test(this.property.name)||e.test(this.property.value));this.listItemElement.classList.toggle("filter-match",t),this.onpopulate();let n=!1;for(let e=0;e<this.childCount();++e){const t=this.childAt(e);!t||t&&!t.updateFilter()||(n=!0)}return e?n&&!this.expanded?(this.expand(),this.expandedDueToFilter=!0):!n&&this.expanded&&this.expandedDueToFilter&&(this.collapse(),this.expandedDueToFilter=!1):(this.expandedDueToFilter&&this.collapse(),this.expandedDueToFilter=!1),t}processColor(e,t){const n=this.editable(),i=Ce(ve.shiftClickToChangeColorFormat),s=this.editable()?Ce(ve.openColorPickerS,{PH1:i}):i,o=new u.ColorSwatch.ColorSwatch;if(o.renderColor(e,n,s),!t){t=o.createChild("span");const n=o.getColor();t.textContent=n?n.asString(o.getFormat()):e}o.appendChild(t);return o.addEventListener(u.ColorSwatch.FormatChangedEvent.eventName,(e=>{const{data:t}=e;o.firstElementChild&&o.firstElementChild.remove(),o.createChild("span").textContent=t.text})),this.editable()&&this.addColorContrastInfo(o),o}processVar(t){const n=this.matchedStylesInternal.computeSingleVariableValue(this.style,t);if(!n)return document.createTextNode(t);const{computedValue:s,fromFallback:o}=n,r=new u.CSSVarSwatch.CSSVarSwatch;return i.UIUtils.createTextChild(r,t),r.data={text:t,computedValue:s,fromFallback:o,onLinkActivate:this.handleVarDefinitionActivate.bind(this)},s&&e.Color.Color.parse(s)?this.processColor(s,r):r}handleVarDefinitionActivate(e){s.userMetrics.actionTaken(s.UserMetrics.Action.CustomPropertyLinkClicked),this.parentPaneInternal.jumpToProperty(e)}async addColorContrastInfo(e){const t=this.parentPaneInternal.swatchPopoverHelper(),n=new ee(this,t,e);if("color"!==this.property.name||!this.parentPaneInternal.cssModel()||!this.node())return;const i=this.parentPaneInternal.cssModel(),s=this.node();if(i&&s&&void 0!==s.id){const e=new y.ContrastInfo.ContrastInfo(await i.backgroundColorsPromise(s.id));n.setContrastInfo(e)}}renderedPropertyText(){return this.nameElement&&this.valueElement?this.nameElement.textContent+": "+this.valueElement.textContent:""}processBezier(e){if(!this.editable()||!i.Geometry.CubicBezier.parse(e))return document.createTextNode(e);const t=this.parentPaneInternal.swatchPopoverHelper(),n=u.Swatches.BezierSwatch.create();return n.setBezierText(e),new Z(this,t,n),n}processFont(e){const t=this.section();return t&&t.registerFontProperty(this),document.createTextNode(e)}processShadow(e,t){if(!this.editable())return document.createTextNode(e);let n;if(n="text-shadow"===t?u.CSSShadowModel.CSSShadowModel.parseTextShadow(e):u.CSSShadowModel.CSSShadowModel.parseBoxShadow(e),!n.length)return document.createTextNode(e);const i=document.createDocumentFragment(),s=this.parentPaneInternal.swatchPopoverHelper();for(let e=0;e<n.length;e++){0!==e&&i.appendChild(document.createTextNode(", "));const t=u.Swatches.CSSShadowSwatch.create();t.setCSSShadow(n[e]),new te(this,s,t);const o=t.colorSwatch();o&&new ee(this,s,o),i.appendChild(t)}return i}processGrid(t,s){const o=g.TextUtils.Utils.splitStringByRegexes(t,[n.CSSMetadata.GridAreaRowRegex]);if(o.length<=1)return document.createTextNode(t);const r=e.Settings.Settings.instance().moduleSetting("textEditorIndent").get(),l=document.createDocumentFragment();for(const e of o){const t=e.value.trim(),n=i.Fragment.html`<br><span class="styles-clipboard-only">${r.repeat(2)}</span>${t}`;l.appendChild(n)}return l}processAngle(e){if(!this.editable())return document.createTextNode(e);const t=new u.CSSAngle.CSSAngle,n=document.createElement("span");n.textContent=e;const i=this.matchedStylesInternal.computeValue(this.property.ownerStyle,this.property.value)||"";t.data={propertyName:this.property.name,propertyValue:i,angleText:e,containingPane:this.parentPaneInternal.element.enclosingNodeOrSelfWithClass("style-panes-wrapper")},t.append(n);return t.addEventListener("popovertoggled",(e=>{const n=this.section();if(!n)return;const{data:i}=e;i.open&&(this.parentPaneInternal.hideAllPopovers(),this.parentPaneInternal.activeCSSAngle=t),n.element.classList.toggle("has-open-popover",i.open),this.parentPaneInternal.setEditingStyle(i.open)})),t.addEventListener("valuechanged",(async e=>{const{data:i}=e;n.textContent=i.value,await this.applyStyleText(this.renderedPropertyText(),!1);const s=this.matchedStylesInternal.computeValue(this.property.ownerStyle,this.property.value)||"";t.updateProperty(this.property.name,s)})),t.addEventListener("unitchanged",(async e=>{const{data:t}=e;n.textContent=t.value})),t}processLength(e){if(!this.editable())return document.createTextNode(e);const t=new u.CSSLength.CSSLength,n=document.createElement("span");n.textContent=e,t.data={lengthText:e},t.append(n);return t.addEventListener("valuechanged",(e=>{const{data:t}=e;n.textContent=t.value,this.parentPaneInternal.setEditingStyle(!0),this.applyStyleText(this.renderedPropertyText(),!1)})),t.addEventListener("draggingfinished",(()=>{this.parentPaneInternal.setEditingStyle(!1)})),t}updateState(){if(!this.listItemElement)return;this.style.isPropertyImplicit(this.name)?this.listItemElement.classList.add("implicit"):this.listItemElement.classList.remove("implicit");!this.property.parsedOk&&We.ignoreErrorsForProperty(this.property)?this.listItemElement.classList.add("has-ignorable-error"):this.listItemElement.classList.remove("has-ignorable-error"),this.inherited()?this.listItemElement.classList.add("inherited"):this.listItemElement.classList.remove("inherited"),this.overloaded()?this.listItemElement.classList.add("overloaded"):this.listItemElement.classList.remove("overloaded"),this.property.disabled?this.listItemElement.classList.add("disabled"):this.listItemElement.classList.remove("disabled")}node(){return this.parentPaneInternal.node()}parentPane(){return this.parentPaneInternal}section(){return this.treeOutline?this.treeOutline.section:null}updatePane(){const e=this.section();e&&e.refreshUpdate(this)}async toggleDisabled(e){if(!this.style.range)return;this.parentPaneInternal.setUserOperation(!0);const t=await this.property.setDisabled(e);this.parentPaneInternal.setUserOperation(!1),t&&(this.matchedStylesInternal.resetActiveProperties(),this.updatePane(),this.styleTextAppliedForTest())}async onpopulate(){if(this.childCount()||!this.isShorthand)return;const e=this.style.longhandProperties(this.name),t=this.style.leadingProperties();for(let i=0;i<e.length;++i){const s=e[i].name;let o=!1,r=!1;const l=this.section();l&&(o=l.isPropertyInherited(s),r=this.matchedStylesInternal.propertyState(e[i])===n.CSSMatchedStyles.PropertyState.Overloaded);t.find((e=>e.name===s&&e.activeInStyle()))&&(r=!0);const a=new xe(this.parentPaneInternal,this.matchedStylesInternal,e[i],!1,o,r,!1);this.appendChild(a)}}onattach(){this.updateTitle(),this.listItemElement.addEventListener("mousedown",(e=>{0===e.button&&we.set(this.parentPaneInternal,this)}),!1),this.listItemElement.addEventListener("mouseup",this.mouseUp.bind(this)),this.listItemElement.addEventListener("click",(e=>{if(!e.target)return;e.target.hasSelection()||e.target===this.listItemElement||e.consume(!0)})),this.listItemElement.addEventListener("contextmenu",this.handleCopyContextMenuEvent.bind(this))}onexpand(){this.updateExpandElement()}oncollapse(){this.updateExpandElement()}updateExpandElement(){this.expandElement&&(this.expanded?this.expandElement.setIconType("smallicon-triangle-down"):this.expandElement.setIconType("smallicon-triangle-right"))}updateTitleIfComputedValueChanged(){const e=this.matchedStylesInternal.computeValue(this.property.ownerStyle,this.property.value);e!==this.lastComputedValue&&(this.lastComputedValue=e,this.innerUpdateTitle())}updateTitle(){this.lastComputedValue=this.matchedStylesInternal.computeValue(this.property.ownerStyle,this.property.value),this.innerUpdateTitle()}innerUpdateTitle(){this.updateState(),this.isExpandable()?this.expandElement=i.Icon.Icon.create("smallicon-triangle-right","expand-icon"):this.expandElement=null;const t=new Je(this.style.parentRule,this.node(),this.name,this.value);if(this.property.parsedOk&&(t.setVarHandler(this.processVar.bind(this)),t.setColorHandler(this.processColor.bind(this)),t.setBezierHandler(this.processBezier.bind(this)),t.setFontHandler(this.processFont.bind(this)),t.setShadowHandler(this.processShadow.bind(this)),t.setGridHandler(this.processGrid.bind(this)),t.setAngleHandler(this.processAngle.bind(this)),t.setLengthHandler(this.processLength.bind(this))),this.listItemElement.removeChildren(),this.nameElement=t.renderName(),this.property.name.startsWith("--")&&this.nameElement&&i.Tooltip.Tooltip.install(this.nameElement,this.matchedStylesInternal.computeCSSVariable(this.style,this.property.name)||""),this.valueElement=t.renderValue(),!this.treeOutline)return;const n=e.Settings.Settings.instance().moduleSetting("textEditorIndent").get();if(i.UIUtils.createTextChild(this.listItemElement.createChild("span","styles-clipboard-only"),n+(this.property.disabled?"/* ":"")),this.nameElement&&this.listItemElement.appendChild(this.nameElement),this.valueElement){const e=this.valueElement.firstElementChild&&"BR"===this.valueElement.firstElementChild.tagName?":":": ";this.listItemElement.createChild("span","styles-name-value-separator").textContent=e,this.expandElement&&this.listItemElement.appendChild(this.expandElement),this.listItemElement.appendChild(this.valueElement),i.UIUtils.createTextChild(this.listItemElement,";"),this.property.disabled&&i.UIUtils.createTextChild(this.listItemElement.createChild("span","styles-clipboard-only")," */")}const s=this.section();if(this.valueElement&&s&&s.editable&&"display"===this.property.name){const e=this.property.trimmedValueWithoutImportant(),t="flex"===e||"inline-flex"===e,n="grid"===e||"inline-grid"===e;if(t||n){const e=`${s.getSectionIdx()}_${s.nextEditorTriggerButtonIdx}`,n=Ie.createTriggerButton(this.parentPaneInternal,s,t?Se:be,Ce(t?ve.flexboxEditorButton:ve.gridEditorButton),e);s.nextEditorTriggerButtonIdx++,this.listItemElement.appendChild(n);const i=this.parentPaneInternal.swatchPopoverHelper();i.isShowing(Ie.instance())&&Ie.instance().getTriggerKey()===e&&i.setAnchorElement(n)}}if(this.property.parsedOk?this.updateFontVariationSettingsWarning():(this.listItemElement.classList.add("not-parsed-ok"),this.listItemElement.insertBefore(We.createExclamationMark(this.property,null),this.listItemElement.firstChild)),this.property.activeInStyle()||this.listItemElement.classList.add("inactive"),this.updateFilter(),this.property.parsedOk&&this.section()&&this.parent&&this.parent.root){const e=document.createElement("input");e.className="enabled-button",e.type="checkbox",e.checked=!this.property.disabled,e.addEventListener("mousedown",(e=>e.consume()),!1),e.addEventListener("click",(e=>{this.toggleDisabled(!this.property.disabled),e.consume()}),!1),this.nameElement&&this.valueElement&&i.ARIAUtils.setAccessibleName(e,`${this.nameElement.textContent} ${this.valueElement.textContent}`),this.listItemElement.insertBefore(e,this.listItemElement.firstChild)}}async updateFontVariationSettingsWarning(){if("font-variation-settings"!==this.property.name)return;const e=this.property.value,t=this.parentPaneInternal.cssModel();if(!t)return;const i=this.parentPaneInternal.computedStyleModel(),s=await i.fetchComputedStyle();if(!s)return;const o=s.computedStyle.get("font-family");if(!o)return;const r=new Set(n.CSSPropertyParser.parseFontFamily(o)),l=t.fontFaces().filter((e=>r.has(e.getFontFamily()))),a=n.CSSPropertyParser.parseFontVariationSettings(e),d=[];for(const e of a)for(const t of l){const n=t.getVariationAxisByTag(e.tag);n&&((e.value<n.minValue||e.value>n.maxValue)&&d.push(Ce(ve.valueForSettingSSIsOutsideThe,{PH1:e.tag,PH2:e.value,PH3:n.minValue,PH4:n.maxValue,PH5:t.getFontFamily()})))}d.length&&(this.listItemElement.classList.add("has-warning"),this.listItemElement.insertBefore(We.createExclamationMark(this.property,d.join(" ")),this.listItemElement.firstChild))}mouseUp(e){const t=we.get(this.parentPaneInternal);if(we.delete(this.parentPaneInternal),!t)return;if(this.listItemElement.hasSelection())return;if(i.UIUtils.isBeingEdited(e.target))return;if(e.consume(!0),e.target===this.listItemElement)return;const n=this.section();i.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(e)&&n&&n.navigable?this.navigateToSource(e.target):this.startEditing(e.target)}handleContextMenuEvent(e,t){const n=new i.ContextMenu.ContextMenu(t);if(this.property.parsedOk&&this.section()&&this.parent&&this.parent.root){const i=this.parentPaneInternal.focusedSectionIndex();n.defaultSection().appendCheckboxItem(Ce(ve.togglePropertyAndContinueEditing),(async()=>{if(this.treeOutline){const n=this.treeOutline.rootElement().indexOfChild(this);this.editingCancelled(null,e),await this.toggleDisabled(!this.property.disabled),t.consume(),this.parentPaneInternal.continueEditingElement(i,n)}}),!this.property.disabled)}const s=this.navigateToSource.bind(this);n.defaultSection().appendItem(Ce(ve.revealInSourcesPanel),s),n.show()}handleCopyContextMenuEvent(e){if(!e.target)return;const t=new i.ContextMenu.ContextMenu(e);t.clipboardSection().appendItem(Ce(ve.copyDeclaration),(()=>{const e=`${this.property.name}: ${this.property.value};`;s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(e)})),t.clipboardSection().appendItem(Ce(ve.copyProperty),(()=>{s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(this.property.name)})),t.clipboardSection().appendItem(Ce(ve.copyValue),(()=>{s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(this.property.value)})),t.defaultSection().appendItem(Ce(ve.copyRule),(()=>{const e=this.section(),t=We.formatLeadingProperties(e).ruleText;s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(t)})),t.defaultSection().appendItem(Ce(ve.copyAllDeclarations),(()=>{const e=this.section(),t=We.formatLeadingProperties(e).allDeclarationText;s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(t)})),t.defaultSection().appendItem(Ce(ve.viewComputedValue),(()=>{this.viewComputedValue()})),t.clipboardSection().appendItem(Ce(ve.copyCssDeclarationAsJs),this.copyCssDeclarationAsJs.bind(this)),t.defaultSection().appendItem(Ce(ve.copyAllCssDeclarationsAsJs),this.copyAllCssDeclarationAsJs.bind(this)),t.show()}async viewComputedValue(){const e=an.instance().getComputedStyleWidget();e.isShowing()||await i.ViewManager.ViewManager.instance().showView("Computed");let t="";t=this.isShorthand?"^"+this.property.name+"-":"^"+this.property.name+"$";const n=new RegExp(t,"i");e.filterComputedStyles(n);const s=e.input;s.value=this.property.name,s.focus()}copyCssDeclarationAsJs(){const e=ye(this.property);s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(e)}copyAllCssDeclarationAsJs(){const e=this.section().style().leadingProperties().filter((e=>!e.disabled)).map(ye);s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(e.join(",\n"))}navigateToSource(t,n){const i=this.section();if(!i||!i.navigable)return;const s=t===this.nameElement,o=m.CSSWorkspaceBinding.CSSWorkspaceBinding.instance().propertyUILocation(this.property,s);o&&e.Revealer.reveal(o,n)}startEditing(e){if(this.parent instanceof xe&&this.parent.isShorthand)return;if(this.expandElement&&e===this.expandElement)return;const t=this.section();if(t&&!t.editable)return;if(e&&(e=e.enclosingNodeOrSelfWithClass("webkit-css-property")||e.enclosingNodeOrSelfWithClass("value")),e||(e=this.nameElement),i.UIUtils.isBeingEdited(e))return;const s=e===this.nameElement;var o;!s&&this.valueElement&&(n.CSSMetadata.cssMetadata().isGridAreaDefiningProperty(this.name)&&(this.valueElement.textContent=(o=this.value,g.TextUtils.Utils.splitStringByRegexes(o,[n.CSSMetadata.GridAreaRowRegex]).map((e=>e.value.trim())).join("\n"))),this.valueElement.textContent=function(e,t){const i=e.split(n.CSSMetadata.URLRegex);if(1===i.length)return e;const s=new RegExp(n.CSSMetadata.URLRegex);for(let e=1;e<i.length;e+=2){const n=s.exec(t);n&&(i[e]=n[0])}return i.join("")}(this.valueElement.textContent||"",this.value));const r=e&&e.textContent||"",l={expanded:this.expanded,hasChildren:this.isExpandable(),isEditingName:s,originalProperty:this.property,previousContent:r,originalName:void 0,originalValue:void 0};this.contextForTest=l,this.setExpandable(!1),e&&(e.parentElement&&e.parentElement.classList.add("child-editing"),e.textContent=e.textContent),this.originalPropertyText=this.property.propertyText||"",this.parentPaneInternal.setEditingStyle(!0,this),e&&e.parentElement&&e.parentElement.scrollIntoViewIfNeeded(!1),this.prompt=new Qe(this,s),this.prompt.setAutocompletionTimeout(0),this.prompt.addEventListener(i.TextPrompt.Events.TextChanged,(e=>{this.applyFreeFlowStyleTextEdit(l)}));const a=this.property.getInvalidStringForInvalidProperty();if(a&&e&&i.ARIAUtils.alert(a),e){const t=this.prompt.attachAndStartEditing(e,function(e,t){let n=t.target.textContent;e.isEditingName||(n=this.value||n),this.editingCommitted(n||"",e,"")}.bind(this,l));this.navigateToSource(e,!0),t.addEventListener("keydown",this.editingNameValueKeyDown.bind(this,l),!1),t.addEventListener("keypress",this.editingNameValueKeyPress.bind(this,l),!1),s&&(t.addEventListener("paste",function(e,t){const n=t.clipboardData;if(!n)return;const i=n.getData("Text");if(!i)return;const s=i.indexOf(":");if(s<0)return;const o=i.substring(0,s).trim(),r=i.substring(s+1).trim();t.preventDefault(),void 0===e.originalName&&(this.nameElement&&(e.originalName=this.nameElement.textContent||""),this.valueElement&&(e.originalValue=this.valueElement.textContent||"")),this.property.name=o,this.property.value=r,this.nameElement&&(this.nameElement.textContent=o,this.nameElement.normalize()),this.valueElement&&(this.valueElement.textContent=r,this.valueElement.normalize());const l=t.target;this.editingCommitted(l.textContent||"",e,"forward")}.bind(this,l),!1),t.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this,l),!1));const n=e.getComponentSelection();n&&n.selectAllChildren(e)}}editingNameValueKeyDown(e,t){if(t.handled)return;const n=t,s=n.target;let o;if("Enter"!==n.key||n.shiftKey)if(n.keyCode===i.KeyboardShortcut.Keys.Esc.code||n.key===p.KeyboardUtilities.ESCAPE_KEY)o="cancel";else if(!e.isEditingName&&this.newProperty&&n.keyCode===i.KeyboardShortcut.Keys.Backspace.code){const e=s.getComponentSelection();e&&e.isCollapsed&&!e.focusOffset&&(t.preventDefault(),o="backward")}else"Tab"===n.key&&(o=n.shiftKey?"backward":"forward",t.preventDefault());else o="forward";if(o){switch(o){case"cancel":this.editingCancelled(null,e);break;case"forward":case"backward":this.editingCommitted(s.textContent||"",e,o)}t.consume()}else;}editingNameValueKeyPress(e,t){const n=t,i=n.target,s=String.fromCharCode(n.charCode),o=i.selectionLeftOffset();if(e.isEditingName?":"===s:";"===s&&null!==o&&function(e,t){let n="";for(let i=0;i<t;++i){const t=e[i];"\\"===t&&""!==n?++i:n||'"'!==t&&"'"!==t?n===t&&(n=""):n=t}return!n}(i.textContent||"",o))return t.consume(!0),void this.editingCommitted(i.textContent||"",e,"forward")}async applyFreeFlowStyleTextEdit(e){if(!this.prompt||!this.parentPaneInternal.node())return;const t=this.prompt.text();if(e.isEditingName&&t.includes(":"))return void this.editingCommitted(t,e,"forward");const n=this.prompt.textWithCurrentSuggestion();if(n.includes(";"))return;const i=this.parentPaneInternal.node();if(i){if(Boolean(i.pseudoType())){if("content"===this.name.toLowerCase())return;const e=n.trim().toLowerCase();if(e.startsWith("content:")||"display: none"===e)return}}e.isEditingName?n.includes(":")?await this.applyStyleText(n,!1):this.hasBeenEditedIncrementally&&await this.applyOriginalStyle(e):this.nameElement&&await this.applyStyleText(`${this.nameElement.textContent}: ${n}`,!1)}kickFreeFlowStyleEditForTest(){const e=this.contextForTest;return this.applyFreeFlowStyleTextEdit(e)}editingEnded(e){this.setExpandable(e.hasChildren),e.expanded&&this.expand();const t=e.isEditingName?this.nameElement:this.valueElement;t&&t.parentElement&&t.parentElement.classList.remove("child-editing"),this.parentPaneInternal.setEditingStyle(!1)}editingCancelled(e,t){this.removePrompt(),this.hasBeenEditedIncrementally?this.applyOriginalStyle(t):this.newProperty&&this.treeOutline&&this.treeOutline.removeChild(this),this.updateTitle(),this.editingEnded(t)}async applyOriginalStyle(e){await this.applyStyleText(this.originalPropertyText,!1,e.originalProperty)}findSibling(e){let t=this;do{const n="forward"===e?t.nextSibling:t.previousSibling;t=n instanceof xe?n:null}while(t&&t.inherited());return t}async editingCommitted(e,t,n){this.removePrompt(),this.editingEnded(t);const i=t.isEditingName;if(!this.nameElement||!this.valueElement)return;const s=this.nameElement.textContent||"",o=i&&s.includes(":")||!this.property;let r=!1,l=!1;const a=void 0!==t.originalName,d=a&&(this.nameElement.textContent!==t.originalName||this.valueElement.textContent!==t.originalValue),h=a&&i&&this.valueElement.textContent!==t.originalValue;let c=this;const u=i!==("forward"===n),m=this.newProperty&&!e&&(u||i);("forward"===n&&(!i||h)||"backward"===n&&i)&&(c=c.findSibling(n),c||("forward"!==n||this.newProperty&&!e?"backward"===n&&(l=!0):r=!0));let g=-1;null!==c&&this.treeOutline&&(g=this.treeOutline.rootElement().indexOfChild(c));const y=p.StringUtilities.isWhitespace(e),f=this.newProperty&&(h||u||!n&&!i||i&&y||o),S=this.section();if((e!==t.previousContent||d)&&!this.newProperty||f){let t;t=o?this.nameElement.textContent:y||this.newProperty&&p.StringUtilities.isWhitespace(this.valueElement.textContent||"")?"":i?e+": "+this.property.value:this.property.name+": "+e,await this.applyStyleText(t||"",!0),b.call(this,this.newProperty,!y,S)}else i?this.property.name=e:this.property.value=e,a||this.newProperty||this.updateTitle(),b.call(this,this.newProperty,!1,S);function b(e,t,s){if(n)if(c&&c.parent)c.startEditing(i?c.valueElement:c.nameElement);else{if(c&&!c.parent){const t=s.propertiesTreeOutline.rootElement();if("forward"===n&&y&&!i&&--g,g>=t.childCount()&&!this.newProperty)r=!0;else{const s=g>=0?t.childAt(g):null;if(s){let t=!i||h?s.nameElement:s.valueElement;return e&&y&&(t="forward"===n?s.nameElement:s.valueElement),void s.startEditing(t)}e||(l=!0)}}if(r){if(e&&!t&&i!==("backward"===n))return;s.addNewBlankProperty().startEditing()}else if(m){c=this.findSibling(n);const e=c||"backward"===n?s:s.nextEditableSibling();e&&(e.style().parentRule?e.startEditingSelector():e.moveEditorFromSelector(n))}else l&&(s.style().parentRule?s.startEditingSelector():s.moveEditorFromSelector(n))}else this.parentPaneInternal.resetFocus()}}removePrompt(){this.prompt&&(this.prompt.detach(),this.prompt=null)}styleTextAppliedForTest(){}applyStyleText(e,t,n){return this.applyStyleThrottler.schedule(this.innerApplyStyleText.bind(this,e,t,n))}async innerApplyStyleText(e,t,n){if(!this.treeOutline||!this.property)return;if(!this.style.range)return;const i=this.hasBeenEditedIncrementally;if(!(e=e.replace(/[\xA0\t]/g," ").trim()).length&&t&&this.newProperty&&!i)return void(this.parent&&this.parent.removeChild(this));const s=this.parentPaneInternal.node();this.parentPaneInternal.setUserOperation(!0),(e+=p.StringUtilities.findUnclosedCssQuote(e)).length&&!/;\s*$/.test(e)&&(e+=";");const o=!this.newProperty||i;let r=await this.property.setText(e,t,o);i&&t&&!r&&(t=!1,r=await this.property.setText(this.originalPropertyText,t,o)),this.parentPaneInternal.setUserOperation(!1);const l=n||this.style.propertyAt(this.property.index),a=this.property.index<this.style.allProperties().length;if(!r||!l&&a)return t&&(this.newProperty?this.treeOutline.removeChild(this):this.updateTitle()),void this.styleTextAppliedForTest();this.matchedStylesInternal.resetActiveProperties(),this.hasBeenEditedIncrementally=!0;const d=t&&!e.length,h=this.section();d&&h?h.resetToolbars():!d&&l&&(this.property=l),s===this.node()&&this.updatePane(),this.styleTextAppliedForTest()}ondblclick(){return!0}isEventWithinDisclosureTriangle(e){return e.target===this.expandElement}}var Me=Object.freeze({__proto__:null,StylePropertyTreeElement:xe});let Te=null;class Ie extends i.Widget.VBox{editor;pane;section;editorContainer;#e;constructor(){super(!0),this.contentElement.tabIndex=0,this.setDefaultFocusedElement(this.contentElement),this.editorContainer=document.createElement("div"),this.contentElement.appendChild(this.editorContainer),this.onPropertySelected=this.onPropertySelected.bind(this),this.onPropertyDeselected=this.onPropertyDeselected.bind(this)}getSection(){return this.section}async onPropertySelected(e){if(!this.section)return;const t=Ne(this.section,e.data.name);t.property.value=e.data.value,t.updateTitle(),await t.applyStyleText(t.renderedPropertyText(),!1),await this.render()}async onPropertyDeselected(e){if(!this.section)return;const t=Ne(this.section,e.data.name);await t.applyStyleText("",!1),await this.render()}bindContext(e,t){this.pane=e,this.section=t,this.editor?.addEventListener("propertyselected",this.onPropertySelected),this.editor?.addEventListener("propertydeselected",this.onPropertyDeselected)}setTriggerKey(e){this.#e=e}getTriggerKey(){return this.#e}unbindContext(){this.pane=void 0,this.section=void 0,this.editor?.removeEventListener("propertyselected",this.onPropertySelected),this.editor?.removeEventListener("propertydeselected",this.onPropertyDeselected)}async render(){this.editor&&(this.editor.data={authoredProperties:this.section?Oe(this.section,this.editor.getEditableProperties()):new Map,computedProperties:this.pane?await Pe(this.pane):new Map})}static instance(){return Te||(Te=new Ie),Te}setEditor(e){this.editor instanceof e||(this.contentElement.removeChildren(),this.editor=new e,this.contentElement.appendChild(this.editor))}static createTriggerButton(e,t,n,i,s){const o=function(e){const t=document.createElement("button");t.classList.add("styles-pane-button"),t.tabIndex=0,t.title=e,t.onmouseup=e=>{e.stopPropagation()};const n=new l.Icon.Icon;return n.data={iconName:"flex-wrap-icon",color:"var(--color-text-secondary)",width:"12px",height:"12px"},t.appendChild(n),t}(i);return o.onclick=async i=>{i.stopPropagation();const r=e.swatchPopoverHelper(),l=Ie.instance();l.setEditor(n),l.bindContext(e,t),l.setTriggerKey(s),await l.render();const a=o.enclosingNodeOrSelfWithClass("style-panes-wrapper"),d=()=>{r.hide(!0)};r.show(l,o,(()=>{l.unbindContext(),a&&a.removeEventListener("scroll",d)})),a&&a.addEventListener("scroll",d)},o}}function Ne(e,t){const n=e.propertiesTreeOutline.rootElement().children().find((e=>e instanceof xe&&e.property.name===t));if(n)return n;const i=e.addNewBlankProperty();return i.property.name=t,i}async function Pe(e){const t=e.computedStyleModel(),n=await t.fetchComputedStyle();return n?n.computedStyle:new Map}function Oe(e,t){const n=new Map,i=new Set(t.map((e=>e.propertyName)));for(const t of e.style().leadingProperties())i.has(t.name)&&n.set(t.name,t.value);return n}var ke=Object.freeze({__proto__:null,StyleEditorWidget:Ie});class Le{styleSidebarPane;constructor(e){this.styleSidebarPane=e}highlightProperty(e){for(const e of this.styleSidebarPane.allSections())for(let t=e.propertiesTreeOutline.firstChild();t;t=t.nextSibling)t.onpopulate();const{treeElement:t,section:n}=this.findTreeElementAndSection((t=>t.property===e));t&&(t.parent&&t.parent.expand(),this.scrollAndHighlightTreeElement(t),n&&n.element.focus())}findAndHighlightPropertyName(e){for(const t of this.styleSidebarPane.allSections()){if(!t.style().hasActiveProperty(e))continue;t.showAllItems();const n=this.findTreeElementFromSection((t=>t.property.name===e&&!t.overloaded()),t);if(n)return this.scrollAndHighlightTreeElement(n),void(t&&t.element.focus())}}findTreeElementAndSection(e){for(const t of this.styleSidebarPane.allSections()){const n=this.findTreeElementFromSection(e,t);if(n)return{treeElement:n,section:t}}return{treeElement:null,section:null}}findTreeElementFromSection(e,t){let n=t.propertiesTreeOutline.firstChild();for(;n&&n instanceof xe;){if(e(n))return n;n=n.traverseNextTreeElement(!1,null,!0)}return null}scrollAndHighlightTreeElement(e){e.listItemElement.scrollIntoViewIfNeeded(),e.listItemElement.animate([{offset:0,backgroundColor:"rgba(255, 255, 0, 0.2)"},{offset:.1,backgroundColor:"rgba(255, 255, 0, 0.7)"},{offset:1,backgroundColor:"transparent"}],{duration:2e3,easing:"cubic-bezier(0, 0, 0.2, 1)"})}}var De=Object.freeze({__proto__:null,StylePropertyHighlighter:Le});const Ae=new CSSStyleSheet;Ae.replaceSync(".tree-outline{padding:0}.tree-outline li.has-warning,.tree-outline li.not-parsed-ok{margin-left:0}.tree-outline li.filter-match{background-color:var(--color-match-highlight)}.tree-outline li.has-warning .exclamation-mark,.tree-outline li.not-parsed-ok .exclamation-mark{display:inline-block;position:relative;width:11px;height:10px;margin:0 7px 0 0;top:1px;left:-36px;user-select:none;cursor:default;z-index:1}.tree-outline li{margin-left:12px;padding-left:22px;white-space:normal;text-overflow:ellipsis;cursor:auto;display:block}.tree-outline li::before{display:none}.has-ignorable-error .webkit-css-property{color:inherit}.tree-outline li .webkit-css-property{margin-left:-22px}.tree-outline>li{padding-left:38px;clear:both;min-height:14px}.tree-outline>li .webkit-css-property{margin-left:-38px}.tree-outline>li.child-editing{padding-left:8px}.tree-outline>li.child-editing .text-prompt{white-space:pre-wrap}.tree-outline>li.child-editing .webkit-css-property{margin-left:0}.tree-outline li.child-editing{word-wrap:break-word!important;white-space:normal!important;padding-left:0}ol:not(.tree-outline){display:none;margin:0;padding-inline-start:12px;list-style:none}ol.expanded{display:block}.tree-outline li .info{padding-top:4px;padding-bottom:3px}.enabled-button{visibility:hidden;float:left;font-size:10px;margin:0;vertical-align:top;position:relative;z-index:1;width:18px;left:-40px;top:1px;height:13px}.tree-outline li.editing .enabled-button{display:none!important}.disabled,.inactive,.not-parsed-ok:not(.has-ignorable-error),.overloaded:not(.has-ignorable-error){text-decoration:line-through}.implicit,.inherited{opacity:50%}.has-ignorable-error{color:var(--color-text-disabled)}.tree-outline li.editing{margin-left:10px;text-overflow:clip}.tree-outline li.editing-sub-part{padding:3px 6px 8px 18px;margin:-1px -6px -8px;text-overflow:clip}:host-context(.no-affect) .tree-outline li{opacity:50%}:host-context(.no-affect) .tree-outline li.editing{opacity:100%}:host-context(.styles-panel-hovered:not(.read-only)) .value:hover,:host-context(.styles-panel-hovered:not(.read-only)) .webkit-css-property:hover{text-decoration:underline;cursor:default}.styles-name-value-separator{display:inline-block;width:14px;text-decoration:inherit;white-space:pre}.styles-clipboard-only{display:inline-block;width:0;opacity:0%;pointer-events:none;white-space:pre}.styles-pane-button{width:15px;height:15px;padding:0;border:0;margin:0 0 0 6px;position:absolute;top:-1px;background-color:var(--color-background-elevation-2);border-radius:3px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer}.tree-outline li.child-editing .styles-clipboard-only{display:none}:host-context(.matched-styles) .tree-outline li{margin-left:0!important}.expand-icon{user-select:none;margin-left:-6px;margin-right:2px;margin-bottom:-2px}.tree-outline li:not(.parent) .expand-icon{display:none}:host-context(.matched-styles:not(.read-only):hover) .enabled-button{visibility:visible}:host-context(.matched-styles:not(.read-only)) .tree-outline li.disabled .enabled-button{visibility:visible}:host-context(.matched-styles) ol.expanded{margin-left:16px}.devtools-link-styled-trim{display:inline-block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:80%;vertical-align:bottom}devtools-css-angle,devtools-css-length{display:inline-block}\n/*# sourceURL=stylesSectionTree.css */\n");const Re=new CSSStyleSheet;Re.replaceSync(".styles-section{min-height:18px;white-space:nowrap;user-select:text;border-bottom:1px solid var(--color-details-hairline);position:relative;overflow:hidden}.styles-section>div{padding:2px 2px 4px 4px}.styles-section:last-child{border-bottom:none}.styles-section.read-only{background-color:var(--color-background-opacity-50);font-style:italic}.styles-section.has-open-popover{z-index:1}.styles-section:focus-visible{background-color:var(--color-background-elevation-2)}.styles-section.read-only:focus-visible{background-color:var(--color-background-elevation-2)}.styles-section .simple-selector.filter-match{background-color:var(--color-match-highlight);color:var(--color-text-primary)}.sidebar-pane-closing-brace{clear:both}.styles-section-title{background-origin:padding;background-clip:padding;word-wrap:break-word;white-space:normal}.styles-section-title .query-list{color:var(--color-text-disabled)}.styles-section-subtitle{color:var(--color-text-secondary);float:right;padding-left:15px;max-width:100%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;height:15px;margin-bottom:-1px}.sidebar-pane-closing-brace,.sidebar-pane-open-brace{color:var(--color-text-primary)}.styles-section .devtools-link{user-select:none}.styles-section .styles-section-subtitle .devtools-link{color:var(--color-text-primary);text-decoration-color:hsl(0deg 0% 60%)}.styles-section .selector{color:var(--color-text-disabled)}.styles-section .simple-selector.selector-matches,.styles-section.keyframe-key{color:var(--color-text-primary)}.styles-section .style-properties{margin:0;padding:2px 4px 0 0;list-style:none;clear:both;display:flex}.styles-section.matched-styles .style-properties{padding-left:0}@keyframes styles-element-state-pane-slidein{from{margin-top:-60px}to{margin-top:0}}@keyframes styles-element-state-pane-slideout{from{margin-top:0}to{margin-top:-60px}}.styles-sidebar-toolbar-pane{position:relative;animation-duration:.1s;animation-direction:normal}.styles-sidebar-toolbar-pane-container{position:relative;overflow:hidden;flex-shrink:0}.styles-selector{cursor:text}.styles-sidebar-pane-toolbar-container{flex-shrink:0;overflow:hidden;position:sticky;top:0;background-color:var(--color-background-elevation-1);z-index:2}.styles-sidebar-pane-toolbar{border-bottom:1px solid var(--color-details-hairline);flex-shrink:0}.font-toolbar-hidden{visibility:hidden}.styles-sidebar-pane-filter-box{flex:auto;display:flex}.styles-sidebar-pane-filter-box>input{outline:0!important;border:none;width:100%;background:var(--color-background);padding-left:4px;margin:3px}.styles-sidebar-pane-filter-box>input:hover{box-shadow:var(--legacy-focus-ring-inactive-shadow)}.styles-sidebar-pane-filter-box>input:focus,.styles-sidebar-pane-filter-box>input:not(:placeholder-shown){box-shadow:var(--legacy-focus-ring-active-shadow)}.styles-sidebar-pane-filter-box>input::placeholder{color:var(--color-text-secondary)}.styles-section.styles-panel-hovered:not(.read-only),.styles-section.styles-panel-hovered:not(.read-only) devtools-css-query{--override-styles-section-text-hover-text-decoration:underline;--override-styles-section-text-hover-cursor:default}.styles-section span.simple-selector:hover{text-decoration:var(--override-styles-section-text-hover-text-decoration);cursor:var(--override-styles-section-text-hover-cursor)}.sidebar-separator{background-color:var(--color-background-elevation-1);padding:0 5px;border-bottom:1px solid var(--color-details-hairline);color:var(--color-text-secondary);white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:22px}.sidebar-separator>span.monospace{max-width:180px;display:inline-block;overflow:hidden;text-overflow:ellipsis;vertical-align:middle;margin-left:2px}.sidebar-pane-section-toolbar{position:absolute;right:0;bottom:0;z-index:0}.sidebar-pane-section-toolbar.new-rule-toolbar{visibility:hidden}.styles-pane:not(.is-editing-style) .styles-section.matched-styles:not(.read-only):hover .sidebar-pane-section-toolbar.new-rule-toolbar{visibility:visible}.sidebar-pane-section-toolbar.shifted-toolbar{padding-right:32px}.styles-show-all{margin-left:16px;text-overflow:ellipsis;overflow:hidden;max-width:-webkit-fill-available}@media (forced-colors:active){.styles-sidebar-pane-filter-box>input{border:1px solid ButtonText;background:ButtonFace}.styles-section.read-only:focus-visible,.styles-section:focus-visible{forced-color-adjust:none;background-color:Highlight}.styles-section .styles-section-subtitle .devtools-link{color:linktext;text-decoration-color:linktext}.styles-section .styles-section-subtitle .devtools-link:focus-visible{color:HighlightText}.styles-section.read-only:focus-visible *,.styles-section:focus-visible *,.styles-section:focus-visible .styles-section-subtitle .devtools-link{color:HighlightText;text-decoration-color:HighlightText}.sidebar-pane-section-toolbar{forced-color-adjust:none;border-color:1px solid ButtonText;background-color:ButtonFace}.styles-section:focus-visible .sidebar-pane-section-toolbar{background-color:ButtonFace}.styles-section:focus-visible{--webkit-css-property-color:HighlightText}}.spinner::before{--dimension:24px;margin-top:2em;left:calc(50% - var(--dimension)/ 2)}\n/*# sourceURL=stylesSidebarPane.css */\n");const Fe={noMatchingSelectorOrStyle:"No matching selector or style",invalidPropertyValue:"Invalid property value",unknownPropertyName:"Unknown property name",filter:"Filter",filterStyles:"Filter Styles",pseudoSElement:"Pseudo ::{PH1} element",inheritedFroms:"Inherited from ",insertStyleRuleBelow:"Insert Style Rule Below",constructedStylesheet:"constructed stylesheet",userAgentStylesheet:"user agent stylesheet",injectedStylesheet:"injected stylesheet",viaInspector:"via inspector",styleAttribute:"`style` attribute",sattributesStyle:"{PH1}[Attributes Style]",showAllPropertiesSMore:"Show All Properties ({PH1} more)",copySelector:"Copy `selector`",copyRule:"Copy rule",copyAllDeclarations:"Copy all declarations",incrementdecrementWithMousewheelOne:"Increment/decrement with mousewheel or up/down keys. {PH1}: R ±1, Shift: G ±1, Alt: B ±1",incrementdecrementWithMousewheelHundred:"Increment/decrement with mousewheel or up/down keys. {PH1}: ±100, Shift: ±10, Alt: ±0.1",invalidString:"{PH1}, property name: {PH2}, property value: {PH3}",newStyleRule:"New Style Rule",cssPropertyName:"`CSS` property name",cssPropertyValue:"`CSS` property value",cssSelector:"`CSS` selector"},Ue=o.i18n.registerUIStrings("panels/elements/StylesSidebarPane.ts",Fe),He=o.i18n.getLocalizedString.bind(void 0,Ue),Be=[{mode:"padding",properties:["padding"]},{mode:"border",properties:["border"]},{mode:"margin",properties:["margin"]},{mode:"gap",properties:["gap","grid-gap"]},{mode:"column-gap",properties:["column-gap","grid-column-gap"]},{mode:"row-gap",properties:["row-gap","grid-row-gap"]},{mode:"grid-template-columns",properties:["grid-template-columns"]},{mode:"grid-template-rows",properties:["grid-template-rows"]},{mode:"grid-template-areas",properties:["grid-areas"]},{mode:"justify-content",properties:["justify-content"]},{mode:"align-content",properties:["align-content"]},{mode:"align-items",properties:["align-items"]},{mode:"flexibility",properties:["flex","flex-basis","flex-grow","flex-shrink"]}];let Ve;class We extends(e.ObjectWrapper.eventMixin(me)){currentToolbarPane;animatedToolbarPane;pendingWidget;pendingWidgetToggle;toolbar;toolbarPaneElement;noMatchesElement;sectionsContainer;sectionByElement;swatchPopoverHelperInternal;linkifier;decorator;lastRevealedProperty;userOperation;isEditingStyle;filterRegexInternal;isActivePropertyHighlighted;initialUpdateCompleted;hasMatchedStyles;sectionBlocks;idleCallbackManager;needsForceUpdate;resizeThrottler;imagePreviewPopover;activeCSSAngle;static instance(){return Ve||(Ve=new We),Ve}constructor(){super(!0),this.setMinimumSize(96,26),this.registerCSSFiles([Re]),e.Settings.Settings.instance().moduleSetting("colorFormat").addChangeListener(this.update.bind(this)),e.Settings.Settings.instance().moduleSetting("textEditorIndent").addChangeListener(this.update.bind(this)),this.currentToolbarPane=null,this.animatedToolbarPane=null,this.pendingWidget=null,this.pendingWidgetToggle=null,this.toolbar=null,this.toolbarPaneElement=this.createStylesSidebarToolbar(),this.computedStyleModelInternal=new A,this.noMatchesElement=this.contentElement.createChild("div","gray-info-message hidden"),this.noMatchesElement.textContent=He(Fe.noMatchingSelectorOrStyle),this.sectionsContainer=this.contentElement.createChild("div"),i.ARIAUtils.markAsList(this.sectionsContainer),this.sectionsContainer.addEventListener("keydown",this.sectionsContainerKeyDown.bind(this),!1),this.sectionsContainer.addEventListener("focusin",this.sectionsContainerFocusChanged.bind(this),!1),this.sectionsContainer.addEventListener("focusout",this.sectionsContainerFocusChanged.bind(this),!1),this.sectionByElement=new WeakMap,this.swatchPopoverHelperInternal=new u.SwatchPopoverHelper.SwatchPopoverHelper,this.swatchPopoverHelperInternal.addEventListener(u.SwatchPopoverHelper.Events.WillShowPopover,this.hideAllPopovers,this),this.linkifier=new a.Linkifier.Linkifier(_e,!0),this.decorator=new Le(this),this.lastRevealedProperty=null,this.userOperation=!1,this.isEditingStyle=!1,this.filterRegexInternal=null,this.isActivePropertyHighlighted=!1,this.initialUpdateCompleted=!1,this.hasMatchedStyles=!1,this.contentElement.classList.add("styles-pane"),this.sectionBlocks=[],this.idleCallbackManager=null,this.needsForceUpdate=!1,Ve=this,i.Context.Context.instance().addFlavorChangeListener(n.DOMModel.DOMNode,this.forceUpdate,this),this.contentElement.addEventListener("copy",this.clipboardCopy.bind(this)),this.resizeThrottler=new e.Throttler.Throttler(100),this.imagePreviewPopover=new U(this.contentElement,(e=>{const t=e.composedPath()[0];return t instanceof Element?t:null}),(()=>this.node())),this.activeCSSAngle=null}swatchPopoverHelper(){return this.swatchPopoverHelperInternal}setUserOperation(e){this.userOperation=e}static createExclamationMark(e,t){const s=document.createElement("span",{is:"dt-icon-label"});let o;s.className="exclamation-mark",We.ignoreErrorsForProperty(e)||(s.type="smallicon-warning"),t?(i.Tooltip.Tooltip.install(s,t),o=t):(o=n.CSSMetadata.cssMetadata().isCSSPropertyName(e.name)?He(Fe.invalidPropertyValue):He(Fe.unknownPropertyName),i.Tooltip.Tooltip.install(s,o));const r=He(Fe.invalidString,{PH1:o,PH2:e.name,PH3:e.value});return e.setDisplayedStringForInvalidProperty(r),s}static ignoreErrorsForProperty(e){function t(e){return!e.startsWith("-webkit-")&&/^[-_][\w\d]+-\w/.test(e)}const n=e.name.toLowerCase();if("_"===n.charAt(0))return!0;if("filter"===n)return!0;if(n.startsWith("scrollbar-"))return!0;if(t(n))return!0;const i=e.value.toLowerCase();return!!i.endsWith("\\9")||!!t(i)}static createPropertyFilterElement(e,t,n){const i=document.createElement("input");function s(){const e=i.value?new RegExp(p.StringUtilities.escapeForRegExp(i.value),"i"):null;n(e)}return i.type="search",i.classList.add("custom-search-input"),i.placeholder=e,i.addEventListener("input",s,!1),i.addEventListener("keydown",(function(e){const t=e;t.key===p.KeyboardUtilities.ESCAPE_KEY&&i.value&&(t.consume(!0),i.value="",s())}),!1),i}static formatLeadingProperties(t){const n=t.headerText(),i=e.Settings.Settings.instance().moduleSetting("textEditorIndent").get(),s=t.style(),o=[];for(const e of s.leadingProperties())e.disabled?o.push(`${i}/* ${e.name}: ${e.value}; */`):o.push(`${i}${e.name}: ${e.value};`);const r=o.join("\n");return{allDeclarationText:r,ruleText:`${n} {\n${r}\n}`}}revealProperty(e){this.decorator.highlightProperty(e),this.lastRevealedProperty=e,this.update()}jumpToProperty(e){this.decorator.findAndHighlightPropertyName(e)}forceUpdate(){this.needsForceUpdate=!0,this.swatchPopoverHelperInternal.hide(),this.resetCache(),this.update()}sectionsContainerKeyDown(e){const t=this.sectionsContainer.ownerDocument.deepActiveElement();if(!t)return;const n=this.sectionByElement.get(t);if(!n)return;let i=null,s=!1;switch(e.key){case"ArrowUp":case"ArrowLeft":i=n.previousSibling()||n.lastSibling(),s=!1;break;case"ArrowDown":case"ArrowRight":i=n.nextSibling()||n.firstSibling(),s=!0;break;case"Home":i=n.firstSibling(),s=!0;break;case"End":i=n.lastSibling(),s=!1}i&&this.filterRegexInternal&&(i=i.findCurrentOrNextVisible(s)),i&&(i.element.focus(),e.consume(!0))}sectionsContainerFocusChanged(){this.resetFocus()}resetFocus(){if(this.noMatchesElement.classList.contains("hidden")&&this.sectionBlocks[0]&&this.sectionBlocks[0].sections[0]){const e=this.sectionBlocks[0].sections[0].findCurrentOrNextVisible(!0);e&&(e.element.tabIndex=this.sectionsContainer.hasFocus()?-1:0)}}onAddButtonLongClick(e){const t=this.cssModel();if(!t)return;const n=t.styleSheetHeaders().filter((function(e){return!e.isViaInspector()&&!e.isInline&&Boolean(e.resourceURL())})),s=[];for(let e=0;e<n.length;++e){const t=n[e],i=this.createNewRuleInStyleSheet.bind(this,t);s.push({text:m.ResourceUtils.displayNameForURL(t.resourceURL()),handler:i})}s.sort((function(e,t){return p.StringUtilities.naturalOrderComparator(e.text,t.text)}));const o=new i.ContextMenu.ContextMenu(e);for(let e=0;e<s.length;++e){const t=s[e];o.defaultSection().appendItem(t.text,t.handler)}o.footerSection().appendItem("inspector-stylesheet",this.createNewRuleInViaInspectorStyleSheet.bind(this)),o.show()}onFilterChanged(e){this.filterRegexInternal=e,this.updateFilter(),this.resetFocus()}refreshUpdate(e,t){if(t)for(const e of this.allSections())e instanceof Ge&&e.isBlank||e.updateVarFunctions(t);if(this.isEditingStyle)return;const n=this.node();if(n){for(const t of this.allSections())t instanceof Ge&&t.isBlank||t.update(t===e);this.filterRegexInternal&&this.updateFilter(),this.swatchPopoverHelper().reposition(),this.nodeStylesUpdatedForTest(n,!1)}}async doUpdate(){this.initialUpdateCompleted||setTimeout((()=>{this.initialUpdateCompleted||this.sectionsContainer.createChild("span","spinner")}),200);const e=await this.fetchMatchedCascade();await this.innerRebuildUpdate(e),this.initialUpdateCompleted||(this.initialUpdateCompleted=!0,this.dispatchEventToListeners("InitialUpdateCompleted")),this.dispatchEventToListeners("StylesUpdateCompleted",{hasMatchedStyles:this.hasMatchedStyles})}onResize(){this.resizeThrottler.schedule(this.innerResize.bind(this))}innerResize(){const e=this.contentElement.getBoundingClientRect().width+"px";return this.allSections().forEach((t=>{t.propertiesTreeOutline.element.style.width=e})),Promise.resolve()}resetCache(){const e=this.cssModel();e&&e.discardCachedMatchedCascade()}fetchMatchedCascade(){const e=this.node();if(!e||!this.cssModel())return Promise.resolve(null);const t=this.cssModel();return t?t.cachedMatchedCascadeForNode(e).then(function(e){return e&&e.node()===this.node()?e:null}.bind(this)):Promise.resolve(null)}setEditingStyle(e,t){this.isEditingStyle!==e&&(this.contentElement.classList.toggle("is-editing-style",e),this.isEditingStyle=e,this.setActiveProperty(null))}setActiveProperty(e){if(this.isActivePropertyHighlighted&&n.OverlayModel.OverlayModel.hideDOMNodeHighlight(),this.isActivePropertyHighlighted=!1,!this.node())return;if(!e||e.overloaded()||e.inherited())return;const t=e.property.ownerStyle.parentRule,i=t instanceof n.CSSRule.CSSStyleRule?t.selectorText():void 0;for(const{properties:t,mode:n}of Be){if(!t.includes(e.name))continue;const s=this.node();if(s){s.domModel().overlayModel().highlightInOverlay({node:this.node(),selectorList:i},n),this.isActivePropertyHighlighted=!0;break}}}onCSSModelChanged(e){const t=e?.data&&"edit"in e.data?e.data.edit:null;if(t)for(const e of this.allSections())e.styleSheetEdited(t);else this.userOperation||this.isEditingStyle||(this.resetCache(),this.update())}focusedSectionIndex(){let e=0;for(const t of this.sectionBlocks)for(const n of t.sections){if(n.element.hasFocus())return e;e++}return-1}continueEditingElement(e,t){const n=this.allSections()[e];if(n){const e=n.closestPropertyForEditing(t);if(!e)return void n.element.focus();e.startEditing()}}async innerRebuildUpdate(e){if(this.needsForceUpdate)this.needsForceUpdate=!1;else if(this.isEditingStyle||this.userOperation)return;const t=this.focusedSectionIndex();this.linkifier.reset();const n=this.sectionBlocks.map((e=>e.sections)).flat();this.sectionBlocks=[];const i=this.node();if(this.hasMatchedStyles=null!==e&&null!==i,!this.hasMatchedStyles)return this.sectionsContainer.removeChildren(),void this.noMatchesElement.classList.remove("hidden");this.sectionBlocks=await this.rebuildSectionsForMatchedStyleRules(e);const o=this.sectionBlocks.map((e=>e.sections)).flat(),r=Ie.instance(),l=r.getSection();if(l){r.unbindContext();for(const[e,t]of n.entries())l===t&&e<o.length&&r.bindContext(this,o[e])}this.sectionsContainer.removeChildren();const a=document.createDocumentFragment();let d=0,h=null;for(const e of this.sectionBlocks){const n=e.titleElement();n&&a.appendChild(n);for(const n of e.sections)a.appendChild(n.element),d===t&&(h=n.element),d++}this.sectionsContainer.appendChild(a),h&&h.focus(),t>=d&&this.sectionBlocks[0].sections[0].element.focus(),this.sectionsContainerFocusChanged(),this.filterRegexInternal?this.updateFilter():this.noMatchesElement.classList.toggle("hidden",this.sectionBlocks.length>0),this.nodeStylesUpdatedForTest(i,!0),this.lastRevealedProperty&&(this.decorator.highlightProperty(this.lastRevealedProperty),this.lastRevealedProperty=null),this.swatchPopoverHelper().reposition(),s.userMetrics.panelLoaded("elements","DevTools.Launch.Elements"),this.dispatchEventToListeners("StylesUpdateCompleted",{hasMatchedStyles:!1})}nodeStylesUpdatedForTest(e,t){}async rebuildSectionsForMatchedStyleRules(e){this.idleCallbackManager&&this.idleCallbackManager.discard(),this.idleCallbackManager=new je;const t=[new ze(null)];let n=0,i=null;for(const s of e.nodeStyles()){const o=e.isInherited(s)?e.nodeForStyle(s):null;if(o&&o!==i){i=o;const e=await ze.createInheritedNodeBlock(i);t.push(e)}const r=t[t.length-1];r&&this.idleCallbackManager.schedule((()=>{const t=new Ke(this,e,s,n);n++,r.sections.push(t)}))}let s=[];const o=e.pseudoTypes();o.delete("before")&&s.push("before"),s=s.concat([...o].sort());for(const i of s){const s=ze.createPseudoTypeBlock(i);for(const t of e.pseudoStyles(i))this.idleCallbackManager.schedule((()=>{const i=new Ke(this,e,t,n);n++,s.sections.push(i)}));t.push(s)}for(const i of e.keyframes()){const s=ze.createKeyframesBlock(i.name().text);for(const t of i.keyframes())this.idleCallbackManager.schedule((()=>{s.sections.push(new qe(this,e,t.style,n)),n++}));t.push(s)}return await this.idleCallbackManager.awaitDone(),t}async createNewRuleInViaInspectorStyleSheet(){const e=this.cssModel(),t=this.node();if(!e||!t)return;this.setUserOperation(!0);const n=await e.requestViaInspectorStylesheet(t);this.setUserOperation(!1),await this.createNewRuleInStyleSheet(n)}async createNewRuleInStyleSheet(e){if(!e)return;const t=((await e.requestContent()).content||"").split("\n"),n=g.TextRange.TextRange.createFromLocation(t.length-1,t[t.length-1].length);this.sectionBlocks&&this.sectionBlocks.length>0&&this.addBlankSection(this.sectionBlocks[0].sections[0],e.id,n)}addBlankSection(e,t,n){const i=this.node(),s=new Ge(this,e.matchedStyles,i?i.simpleSelector():"",t,n,e.style(),0);this.sectionsContainer.insertBefore(s.element,e.element.nextSibling);for(const t of this.sectionBlocks){const n=t.sections.indexOf(e);-1!==n&&(t.sections.splice(n+1,0,s),s.startEditingSelector())}let o=0;for(const e of this.sectionBlocks)for(const t of e.sections)t.setSectionIdx(o),o++}removeSection(e){for(const t of this.sectionBlocks){const n=t.sections.indexOf(e);-1!==n&&(t.sections.splice(n,1),e.element.remove())}}filterRegex(){return this.filterRegexInternal}updateFilter(){let e=!1;for(const t of this.sectionBlocks)e=t.updateFilter()||e;this.noMatchesElement.classList.toggle("hidden",Boolean(e))}willHide(){this.hideAllPopovers(),super.willHide()}hideAllPopovers(){this.swatchPopoverHelperInternal.hide(),this.imagePreviewPopover.hide(),this.activeCSSAngle&&(this.activeCSSAngle.minify(),this.activeCSSAngle=null)}allSections(){let e=[];for(const t of this.sectionBlocks)e=e.concat(t.sections);return e}clipboardCopy(e){s.userMetrics.actionTaken(s.UserMetrics.Action.StyleRuleCopied)}createStylesSidebarToolbar(){const e=this.contentElement.createChild("div","styles-sidebar-pane-toolbar-container"),t=e.createChild("div","hbox styles-sidebar-pane-toolbar"),n=t.createChild("div","styles-sidebar-pane-filter-box"),s=We.createPropertyFilterElement(He(Fe.filter),t,this.onFilterChanged.bind(this));i.ARIAUtils.setAccessibleName(s,He(Fe.filterStyles)),n.appendChild(s);const o=new i.Toolbar.Toolbar("styles-pane-toolbar",t);o.makeToggledGray(),o.appendItemsAtLocation("styles-sidebarpane-toolbar"),this.toolbar=o;return e.createChild("div","styles-sidebar-toolbar-pane-container").createChild("div","styles-sidebar-toolbar-pane")}showToolbarPane(e,t){this.pendingWidgetToggle&&this.pendingWidgetToggle.setToggled(!1),this.pendingWidgetToggle=t,this.animatedToolbarPane?this.pendingWidget=e:this.startToolbarPaneAnimation(e),e&&t&&t.setToggled(!0)}appendToolbarItem(e){this.toolbar&&this.toolbar.appendToolbarItem(e)}startToolbarPaneAnimation(e){if(e===this.currentToolbarPane)return;if(e&&this.currentToolbarPane)return this.currentToolbarPane.detach(),e.show(this.toolbarPaneElement),this.currentToolbarPane=e,void this.currentToolbarPane.focus();this.animatedToolbarPane=e,this.currentToolbarPane?this.toolbarPaneElement.style.animationName="styles-element-state-pane-slideout":e&&(this.toolbarPaneElement.style.animationName="styles-element-state-pane-slidein"),e&&e.show(this.toolbarPaneElement);const t=function(){this.toolbarPaneElement.style.removeProperty("animation-name"),this.toolbarPaneElement.removeEventListener("animationend",t,!1),this.currentToolbarPane&&this.currentToolbarPane.detach();this.currentToolbarPane=this.animatedToolbarPane,this.currentToolbarPane&&this.currentToolbarPane.focus();this.animatedToolbarPane=null,this.pendingWidget&&(this.startToolbarPaneAnimation(this.pendingWidget),this.pendingWidget=null)}.bind(this);this.toolbarPaneElement.addEventListener("animationend",t,!1)}}const _e=23;class ze{titleElementInternal;sections;constructor(e){this.titleElementInternal=e,this.sections=[]}static createPseudoTypeBlock(e){const t=document.createElement("div");return t.className="sidebar-separator",t.textContent=He(Fe.pseudoSElement,{PH1:e}),new ze(t)}static createKeyframesBlock(e){const t=document.createElement("div");return t.className="sidebar-separator",t.textContent=`@keyframes ${e}`,new ze(t)}static async createInheritedNodeBlock(t){const n=document.createElement("div");n.className="sidebar-separator",i.UIUtils.createTextChild(n,He(Fe.inheritedFroms));const s=await e.Linkifier.Linkifier.linkify(t,{preventKeyboardFocus:!0,tooltip:void 0});return n.appendChild(s),new ze(n)}updateFilter(){let e=!1;for(const t of this.sections)e=t.updateFilter()||e;return this.titleElementInternal&&this.titleElementInternal.classList.toggle("hidden",!e),Boolean(e)}titleElement(){return this.titleElementInternal}}class je{discarded;promises;constructor(){this.discarded=!1,this.promises=[]}discard(){this.discarded=!0}schedule(e,t=100){this.discarded||this.promises.push(new Promise(((n,i)=>{window.requestIdleCallback((()=>{if(this.discarded)return n();(()=>{try{e(),n()}catch(e){i(e)}})()}),{timeout:t})})))}awaitDone(){return Promise.all(this.promises)}}class Ke{parentPane;styleInternal;matchedStyles;editable;hoverTimer;willCauseCancelEditing;forceShowAll;originalPropertiesCount;element;innerElement;titleElement;propertiesTreeOutline;showAllButton;selectorElement;newStyleRuleToolbar;fontEditorToolbar;fontEditorSectionManager;fontEditorButton;selectedSinceMouseDown;elementToSelectorIndex;navigable;selectorRefElement;selectorContainer;fontPopoverIcon;hoverableSelectorsMode;isHiddenInternal;queryListElement;nextEditorTriggerButtonIdx=1;sectionIdx=0;constructor(e,s,o,r){this.parentPane=e,this.sectionIdx=r,this.styleInternal=o,this.matchedStyles=s,this.editable=Boolean(o.styleSheetId&&o.range),this.hoverTimer=null,this.willCauseCancelEditing=!1,this.forceShowAll=!1,this.originalPropertiesCount=o.leadingProperties().length;const l=o.parentRule;this.element=document.createElement("div"),this.element.classList.add("styles-section"),this.element.classList.add("matched-styles"),this.element.classList.add("monospace"),i.ARIAUtils.setAccessibleName(this.element,`${this.headerText()}, css selector`),this.element.tabIndex=-1,i.ARIAUtils.markAsListitem(this.element),this.element.addEventListener("keydown",this.onKeyDown.bind(this),!1),e.sectionByElement.set(this.element,this),this.innerElement=this.element.createChild("div"),this.titleElement=this.innerElement.createChild("div","styles-section-title "+(l?"styles-selector":"")),this.propertiesTreeOutline=new i.TreeOutline.TreeOutlineInShadow,this.propertiesTreeOutline.setFocusable(!1),this.propertiesTreeOutline.registerCSSFiles([Ae]),this.propertiesTreeOutline.element.classList.add("style-properties","matched-styles","monospace"),this.propertiesTreeOutline.section=this,this.innerElement.appendChild(this.propertiesTreeOutline.element),this.showAllButton=i.UIUtils.createTextButton("",this.showAllItems.bind(this),"styles-show-all"),this.innerElement.appendChild(this.showAllButton);const a=document.createElement("div");this.selectorElement=document.createElement("span"),i.ARIAUtils.setAccessibleName(this.selectorElement,He(Fe.cssSelector)),this.selectorElement.classList.add("selector"),this.selectorElement.textContent=this.headerText(),a.appendChild(this.selectorElement),this.selectorElement.addEventListener("mouseenter",this.onMouseEnterSelector.bind(this),!1),this.selectorElement.addEventListener("mousemove",(e=>e.consume()),!1),this.selectorElement.addEventListener("mouseleave",this.onMouseOutSelector.bind(this),!1);a.createChild("span","sidebar-pane-open-brace").textContent=" {",a.addEventListener("mousedown",this.handleEmptySpaceMouseDown.bind(this),!1),a.addEventListener("click",this.handleSelectorContainerClick.bind(this),!1);if(this.innerElement.createChild("div","sidebar-pane-closing-brace").textContent="}",this.styleInternal.parentRule){const e=new i.Toolbar.ToolbarButton(He(Fe.insertStyleRuleBelow),"largeicon-add");e.addEventListener(i.Toolbar.ToolbarButton.Events.Click,this.onNewRuleClick,this),e.element.tabIndex=-1,this.newStyleRuleToolbar||(this.newStyleRuleToolbar=new i.Toolbar.Toolbar("sidebar-pane-section-toolbar new-rule-toolbar",this.innerElement)),this.newStyleRuleToolbar.appendToolbarItem(e),i.ARIAUtils.markAsHidden(this.newStyleRuleToolbar.element)}if(t.Runtime.experiments.isEnabled("fontEditor")&&this.editable&&(this.fontEditorToolbar=new i.Toolbar.Toolbar("sidebar-pane-section-toolbar",this.innerElement),this.fontEditorSectionManager=new ne(this.parentPane.swatchPopoverHelper(),this),this.fontEditorButton=new i.Toolbar.ToolbarButton("Font Editor","largeicon-font-editor"),this.fontEditorButton.addEventListener(i.Toolbar.ToolbarButton.Events.Click,(()=>{this.onFontEditorButtonClicked()}),this),this.fontEditorButton.element.addEventListener("keydown",(e=>{isEnterOrSpaceKey(e)&&(e.consume(!0),this.onFontEditorButtonClicked())}),!1),this.fontEditorToolbar.appendToolbarItem(this.fontEditorButton),this.styleInternal.type===n.CSSStyleDeclaration.Type.Inline?this.newStyleRuleToolbar&&this.newStyleRuleToolbar.element.classList.add("shifted-toolbar"):this.fontEditorToolbar.element.classList.add("font-toolbar-hidden")),this.selectorElement.addEventListener("click",this.handleSelectorClick.bind(this),!1),this.element.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!1),this.element.addEventListener("mousedown",this.handleEmptySpaceMouseDown.bind(this),!1),this.element.addEventListener("click",this.handleEmptySpaceClick.bind(this),!1),this.element.addEventListener("mousemove",this.onMouseMove.bind(this),!1),this.element.addEventListener("mouseleave",this.onMouseLeave.bind(this),!1),this.selectedSinceMouseDown=!1,this.elementToSelectorIndex=new WeakMap,l)if(l.isUserAgent()||l.isInjected())this.editable=!1;else if(l.styleSheetId){const e=l.cssModel().styleSheetHeaderForId(l.styleSheetId);this.navigable=e&&!e.isAnonymousInlineStyleSheet()}this.queryListElement=this.titleElement.createChild("div","query-list query-matches"),this.selectorRefElement=this.titleElement.createChild("div","styles-section-subtitle"),this.updateQueryList(),this.updateRuleOrigin(),this.titleElement.appendChild(a),this.selectorContainer=a,this.navigable&&this.element.classList.add("navigable"),this.editable||(this.element.classList.add("read-only"),this.propertiesTreeOutline.element.classList.add("read-only")),this.fontPopoverIcon=null,this.hoverableSelectorsMode=!1,this.isHiddenInternal=!1,this.markSelectorMatches(),this.onpopulate()}setSectionIdx(e){this.sectionIdx=e,this.onpopulate()}getSectionIdx(){return this.sectionIdx}registerFontProperty(e){this.fontEditorSectionManager&&this.fontEditorSectionManager.registerFontProperty(e),this.fontEditorToolbar&&(this.fontEditorToolbar.element.classList.remove("font-toolbar-hidden"),this.newStyleRuleToolbar&&this.newStyleRuleToolbar.element.classList.add("shifted-toolbar"))}resetToolbars(){this.parentPane.swatchPopoverHelper().isShowing()||this.styleInternal.type===n.CSSStyleDeclaration.Type.Inline||(this.fontEditorToolbar&&this.fontEditorToolbar.element.classList.add("font-toolbar-hidden"),this.newStyleRuleToolbar&&this.newStyleRuleToolbar.element.classList.remove("shifted-toolbar"))}static createRuleOriginNode(e,t,n){if(!n)return document.createTextNode("");const i=this.getRuleLocationFromCSSRule(n),s=n.styleSheetId?e.cssModel().styleSheetHeaderForId(n.styleSheetId):null;function o(){return n&&i&&n.styleSheetId&&s&&!s.isAnonymousInlineStyleSheet()?Ke.linkifyRuleLocation(e.cssModel(),t,n.styleSheetId,i):null}function r(e){if(s?.ownerNode){const t=he(s.ownerNode,{preventKeyboardFocus:!1,tooltip:void 0});return t.textContent=e,t}return null}if(s?.isMutable&&!s.isViaInspector()){const e=s.isConstructedByNew()?null:o();if(e)return e;const t=s.isConstructedByNew()?He(Fe.constructedStylesheet):"<style>",n=r(t);return n||document.createTextNode(t)}const l=o();if(l)return l;if(n.isUserAgent())return document.createTextNode(He(Fe.userAgentStylesheet));if(n.isInjected())return document.createTextNode(He(Fe.injectedStylesheet));if(n.isViaInspector())return document.createTextNode(He(Fe.viaInspector));const a=r("<style>");return a||document.createTextNode("")}static getRuleLocationFromCSSRule(e){let t;return e instanceof n.CSSRule.CSSStyleRule?t=e.style.range:e instanceof n.CSSRule.CSSKeyframeRule&&(t=e.key().range),t}static tryNavigateToRuleLocation(e,t){if(!t)return;const n=this.getRuleLocationFromCSSRule(t),i=t.styleSheetId?e.cssModel().styleSheetHeaderForId(t.styleSheetId):null;if(n&&t.styleSheetId&&i&&!i.isAnonymousInlineStyleSheet()){const i=this.getCSSSelectorLocation(e.cssModel(),t.styleSheetId,n);this.revealSelectorSource(i,!0)}}static linkifyRuleLocation(e,t,n,i){const s=this.getCSSSelectorLocation(e,n,i);return t.linkifyCSSLocation(s)}static getCSSSelectorLocation(e,t,i){const s=e.styleSheetHeaderForId(t),o=s.lineNumberInSource(i.startLine),r=s.columnNumberInSource(i.startLine,i.startColumn);return new n.CSSModel.CSSLocation(s,o,r)}getFocused(){return this.propertiesTreeOutline.shadowRoot.activeElement||null}focusNext(e){const t=this.getFocused();t&&(t.tabIndex=-1),e.focus(),this.propertiesTreeOutline.shadowRoot.contains(e)&&(e.tabIndex=0)}ruleNavigation(e){if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;const t=this.getFocused();let n=null;const i=Array.from(this.propertiesTreeOutline.shadowRoot.querySelectorAll("[tabindex]"));if(0===i.length)return;const s=t?i.indexOf(t):-1;if("ArrowLeft"===e.key)n=i[s-1]||this.element;else if("ArrowRight"===e.key)n=i[s+1]||this.element;else if("ArrowUp"===e.key||"ArrowDown"===e.key)return void this.focusNext(this.element);n&&(this.focusNext(n),e.consume(!0))}onKeyDown(e){const t=e;if(!(i.UIUtils.isEditing()||!this.editable||t.altKey||t.ctrlKey||t.metaKey))switch(t.key){case"Enter":case" ":this.startEditingAtFirstPosition(),t.consume(!0);break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.ruleNavigation(t);break;default:1===t.key.length&&this.addNewBlankProperty(0).startEditing()}}setSectionHovered(e){this.element.classList.toggle("styles-panel-hovered",e),this.propertiesTreeOutline.element.classList.toggle("styles-panel-hovered",e),this.hoverableSelectorsMode!==e&&(this.hoverableSelectorsMode=e,this.markSelectorMatches())}onMouseLeave(e){this.setSectionHovered(!1),this.parentPane.setActiveProperty(null)}onMouseMove(e){const t=i.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(e);this.setSectionHovered(t);const n=this.propertiesTreeOutline.treeElementFromEvent(e);n instanceof xe?this.parentPane.setActiveProperty(n):this.parentPane.setActiveProperty(null);const s=this.element.getComponentSelection();!this.selectedSinceMouseDown&&s&&s.toString()&&(this.selectedSinceMouseDown=!0)}onFontEditorButtonClicked(){this.fontEditorSectionManager&&this.fontEditorButton&&this.fontEditorSectionManager.showPopover(this.fontEditorButton.element,this.parentPane)}style(){return this.styleInternal}headerText(){const e=this.matchedStyles.nodeForStyle(this.styleInternal);return this.styleInternal.type===n.CSSStyleDeclaration.Type.Inline?this.matchedStyles.isInherited(this.styleInternal)?He(Fe.styleAttribute):"element.style":e&&this.styleInternal.type===n.CSSStyleDeclaration.Type.Attributes?He(Fe.sattributesStyle,{PH1:e.nodeNameInCorrectCase()}):this.styleInternal.parentRule instanceof n.CSSRule.CSSStyleRule?this.styleInternal.parentRule.selectorText():""}onMouseOutSelector(){this.hoverTimer&&clearTimeout(this.hoverTimer),n.OverlayModel.OverlayModel.hideDOMNodeHighlight()}onMouseEnterSelector(){this.hoverTimer&&clearTimeout(this.hoverTimer),this.hoverTimer=setTimeout(this.highlight.bind(this),300)}highlight(e="all"){n.OverlayModel.OverlayModel.hideDOMNodeHighlight();const t=this.parentPane.node();if(!t)return;const i=this.styleInternal.parentRule&&this.styleInternal.parentRule instanceof n.CSSRule.CSSStyleRule?this.styleInternal.parentRule.selectorText():void 0;t.domModel().overlayModel().highlightInOverlay({node:t,selectorList:i},e)}firstSibling(){const e=this.element.parentElement;if(!e)return null;let t=e.firstChild;for(;t;){const e=this.parentPane.sectionByElement.get(t);if(e)return e;t=t.nextSibling}return null}findCurrentOrNextVisible(e,t){if(!this.isHidden())return this;if(this===t)return null;t||(t=this);let n=null;const i=e?this.nextSibling():this.previousSibling();if(i)n=i.findCurrentOrNextVisible(e,t);else{const i=e?this.firstSibling():this.lastSibling();i&&(n=i.findCurrentOrNextVisible(e,t))}return n}lastSibling(){const e=this.element.parentElement;if(!e)return null;let t=e.lastChild;for(;t;){const e=this.parentPane.sectionByElement.get(t);if(e)return e;t=t.previousSibling}return null}nextSibling(){let e=this.element;do{e=e.nextSibling}while(e&&!this.parentPane.sectionByElement.has(e));if(e)return this.parentPane.sectionByElement.get(e)}previousSibling(){let e=this.element;do{e=e.previousSibling}while(e&&!this.parentPane.sectionByElement.has(e));if(e)return this.parentPane.sectionByElement.get(e)}onNewRuleClick(e){e.data.consume();const t=this.styleInternal.parentRule;if(!t||!t.style.range||void 0===t.styleSheetId)return;const n=g.TextRange.TextRange.createFromLocation(t.style.range.endLine,t.style.range.endColumn+1);this.parentPane.addBlankSection(this,t.styleSheetId,n)}styleSheetEdited(e){const t=this.styleInternal.parentRule;t?t.rebase(e):this.styleInternal.rebase(e),this.updateQueryList(),this.updateRuleOrigin()}createMediaList(e){for(let t=e.length-1;t>=0;--t){const i=e[t];if(!i.text||!i.text.includes("(")&&"print"!==i.text)continue;let s,o="",r="";switch(i.source){case n.CSSMedia.Source.LINKED_SHEET:case n.CSSMedia.Source.INLINE_SHEET:r=`media="${i.text}"`;break;case n.CSSMedia.Source.MEDIA_RULE:o="@media",r=i.text,i.styleSheetId&&(s=this.handleQueryRuleClick.bind(this,i));break;case n.CSSMedia.Source.IMPORT_RULE:r=`@import ${i.text}`}const l=new h.CSSQuery.CSSQuery;l.data={queryPrefix:o,queryText:r,onQueryTextClick:s},this.queryListElement.append(l)}}createContainerQueryList(e){for(let t=e.length-1;t>=0;--t){const n=e[t];if(!n.text)continue;let i;n.styleSheetId&&(i=this.handleQueryRuleClick.bind(this,n));const s=new h.CSSQuery.CSSQuery;s.data={queryPrefix:"@container",queryName:n.name,queryText:n.text,onQueryTextClick:i},this.queryListElement.append(s),this.addContainerForContainerQuery(n)}}async addContainerForContainerQuery(e){const t=await e.getContainerForNode(this.matchedStyles.node().id);if(!t)return;const n=new h.QueryContainer.QueryContainer;n.data={container:h.Helper.legacyNodeToElementsComponentsNode(t.containerNode),queryName:e.name,onContainerLinkClick:e=>{e.preventDefault(),an.instance().revealAndSelectNode(t.containerNode,!0,!0),t.containerNode.scrollIntoView()}},n.addEventListener("queriedsizerequested",(async()=>{const e=await t.getContainerSizeDetails();e&&n.updateContainerQueriedSizeDetails(e)})),this.queryListElement.prepend(n)}updateQueryList(){this.queryListElement.removeChildren(),this.styleInternal.parentRule&&this.styleInternal.parentRule instanceof n.CSSRule.CSSStyleRule&&(this.createMediaList(this.styleInternal.parentRule.media),this.createContainerQueryList(this.styleInternal.parentRule.containerQueries))}isPropertyInherited(e){return!!this.matchedStyles.isInherited(this.styleInternal)&&!n.CSSMetadata.cssMetadata().isPropertyInherited(e)}nextEditableSibling(){let e=this;do{e=e.nextSibling()}while(e&&!e.editable);if(!e)for(e=this.firstSibling();e&&!e.editable;)e=e.nextSibling();return e&&e.editable?e:null}previousEditableSibling(){let e=this;do{e=e.previousSibling()}while(e&&!e.editable);if(!e)for(e=this.lastSibling();e&&!e.editable;)e=e.previousSibling();return e&&e.editable?e:null}refreshUpdate(e){this.parentPane.refreshUpdate(this,e)}updateVarFunctions(e){let t=this.propertiesTreeOutline.firstChild();for(;t;)t!==e&&t instanceof xe&&t.updateTitleIfComputedValueChanged(),t=t.traverseNextTreeElement(!1,null,!0)}update(e){if(this.selectorElement.textContent=this.headerText(),this.markSelectorMatches(),e)this.onpopulate();else{let e=this.propertiesTreeOutline.firstChild();for(;e&&e instanceof xe;)e.setOverloaded(this.isPropertyOverloaded(e.property)),e=e.traverseNextTreeElement(!1,null,!0)}}showAllItems(e){e&&e.consume(),this.forceShowAll||(this.forceShowAll=!0,this.onpopulate())}onpopulate(){this.parentPane.setActiveProperty(null),this.nextEditorTriggerButtonIdx=1,this.propertiesTreeOutline.removeChildren();const e=this.styleInternal;let t=0;const n=e.leadingProperties(),i=Ke.MaxProperties+n.length-this.originalPropertiesCount;for(const s of n){if(!this.forceShowAll&&t>=i)break;t++;const n=Boolean(e.longhandProperties(s.name).length),o=this.isPropertyInherited(s.name),r=this.isPropertyOverloaded(s);if(e.parentRule&&e.parentRule.isUserAgent()&&o)continue;const l=new xe(this.parentPane,this.matchedStyles,s,n,o,r,!1);this.propertiesTreeOutline.appendChild(l)}t<n.length?(this.showAllButton.classList.remove("hidden"),this.showAllButton.textContent=He(Fe.showAllPropertiesSMore,{PH1:n.length-t})):this.showAllButton.classList.add("hidden")}isPropertyOverloaded(e){return this.matchedStyles.propertyState(e)===n.CSSMatchedStyles.PropertyState.Overloaded}updateFilter(){let e=!1;this.showAllItems();for(const t of this.propertiesTreeOutline.rootElement().children())if(t instanceof xe){const n=t.updateFilter();e=e||n}const t=this.parentPane.filterRegex(),n=!e&&null!==t&&!t.test(this.element.deepTextContent());return this.isHiddenInternal=n,this.element.classList.toggle("hidden",n),!n&&this.styleInternal.parentRule&&this.markSelectorHighlights(),!n}isHidden(){return this.isHiddenInternal}markSelectorMatches(){const e=this.styleInternal.parentRule;if(!(e&&e instanceof n.CSSRule.CSSStyleRule))return;this.queryListElement.classList.toggle("query-matches",this.matchedStyles.mediaMatches(this.styleInternal));const t=e.selectors.map((e=>e.text)),i=this.matchedStyles.getMatchingSelectors(e),s=new Array(t.length).fill(!1);for(const e of i)s[e]=!0;if(this.parentPane.isEditingStyle)return;const o=this.hoverableSelectorsMode?this.renderHoverableSelectors(t,s):this.renderSimplifiedSelectors(t,s);this.selectorElement.removeChildren(),this.selectorElement.appendChild(o),this.markSelectorHighlights()}renderHoverableSelectors(e,t){const n=document.createDocumentFragment();for(let s=0;s<e.length;++s)s&&i.UIUtils.createTextChild(n,", "),n.appendChild(this.createSelectorElement(e[s],t[s],s));return n}createSelectorElement(e,t,n){const i=document.createElement("span");return i.classList.add("simple-selector"),i.classList.toggle("selector-matches",t),"number"==typeof n&&this.elementToSelectorIndex.set(i,n),i.textContent=e,i}renderSimplifiedSelectors(e,t){const n=document.createDocumentFragment();let i=!1,s="";for(let o=0;o<e.length;++o)i!==t[o]&&s&&(n.appendChild(this.createSelectorElement(s,i)),s=""),i=t[o],s+=e[o]+(o===e.length-1?"":", ");return s&&n.appendChild(this.createSelectorElement(s,i)),n}markSelectorHighlights(){const e=this.selectorElement.getElementsByClassName("simple-selector"),t=this.parentPane.filterRegex();for(let n=0;n<e.length;++n){const i=null!==t&&t.test(e[n].textContent||"");e[n].classList.toggle("filter-match",i)}}checkWillCancelEditing(){const e=this.willCauseCancelEditing;return this.willCauseCancelEditing=!1,e}handleSelectorContainerClick(e){!this.checkWillCancelEditing()&&this.editable&&e.target===this.selectorContainer&&(this.addNewBlankProperty(0).startEditing(),e.consume(!0))}addNewBlankProperty(e=this.propertiesTreeOutline.rootElement().childCount()){const t=this.styleInternal.newBlankProperty(e),n=new xe(this.parentPane,this.matchedStyles,t,!1,!1,!1,!0);return this.propertiesTreeOutline.insertChild(n,t.index),n}handleEmptySpaceMouseDown(){this.willCauseCancelEditing=this.parentPane.isEditingStyle,this.selectedSinceMouseDown=!1}handleEmptySpaceClick(e){if(!this.editable||this.element.hasSelection()||this.checkWillCancelEditing()||this.selectedSinceMouseDown)return;const t=e.target;if(t.classList.contains("header")||this.element.classList.contains("read-only")||t.enclosingNodeOrSelfWithClass("query"))return void e.consume();const n=i.UIUtils.deepElementFromEvent(e),s=n&&i.TreeOutline.TreeElement.getTreeElementBylistItemNode(n);s&&s instanceof xe?this.addNewBlankProperty(s.property.index+1).startEditing():this.addNewBlankProperty().startEditing(),e.consume(!0)}handleQueryRuleClick(t,n){const s=n.currentTarget;if(i.UIUtils.isBeingEdited(s))return;if(i.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(n)&&this.navigable){const i=t.rawLocation();if(!i)return void n.consume(!0);const s=m.CSSWorkspaceBinding.CSSWorkspaceBinding.instance().rawLocationToUILocation(i);return s&&e.Revealer.reveal(s),void n.consume(!0)}if(!this.editable)return;const o=new i.InplaceEditor.Config(this.editingMediaCommitted.bind(this,t),this.editingMediaCancelled.bind(this,s),void 0,this.editingMediaBlurHandler.bind(this));i.InplaceEditor.InplaceEditor.startEditing(s,o);const r=s.getComponentSelection();r&&r.selectAllChildren(s),this.parentPane.setEditingStyle(!0);s.enclosingNodeOrSelfWithClass("query").classList.add("editing-query"),n.consume(!0)}editingMediaFinished(e){this.parentPane.setEditingStyle(!1);e.enclosingNodeOrSelfWithClass("query").classList.remove("editing-query")}editingMediaCancelled(e){this.editingMediaFinished(e),this.markSelectorMatches();const t=e.getComponentSelection();t&&t.collapse(e,0)}editingMediaBlurHandler(){return!0}editingMediaCommitted(e,t,i,s,o,r){this.parentPane.setEditingStyle(!1),this.editingMediaFinished(t),i&&(i=i.trim()),this.parentPane.setUserOperation(!0);const l=this.parentPane.cssModel();if(l&&e.styleSheetId){(e instanceof n.CSSMedia.CSSMedia?l.setMediaText:l.setContainerQueryText).call(l,e.styleSheetId,e.range,i).then(function(e){e&&(this.matchedStyles.resetActiveProperties(),this.parentPane.refreshUpdate(this)),this.parentPane.setUserOperation(!1),this.editingMediaTextCommittedForTest()}.bind(this))}}editingMediaTextCommittedForTest(){}handleSelectorClick(e){const t=e.target;if(t){if(i.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(e)&&this.navigable&&t.classList.contains("simple-selector")){const n=this.elementToSelectorIndex.get(t);return n&&this.navigateToSelectorSource(n,!0),void e.consume(!0)}this.element.hasSelection()||(this.startEditingAtFirstPosition(),e.consume(!0))}}handleContextMenuEvent(e){if(!e.target)return;const t=new i.ContextMenu.ContextMenu(e);t.clipboardSection().appendItem(He(Fe.copySelector),(()=>{const e=this.headerText();s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(e)})),t.clipboardSection().appendItem(He(Fe.copyRule),(()=>{const e=We.formatLeadingProperties(this).ruleText;s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(e)})),t.clipboardSection().appendItem(He(Fe.copyAllDeclarations),(()=>{const e=We.formatLeadingProperties(this).allDeclarationText;s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(e)})),t.show()}navigateToSelectorSource(e,t){const i=this.parentPane.cssModel();if(!i)return;const s=this.styleInternal.parentRule;if(!s||void 0===s.styleSheetId)return;const o=i.styleSheetHeaderForId(s.styleSheetId);if(!o)return;const r=new n.CSSModel.CSSLocation(o,s.lineNumberInSource(e),s.columnNumberInSource(e));Ke.revealSelectorSource(r,t)}static revealSelectorSource(t,n){const i=m.CSSWorkspaceBinding.CSSWorkspaceBinding.instance().rawLocationToUILocation(t);i&&e.Revealer.reveal(i,!n)}startEditingAtFirstPosition(){this.editable&&(this.styleInternal.parentRule?this.startEditingSelector():this.moveEditorFromSelector("forward"))}startEditingSelector(){const e=this.selectorElement;if(i.UIUtils.isBeingEdited(e))return;e.scrollIntoViewIfNeeded(!1);const t=e.textContent;null!==t&&(e.textContent=t.replace(/\s+/g," ").trim());const n=new i.InplaceEditor.Config(this.editingSelectorCommitted.bind(this),this.editingSelectorCancelled.bind(this));i.InplaceEditor.InplaceEditor.startEditing(this.selectorElement,n);const s=e.getComponentSelection();s&&s.selectAllChildren(e),this.parentPane.setEditingStyle(!0),e.classList.contains("simple-selector")&&this.navigateToSelectorSource(0,!1)}moveEditorFromSelector(e){if(this.markSelectorMatches(),e)if("forward"===e){let e=this.propertiesTreeOutline.firstChild();for(;e&&e.inherited();){const t=e.nextSibling;e=t instanceof xe?t:null}e?e.startEditing(e.nameElement):this.addNewBlankProperty().startEditing()}else{const e=this.previousEditableSibling();if(!e)return;e.addNewBlankProperty().startEditing()}}editingSelectorCommitted(e,t,n,i,s){if(this.editingSelectorEnded(),t&&(t=t.trim()),t===n)return this.selectorElement.textContent=t,void this.moveEditorFromSelector(s);const o=this.styleInternal.parentRule;o&&(this.parentPane.setUserOperation(!0),this.setHeaderText(o,t).then(function(){this.parentPane.setUserOperation(!1),this.moveEditorFromSelector(s),this.editingSelectorCommittedForTest()}.bind(this)))}setHeaderText(e,t){function i(e){const t=this.matchedStyles.getMatchingSelectors(e).length>0;this.propertiesTreeOutline.element.classList.toggle("no-affect",!t),this.matchedStyles.resetActiveProperties(),this.parentPane.refreshUpdate(this)}if(!(e instanceof n.CSSRule.CSSStyleRule))return Promise.resolve();const s=e.selectorRange();return s?e.setSelectorText(t).then(function(e,t){return t?this.matchedStyles.recomputeMatchingSelectors(e).then(i.bind(this,e)):Promise.resolve()}.bind(this,e,Boolean(s))):Promise.resolve()}editingSelectorCommittedForTest(){}updateRuleOrigin(){this.selectorRefElement.removeChildren(),this.selectorRefElement.appendChild(Ke.createRuleOriginNode(this.matchedStyles,this.parentPane.linkifier,this.styleInternal.parentRule))}editingSelectorEnded(){this.parentPane.setEditingStyle(!1)}editingSelectorCancelled(){this.editingSelectorEnded(),this.markSelectorMatches()}closestPropertyForEditing(e){const t=this.propertiesTreeOutline.rootElement();return e>=t.childCount()?t.lastChild():t.childAt(e)}static MaxProperties=50}class Ge extends Ke{normal;ruleLocation;styleSheetId;constructor(e,t,i,s,o,r,l){const a=e.cssModel();super(e,t,n.CSSRule.CSSStyleRule.createDummyRule(a,i).style,l),this.normal=!1,this.ruleLocation=o,this.styleSheetId=s,this.selectorRefElement.removeChildren(),this.selectorRefElement.appendChild(Ke.linkifyRuleLocation(a,this.parentPane.linkifier,s,this.actualRuleLocation())),r&&r.parentRule&&r.parentRule instanceof n.CSSRule.CSSStyleRule&&(this.createMediaList(r.parentRule.media),this.createContainerQueryList(r.parentRule.containerQueries)),this.element.classList.add("blank-section")}actualRuleLocation(){const e=this.rulePrefix().split("\n"),t=e[e.length-1],n=new g.TextRange.TextRange(0,0,e.length-1,t?t.length:0);return this.ruleLocation.rebaseAfterTextEdit(g.TextRange.TextRange.createFromLocation(0,0),n)}rulePrefix(){return 0===this.ruleLocation.startLine&&0===this.ruleLocation.startColumn?"":"\n\n"}get isBlank(){return!this.normal}editingSelectorCommitted(e,t,n,i,s){if(!this.isBlank)return void super.editingSelectorCommitted(e,t,n,i,s);function o(e){const t=this.matchedStyles.getMatchingSelectors(e).length>0;this.makeNormal(e),t||this.propertiesTreeOutline.element.classList.add("no-affect"),this.updateRuleOrigin(),this.parentPane.setUserOperation(!1),this.editingSelectorEnded(),this.element.parentElement&&this.moveEditorFromSelector(s),this.markSelectorMatches(),this.editingSelectorCommittedForTest()}t&&(t=t.trim()),this.parentPane.setUserOperation(!0);const r=this.parentPane.cssModel(),l=this.rulePrefix()+t+" {}";r&&r.addRule(this.styleSheetId,l,this.ruleLocation).then(function(e){return e?this.matchedStyles.addNewRule(e,this.matchedStyles.node()).then(o.bind(this,e)):(this.editingSelectorCancelled(),this.editingSelectorCommittedForTest(),Promise.resolve())}.bind(this))}editingSelectorCancelled(){this.parentPane.setUserOperation(!1),this.isBlank?(this.editingSelectorEnded(),this.parentPane.removeSection(this)):super.editingSelectorCancelled()}makeNormal(e){this.element.classList.remove("blank-section"),this.styleInternal=e.style,this.normal=!0}}class qe extends Ke{constructor(e,t,n,i){super(e,t,n,i),this.selectorElement.className="keyframe-key"}headerText(){return this.styleInternal.parentRule instanceof n.CSSRule.CSSKeyframeRule?this.styleInternal.parentRule.key().text:""}setHeaderText(e,t){if(!(e instanceof n.CSSRule.CSSKeyframeRule))return Promise.resolve();return e.key().range?e.setKeyText(t).then(function(e){e&&this.parentPane.refreshUpdate(this)}.bind(this)):Promise.resolve()}isPropertyInherited(e){return!1}isPropertyOverloaded(e){return!1}markSelectorHighlights(){}markSelectorMatches(){this.styleInternal.parentRule instanceof n.CSSRule.CSSKeyframeRule&&(this.selectorElement.textContent=this.styleInternal.parentRule.key().text)}highlight(){}}function $e(e){return`'${e.replaceAll("'","\\'")}'`}class Qe extends i.TextPrompt.TextPrompt{isColorAware;cssCompletions;selectedNodeComputedStyles;parentNodeComputedStyles;treeElement;isEditingName;cssVariables;constructor(e,t){super(),this.initialize(this.buildPropertyCompletions.bind(this),i.UIUtils.StyleValueDelimiters);const o=n.CSSMetadata.cssMetadata();this.isColorAware=n.CSSMetadata.cssMetadata().isColorAwareProperty(e.property.name),this.cssCompletions=[];const r=e.node();if(t)this.cssCompletions=o.allProperties(),r&&!r.isSVGNode()&&(this.cssCompletions=this.cssCompletions.filter((e=>!o.isSVGProperty(e))));else if(this.cssCompletions=o.getPropertyValues(e.property.name),r&&o.isFontFamilyProperty(e.property.name)){const e=r.domModel().cssModel().fontFaces().map((e=>$e(e.getFontFamily())));this.cssCompletions.unshift(...e)}if(this.selectedNodeComputedStyles=null,this.parentNodeComputedStyles=null,this.treeElement=e,this.isEditingName=t,this.cssVariables=e.matchedStyles().availableCSSVariables(e.property.ownerStyle),this.cssVariables.length<1e3?this.cssVariables.sort(p.StringUtilities.naturalOrderComparator):this.cssVariables.sort(),!t&&(this.disableDefaultSuggestionForEmptyInput(),e&&e.valueElement)){const t=e.valueElement.textContent,n=s.Platform.isMac()?"Cmd":"Ctrl";null!==t&&(t.match(/#[\da-f]{3,6}$/i)?this.setTitle(He(Fe.incrementdecrementWithMousewheelOne,{PH1:n})):t.match(/\d+/)&&this.setTitle(He(Fe.incrementdecrementWithMousewheelHundred,{PH1:n})))}}onKeyDown(e){const t=e;switch(t.key){case"ArrowUp":case"ArrowDown":case"PageUp":case"PageDown":if(!this.isSuggestBoxVisible()&&this.handleNameOrValueUpDown(t))return void t.preventDefault();break;case"Enter":if(t.shiftKey)return;return this.tabKeyPressed(),void t.preventDefault()}super.onKeyDown(t)}onMouseWheel(e){this.handleNameOrValueUpDown(e)?e.consume(!0):super.onMouseWheel(e)}tabKeyPressed(){return this.acceptAutoComplete(),!1}handleNameOrValueUpDown(e){return!(this.isEditingName||!this.treeElement.valueElement||!i.UIUtils.handleElementValueModifications(e,this.treeElement.valueElement,function(e,t){this.treeElement.nameElement&&this.treeElement.valueElement&&this.treeElement.applyStyleText(this.treeElement.nameElement.textContent+": "+this.treeElement.valueElement.textContent,!1)}.bind(this),this.isValueSuggestion.bind(this),function(e,t,i){return 0===t||i.length||!n.CSSMetadata.cssMetadata().isLengthProperty(this.treeElement.property.name)||this.treeElement.property.value.toLowerCase().startsWith("calc(")||(i="px"),e+t+i}.bind(this)))}isValueSuggestion(e){return!!e&&(e=e.toLowerCase(),-1!==this.cssCompletions.indexOf(e)||e.startsWith("--"))}async buildPropertyCompletions(t,i,s){const o=i.toLowerCase(),r=!this.isEditingName&&t.trim().endsWith("var(");if(!i&&!s&&!r&&(this.isEditingName||t))return Promise.resolve([]);const a=[],d=[];r||this.cssCompletions.forEach((e=>y.call(this,e,!1)));const c=this.treeElement.node();if(this.isEditingName&&c){n.CSSMetadata.cssMetadata().nameValuePresets(c.isSVGNode()).forEach((e=>y.call(this,e,!1,!0)))}(this.isEditingName||r)&&this.cssVariables.forEach((e=>y.call(this,e,!0)));const p=a.concat(d);!this.isEditingName&&!p.length&&i.length>1&&"!important".startsWith(o)&&p.push({text:"!important",title:void 0,subtitle:void 0,iconType:void 0,priority:void 0,isSecondary:void 0,subtitleRenderer:void 0,selectionRange:void 0,hideGhostText:void 0,iconElement:void 0});const m=i.replace("-","");if(m&&m===m.toUpperCase())for(let e=0;e<p.length;++e)p[e].text.startsWith("--")||(p[e].text=p[e].text.toUpperCase());for(const e of p){if(r){e.title=e.text,e.text+=")";continue}const t=n.CSSMetadata.cssMetadata().getValuePreset(this.treeElement.name,e.text);!this.isEditingName&&t&&(e.title=e.text,e.text=t.text,e.selectionRange={startColumn:t.startColumn,endColumn:t.endColumn})}const g=async()=>{if(!c||this.selectedNodeComputedStyles)return;this.selectedNodeComputedStyles=await c.domModel().cssModel().computedStylePromise(c.id);const e=c.parentNode;e&&(this.parentNodeComputedStyles=await e.domModel().cssModel().computedStylePromise(e.id))};for(const e of p){await g();const t=h.CSSPropertyIconResolver.findIcon(this.isEditingName?e.text:`${this.treeElement.property.name}: ${e.text}`,this.selectedNodeComputedStyles,this.parentNodeComputedStyles);if(!t)continue;const n=new l.Icon.Icon,i="12.5px",s="12.5px";n.data={iconName:t.iconName,width:i,height:s,color:"black"},n.style.transform=`rotate(${t.rotate}deg) scale(${1.1*t.scaleX}, ${1.1*t.scaleY})`,n.style.maxHeight=s,n.style.maxWidth=i,e.iconElement=n}return this.isColorAware&&!this.isEditingName&&p.sort(((e,t)=>Boolean(e.subtitleRenderer)===Boolean(t.subtitleRenderer)?0:e.subtitleRenderer?-1:1)),Promise.resolve(p);function y(t,i,s){const r=t.toLowerCase().indexOf(o),l={text:t,title:void 0,subtitle:void 0,iconType:void 0,priority:void 0,isSecondary:void 0,subtitleRenderer:void 0,selectionRange:void 0,hideGhostText:void 0,iconElement:void 0};if(i){const n=this.treeElement.matchedStyles().computeCSSVariable(this.treeElement.property.ownerStyle,t);if(n){const t=e.Color.Color.parse(n);t&&(l.subtitleRenderer=f.bind(null,t))}}s&&(l.hideGhostText=!0),0===r?(l.priority=this.isEditingName?n.CSSMetadata.cssMetadata().propertyUsageWeight(t):1,a.push(l)):r>-1&&d.push(l)}function f(e){const t=new u.ColorSwatch.ColorSwatch;return t.renderColor(e),t.style.pointerEvents="none",t}}}function Xe(e){return e.replace(/(?<!\\)\\(?:([a-fA-F0-9]{1,6})|(.))[\n\t\x20]?/gs,((e,t,n)=>{if(n)return n;const i=parseInt(t,16);return 55296<=i&&i<=57343||0===i||i>1114111?"�":String.fromCodePoint(i)}))}class Je{rule;node;propertyName;propertyValue;colorHandler;bezierHandler;fontHandler;shadowHandler;gridHandler;varHandler;angleHandler;lengthHandler;constructor(e,t,n,i){this.rule=e,this.node=t,this.propertyName=n,this.propertyValue=i,this.colorHandler=null,this.bezierHandler=null,this.fontHandler=null,this.shadowHandler=null,this.gridHandler=null,this.varHandler=document.createTextNode.bind(document),this.angleHandler=null,this.lengthHandler=null}setColorHandler(e){this.colorHandler=e}setBezierHandler(e){this.bezierHandler=e}setFontHandler(e){this.fontHandler=e}setShadowHandler(e){this.shadowHandler=e}setGridHandler(e){this.gridHandler=e}setVarHandler(e){this.varHandler=e}setAngleHandler(e){this.angleHandler=e}setLengthHandler(e){this.lengthHandler=e}renderName(){const e=document.createElement("span");return i.ARIAUtils.setAccessibleName(e,He(Fe.cssPropertyName)),e.className="webkit-css-property",e.textContent=this.propertyName,e.normalize(),e}renderValue(){const s=document.createElement("span");if(i.ARIAUtils.setAccessibleName(s,He(Fe.cssPropertyValue)),s.className="value",!this.propertyValue)return s;const o=n.CSSMetadata.cssMetadata();if(this.shadowHandler&&o.isShadowProperty(this.propertyName)&&!n.CSSMetadata.VariableRegex.test(this.propertyValue))return s.appendChild(this.shadowHandler(this.propertyValue,this.propertyName)),s.normalize(),s;if(this.gridHandler&&o.isGridAreaDefiningProperty(this.propertyName))return s.appendChild(this.gridHandler(this.propertyValue,this.propertyName)),s.normalize(),s;o.isStringProperty(this.propertyName)&&i.Tooltip.Tooltip.install(s,Xe(this.propertyValue));const r=[n.CSSMetadata.VariableRegex,n.CSSMetadata.URLRegex],l=[this.varHandler,this.processURL.bind(this)];this.bezierHandler&&o.isBezierAwareProperty(this.propertyName)&&(r.push(i.Geometry.CubicBezier.Regex),l.push(this.bezierHandler)),this.colorHandler&&o.isColorAwareProperty(this.propertyName)&&(r.push(e.Color.Regex),l.push(this.colorHandler)),this.angleHandler&&o.isAngleAwareProperty(this.propertyName)&&(r.push(u.CSSAngleUtils.CSSAngleRegex),l.push(this.angleHandler)),this.fontHandler&&o.isFontAwareProperty(this.propertyName)&&("font-family"===this.propertyName?r.push(u.FontEditorUtils.FontFamilyRegex):r.push(u.FontEditorUtils.FontPropertiesRegex),l.push(this.fontHandler)),t.Runtime.experiments.isEnabled("cssTypeComponentLength")&&this.lengthHandler&&(r.push(u.CSSLengthUtils.CSSLengthRegex),l.push(this.lengthHandler));const a=g.TextUtils.Utils.splitStringByRegexes(this.propertyValue,r);for(let e=0;e<a.length;e++){const t=a[e],n=-1===t.regexIndex?document.createTextNode.bind(document):l[t.regexIndex];n&&s.appendChild(n(t.value))}return s.normalize(),s}processURL(t){let n=t.substring(4,t.length-1).trim();(/^'.*'$/s.test(n)||/^".*"$/s.test(n))&&(n=n.substring(1,n.length-1));const s=document.createDocumentFragment();i.UIUtils.createTextChild(s,"url(");let o=null;this.rule&&this.rule.resourceURL()?o=e.ParsedURL.ParsedURL.completeURL(this.rule.resourceURL(),n):this.node&&(o=this.node.resolveURL(n));const r=U.setImageUrl(a.Linkifier.Linkifier.linkifyURL(o||n,{text:n,preventClick:!1,bypassURLTrimming:!0,className:void 0,lineNumber:void 0,columnNumber:void 0,showColumnNumber:!1,inlineFrameIndex:0,maxLength:void 0,tabStop:void 0}),o||n);return s.appendChild(r),i.UIUtils.createTextChild(s,")"),s}}let Ye;class Ze{button;constructor(){this.button=new i.Toolbar.ToolbarButton(He(Fe.newStyleRule),"largeicon-add"),this.button.addEventListener(i.Toolbar.ToolbarButton.Events.Click,this.clicked,this);const e=i.Icon.Icon.create("largeicon-longclick-triangle","long-click-glyph");function t(){let e=i.Context.Context.instance().flavor(n.DOMModel.DOMNode);e=e?e.enclosingElementOrSelf():null,this.button.setEnabled(Boolean(e))}this.button.element.appendChild(e),new i.UIUtils.LongClickController(this.button.element,this.longClicked.bind(this)),i.Context.Context.instance().addFlavorChangeListener(n.DOMModel.DOMNode,t.bind(this)),t.call(this)}static instance(e={forceNew:null}){const{forceNew:t}=e;return Ye&&!t||(Ye=new Ze),Ye}clicked(){We.instance().createNewRuleInViaInspectorStyleSheet()}longClicked(e){We.instance().onAddButtonLongClick(e)}item(){return this.button}}var et=Object.freeze({__proto__:null,StylesSidebarPane:We,_maxLinkLength:_e,SectionBlock:ze,IdleCallbackManager:je,StylePropertiesSection:Ke,BlankStylePropertiesSection:Ge,KeyframePropertiesSection:qe,quoteFamilyName:$e,CSSPropertyPrompt:Qe,unescapeCssString:Xe,StylesSidebarPropertyRenderer:Je,ButtonProvider:Ze});const tt={filter:"Filter",filterComputedStyles:"Filter Computed Styles",showAll:"Show all",group:"Group",noMatchingProperty:"No matching property",navigateToSelectorSource:"Navigate to selector source",navigateToStyle:"Navigate to style"},nt=o.i18n.registerUIStrings("panels/elements/ComputedStyleWidget.ts",tt),it=o.i18n.getLocalizedString.bind(void 0,nt),st=(e,t,n,i,s)=>{const o=new h.ComputedStyleTrace.ComputedStyleTrace,r=new Je(null,e,t.name,t.value);r.setColorHandler(ot.bind(null,!0));const l=r.renderValue();l.slot="trace-value",o.appendChild(l);const a=t.ownerStyle.parentRule;if(a){const e=document.createElement("span");e.appendChild(Ke.createRuleOriginNode(i,s,a)),e.slot="trace-link",o.appendChild(e)}return o.data={selector:a?a.selectorText():"element.style",active:!n,onNavigateToSource:rt.bind(null,t)},o},ot=(t,n)=>{const i=new u.ColorSwatch.ColorSwatch;i.renderColor(n,t||e.Color.Format.RGB);const s=document.createElement("span");return s.textContent=n,i.append(s),i.addEventListener(u.ColorSwatch.FormatChangedEvent.eventName,(e=>{const{data:t}=e;s.textContent=t.text})),i},rt=(t,n)=>{e.Revealer.reveal(t),n.consume(!0)},lt=(e,t)=>{if(e.startsWith("--")!==t.startsWith("--"))return e.startsWith("--")?1:-1;if(e.startsWith("-webkit")!==t.startsWith("-webkit"))return e.startsWith("-webkit")?1:-1;const i=n.CSSMetadata.cssMetadata().canonicalPropertyName(e),s=n.CSSMetadata.cssMetadata().canonicalPropertyName(t);return p.StringUtilities.compare(i,s)};class at extends i.ThrottledWidget.ThrottledWidget{computedStyleModel;showInheritedComputedStylePropertiesSetting;groupComputedStylesSetting;input;filterRegex;noMatchesElement;propertiesOutline;propertyByTreeElement;categoryByTreeElement;expandedProperties;expandedGroups;linkifier;imagePreviewPopover;idleCallbackManager;constructor(){super(!0),this.computedStyleModel=new A,this.computedStyleModel.addEventListener("ComputedStyleChanged",this.update,this),this.showInheritedComputedStylePropertiesSetting=e.Settings.Settings.instance().createSetting("showInheritedComputedStyleProperties",!1),this.showInheritedComputedStylePropertiesSetting.addChangeListener(this.update.bind(this)),this.groupComputedStylesSetting=e.Settings.Settings.instance().createSetting("groupComputedStyles",!1),this.groupComputedStylesSetting.addChangeListener((()=>{this.update()}));const t=this.contentElement.createChild("div","hbox styles-sidebar-pane-toolbar"),n=t.createChild("div","styles-sidebar-pane-filter-box"),s=We.createPropertyFilterElement(it(tt.filter),t,this.filterComputedStyles.bind(this));i.ARIAUtils.setAccessibleName(s,it(tt.filterComputedStyles)),n.appendChild(s),this.input=s,this.filterRegex=null;const o=new i.Toolbar.Toolbar("styles-pane-toolbar",t);o.appendToolbarItem(new i.Toolbar.ToolbarSettingCheckbox(this.showInheritedComputedStylePropertiesSetting,void 0,it(tt.showAll))),o.appendToolbarItem(new i.Toolbar.ToolbarSettingCheckbox(this.groupComputedStylesSetting,void 0,it(tt.group))),this.noMatchesElement=this.contentElement.createChild("div","gray-info-message"),this.noMatchesElement.textContent=it(tt.noMatchingProperty),this.propertiesOutline=new i.TreeOutline.TreeOutlineInShadow,this.propertiesOutline.hideOverflow(),this.propertiesOutline.setShowSelectionOnKeyboardFocus(!0),this.propertiesOutline.setFocusable(!0),this.propertiesOutline.element.classList.add("monospace","computed-properties"),this.propertiesOutline.addEventListener(i.TreeOutline.Events.ElementExpanded,this.onTreeElementToggled,this),this.propertiesOutline.addEventListener(i.TreeOutline.Events.ElementCollapsed,this.onTreeElementToggled,this),this.contentElement.appendChild(this.propertiesOutline.element),this.propertyByTreeElement=new WeakMap,this.categoryByTreeElement=new WeakMap,this.expandedProperties=new Set,this.expandedGroups=new Set(K),this.linkifier=new a.Linkifier.Linkifier(dt),this.imagePreviewPopover=new U(this.contentElement,(e=>{const t=e.composedPath()[0];return t instanceof Element?t:null}),(()=>this.computedStyleModel.node()));new z(this.computedStyleModel).show(this.contentElement),this.idleCallbackManager=new je}onResize(){const e=this.contentElement.offsetWidth<260;this.propertiesOutline.contentElement.classList.toggle("computed-narrow",e)}showInheritedComputedStyleChanged(){this.update()}update(){this.idleCallbackManager&&this.idleCallbackManager.discard(),this.idleCallbackManager=new je,super.update()}wasShown(){super.wasShown(),this.registerCSSFiles([L]),this.propertiesOutline.registerCSSFiles([D])}async doUpdate(){const[e,t]=await Promise.all([this.computedStyleModel.fetchComputedStyle(),this.fetchMatchedCascade()]),n=this.groupComputedStylesSetting.get();this.propertiesOutline.contentElement.classList.toggle("grouped-list",n),this.propertiesOutline.contentElement.classList.toggle("alphabetical-list",!n),n?await this.rebuildGroupedList(e,t):await this.rebuildAlphabeticalList(e,t)}async fetchMatchedCascade(){const e=this.computedStyleModel.node();if(!e||!this.computedStyleModel.cssModel())return null;const t=this.computedStyleModel.cssModel();return t?t.cachedMatchedCascadeForNode(e).then(function(e){return e&&e.node()===this.computedStyleModel.node()?e:null}.bind(this)):null}async rebuildAlphabeticalList(e,t){const i=this.propertiesOutline.element.hasFocus();this.imagePreviewPopover.hide(),this.propertiesOutline.removeChildren(),this.linkifier.reset();const s=this.computedStyleModel.cssModel();if(!e||!t||!s)return void this.noMatchesElement.classList.remove("hidden");const o=[...e.computedStyle.keys()];o.sort(lt);const r=e.node,l=this.computePropertyTraces(t),a=this.computeNonInheritedProperties(t),d=this.showInheritedComputedStylePropertiesSetting.get(),h=[];for(const t of o){const i=e.computedStyle.get(t)||"",s=n.CSSMetadata.cssMetadata().canonicalPropertyName(t),o=!a.has(s);(d||!o||ht.has(t))&&(!d&&t.startsWith("--")||t!==s&&i===e.computedStyle.get(s)||h.push({propertyName:t,propertyValue:i,isInherited:o}))}this.propertiesOutline.contentElement.classList.add("render-flash");let c=100;for(;h.length>0;){const e=h.splice(0,20);this.idleCallbackManager.schedule((()=>{for(const{propertyName:n,propertyValue:s,isInherited:o}of e){const e=this.buildPropertyTreeElement(l,r,t,n,s,o,i);this.propertiesOutline.appendChild(e)}this.filterAlphabeticalList()}),c),c+=100}await this.idleCallbackManager.awaitDone(),this.propertiesOutline.contentElement.classList.remove("render-flash")}async rebuildGroupedList(e,t){const s=this.propertiesOutline.element.hasFocus();this.imagePreviewPopover.hide(),this.propertiesOutline.removeChildren(),this.linkifier.reset();const o=this.computedStyleModel.cssModel();if(!e||!t||!o)return void this.noMatchesElement.classList.remove("hidden");const r=e.node,l=this.computePropertyTraces(t),a=this.computeNonInheritedProperties(t),d=this.showInheritedComputedStylePropertiesSetting.get(),h=new Map;for(const[i,o]of e.computedStyle){const c=n.CSSMetadata.cssMetadata().canonicalPropertyName(i),p=!a.has(c);if(!d&&p&&!ht.has(i))continue;if(!d&&i.startsWith("--"))continue;if(i!==c&&o===e.computedStyle.get(c))continue;const u=Q(i);for(const e of u){const n=this.buildPropertyTreeElement(l,r,t,i,o,p,s);h.has(e)||h.set(e,[]),h.get(e).push(n)}}for(const e of K){const t=h.get(e);if(t&&t.length>0){const n=document.createElement("h1");n.textContent=e;const s=new i.TreeOutline.TreeElement(n);s.listItemElement.classList.add("group-title"),s.toggleOnClick=!0;for(const e of t)s.appendChild(e);this.propertiesOutline.appendChild(s),this.expandedGroups.has(e)&&s.expand(),this.categoryByTreeElement.set(s,e)}}this.filterGroupLists()}onTreeElementToggled(e){const t=e.data,n=this.propertyByTreeElement.get(t);if(n)t.expanded?this.expandedProperties.add(n.name):this.expandedProperties.delete(n.name);else{const e=this.categoryByTreeElement.get(t);e&&(t.expanded?this.expandedGroups.add(e):this.expandedGroups.delete(e))}}buildPropertyTreeElement(e,t,n,s,o,r,l){const a=new i.TreeOutline.TreeElement,d=e.get(s);let c=()=>{};if(d){const e=this.renderPropertyTrace(n,t,a,d);a.setExpandable(!0),a.listItemElement.addEventListener("click",(e=>{a.expanded?a.collapse():a.expand(),e.consume()}),!1),c=rt.bind(this,e)}const p=((e,t,n)=>{const i=new h.ComputedStyleProperty.ComputedStyleProperty,s=new Je(null,e,t,n);s.setColorHandler(ot.bind(null,!1));const o=s.renderName();o.slot="property-name",i.appendChild(o);const r=s.renderValue();return r.slot="property-value",i.appendChild(r),i})(t,s,o);return p.data={traceable:e.has(s),inherited:r,onNavigateToSource:c},a.title=p,this.propertyByTreeElement.set(a,{name:s,value:o}),this.propertiesOutline.selectedTreeElement||a.select(!l),this.expandedProperties.has(s)&&a.expand(),a}renderPropertyTrace(e,t,s,o){let r=null;for(const l of o){const o=e.propertyState(l)===n.CSSMatchedStyles.PropertyState.Overloaded;o||(r=l,s.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this,e,l)));const a=st(t,l,o,e,this.linkifier),d=new i.TreeOutline.TreeElement;d.title=a,d.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this,e,l)),s.appendChild(d)}return r}handleContextMenuEvent(t,n,s){const o=new i.ContextMenu.ContextMenu(s),r=n.ownerStyle.parentRule;if(r){const e=r.styleSheetId?t.cssModel().styleSheetHeaderForId(r.styleSheetId):null;e&&!e.isAnonymousInlineStyleSheet()&&o.defaultSection().appendItem(it(tt.navigateToSelectorSource),(()=>{Ke.tryNavigateToRuleLocation(t,r)}))}o.defaultSection().appendItem(it(tt.navigateToStyle),(()=>e.Revealer.reveal(n))),o.show()}computePropertyTraces(e){const t=new Map;for(const n of e.nodeStyles()){const i=n.allProperties();for(const n of i)n.activeInStyle()&&e.propertyState(n)&&(t.has(n.name)||t.set(n.name,[]),t.get(n.name).push(n))}return t}computeNonInheritedProperties(e){const t=new Set;for(const i of e.nodeStyles())for(const s of i.allProperties())e.propertyState(s)&&t.add(n.CSSMetadata.cssMetadata().canonicalPropertyName(s.name));return t}filterComputedStyles(e){this.filterRegex=e,this.groupComputedStylesSetting.get()?this.filterGroupLists():this.filterAlphabeticalList()}filterAlphabeticalList(){const e=this.filterRegex,t=this.propertiesOutline.rootElement().children();let n=!1;for(const i of t){const t=this.propertyByTreeElement.get(i);if(!t)continue;const s=!e||e.test(t.name)||e.test(t.value);i.hidden=!s,n=n||s}this.noMatchesElement.classList.toggle("hidden",Boolean(n))}filterGroupLists(){const e=this.filterRegex,t=this.propertiesOutline.rootElement().children();let n=!1,i=!1;for(const s of t){let t=!1;const o=s.children();for(const i of o){const s=this.propertyByTreeElement.get(i);if(!s)continue;const o=!e||e.test(s.name)||e.test(s.value);i.hidden=!o,n=n||o,t=t||o}s.hidden=!t,s.listItemElement.classList.toggle("first-group",t&&!i),i=i||t}this.noMatchesElement.classList.toggle("hidden",n)}}const dt=30,ht=new Set(["display","height","width"]);var ct=Object.freeze({__proto__:null,ComputedStyleWidget:at});const pt=function(e,t){if(e.nodeType()!==Node.ELEMENT_NODE)return"";const n=[];let i=e;for(;i;){const s=gt(i,Boolean(t),i===e);if(!s)break;if(n.push(s),s.optimized)break;i=i.parentNode}return n.reverse(),n.join(" > ")},ut=function(e){let t=e;for(;t;){const e=t.ancestorShadowRoot();if(e&&e.shadowRootType()!==n.DOMModel.DOMNode.ShadowRootTypes.Open)return!1;t=t.ancestorShadowHost()}return!0},mt=function(e,t){if(e.nodeType()!==Node.ELEMENT_NODE)return"";const n=[];let i=e;for(;i;)n.push(pt(i,t)),i=i.ancestorShadowHost();n.reverse();let s="";for(let e=0;e<n.length;++e){const t=JSON.stringify(n[e]);s+=e?`.shadowRoot.querySelector(${t})`:`document.querySelector(${t})`}return s},gt=function(e,t,n){if(e.nodeType()!==Node.ELEMENT_NODE)return null;const i=e.getAttribute("id");if(t){if(i)return new bt(l(i),!0);const t=e.nodeName().toLowerCase();if("body"===t||"head"===t||"html"===t)return new bt(e.nodeNameInCorrectCase(),!0)}const s=e.nodeNameInCorrectCase();if(i)return new bt(s+l(i),!0);const o=e.parentNode;if(!o||o.nodeType()===Node.DOCUMENT_NODE)return new bt(s,!0);function r(e){const t=e.getAttribute("class");return t?t.split(/\s+/g).filter(Boolean).map((function(e){return"$"+e})):[]}function l(e){return"#"+CSS.escape(e)}const a=r(e);let d=!1,h=!1,c=-1,p=-1;const u=o.children();for(let t=0;u&&(-1===c||!h)&&t<u.length;++t){const n=u[t];if(n.nodeType()!==Node.ELEMENT_NODE)continue;if(p+=1,n===e){c=p;continue}if(h)continue;if(n.nodeNameInCorrectCase()!==s)continue;d=!0;const i=new Set(a);if(!i.size){h=!0;continue}const o=r(n);for(let e=0;e<o.length;++e){const t=o[e];if(i.has(t)&&(i.delete(t),!i.size)){h=!0;break}}}let m=s;if(n&&"input"===s.toLowerCase()&&e.getAttribute("type")&&!e.getAttribute("id")&&!e.getAttribute("class")&&(m+="[type="+CSS.escape(e.getAttribute("type")||"")+"]"),h)m+=":nth-child("+(c+1)+")";else if(d)for(const e of a)m+="."+CSS.escape(e.slice(1));return new bt(m,!1)},yt=function(e,t){if(e.nodeType()===Node.DOCUMENT_NODE)return"/";const n=[];let i=e;for(;i;){const e=ft(i,t);if(!e)break;if(n.push(e),e.optimized)break;i=i.parentNode}return n.reverse(),(n.length&&n[0].optimized?"":"/")+n.join("/")},ft=function(e,t){let n;const i=St(e);if(-1===i)return null;switch(e.nodeType()){case Node.ELEMENT_NODE:if(t&&e.getAttribute("id"))return new bt('//*[@id="'+e.getAttribute("id")+'"]',!0);n=e.localName();break;case Node.ATTRIBUTE_NODE:n="@"+e.nodeName();break;case Node.TEXT_NODE:case Node.CDATA_SECTION_NODE:n="text()";break;case Node.PROCESSING_INSTRUCTION_NODE:n="processing-instruction()";break;case Node.COMMENT_NODE:n="comment()";break;case Node.DOCUMENT_NODE:default:n=""}return i>0&&(n+="["+i+"]"),new bt(n,e.nodeType()===Node.DOCUMENT_NODE)},St=function(e){function t(e,t){if(e===t)return!0;if(e.nodeType()===Node.ELEMENT_NODE&&t.nodeType()===Node.ELEMENT_NODE)return e.localName()===t.localName();if(e.nodeType()===t.nodeType())return!0;return(e.nodeType()===Node.CDATA_SECTION_NODE?Node.TEXT_NODE:e.nodeType())===(t.nodeType()===Node.CDATA_SECTION_NODE?Node.TEXT_NODE:t.nodeType())}const n=e.parentNode?e.parentNode.children():null;if(!n)return 0;let i;for(let s=0;s<n.length;++s)if(t(e,n[s])&&n[s]!==e){i=!0;break}if(!i)return 0;let s=1;for(let i=0;i<n.length;++i)if(t(e,n[i])){if(n[i]===e)return s;++s}return-1};class bt{value;optimized;constructor(e,t){this.value=e,this.optimized=t||!1}toString(){return this.value}}var vt=Object.freeze({__proto__:null,fullQualifiedSelector:function(e,t){return e.nodeType()!==Node.ELEMENT_NODE?e.localName()||e.nodeName().toLowerCase():pt(e,t)},cssPath:pt,canGetJSPath:ut,jsPath:mt,xPath:yt,Step:bt});const Et=new CSSStyleSheet;Et.replaceSync('.editing{box-shadow:var(--drop-shadow);background-color:var(--color-background);text-overflow:clip!important;padding-left:2px;margin-left:-2px;padding-right:2px;margin-right:-2px;margin-bottom:-1px;padding-bottom:1px;opacity:100%!important}.editing,.editing *{color:var(--color-text-primary)!important;text-decoration:none!important}.editing br{display:none}.elements-disclosure{width:100%;display:inline-block;line-height:normal}.elements-disclosure li{padding:1px 0 0 14px;margin-left:-2px;word-break:normal;position:relative;min-height:15px;line-height:1.36;min-width:200px}.elements-disclosure li.parent{margin-left:-13px}.elements-disclosure li .selected-hint::before{font-style:italic;content:" == $0";opacity:0%;position:absolute;white-space:pre}.elements-disclosure .elements-tree-outline:not(.hide-selection-when-blurred) li.selected .selected-hint::before{position:static;opacity:60%}.elements-disclosure li.parent::before{box-sizing:border-box;user-select:none;-webkit-mask-image:var(--image-file-treeoutlineTriangles);-webkit-mask-size:32px 24px;content:"\\A0\\A0";color:transparent;text-shadow:none;margin-right:-3px;-webkit-mask-position:0 0;background-color:var(--color-text-secondary)}.elements-disclosure li.parent.expanded::before{-webkit-mask-position:-16px 0}.elements-disclosure li.always-parent::before{visibility:hidden}.elements-disclosure li .selection{display:none;z-index:-1}.elements-disclosure li.selected .selection{display:block}.elements-disclosure li.elements-drag-over .selection{display:block;margin-top:-2px;border-top:2px solid var(--legacy-selection-bg-color)}.elements-disclosure .elements-tree-outline:not(.hide-selection-when-blurred) .selection{background-color:var(--legacy-item-selection-inactive-bg-color)}.elements-disclosure li.hovered:not(.selected) .selection{display:block;left:3px;right:3px;background-color:var(--item-hover-color);border-radius:5px}.elements-disclosure li .webkit-html-tag.close{margin-left:-12px}.elements-disclosure .elements-tree-outline.hide-selection-when-blurred .selected:focus-visible .highlight>*{background:var(--legacy-focus-bg-color);border-radius:2px;box-shadow:0 0 0 2px var(--legacy-focus-bg-color)}.elements-disclosure .elements-tree-outline:not(.hide-selection-when-blurred) li.selected:focus .selection{background-color:var(--legacy-item-selection-bg-color)}.elements-disclosure ol{list-style-type:none;padding-inline-start:12px;margin:0}.elements-disclosure ol.children{display:none;min-width:100%}.elements-disclosure ol.children.expanded{display:inline-block}.elements-disclosure>ol{position:relative;margin:0;cursor:default;min-width:100%;min-height:100%;padding-left:2px}.elements-disclosure li.in-clipboard .highlight{outline:1px dotted var(--color-details-hairline)}.elements-tree-outline ol.shadow-root-depth-4{--override-shadow-root-background-color:rgb(0 0 0 / 4%);background-color:var(--override-shadow-root-background-color)}.elements-tree-outline ol.shadow-root-depth-3{--override-shadow-root-background-color:rgb(0 0 0 / 3%);background-color:var(--override-shadow-root-background-color)}.elements-tree-outline ol.shadow-root-depth-2{--override-shadow-root-background-color:rgb(0 0 0 / 2%);background-color:var(--override-shadow-root-background-color)}.elements-tree-outline ol.shadow-root-depth-1{--override-shadow-root-background-color:rgb(0 0 0 / 1%);background-color:var(--override-shadow-root-background-color)}.elements-tree-outline ol.shadow-root-deep{background-color:transparent}.elements-tree-editor{box-shadow:var(--drop-shadow);margin-right:4px}button,input,select{font-family:inherit;font-size:inherit}.elements-gutter-decoration{position:absolute;top:3px;left:2px;height:9px;width:9px;border-radius:5px;border:1px solid var(--issue-color-yellow);background-color:var(--issue-color-yellow);cursor:pointer}.elements-gutter-decoration.elements-has-decorated-children{opacity:50%}.add-attribute{margin-left:1px;margin-right:1px;white-space:nowrap}.elements-tree-nowrap,.elements-tree-nowrap .li{white-space:pre!important}.elements-disclosure .elements-tree-nowrap li{word-wrap:normal}@keyframes dom-update-highlight-animation{from{background-color:var(--color-syntax-2);color:var(--color-background)}80%{background-color:var(--color-syntax-8)}to{background-color:inherit}}@keyframes dom-update-highlight-animation-dark{from{background-color:var(--color-syntax-2);color:var(--color-background)}80%{background-color:var(--color-background);color:inherit}to{background-color:inherit}}.dom-update-highlight{animation:dom-update-highlight-animation 1.4s 1 cubic-bezier(0,0,.2,1);border-radius:2px}:host-context(.-theme-with-dark-background) .dom-update-highlight{animation:dom-update-highlight-animation-dark 1.4s 1 cubic-bezier(0,0,.2,1)}.elements-disclosure.single-node li{padding-left:2px}.elements-tree-shortcut-link,.elements-tree-shortcut-title{color:var(--color-text-secondary)}.elements-disclosure .gutter-container{position:absolute;top:0;left:0;cursor:pointer;width:15px;height:15px}.elements-hide-gutter .gutter-container{display:none}.gutter-menu-icon{display:block;visibility:hidden;transform:rotate(-90deg) scale(.8);background-color:var(--color-background);position:relative;left:-7px;top:-3px}.elements-disclosure li.selected .gutter-container:not(.has-decorations) .gutter-menu-icon{visibility:visible}.elements-tree-outline ol.shadow-root,li.hovered:not(.always-parent)+ol.children,li.selected:not(.always-parent)+ol.children{background:linear-gradient(to right,var(--override-indentation-level-border-color),var(--override-indentation-level-border-color) .5px,transparent 0);background-position-x:5px}li.selected:not(.always-parent)+ol.children{--override-indentation-level-border-color:hsl(216deg 68% 80% / 100%)!important}li.hovered:not(.always-parent)+ol.children:not(.shadow-root){--override-indentation-level-border-color:hsl(0deg 0% 0% / 10%)}.elements-tree-outline ol.shadow-root{--override-indentation-level-border-color:hsl(0deg 0% 80% / 100%)}@media (forced-colors:active){.elements-disclosure li.parent::before{forced-color-adjust:none;background-color:ButtonText!important}.elements-disclosure .elements-tree-outline:not(.hide-selection-when-blurred) li.selected .selected-hint::before{opacity:unset}.elements-disclosure .elements-tree-outline:not(.hide-selection-when-blurred) .selection,.elements-disclosure .elements-tree-outline:not(.hide-selection-when-blurred) li.selected:focus .selection,.elements-disclosure li.hovered:not(.selected) .selection{forced-color-adjust:none;background:canvas!important;border:1px solid Highlight!important}.gutter-menu-icon{forced-color-adjust:none}}\n/*# sourceURL=elementsTreeOutline.css */\n');const Ct={pageDom:"Page DOM",storeAsGlobalVariable:"Store as global variable",showAllNodesDMore:"Show All Nodes ({PH1} More)",reveal:"reveal",adornerSettings:"Badge settings…"},wt=o.i18n.registerUIStrings("panels/elements/ElementsTreeOutline.ts",Ct),xt=o.i18n.getLocalizedString.bind(void 0,wt),Mt=new WeakMap,Tt=new Set;class It extends(e.ObjectWrapper.eventMixin(i.TreeOutline.TreeOutline)){treeElementByNode;shadowRoot;elementInternal;includeRootDOMNode;selectEnabled;rootDOMNodeInternal;selectedDOMNodeInternal;visible;imagePreviewPopover;updateRecords;treeElementsBeingUpdated;decoratorExtensions;showHTMLCommentsSetting;multilineEditing;visibleWidthInternal;clipboardNodeData;isXMLMimeTypeInternal;suppressRevealAndSelect=!1;previousHoveredElement;treeElementBeingDragged;dragOverTreeElement;updateModifiedNodesTimeout;constructor(t,n,s){super(),this.treeElementByNode=new WeakMap;const o=document.createElement("div");this.shadowRoot=i.Utils.createShadowRootWithCoreStyles(o,{cssFile:[Et,b.Style.default],delegatesFocus:void 0});const r=this.shadowRoot.createChild("div","elements-disclosure");this.elementInternal=this.element,this.elementInternal.classList.add("elements-tree-outline","source-code"),s&&this.elementInternal.classList.add("elements-hide-gutter"),i.ARIAUtils.setAccessibleName(this.elementInternal,xt(Ct.pageDom)),this.elementInternal.addEventListener("focusout",this.onfocusout.bind(this),!1),this.elementInternal.addEventListener("mousedown",this.onmousedown.bind(this),!1),this.elementInternal.addEventListener("mousemove",this.onmousemove.bind(this),!1),this.elementInternal.addEventListener("mouseleave",this.onmouseleave.bind(this),!1),this.elementInternal.addEventListener("dragstart",this.ondragstart.bind(this),!1),this.elementInternal.addEventListener("dragover",this.ondragover.bind(this),!1),this.elementInternal.addEventListener("dragleave",this.ondragleave.bind(this),!1),this.elementInternal.addEventListener("drop",this.ondrop.bind(this),!1),this.elementInternal.addEventListener("dragend",this.ondragend.bind(this),!1),this.elementInternal.addEventListener("contextmenu",this.contextMenuEventFired.bind(this),!1),this.elementInternal.addEventListener("clipboard-beforecopy",this.onBeforeCopy.bind(this),!1),this.elementInternal.addEventListener("clipboard-copy",this.onCopyOrCut.bind(this,!1),!1),this.elementInternal.addEventListener("clipboard-cut",this.onCopyOrCut.bind(this,!0),!1),this.elementInternal.addEventListener("clipboard-paste",this.onPaste.bind(this),!1),this.elementInternal.addEventListener("keydown",this.onKeyDown.bind(this),!1),r.appendChild(this.elementInternal),this.element=o,this.includeRootDOMNode=!t,this.selectEnabled=n,this.rootDOMNodeInternal=null,this.selectedDOMNodeInternal=null,this.visible=!1,this.imagePreviewPopover=new U(this.contentElement,(e=>{let t=e.target;for(;t&&!U.getImageURL(t);)t=t.parentElementOrShadowHost();return t}),(e=>{const t=i.UIUtils.enclosingNodeOrSelfWithNodeName(e,"li");if(!t)return null;const n=i.TreeOutline.TreeElement.getTreeElementBylistItemNode(t);return n?n.node():null})),this.updateRecords=new Map,this.treeElementsBeingUpdated=new Set,this.decoratorExtensions=null,this.showHTMLCommentsSetting=e.Settings.Settings.instance().moduleSetting("showHTMLComments"),this.showHTMLCommentsSetting.addChangeListener(this.onShowHTMLCommentsChange.bind(this)),this.setUseLightSelectionColor(!0)}static forDOMModel(e){return Mt.get(e)||null}onShowHTMLCommentsChange(){const e=this.selectedDOMNode();e&&e.nodeType()===Node.COMMENT_NODE&&!this.showHTMLCommentsSetting.get()&&this.selectDOMNode(e.parentNode),this.update()}setWordWrap(e){this.elementInternal.classList.toggle("elements-tree-nowrap",!e)}setMultilineEditing(e){this.multilineEditing=e}visibleWidth(){return this.visibleWidthInternal||0}setVisibleWidth(e){this.visibleWidthInternal=e,this.multilineEditing&&this.multilineEditing.resize()}setClipboardData(e){if(this.clipboardNodeData){const e=this.findTreeElement(this.clipboardNodeData.node);e&&e.setInClipboard(!1),delete this.clipboardNodeData}if(e){const t=this.findTreeElement(e.node);t&&t.setInClipboard(!0),this.clipboardNodeData=e}}resetClipboardIfNeeded(e){this.clipboardNodeData&&this.clipboardNodeData.node===e&&this.setClipboardData(null)}onBeforeCopy(e){e.handled=!0}onCopyOrCut(e,t){this.setClipboardData(null);const n=t.original;if(!n||!n.target)return;if(n.target instanceof Node&&n.target.hasSelection())return;if(i.UIUtils.isEditing())return;const s=this.selectedDOMNode();s&&n.clipboardData&&(n.clipboardData.clearData(),t.handled=!0,this.performCopyOrCut(e,s))}performCopyOrCut(e,t){t&&(e&&(t.isShadowRoot()||t.ancestorUserAgentShadowRoot())||(t.copyNode(),this.setClipboardData({node:t,isCut:e})))}canPaste(e){if(e.isShadowRoot()||e.ancestorUserAgentShadowRoot())return!1;if(!this.clipboardNodeData)return!1;const t=this.clipboardNodeData.node;return(!this.clipboardNodeData.isCut||t!==e&&!t.isAncestor(e))&&e.domModel()===t.domModel()}pasteNode(e){this.canPaste(e)&&this.performPaste(e)}duplicateNode(e){this.performDuplicate(e)}onPaste(e){if(i.UIUtils.isEditing())return;const t=this.selectedDOMNode();t&&this.canPaste(t)&&(e.handled=!0,this.performPaste(t))}performPaste(e){function t(e,t){!e&&t&&this.selectDOMNode(t)}this.clipboardNodeData&&(this.clipboardNodeData.isCut?(this.clipboardNodeData.node.moveTo(e,null,t.bind(this)),this.setClipboardData(null)):this.clipboardNodeData.node.copyTo(e,null,t.bind(this)))}performDuplicate(e){if(e.isInShadowTree())return;const t=e.parentNode?e.parentNode:e;"#document"!==t.nodeName()&&e.copyTo(t,e.nextSibling)}setVisible(e){if(e!==this.visible){if(this.visible=e,!this.visible)return this.imagePreviewPopover.hide(),void(this.multilineEditing&&this.multilineEditing.cancel());this.runPendingUpdates(),this.selectedDOMNodeInternal&&this.revealAndSelectNode(this.selectedDOMNodeInternal,!1)}}get rootDOMNode(){return this.rootDOMNodeInternal}set rootDOMNode(e){this.rootDOMNodeInternal!==e&&(this.rootDOMNodeInternal=e,this.isXMLMimeTypeInternal=e&&e.isXMLNode(),this.update())}get isXMLMimeType(){return Boolean(this.isXMLMimeTypeInternal)}selectedDOMNode(){return this.selectedDOMNodeInternal}selectDOMNode(e,t){this.selectedDOMNodeInternal!==e?(this.selectedDOMNodeInternal=e,this.revealAndSelectNode(e,!t),this.selectedDOMNodeInternal===e&&this.selectedNodeChanged(Boolean(t))):this.revealAndSelectNode(e,!t)}editing(){const e=this.selectedDOMNode();if(!e)return!1;const t=this.findTreeElement(e);return t&&t.isEditing()||!1}update(){const e=this.selectedDOMNode();if(this.removeChildren(),this.rootDOMNode){if(this.includeRootDOMNode){const e=this.createElementTreeElement(this.rootDOMNode);this.appendChild(e)}else{const e=this.visibleChildren(this.rootDOMNode);for(const t of e){const e=this.createElementTreeElement(t);this.appendChild(e)}}e&&this.revealAndSelectNode(e,!0)}}selectedNodeChanged(e){this.dispatchEventToListeners(It.Events.SelectedNodeChanged,{node:this.selectedDOMNodeInternal,focus:e})}fireElementsTreeUpdated(e){this.dispatchEventToListeners(It.Events.ElementsTreeUpdated,e)}findTreeElement(e){let t=this.lookUpTreeElement(e);return t||e.nodeType()!==Node.TEXT_NODE||(t=this.lookUpTreeElement(e.parentNode)),t}lookUpTreeElement(e){if(!e)return null;const t=this.treeElementByNode.get(e);if(t)return t;const n=[];let i;for(i=e.parentNode;i&&(n.push(i),!this.treeElementByNode.has(i));i=i.parentNode);if(!i)return null;for(let t=n.length-1;t>=0;--t){const i=n[t-1]||e,s=this.treeElementByNode.get(n[t]);s&&(s.onpopulate(),i.index&&i.index>=s.expandedChildrenLimit()&&this.setExpandedChildrenLimit(s,i.index+1))}return this.treeElementByNode.get(e)||null}createTreeElementFor(e){let t=this.findTreeElement(e);return t||(e.parentNode?(t=this.createTreeElementFor(e.parentNode),t?this.showChild(t,e):null):null)}revealAndSelectNode(e,t){if(this.suppressRevealAndSelect)return;if(!this.includeRootDOMNode&&e===this.rootDOMNode&&this.rootDOMNode&&(e=this.rootDOMNode.firstChild),!e)return;const n=this.createTreeElementFor(e);n&&n.revealAndSelect(t)}treeElementFromEventInternal(e){const t=this.element.parentElement;if(!t)return null;const n=t.totalOffsetLeft()+t.offsetWidth-36,i=e.pageY,s=this.treeElementFromPoint(n,i);let o;return o=s===this.treeElementFromPoint(n,i-2)?s:this.treeElementFromPoint(n,i+2),o}onfocusout(e){n.OverlayModel.OverlayModel.hideDOMNodeHighlight()}onmousedown(e){const t=this.treeElementFromEventInternal(e);t&&!t.isEventWithinDisclosureTriangle(e)&&t.select()}setHoverEffect(e){this.previousHoveredElement!==e&&(this.previousHoveredElement instanceof Kt&&(this.previousHoveredElement.hovered=!1,delete this.previousHoveredElement),e instanceof Kt&&(e.hovered=!0,this.previousHoveredElement=e))}onmousemove(e){const t=this.treeElementFromEventInternal(e);t&&this.previousHoveredElement===t||(this.setHoverEffect(t),this.highlightTreeElement(t,!i.KeyboardShortcut.KeyboardShortcut.eventHasEitherCtrlOrMeta(e)))}highlightTreeElement(e,t){e instanceof Kt?e.node().domModel().overlayModel().highlightInOverlay({node:e.node(),selectorList:void 0},"all",t):e instanceof Lt&&e.domModel().overlayModel().highlightInOverlay({deferredNode:e.deferredNode(),selectorList:void 0},"all",t)}onmouseleave(e){this.setHoverEffect(null),n.OverlayModel.OverlayModel.hideDOMNodeHighlight()}ondragstart(e){const t=e.target;if(!t||t.hasSelection())return!1;if("A"===t.nodeName)return!1;const i=this.validDragSourceOrTarget(this.treeElementFromEventInternal(e));return!!i&&("BODY"!==i.node().nodeName()&&"HEAD"!==i.node().nodeName()&&(e.dataTransfer&&i.listItemElement.textContent?(e.dataTransfer.setData("text/plain",i.listItemElement.textContent.replace(/\u200b/g,"")),e.dataTransfer.effectAllowed="copyMove",this.treeElementBeingDragged=i,n.OverlayModel.OverlayModel.hideDOMNodeHighlight(),!0):void 0))}ondragover(e){if(!this.treeElementBeingDragged)return!1;const t=this.validDragSourceOrTarget(this.treeElementFromEventInternal(e));if(!t)return!1;let n=t.node();for(;n;){if(n===this.treeElementBeingDragged.nodeInternal)return!1;n=n.parentNode}return t.listItemElement.classList.add("elements-drag-over"),this.dragOverTreeElement=t,e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!1}ondragleave(e){return this.clearDragOverTreeElementMarker(),e.preventDefault(),!1}validDragSourceOrTarget(e){if(!e)return null;if(!(e instanceof Kt))return null;const t=e,n=t.node();return n.parentNode&&n.parentNode.nodeType()===Node.ELEMENT_NODE?t:null}ondrop(e){e.preventDefault();const t=this.treeElementFromEventInternal(e);t instanceof Kt&&this.doMove(t)}doMove(e){if(!this.treeElementBeingDragged)return;let t,n;if(e.isClosingTag())t=e.node();else{const i=e.node();t=i.parentNode,n=i}if(!t||!n)return;const i=this.treeElementBeingDragged.expanded;this.treeElementBeingDragged.nodeInternal.moveTo(t,n,this.selectNodeAfterEdit.bind(this,i)),delete this.treeElementBeingDragged}ondragend(e){e.preventDefault(),this.clearDragOverTreeElementMarker(),delete this.treeElementBeingDragged}clearDragOverTreeElementMarker(){this.dragOverTreeElement&&(this.dragOverTreeElement.listItemElement.classList.remove("elements-drag-over"),delete this.dragOverTreeElement)}contextMenuEventFired(e){const t=this.treeElementFromEventInternal(e);t instanceof Kt&&this.showContextMenu(t,e)}showContextMenu(e,t){if(i.UIUtils.isEditing())return;const n=new i.ContextMenu.ContextMenu(t),s=Boolean(e.node().pseudoType()),o=e.node().nodeType()===Node.ELEMENT_NODE&&!s,r=t.target;if(!r)return;let l=r.enclosingNodeOrSelfWithClass("webkit-html-text-node");l&&l.classList.contains("bogus")&&(l=null);const a=r.enclosingNodeOrSelfWithClass("webkit-html-comment");n.saveSection().appendItem(xt(Ct.storeAsGlobalVariable),this.saveNodeToTempVariable.bind(this,e.node())),l?e.populateTextContextMenu(n,l):o?e.populateTagContextMenu(n,t):a?e.populateNodeContextMenu(n):s&&e.populateScrollIntoView(n),n.viewSection().appendItem(xt(Ct.adornerSettings),(()=>{an.instance().showAdornerSettingsPane()})),n.appendApplicableItems(e.node()),n.show()}async saveNodeToTempVariable(e){const t=await e.resolveToObject();await n.ConsoleModel.ConsoleModel.instance().saveToTempVariable(i.Context.Context.instance().flavor(n.RuntimeModel.ExecutionContext),t)}runPendingUpdates(){this.updateModifiedNodes()}onKeyDown(e){const t=e;if(i.UIUtils.isEditing())return;const n=this.selectedDOMNode();if(!n)return;const s=this.treeElementByNode.get(n);if(s&&i.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(t)&&n.parentNode){if("ArrowUp"===t.key&&n.previousSibling)return n.moveTo(n.parentNode,n.previousSibling,this.selectNodeAfterEdit.bind(this,s.expanded)),void t.consume(!0);if("ArrowDown"===t.key&&n.nextSibling)return n.moveTo(n.parentNode,n.nextSibling.nextSibling,this.selectNodeAfterEdit.bind(this,s.expanded)),void t.consume(!0)}}toggleEditAsHTML(e,t,n){const i=this.treeElementByNode.get(e);if(!i||!i.hasEditableNode())return;if(e.pseudoType())return;const s=e.parentNode,o=e.index,r=i.expanded;i.toggleEditAsHTML(function(e){n&&n();if(!e)return;if(this.runPendingUpdates(),!o)return;const t=s&&s.children(),i=t&&t[o]||s;if(!i)return;if(this.selectDOMNode(i,!0),r){const e=this.findTreeElement(i);e&&e.expand()}}.bind(this),t)}selectNodeAfterEdit(e,t,n){if(t)return null;if(this.runPendingUpdates(),!n)return null;this.selectDOMNode(n,!0);const i=this.findTreeElement(n);return e&&i&&i.expand(),i}async toggleHideElement(e){const t=e.pseudoType(),n=t?e.parentNode:e;if(!n)return;const i=e.marker("hidden-marker"),s=await n.resolveToObject("");s&&(await s.callFunction((function(e,t){const n="__web-inspector-hide-shortcut-style__",i=[];i.push(".__web-inspector-hide-shortcut__"),i.push(".__web-inspector-hide-shortcut__ *"),i.push(".__web-inspector-hidebefore-shortcut__::before"),i.push(".__web-inspector-hideafter-shortcut__::after");const s=i.join(", "),o="\n"+s+"\n{\n    visibility: hidden !important;\n}\n",r="__web-inspector-hide"+(e||"")+"-shortcut__";this.classList.toggle(r,t);let l=this;for(;l.parentNode;)l=l.parentNode;l.nodeType===Node.DOCUMENT_NODE&&(l=document.head);let a=l.querySelector("style#"+n);if(a)return;a=document.createElement("style"),a.id=n,a.textContent=o,l.appendChild(a)}),[{value:t},{value:!i}]),s.release(),e.setMarker("hidden-marker",!i||null))}isToggledToHidden(e){return Boolean(e.marker("hidden-marker"))}reset(){this.rootDOMNode=null,this.selectDOMNode(null,!1),this.imagePreviewPopover.hide(),delete this.clipboardNodeData,n.OverlayModel.OverlayModel.hideDOMNodeHighlight(),this.updateRecords.clear()}wireToDOMModel(e){Mt.set(e,this),e.addEventListener(n.DOMModel.Events.MarkersChanged,this.markersChanged,this),e.addEventListener(n.DOMModel.Events.NodeInserted,this.nodeInserted,this),e.addEventListener(n.DOMModel.Events.NodeRemoved,this.nodeRemoved,this),e.addEventListener(n.DOMModel.Events.AttrModified,this.attributeModified,this),e.addEventListener(n.DOMModel.Events.AttrRemoved,this.attributeRemoved,this),e.addEventListener(n.DOMModel.Events.CharacterDataModified,this.characterDataModified,this),e.addEventListener(n.DOMModel.Events.DocumentUpdated,this.documentUpdated,this),e.addEventListener(n.DOMModel.Events.ChildNodeCountUpdated,this.childNodeCountUpdated,this),e.addEventListener(n.DOMModel.Events.DistributedNodesChanged,this.distributedNodesChanged,this)}unwireFromDOMModel(e){e.removeEventListener(n.DOMModel.Events.MarkersChanged,this.markersChanged,this),e.removeEventListener(n.DOMModel.Events.NodeInserted,this.nodeInserted,this),e.removeEventListener(n.DOMModel.Events.NodeRemoved,this.nodeRemoved,this),e.removeEventListener(n.DOMModel.Events.AttrModified,this.attributeModified,this),e.removeEventListener(n.DOMModel.Events.AttrRemoved,this.attributeRemoved,this),e.removeEventListener(n.DOMModel.Events.CharacterDataModified,this.characterDataModified,this),e.removeEventListener(n.DOMModel.Events.DocumentUpdated,this.documentUpdated,this),e.removeEventListener(n.DOMModel.Events.ChildNodeCountUpdated,this.childNodeCountUpdated,this),e.removeEventListener(n.DOMModel.Events.DistributedNodesChanged,this.distributedNodesChanged,this),Mt.delete(e)}addUpdateRecord(e){let t=this.updateRecords.get(e);return t||(t=new Pt,this.updateRecords.set(e,t)),t}updateRecordForHighlight(e){return this.visible&&this.updateRecords.get(e)||null}documentUpdated(e){const t=e.data;this.reset(),t.existingDocument()&&(this.rootDOMNode=t.existingDocument())}attributeModified(e){const{node:t}=e.data;this.addUpdateRecord(t).attributeModified(e.data.name),this.updateModifiedNodesSoon()}attributeRemoved(e){const{node:t}=e.data;this.addUpdateRecord(t).attributeRemoved(e.data.name),this.updateModifiedNodesSoon()}characterDataModified(e){const t=e.data;this.addUpdateRecord(t).charDataModified(),t.parentNode&&t.parentNode.firstChild===t.parentNode.lastChild&&this.addUpdateRecord(t.parentNode).childrenModified(),this.updateModifiedNodesSoon()}nodeInserted(e){const t=e.data;this.addUpdateRecord(t.parentNode).nodeInserted(t),this.updateModifiedNodesSoon()}nodeRemoved(e){const{node:t,parent:n}=e.data;this.resetClipboardIfNeeded(t),this.addUpdateRecord(n).nodeRemoved(t),this.updateModifiedNodesSoon()}childNodeCountUpdated(e){const t=e.data;this.addUpdateRecord(t).childrenModified(),this.updateModifiedNodesSoon()}distributedNodesChanged(e){const t=e.data;this.addUpdateRecord(t).childrenModified(),this.updateModifiedNodesSoon()}updateModifiedNodesSoon(){this.updateRecords.size&&(this.updateModifiedNodesTimeout||(this.updateModifiedNodesTimeout=window.setTimeout(this.updateModifiedNodes.bind(this),50)))}updateModifiedNodes(){this.updateModifiedNodesTimeout&&(clearTimeout(this.updateModifiedNodesTimeout),delete this.updateModifiedNodesTimeout);const e=[...this.updateRecords.keys()],t=e.length>10;let n,i;t&&(n=this.element.parentNode,i=n?n.scrollTop:0,this.elementInternal.classList.add("hidden"));const s=this.rootDOMNodeInternal&&this.updateRecords.get(this.rootDOMNodeInternal);if(s&&s.hasChangedChildren())this.update();else for(const[e,t]of this.updateRecords)t.hasChangedChildren()?this.updateModifiedParentNode(e):this.updateModifiedNode(e);t&&(this.elementInternal.classList.remove("hidden"),n&&i&&(n.scrollTop=i)),this.updateRecords.clear(),this.fireElementsTreeUpdated(e)}updateModifiedNode(e){const t=this.findTreeElement(e);t&&t.updateTitle(this.updateRecordForHighlight(e))}updateModifiedParentNode(e){const t=this.findTreeElement(e);t&&(t.setExpandable(this.hasVisibleChildren(e)),t.updateTitle(this.updateRecordForHighlight(e)),Tt.has(t)&&this.updateChildren(t))}populateTreeElement(e){return e.childCount()||!e.isExpandable()?Promise.resolve():new Promise((t=>{e.node().getChildNodes((()=>{Tt.add(e),this.updateModifiedParentNode(e.node()),t()}))}))}createElementTreeElement(e,t){const n=new Kt(e,t);return n.setExpandable(!t&&this.hasVisibleChildren(e)),e.nodeType()===Node.ELEMENT_NODE&&e.parentNode&&e.parentNode.nodeType()===Node.DOCUMENT_NODE&&!e.parentNode.parentNode&&n.setCollapsible(!1),n.selectable=Boolean(this.selectEnabled),n}showChild(e,t){if(e.isClosingTag())return null;const n=this.visibleChildren(e.node()).indexOf(t);return-1===n?null:(n>=e.expandedChildrenLimit()&&this.setExpandedChildrenLimit(e,n+1),e.childAt(n))}visibleChildren(e){let t=Kt.visibleShadowRoots(e);const n=e.contentDocument();n&&t.push(n);const i=e.templateContent();i&&t.push(i);const s=e.markerPseudoElement();s&&t.push(s);const o=e.beforePseudoElement();if(o&&t.push(o),e.childNodeCount()){let n=e.children()||[];this.showHTMLCommentsSetting.get()||(n=n.filter((e=>e.nodeType()!==Node.COMMENT_NODE))),t=t.concat(n)}const r=e.afterPseudoElement();return r&&t.push(r),t}hasVisibleChildren(e){return!!e.isIframe()||(!!e.isPortal()||(!!e.contentDocument()||(!!e.templateContent()||(!!Kt.visibleShadowRoots(e).length||(!!e.hasPseudoElements()||(!!e.isInsertionPoint()||Boolean(e.childNodeCount())&&!Kt.canShowInlineText(e)))))))}createExpandAllButtonTreeElement(e){const t=i.UIUtils.createTextButton("",function(t){const n=this.visibleChildren(e.node()).length;this.setExpandedChildrenLimit(e,Math.max(n,e.expandedChildrenLimit()+Gt)),t.consume()}.bind(this));t.value="";const n=new i.TreeOutline.TreeElement(t);return n.selectable=!1,n.button=t,n}setExpandedChildrenLimit(e,t){e.expandedChildrenLimit()!==t&&(e.setExpandedChildrenLimit(t),e.treeOutline&&!this.treeElementsBeingUpdated.has(e)&&this.updateModifiedParentNode(e.node()))}updateChildren(e){if(!e.isExpandable()){if(!e.treeOutline)return;const t=e.treeOutline.selectedTreeElement;return t&&t.hasAncestor(e)&&e.select(!0),void e.removeChildren()}console.assert(!e.isClosingTag()),this.innerUpdateChildren(e)}insertChildElement(e,t,n,i){const s=this.createElementTreeElement(t,i);return e.insertChild(s,n),s}moveChild(e,t,n){if(e.indexOfChild(t)===n)return;const i=t.selected;t.parent&&t.parent.removeChild(t),e.insertChild(t,n),i&&t.select()}innerUpdateChildren(e){if(this.treeElementsBeingUpdated.has(e))return;this.treeElementsBeingUpdated.add(e);const t=e.node(),n=this.visibleChildren(t),i=new Set(n),s=new Map;for(let t=e.childCount()-1;t>=0;--t){const n=e.childAt(t);if(!(n instanceof Kt)){e.removeChildAtIndex(t);continue}const o=n.node();i.has(o)?s.set(o,n):e.removeChildAtIndex(t)}for(let i=0;i<n.length&&i<e.expandedChildrenLimit();++i){const o=n[i],r=s.get(o)||this.findTreeElement(o);if(r&&r!==e)this.moveChild(e,r,i);else{const n=this.insertChildElement(e,o,i);this.updateRecordForHighlight(t)&&e.expanded&&Kt.animateOnDOMUpdate(n),e.childCount()>e.expandedChildrenLimit()&&this.setExpandedChildrenLimit(e,e.expandedChildrenLimit()+1)}}const o=e.childCount();if(n.length>o){const t=o;e.expandAllButtonElement||(e.expandAllButtonElement=this.createExpandAllButtonTreeElement(e)),e.insertChild(e.expandAllButtonElement,t),e.expandAllButtonElement.title=xt(Ct.showAllNodesDMore,{PH1:n.length-o})}else e.expandAllButtonElement&&(e.expandAllButtonElement=null);if(t.isInsertionPoint())for(const n of t.distributedNodes())e.appendChild(new Lt(n));t.nodeType()===Node.ELEMENT_NODE&&!t.pseudoType()&&e.isExpandable()&&this.insertChildElement(e,t,e.childCount(),!0),this.treeElementsBeingUpdated.delete(e)}markersChanged(e){const t=e.data,n=this.treeElementByNode.get(t);n&&n.updateDecorations()}static treeOutlineSymbol=Symbol("treeOutline")}!function(e){let t;!function(e){e.SelectedNodeChanged="SelectedNodeChanged",e.ElementsTreeUpdated="ElementsTreeUpdated"}(t=e.Events||(e.Events={}))}(It||(It={}));const Nt=new Map([[" ","nbsp"],["­","shy"],[" ","ensp"],[" ","emsp"],[" ","thinsp"],[" ","hairsp"],["​","ZeroWidthSpace"],["‌","zwnj"],["‍","zwj"],["‎","lrm"],["‏","rlm"],["‪","#x202A"],["‫","#x202B"],["‬","#x202C"],["‭","#x202D"],["‮","#x202E"],["⁠","NoBreak"],["\ufeff","#xFEFF"]]);class Pt{modifiedAttributes;removedAttributes;hasChangedChildrenInternal;hasRemovedChildrenInternal;charDataModifiedInternal;attributeModified(e){this.removedAttributes&&this.removedAttributes.has(e)&&this.removedAttributes.delete(e),this.modifiedAttributes||(this.modifiedAttributes=new Set),this.modifiedAttributes.add(e)}attributeRemoved(e){this.modifiedAttributes&&this.modifiedAttributes.has(e)&&this.modifiedAttributes.delete(e),this.removedAttributes||(this.removedAttributes=new Set),this.removedAttributes.add(e)}nodeInserted(e){this.hasChangedChildrenInternal=!0}nodeRemoved(e){this.hasChangedChildrenInternal=!0,this.hasRemovedChildrenInternal=!0}charDataModified(){this.charDataModifiedInternal=!0}childrenModified(){this.hasChangedChildrenInternal=!0}isAttributeModified(e){return null!==this.modifiedAttributes&&void 0!==this.modifiedAttributes&&this.modifiedAttributes.has(e)}hasRemovedAttributes(){return null!==this.removedAttributes&&void 0!==this.removedAttributes&&Boolean(this.removedAttributes.size)}isCharDataModified(){return Boolean(this.charDataModifiedInternal)}hasChangedChildren(){return Boolean(this.hasChangedChildrenInternal)}hasRemovedChildren(){return Boolean(this.hasRemovedChildrenInternal)}}let Ot;class kt{static instance(e={forceNew:null}){const{forceNew:t}=e;return Ot&&!t||(Ot=new kt),Ot}async render(e){let t=null;if(e instanceof n.DOMModel.DOMNode?t=e:e instanceof n.DOMModel.DeferredDOMNode&&(t=await e.resolvePromise()),!t)return null;const i=new It(!1,!0,!0);i.rootDOMNode=t;const s=i.firstChild();return s&&!s.isExpandable()&&i.element.classList.add("single-node"),i.setVisible(!0),i.element.treeElementForTest=s,i.setShowSelectionOnKeyboardFocus(!0,!0),{node:i.element,tree:i}}}class Lt extends i.TreeOutline.TreeElement{nodeShortcut;hoveredInternal;constructor(e){super(""),this.listItemElement.createChild("div","selection fill");const t=this.listItemElement.createChild("span","elements-tree-shortcut-title");let n=e.nodeName.toLowerCase();e.nodeType===Node.ELEMENT_NODE&&(n="<"+n+">"),t.textContent="↪ "+n;const s=he(e.deferredNode);i.UIUtils.createTextChild(this.listItemElement," "),s.classList.add("elements-tree-shortcut-link"),s.textContent=xt(Ct.reveal),this.listItemElement.appendChild(s),this.nodeShortcut=e}get hovered(){return Boolean(this.hoveredInternal)}set hovered(e){this.hoveredInternal!==e&&(this.hoveredInternal=e,this.listItemElement.classList.toggle("hovered",e))}deferredNode(){return this.nodeShortcut.deferredNode}domModel(){return this.nodeShortcut.deferredNode.domModel()}onselect(e){if(!e)return!0;return this.nodeShortcut.deferredNode.highlight(),this.nodeShortcut.deferredNode.resolve(function(e){e&&this.treeOutline instanceof It&&(this.treeOutline.selectedDOMNodeInternal=e,this.treeOutline.selectedNodeChanged(!1))}.bind(this)),!0}}var Dt=Object.freeze({__proto__:null,get ElementsTreeOutline(){return It},MappedCharToEntity:Nt,UpdateRecord:Pt,Renderer:kt,ShortcutTreeElement:Lt});const At={domBreakpoint:"DOM Breakpoint",elementIsHidden:"Element is hidden"},Rt=o.i18n.registerUIStrings("panels/elements/MarkerDecorator.ts",At),Ft=o.i18n.getLazilyComputedLocalizedString.bind(void 0,Rt);class Ut{title;color;constructor(e){if(!e.title||!e.color)throw new Error(`Generic decorator requires a color and a title: ${e.marker}`);this.title=e.title(),this.color=e.color}decorate(e){return{title:this.title,color:this.color}}}const Ht={marker:"breakpoint-marker",title:Ft(At.domBreakpoint),color:"rgb(105, 140, 254)"},Bt={marker:"hidden-marker",title:Ft(At.elementIsHidden),color:"#555"};function Vt(){return[{...Ht,decorator:()=>new Ut(Ht)},{...Bt,decorator:()=>new Ut(Bt)},{decorator:bn.instance,marker:"pseudo-state-marker",title:void 0,color:void 0}]}var Wt=Object.freeze({__proto__:null,GenericDecorator:Ut,getRegisteredDecorators:Vt});const _t={thisFrameWasIdentifiedAsAnAd:"This frame was identified as an ad frame",forceState:"Force state",useSInTheConsoleToReferToThis:"Use {PH1} in the console to refer to this element.",addAttribute:"Add attribute",editAttribute:"Edit attribute",focus:"Focus",scrollIntoView:"Scroll into view",enterIsolationMode:"Enter Isolation Mode",exitIsolationMode:"Exit Isolation Mode",editText:"Edit text",editAsHtml:"Edit as HTML",cut:"Cut",copy:"Copy",paste:"Paste",copyOuterhtml:"Copy outerHTML",copySelector:"Copy `selector`",copyJsPath:"Copy JS path",copyStyles:"Copy styles",copyXpath:"Copy XPath",copyFullXpath:"Copy full XPath",copyElement:"Copy element",duplicateElement:"Duplicate element",hideElement:"Hide element",deleteElement:"Delete element",expandRecursively:"Expand recursively",collapseChildren:"Collapse children",captureNodeScreenshot:"Capture node screenshot",showFrameDetails:"Show `iframe` details",valueIsTooLargeToEdit:"<value is too large to edit>",children:"Children:",enableGridMode:"Enable grid mode",disableGridMode:"Disable grid mode",enableFlexMode:"Enable flex mode",disableFlexMode:"Disable flex mode",enableScrollSnap:"Enable scroll-snap overlay",disableScrollSnap:"Disable scroll-snap overlay"},zt=o.i18n.registerUIStrings("panels/elements/ElementsTreeElement.ts",_t),jt=o.i18n.getLocalizedString.bind(void 0,zt);class Kt extends i.TreeOutline.TreeElement{nodeInternal;treeOutline;gutterContainer;decorationsElement;isClosingTagInternal;canAddAttributes;searchQuery;expandedChildrenLimitInternal;decorationsThrottler;inClipboard;hoveredInternal;editing;highlightResult;adornerContainer;adorners;styleAdorners;adornersThrottler;htmlEditElement;expandAllButtonElement;searchHighlightsVisible;selectionElement;hintElement;constructor(t,n){super(),this.nodeInternal=t,this.treeOutline=null,this.gutterContainer=this.listItemElement.createChild("div","gutter-container"),this.gutterContainer.addEventListener("click",this.showContextMenu.bind(this));const s=i.Icon.Icon.create("largeicon-menu","gutter-menu-icon");if(this.gutterContainer.appendChild(s),this.decorationsElement=this.gutterContainer.createChild("div","hidden"),this.isClosingTagInternal=n,this.nodeInternal.nodeType()!==Node.ELEMENT_NODE||n||(this.canAddAttributes=!0),this.searchQuery=null,this.expandedChildrenLimitInternal=Gt,this.decorationsThrottler=new e.Throttler.Throttler(100),this.inClipboard=!1,this.hoveredInternal=!1,this.editing=null,this.highlightResult=[],!n&&(this.adornerContainer=this.listItemElement.createChild("div","adorner-container hidden"),this.adorners=[],this.styleAdorners=[],this.adornersThrottler=new e.Throttler.Throttler(100),this.updateStyleAdorners(),t.isAdFrameNode())){const e=h.AdornerManager.getRegisteredAdorner(h.AdornerManager.RegisteredAdorners.AD),t=this.adorn(e);i.Tooltip.Tooltip.install(t,jt(_t.thisFrameWasIdentifiedAsAnAd))}this.expandAllButtonElement=null}static animateOnDOMUpdate(e){const t=e.listItemElement.querySelector(".webkit-html-tag-name");i.UIUtils.runCSSAnimationOnce(t||e.listItemElement,"dom-update-highlight")}static visibleShadowRoots(t){let i=t.shadowRoots();return i.length&&!e.Settings.Settings.instance().moduleSetting("showUAShadowDOM").get()&&(i=i.filter((function(e){return e.shadowRootType()!==n.DOMModel.DOMNode.ShadowRootTypes.UserAgent}))),i}static canShowInlineText(e){if(e.contentDocument()||e.templateContent()||Kt.visibleShadowRoots(e).length||e.hasPseudoElements())return!1;if(e.nodeType()!==Node.ELEMENT_NODE)return!1;if(!e.firstChild||e.firstChild!==e.lastChild||e.firstChild.nodeType()!==Node.TEXT_NODE)return!1;return e.firstChild.nodeValue().length<80}static populateForcedPseudoStateItems(e,t){const n=["active","hover","focus","visited","focus-within","focus-visible"],i=t.domModel().cssModel().pseudoState(t),s=e.debugSection().appendSubMenuItem(jt(_t.forceState));for(const e of n){const t=!!i&&i.indexOf(e)>=0;s.defaultSection().appendCheckboxItem(":"+e,o.bind(null,e,!t),t,!1)}function o(e,n){t.domModel().cssModel().forcePseudoState(t,e,n)}}isClosingTag(){return Boolean(this.isClosingTagInternal)}node(){return this.nodeInternal}isEditing(){return Boolean(this.editing)}highlightSearchResults(e){this.searchQuery!==e&&this.hideSearchHighlight(),this.searchQuery=e,this.searchHighlightsVisible=!0,this.updateTitle(null,!0)}hideSearchHighlights(){delete this.searchHighlightsVisible,this.hideSearchHighlight()}hideSearchHighlight(){if(0!==this.highlightResult.length){for(let e=this.highlightResult.length-1;e>=0;--e){const t=this.highlightResult[e];switch(t.type){case"added":t.node.remove();break;case"changed":t.node.textContent=t.oldText||null}}this.highlightResult=[]}}setInClipboard(e){this.inClipboard!==e&&(this.inClipboard=e,this.listItemElement.classList.toggle("in-clipboard",e))}get hovered(){return this.hoveredInternal}set hovered(e){this.hoveredInternal!==e&&(this.hoveredInternal=e,this.listItemElement&&(e?(this.createSelection(),this.listItemElement.classList.add("hovered")):this.listItemElement.classList.remove("hovered")))}expandedChildrenLimit(){return this.expandedChildrenLimitInternal}setExpandedChildrenLimit(e){this.expandedChildrenLimitInternal=e}createSelection(){const e=this.listItemElement;e&&(this.selectionElement||(this.selectionElement=document.createElement("div"),this.selectionElement.className="selection fill",this.selectionElement.style.setProperty("margin-left",-this.computeLeftIndent()+"px"),e.insertBefore(this.selectionElement,e.firstChild)))}createHint(){if(this.listItemElement&&!this.hintElement){this.hintElement=this.listItemElement.createChild("span","selected-hint");const e="$0";i.Tooltip.Tooltip.install(this.hintElement,jt(_t.useSInTheConsoleToReferToThis,{PH1:e})),i.ARIAUtils.markAsHidden(this.hintElement)}}onbind(){this.treeOutline&&!this.isClosingTagInternal&&this.treeOutline.treeElementByNode.set(this.nodeInternal,this)}onunbind(){this.editing&&this.editing.cancel(),this.treeOutline&&this.treeOutline.treeElementByNode.get(this.nodeInternal)===this&&this.treeOutline.treeElementByNode.delete(this.nodeInternal)}onattach(){this.hoveredInternal&&(this.createSelection(),this.listItemElement.classList.add("hovered")),this.updateTitle(),this.listItemElement.draggable=!0}async onpopulate(){if(this.treeOutline)return this.treeOutline.populateTreeElement(this)}async expandRecursively(){await this.nodeInternal.getSubtree(-1,!0),await super.expandRecursively(Number.MAX_VALUE)}onexpand(){this.isClosingTagInternal||this.updateTitle()}oncollapse(){this.isClosingTagInternal||this.updateTitle()}select(e,t){return!this.editing&&super.select(e,t)}onselect(e){return!!this.treeOutline&&(this.treeOutline.suppressRevealAndSelect=!0,this.treeOutline.selectDOMNode(this.nodeInternal,e),e&&(this.nodeInternal.highlight(),s.userMetrics.actionTaken(s.UserMetrics.Action.ChangeInspectedNodeInElementsPanel)),this.createSelection(),this.createHint(),this.treeOutline.suppressRevealAndSelect=!1,!0)}ondelete(){if(!this.treeOutline)return!1;const e=this.treeOutline.findTreeElement(this.nodeInternal);return e?e.remove():this.remove(),!0}onenter(){return!this.editing&&(this.startEditing(),!0)}selectOnMouseDown(e){super.selectOnMouseDown(e),this.editing||e.detail>=2&&e.preventDefault()}ondblclick(e){return this.editing||this.isClosingTagInternal||this.startEditingTarget(e.target)||this.isExpandable()&&!this.expanded&&this.expand(),!1}hasEditableNode(){return!this.nodeInternal.isShadowRoot()&&!this.nodeInternal.ancestorUserAgentShadowRoot()}insertInLastAttributePosition(e,t){if(e.getElementsByClassName("webkit-html-attribute").length>0)e.insertBefore(t,e.lastChild);else if(null!==e.textContent){const n=e.textContent.match(/^<(.*?)>$/);if(!n)return;const s=n[1];e.textContent="",i.UIUtils.createTextChild(e,"<"+s),e.appendChild(t),i.UIUtils.createTextChild(e,">")}}startEditingTarget(e){if(!this.treeOutline||this.treeOutline.selectedDOMNode()!==this.nodeInternal)return!1;if(this.nodeInternal.nodeType()!==Node.ELEMENT_NODE&&this.nodeInternal.nodeType()!==Node.TEXT_NODE)return!1;const t=e.enclosingNodeOrSelfWithClass("webkit-html-text-node");if(t)return this.startEditingTextNode(t);const n=e.enclosingNodeOrSelfWithClass("webkit-html-attribute");if(n)return this.startEditingAttribute(n,e);const i=e.enclosingNodeOrSelfWithClass("webkit-html-tag-name");if(i)return this.startEditingTagName(i);return!!e.enclosingNodeOrSelfWithClass("add-attribute")&&this.addNewAttribute()}showContextMenu(e){this.treeOutline&&this.treeOutline.showContextMenu(this,e)}populateTagContextMenu(e,t){const n=this.isClosingTagInternal&&this.treeOutline?this.treeOutline.findTreeElement(this.nodeInternal):this;if(!n)return;e.editSection().appendItem(jt(_t.addAttribute),n.addNewAttribute.bind(n));const i=t.target,s=i.enclosingNodeOrSelfWithClass("webkit-html-attribute"),o=i.enclosingNodeOrSelfWithClass("add-attribute");s&&!o&&e.editSection().appendItem(jt(_t.editAttribute),this.startEditingAttribute.bind(this,s,i)),this.populateNodeContextMenu(e),Kt.populateForcedPseudoStateItems(e,n.node()),this.populateScrollIntoView(e),e.viewSection().appendItem(jt(_t.focus),(async()=>{await this.nodeInternal.focus()}));const r=this.nodeInternal.domModel().overlayModel();r.isHighlightedIsolatedElementInPersistentOverlay(this.nodeInternal.id)?e.viewSection().appendItem(jt(_t.exitIsolationMode),(()=>{r.hideIsolatedElementInPersistentOverlay(this.nodeInternal.id)})):e.viewSection().appendItem(jt(_t.enterIsolationMode),(()=>{r.highlightIsolatedElementInPersistentOverlay(this.nodeInternal.id)}))}populateScrollIntoView(e){e.viewSection().appendItem(jt(_t.scrollIntoView),(()=>this.nodeInternal.scrollIntoView()))}populateTextContextMenu(e,t){this.editing||e.editSection().appendItem(jt(_t.editText),this.startEditingTextNode.bind(this,t)),this.populateNodeContextMenu(e)}populateNodeContextMenu(t){const s=this.hasEditableNode();s&&!this.editing&&t.editSection().appendItem(jt(_t.editAsHtml),this.editAsHTML.bind(this));const o=this.nodeInternal.isShadowRoot(),r=i.KeyboardShortcut.KeyboardShortcut.shortcutToString.bind(null),l=i.KeyboardShortcut.Modifiers.CtrlOrMeta,a=this.treeOutline;if(!a)return;let d;d=t.clipboardSection().appendItem(jt(_t.cut),a.performCopyOrCut.bind(a,!0,this.nodeInternal),!this.hasEditableNode()),d.setShortcut(r("X",l));const h=t.clipboardSection().appendSubMenuItem(jt(_t.copy)),c=h.section();if(o||(d=c.appendItem(jt(_t.copyOuterhtml),a.performCopyOrCut.bind(a,!1,this.nodeInternal)),d.setShortcut(r("V",l))),this.nodeInternal.nodeType()===Node.ELEMENT_NODE&&(c.appendItem(jt(_t.copySelector),this.copyCSSPath.bind(this)),c.appendItem(jt(_t.copyJsPath),this.copyJSPath.bind(this),!ut(this.nodeInternal)),c.appendItem(jt(_t.copyStyles),this.copyStyles.bind(this))),o||(c.appendItem(jt(_t.copyXpath),this.copyXPath.bind(this)),c.appendItem(jt(_t.copyFullXpath),this.copyFullXPath.bind(this))),!o){d=h.clipboardSection().appendItem(jt(_t.copyElement),a.performCopyOrCut.bind(a,!1,this.nodeInternal)),d.setShortcut(r("C",l));const e=!this.nodeInternal.parentNode||"#document"===this.nodeInternal.parentNode.nodeName();d=t.editSection().appendItem(jt(_t.duplicateElement),a.duplicateNode.bind(a,this.nodeInternal),this.nodeInternal.isInShadowTree()||e)}d=t.clipboardSection().appendItem(jt(_t.paste),a.pasteNode.bind(a,this.nodeInternal),!a.canPaste(this.nodeInternal)),d.setShortcut(r("V",l)),d=t.debugSection().appendCheckboxItem(jt(_t.hideElement),a.toggleHideElement.bind(a,this.nodeInternal),a.isToggledToHidden(this.nodeInternal)),d.setShortcut(i.ShortcutRegistry.ShortcutRegistry.instance().shortcutTitleForAction("elements.hide-element")||""),s&&t.editSection().appendItem(jt(_t.deleteElement),this.remove.bind(this)),t.viewSection().appendItem(jt(_t.expandRecursively),this.expandRecursively.bind(this)),t.viewSection().appendItem(jt(_t.collapseChildren),this.collapseChildren.bind(this));const p=new E.DeviceModeWrapper.ActionDelegate;t.viewSection().appendItem(jt(_t.captureNodeScreenshot),p.handleAction.bind(null,i.Context.Context.instance(),"emulation.capture-node-screenshot")),this.nodeInternal.frameOwnerFrameId()&&t.viewSection().appendItem(jt(_t.showFrameDetails),(()=>{const t=this.nodeInternal.frameOwnerFrameId();if(t){const i=n.FrameManager.FrameManager.instance().getFrame(t);e.Revealer.reveal(i)}}))}startEditing(){if(!this.treeOutline||this.treeOutline.selectedDOMNode()!==this.nodeInternal)return;const e=this.listItemElement;if(this.canAddAttributes){const t=e.getElementsByClassName("webkit-html-attribute")[0];return t?this.startEditingAttribute(t,t.getElementsByClassName("webkit-html-attribute-value")[0]):this.addNewAttribute()}if(this.nodeInternal.nodeType()===Node.TEXT_NODE){const t=e.getElementsByClassName("webkit-html-text-node")[0];if(t)return this.startEditingTextNode(t)}}addNewAttribute(){const e=document.createElement("span"),t=this.buildAttributeDOM(e," ","",null);t.style.marginLeft="2px",t.style.marginRight="2px";const n=this.listItemElement.getElementsByClassName("webkit-html-tag")[0];return this.insertInLastAttributePosition(n,t),t.scrollIntoViewIfNeeded(!0),this.startEditingAttribute(t,t)}triggerEditAttribute(e){const t=this.listItemElement.getElementsByClassName("webkit-html-attribute-name");for(let n=0,i=t.length;n<i;++n)if(t[n].textContent===e)for(let e=t[n].nextSibling;e;e=e.nextSibling)if(e.nodeType===Node.ELEMENT_NODE&&e.classList.contains("webkit-html-attribute-value"))return this.startEditingAttribute(e.parentElement,e)}startEditingAttribute(t,n){if(console.assert(this.listItemElement.isAncestor(t)),i.UIUtils.isBeingEdited(t))return!0;const s=t.getElementsByClassName("webkit-html-attribute-name")[0];if(!s)return!1;const o=s.textContent,r=t.getElementsByClassName("webkit-html-attribute-value")[0];n=r.isAncestor(n)?r:n;const l=o&&r?this.nodeInternal.getAttribute(o):void 0;void 0!==l&&r.setTextContentTruncatedIfNeeded(l,jt(_t.valueIsTooLargeToEdit)),function e(t){if(t.nodeType!==Node.TEXT_NODE){if(t.nodeType===Node.ELEMENT_NODE)for(let n=t.firstChild;n;n=n.nextSibling)e(n)}else t.nodeValue=t.nodeValue?t.nodeValue.replace(/\u200B/g,""):""}(t);const a=new i.InplaceEditor.Config(this.attributeEditingCommitted.bind(this),this.editingCancelled.bind(this),o||void 0);e.ParsedURL.ParsedURL.fromString(r.textContent||"")||a.setPostKeydownFinishHandler((function(e){return i.UIUtils.handleElementValueModifications(e,t),""})),this.updateEditorHandles(t,a);const d=this.listItemElement.getComponentSelection();return d&&d.selectAllChildren(n),!0}startEditingTextNode(e){if(i.UIUtils.isBeingEdited(e))return!0;let t=this.nodeInternal;t.nodeType()===Node.ELEMENT_NODE&&t.firstChild&&(t=t.firstChild);const n=e.enclosingNodeOrSelfWithClass("webkit-html-text-node");n&&(n.textContent=t.nodeValue());const s=new i.InplaceEditor.Config(this.textNodeEditingCommitted.bind(this,t),this.editingCancelled.bind(this));this.updateEditorHandles(e,s);const o=this.listItemElement.getComponentSelection();return o&&o.selectAllChildren(e),!0}startEditingTagName(e){if(!e&&!(e=this.listItemElement.getElementsByClassName("webkit-html-tag-name")[0]))return!1;const t=e.textContent;if(null!==t&&$t.has(t.toLowerCase()))return!1;if(i.UIUtils.isBeingEdited(e))return!0;const n=this.distinctClosingTagElement();function s(){n&&e&&(n.textContent="</"+e.textContent+">")}const o=e=>{" "===e.key&&(this.editing&&this.editing.commit(),e.consume(!0))};e.addEventListener("keyup",s,!1),e.addEventListener("keydown",o,!1);const r=new i.InplaceEditor.Config(function(t,n,i,r,l){e&&(e.removeEventListener("keyup",s,!1),e.removeEventListener("keydown",o,!1),this.tagNameEditingCommitted(t,n,i,r,l))}.bind(this),function(t,n){e&&(e.removeEventListener("keyup",s,!1),e.removeEventListener("keydown",o,!1),this.editingCancelled(t,n))}.bind(this),t);this.updateEditorHandles(e,r);const l=this.listItemElement.getComponentSelection();return l&&l.selectAllChildren(e),!0}updateEditorHandles(e,t){const n=i.InplaceEditor.InplaceEditor.startEditing(e,t);this.editing=n?{commit:n.commit,cancel:n.cancel,editor:void 0,resize:()=>{}}:null}async startEditingAsHTML(e,t,n){if(null===n)return;if(this.editing)return;const i=this.convertWhitespaceToEntities(n).text;this.htmlEditElement=document.createElement("div"),this.htmlEditElement.className="source-code elements-tree-editor";let s=this.listItemElement.firstChild;for(;s;)s.style.display="none",s=s.nextSibling;this.childrenListElement&&(this.childrenListElement.style.display="none"),this.listItemElement.appendChild(this.htmlEditElement),this.htmlEditElement.addEventListener("keydown",(e=>{"Escape"===e.key&&e.consume(!0)}));const o=new v.TextEditor.TextEditor(f.EditorState.create({doc:i,extensions:[f.keymap.of([{key:"Mod-Enter",run:()=>(this.editing?.commit(),!0)},{key:"Escape",run:()=>(this.editing?.cancel(),!0)}]),v.Config.baseConfiguration(i),v.Config.closeBrackets,v.Config.autocompletion,f.html.html(),v.Config.domWordWrap.instance(),f.EditorView.theme({"&.cm-editor":{maxHeight:"300px"},".cm-scroller":{overflowY:"auto"}}),f.EditorView.domEventHandlers({focusout:e=>{const t=e.relatedTarget;t&&!t.isSelfOrDescendant(o)&&this.editing&&this.editing.commit()}})]}));function r(){this.treeOutline&&this.htmlEditElement&&(this.htmlEditElement.style.width=this.treeOutline.visibleWidth()-this.computeLeftIndent()-30+"px")}function l(){if(!this.editing||!this.editing.editor)return;this.editing=null,this.htmlEditElement&&this.listItemElement.removeChild(this.htmlEditElement),this.htmlEditElement=void 0,this.childrenListElement&&this.childrenListElement.style.removeProperty("display");let e=this.listItemElement.firstChild;for(;e;)e.style.removeProperty("display"),e=e.nextSibling;this.treeOutline&&(this.treeOutline.setMultilineEditing(null),this.treeOutline.focus()),t()}this.editing={commit:function(){this.editing&&this.editing.editor&&e(i,this.editing.editor.state.doc.toString());l.call(this)}.bind(this),cancel:l.bind(this),editor:o,resize:r.bind(this)},r.call(this),this.htmlEditElement.appendChild(o),o.editor.focus(),this.treeOutline&&this.treeOutline.setMultilineEditing(this.editing)}attributeEditingCommitted(e,t,n,i,s){this.editing=null;const o=this.treeOutline;function r(n){if(n&&this.editingCancelled(e,i),!s)return;o&&(o.runPendingUpdates(),o.focus());const r=this.nodeInternal.attributes();for(let e=0;e<r.length;++e)if(r[e].name===i)return void("backward"===s?0===e?this.startEditingTagName():this.triggerEditAttribute(r[e-1].name):e===r.length-1?this.addNewAttribute():this.triggerEditAttribute(r[e+1].name));"backward"===s?" "===t?r.length>0&&this.triggerEditAttribute(r[r.length-1].name):r.length>1&&this.triggerEditAttribute(r[r.length-2].name):"forward"===s&&(p.StringUtilities.isWhitespace(t)?this.startEditingTagName():this.addNewAttribute())}!i.trim()&&!t.trim()||n===t?(this.updateTitle(),r.call(this)):this.nodeInternal.setAttribute(i,t,r.bind(this))}tagNameEditingCommitted(e,t,n,i,s){this.editing=null;const o=this;function r(){const t=o.distinctClosingTagElement();t&&(t.textContent="</"+i+">"),o.editingCancelled(e,i),l.call(o)}function l(){if("forward"!==s)return void this.addNewAttribute();const e=this.nodeInternal.attributes();e.length>0?this.triggerEditAttribute(e[0].name):this.addNewAttribute()}if((t=t.trim())===n)return void r();const a=this.treeOutline,d=this.expanded;this.nodeInternal.setNodeName(t,((e,t)=>{if(e||!t)return void r();if(!a)return;const n=a.selectNodeAfterEdit(d,e,t);l.call(n)}))}textNodeEditingCommitted(e,t,n){this.editing=null,e.setNodeValue(n,function(){this.updateTitle()}.bind(this))}editingCancelled(e,t){this.editing=null,this.updateTitle()}distinctClosingTagElement(){if(this.expanded){const e=this.childrenListElement.querySelectorAll(".close");return e[e.length-1]}const e=this.listItemElement.getElementsByClassName("webkit-html-tag");return 1===e.length?null:e[e.length-1]}updateTitle(e,t){if(!this.editing){if(t)this.hideSearchHighlight();else{const t=this.nodeTitleInfo(e||null);if(this.nodeInternal.nodeType()===Node.DOCUMENT_FRAGMENT_NODE&&this.nodeInternal.isInShadowTree()&&this.nodeInternal.shadowRootType()){this.childrenListElement.classList.add("shadow-root");let e=4;for(let t=this.nodeInternal;e&&t;t=t.parentNode)t.nodeType()===Node.DOCUMENT_FRAGMENT_NODE&&e--;e?this.childrenListElement.classList.add("shadow-root-depth-"+e):this.childrenListElement.classList.add("shadow-root-deep")}const n=document.createElement("span");n.className="highlight",n.appendChild(t),this.title=n,this.updateDecorations(),this.listItemElement.insertBefore(this.gutterContainer,this.listItemElement.firstChild),!this.isClosingTagInternal&&this.adornerContainer&&this.listItemElement.appendChild(this.adornerContainer),this.highlightResult=[],delete this.selectionElement,delete this.hintElement,this.selected&&(this.createSelection(),this.createHint())}this.highlightSearchResultsInternal()}}computeLeftIndent(){let e=this.parent,t=0;for(;null!==e;)t++,e=e.parent;return 12*(t-2)+(this.isExpandable()?1:12)}updateDecorations(){this.gutterContainer.style.left=-this.computeLeftIndent()+"px",this.isClosingTag()||this.nodeInternal.nodeType()===Node.ELEMENT_NODE&&this.decorationsThrottler.schedule(this.updateDecorationsInternal.bind(this))}updateDecorationsInternal(){if(!this.treeOutline)return Promise.resolve();const e=this.nodeInternal;this.treeOutline.decoratorExtensions||(this.treeOutline.decoratorExtensions=Vt());const t=new Map;for(const e of this.treeOutline.decoratorExtensions)t.set(e.marker,e);const n=[],s=[],o=[];function r(t,n){const i=n.decorate(t);i&&(t===e?s:o).push(i)}return e.traverseMarkers((function(e,i){const s=t.get(i);if(!s)return;n.push(Promise.resolve(s.decorator()).then(r.bind(null,e)))})),Promise.all(n).then(function(){if(this.decorationsElement.removeChildren(),this.decorationsElement.classList.add("hidden"),this.gutterContainer.classList.toggle("has-decorations",Boolean(s.length||o.length)),i.ARIAUtils.setAccessibleName(this.decorationsElement,""),!s.length&&!o.length)return;const e=new Set,t=document.createElement("div");for(const n of s){t.createChild("div").textContent=n.title,e.add(n.color)}if(this.expanded&&!s.length)return;const n=new Set;if(o.length){let e=t.createChild("div");e.textContent=jt(_t.children);for(const i of o)e=t.createChild("div"),e.style.marginLeft="15px",e.textContent=i.title,n.add(i.color)}let r=0;l.call(this,e,"elements-gutter-decoration"),this.expanded||l.call(this,n,"elements-gutter-decoration elements-has-decorated-children");function l(e,t){for(const n of e){const e=this.decorationsElement.createChild("div",t);this.decorationsElement.classList.remove("hidden"),e.style.backgroundColor=n,e.style.borderColor=n,r&&(e.style.marginLeft=r+"px"),r+=3}}i.Tooltip.Tooltip.install(this.decorationsElement,t.textContent),i.ARIAUtils.setAccessibleName(this.decorationsElement,t.textContent||"")}.bind(this))}buildAttributeDOM(e,t,n,s,o,r){const l=/[\/;:\)\]\}]/g;let d=0,h=0,c=0;function u(e,t){const n=this.convertWhitespaceToEntities(t);for(h=n.entityRanges.length,t=n.text.replace(l,((e,t)=>{for(;d<h&&n.entityRanges[d].offset<t;)n.entityRanges[d].offset+=c,++d;return c+=1,e+"​"}));d<h;)n.entityRanges[d].offset+=c,++d;e.setTextContentTruncatedIfNeeded(t),i.UIUtils.highlightRangesWithStyleClass(e,n.entityRanges,"webkit-html-entity-value")}const m=o||n.length>0,g=e.createChild("span","webkit-html-attribute"),y=g.createChild("span","webkit-html-attribute-name");y.textContent=t,m&&i.UIUtils.createTextChild(g,'=​"');const f=g.createChild("span","webkit-html-attribute-value");function S(e){const t=r?r.resolveURL(e):null;if(null===t){const t=document.createElement("span");return u.call(this,t,e),t}(e=e.replace(l,"$&​")).startsWith("data:")&&(e=p.StringUtilities.trimMiddle(e,60));const n=r&&"a"===r.nodeName().toLowerCase()?i.XLink.XLink.create(t,e,"",!0):a.Linkifier.Linkifier.linkifyURL(t,{text:e,preventClick:!0,className:void 0,lineNumber:void 0,columnNumber:void 0,showColumnNumber:!1,inlineFrameIndex:0,maxLength:void 0,tabStop:void 0,bypassURLTrimming:void 0});return U.setImageUrl(n,t)}s&&s.isAttributeModified(t)&&i.UIUtils.runCSSAnimationOnce(m?f:y,"dom-update-highlight");const b=r?r.nodeName().toLowerCase():"";function v(e){const t=document.createDocumentFragment();let n=0;for(;e.length;){n++>0&&i.UIUtils.createTextChild(t," ");let s="",o="";const r=(e=e.trim()).search(/\s/);if(-1===r)s=e;else if(r>0&&","===e[r-1])s=e.substring(0,r);else{s=e.substring(0,r);const t=e.indexOf(",",r);o=-1!==t?e.substring(r,t+1):e.substring(r)}s&&(s.endsWith(",")?(t.appendChild(S.call(this,s.substring(0,s.length-1))),i.UIUtils.createTextChild(t,",")):t.appendChild(S.call(this,s))),o&&i.UIUtils.createTextChild(t,o),e=e.substring(s.length+o.length)}return t}return!b||"src"!==t&&"href"!==t?("img"!==b&&"source"!==b||"srcset"!==t)&&("image"!==b||"xlink:href"!==t&&"href"!==t)?u.call(this,f,n):f.appendChild(v.call(this,n)):f.appendChild(S.call(this,n)),m&&i.UIUtils.createTextChild(g,'"'),g}buildPseudoElementDOM(e,t){e.createChild("span","webkit-html-pseudo-element").textContent="::"+t,i.UIUtils.createTextChild(e,"​")}buildTagDOM(e,t,n,s,o){const r=this.nodeInternal,l=["webkit-html-tag"];n&&s&&l.push("close");const a=e.createChild("span",l.join(" "));i.UIUtils.createTextChild(a,"<");const d=a.createChild("span",n?"webkit-html-close-tag-name":"webkit-html-tag-name");if(d.textContent=(n?"/":"")+t,!n){if(r.hasAttributes()){const e=r.attributes();for(let t=0;t<e.length;++t){const n=e[t];i.UIUtils.createTextChild(a," "),this.buildAttributeDOM(a,n.name,n.value,o,!1,r)}}if(o){let e=o.hasRemovedAttributes()||o.hasRemovedChildren();e=e||!this.expanded&&o.hasChangedChildren(),e&&i.UIUtils.runCSSAnimationOnce(d,"dom-update-highlight")}}i.UIUtils.createTextChild(a,">"),i.UIUtils.createTextChild(e,"​"),a.textContent&&i.ARIAUtils.setAccessibleName(a,a.textContent)}convertWhitespaceToEntities(e){let t="",n=0;const i=[],s=Nt;for(let o=0,r=e.length;o<r;++o){const r=e.charAt(o);if(s.has(r)){t+=e.substring(n,o);const l="&"+s.get(r)+";";i.push({offset:t.length,length:l.length}),t+=l,n=o+1}}return t&&(t+=e.substring(n)),{text:t||e,entityRanges:i}}nodeTitleInfo(e){const t=this.nodeInternal,n=document.createDocumentFragment(),s=()=>{this.highlightResult=[],this.highlightSearchResultsInternal()};switch(t.nodeType()){case Node.ATTRIBUTE_NODE:this.buildAttributeDOM(n,t.name,t.value,e,!0);break;case Node.ELEMENT_NODE:{const s=t.pseudoType();if(s){this.buildPseudoElementDOM(n,s);break}const o=t.nodeNameInCorrectCase();if(this.isClosingTagInternal){this.buildTagDOM(n,o,!0,!0,e);break}if(this.buildTagDOM(n,o,!1,!1,e),this.isExpandable()){if(!this.expanded){n.createChild("span","webkit-html-text-node bogus").textContent="…",i.UIUtils.createTextChild(n,"​"),this.buildTagDOM(n,o,!0,!1,e)}break}if(Kt.canShowInlineText(t)){const s=n.createChild("span","webkit-html-text-node"),r=t.firstChild;if(!r)throw new Error("ElementsTreeElement._nodeTitleInfo expects node.firstChild to be defined.");const l=this.convertWhitespaceToEntities(r.nodeValue());s.textContent=p.StringUtilities.collapseWhitespace(l.text),i.UIUtils.highlightRangesWithStyleClass(s,l.entityRanges,"webkit-html-entity-value"),i.UIUtils.createTextChild(n,"​"),this.buildTagDOM(n,o,!0,!1,e),e&&e.hasChangedChildren()&&i.UIUtils.runCSSAnimationOnce(s,"dom-update-highlight"),e&&e.isCharDataModified()&&i.UIUtils.runCSSAnimationOnce(s,"dom-update-highlight");break}(this.treeOutline&&this.treeOutline.isXMLMimeType||!qt.has(o))&&this.buildTagDOM(n,o,!0,!1,e);break}case Node.TEXT_NODE:if(t.parentNode&&"script"===t.parentNode.nodeName().toLowerCase()){const e=n.createChild("span","webkit-html-text-node webkit-html-js-node"),i=t.nodeValue();e.textContent=i.replace(/^[\n\r]+|\s+$/g,""),b.CodeHighlighter.highlightNode(e,"text/javascript").then(s)}else if(t.parentNode&&"style"===t.parentNode.nodeName().toLowerCase()){const e=n.createChild("span","webkit-html-text-node webkit-html-css-node"),i=t.nodeValue();e.textContent=i.replace(/^[\n\r]+|\s+$/g,""),b.CodeHighlighter.highlightNode(e,"text/css").then(s)}else{i.UIUtils.createTextChild(n,'"');const s=n.createChild("span","webkit-html-text-node"),o=this.convertWhitespaceToEntities(t.nodeValue());s.textContent=p.StringUtilities.collapseWhitespace(o.text),i.UIUtils.highlightRangesWithStyleClass(s,o.entityRanges,"webkit-html-entity-value"),i.UIUtils.createTextChild(n,'"'),e&&e.isCharDataModified()&&i.UIUtils.runCSSAnimationOnce(s,"dom-update-highlight")}break;case Node.COMMENT_NODE:{const e=n.createChild("span","webkit-html-comment");i.UIUtils.createTextChild(e,"\x3c!--"+t.nodeValue()+"--\x3e");break}case Node.DOCUMENT_TYPE_NODE:{const e=n.createChild("span","webkit-html-doctype");i.UIUtils.createTextChild(e,"<!DOCTYPE "+t.nodeName()),t.publicId?(i.UIUtils.createTextChild(e,' PUBLIC "'+t.publicId+'"'),t.systemId&&i.UIUtils.createTextChild(e,' "'+t.systemId+'"')):t.systemId&&i.UIUtils.createTextChild(e,' SYSTEM "'+t.systemId+'"'),t.internalSubset&&i.UIUtils.createTextChild(e," ["+t.internalSubset+"]"),i.UIUtils.createTextChild(e,">");break}case Node.CDATA_SECTION_NODE:{const e=n.createChild("span","webkit-html-text-node");i.UIUtils.createTextChild(e,"<![CDATA["+t.nodeValue()+"]]>");break}case Node.DOCUMENT_FRAGMENT_NODE:n.createChild("span","webkit-html-fragment").textContent=p.StringUtilities.collapseWhitespace(t.nodeNameInCorrectCase());break;default:{const e=p.StringUtilities.collapseWhitespace(t.nodeNameInCorrectCase());i.UIUtils.createTextChild(n,e)}}return n}remove(){if(this.nodeInternal.pseudoType())return;this.parent&&this.nodeInternal.parentNode&&this.nodeInternal.parentNode.nodeType()!==Node.DOCUMENT_NODE&&this.nodeInternal.removeNode()}toggleEditAsHTML(e,t){if(this.editing&&this.htmlEditElement)return void this.editing.commit();if(!1===t)return;function n(t){e&&e(!t)}const i=this.nodeInternal;i.getOuterHTML().then(this.startEditingAsHTML.bind(this,(function(e,t){e!==t&&i.setOuterHTML(t,n)}),(function(){e&&e(!1)})))}copyCSSPath(){s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(pt(this.nodeInternal,!0))}copyJSPath(){s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(mt(this.nodeInternal,!0))}copyXPath(){s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(yt(this.nodeInternal,!0))}copyFullXPath(){s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(yt(this.nodeInternal,!1))}async copyStyles(){const t=this.nodeInternal,i=t.domModel().cssModel(),o=await i.cachedMatchedCascadeForNode(t);if(!o)return;const r=e.Settings.Settings.instance().moduleSetting("textEditorIndent").get(),l=[];for(const e of o.nodeStyles().reverse())for(const t of e.leadingProperties())t.parsedOk&&!t.disabled&&t.activeInStyle()&&!t.implicit&&(o.isInherited(e)&&!n.CSSMetadata.cssMetadata().isPropertyInherited(t.name)||e.parentRule&&e.parentRule.isUserAgent()||o.propertyState(t)===n.CSSMatchedStyles.PropertyState.Active&&l.push(`${r}${t.name}: ${t.value};`));s.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(l.join("\n"))}highlightSearchResultsInternal(){if(!this.searchQuery||!this.searchHighlightsVisible)return;this.hideSearchHighlight();const e=this.listItemElement.textContent||"",t=createPlainTextSearchRegex(this.searchQuery,"gi");let n=t.exec(e);const s=[];for(;n;)s.push(new g.TextRange.SourceRange(n.index,n[0].length)),n=t.exec(e);s.length||s.push(new g.TextRange.SourceRange(0,e.length)),this.highlightResult=[],i.UIUtils.highlightSearchResults(this.listItemElement,s,this.highlightResult)}editAsHTML(){e.Revealer.reveal(this.node()).then((()=>{const e=i.ActionRegistry.ActionRegistry.instance().action("elements.edit-as-html");if(e)return e.execute()}))}adorn({name:e}){const t=document.createElement("span");t.textContent=e;const n=new S.Adorner.Adorner;return n.data={name:e,content:t},this.adorners.push(n),an.instance().registerAdorner(n),this.updateAdorners(),n}removeAdorner(e){const t=this.adorners;an.instance().deregisterAdorner(e),e.remove();for(let n=0;n<t.length;++n)if(t[n]===e)return t.splice(n,1),void this.updateAdorners()}removeAllAdorners(){for(const e of this.adorners)an.instance().deregisterAdorner(e),e.remove();this.adorners=[],this.updateAdorners()}updateAdorners(){this.adornersThrottler.schedule(this.updateAdornersInternal.bind(this))}updateAdornersInternal(){const e=this.adornerContainer;if(!e)return Promise.resolve();const t=this.adorners;if(0===t.length)return e.classList.add("hidden"),Promise.resolve();t.sort(Qt),e.removeChildren();for(const n of t)e.appendChild(n);return e.classList.remove("hidden"),Promise.resolve()}async updateStyleAdorners(){if(this.isClosingTagInternal)return;const e=this.node(),t=e.id;if(e.nodeType()===Node.COMMENT_NODE||e.nodeType()===Node.DOCUMENT_FRAGMENT_NODE||e.nodeType()===Node.TEXT_NODE||void 0===t)return;const i=await e.domModel().cssModel().computedStylePromise(t);for(const e of this.styleAdorners)this.removeAdorner(e);if(this.styleAdorners=[],!i)return;const s=i.get("display"),o="grid"===s||"inline-grid"===s,r="flex"===s||"inline-flex"===s,l=i.get("container-type"),a=i.get("contain"),d=""!==n.CSSContainerQuery.getQueryAxis(`${l} ${a}`),h=e=>{e&&this.styleAdorners.push(e)};o&&h(this.createGridAdorner()),r&&h(this.createFlexAdorner()),i.get("scroll-snap-type")&&"none"!==i.get("scroll-snap-type")&&h(this.createScrollSnapAdorner()),d&&h(this.createContainerAdorner())}createGridAdorner(){const e=this.node(),t=e.id;if(!t)return null;const i=h.AdornerManager.getRegisteredAdorner(h.AdornerManager.RegisteredAdorners.GRID),s=this.adorn(i);s.classList.add("grid");return s.addInteraction((()=>{s.isActive()?e.domModel().overlayModel().highlightGridInPersistentOverlay(t):e.domModel().overlayModel().hideGridInPersistentOverlay(t)}),{isToggle:!0,shouldPropagateOnKeydown:!1,ariaLabelDefault:jt(_t.enableGridMode),ariaLabelActive:jt(_t.disableGridMode)}),e.domModel().overlayModel().addEventListener(n.OverlayModel.Events.PersistentGridOverlayStateChanged,(e=>{const{nodeId:n,enabled:i}=e.data;n===t&&s.toggle(i)})),s}createScrollSnapAdorner(){const e=this.node(),t=e.id;if(!t)return null;const i=h.AdornerManager.getRegisteredAdorner(h.AdornerManager.RegisteredAdorners.SCROLL_SNAP),s=this.adorn(i);s.classList.add("scroll-snap");return s.addInteraction((()=>{const n=e.domModel().overlayModel();s.isActive()?n.highlightScrollSnapInPersistentOverlay(t):n.hideScrollSnapInPersistentOverlay(t)}),{isToggle:!0,shouldPropagateOnKeydown:!1,ariaLabelDefault:jt(_t.enableScrollSnap),ariaLabelActive:jt(_t.disableScrollSnap)}),e.domModel().overlayModel().addEventListener(n.OverlayModel.Events.PersistentScrollSnapOverlayStateChanged,(e=>{const{nodeId:n,enabled:i}=e.data;n===t&&s.toggle(i)})),s}createFlexAdorner(){const e=this.node(),t=e.id;if(!t)return null;const i=h.AdornerManager.getRegisteredAdorner(h.AdornerManager.RegisteredAdorners.FLEX),s=this.adorn(i);s.classList.add("flex");return s.addInteraction((()=>{const n=e.domModel().overlayModel();s.isActive()?n.highlightFlexContainerInPersistentOverlay(t):n.hideFlexContainerInPersistentOverlay(t)}),{isToggle:!0,shouldPropagateOnKeydown:!1,ariaLabelDefault:jt(_t.enableFlexMode),ariaLabelActive:jt(_t.disableFlexMode)}),e.domModel().overlayModel().addEventListener(n.OverlayModel.Events.PersistentFlexContainerOverlayStateChanged,(e=>{const{nodeId:n,enabled:i}=e.data;n===t&&s.toggle(i)})),s}createContainerAdorner(){const e=this.node(),t=e.id;if(!t)return null;const i=h.AdornerManager.getRegisteredAdorner(h.AdornerManager.RegisteredAdorners.CONTAINER),s=this.adorn(i);s.classList.add("container");return s.addInteraction((()=>{const n=e.domModel().overlayModel();s.isActive()?n.highlightContainerQueryInPersistentOverlay(t):n.hideContainerQueryInPersistentOverlay(t)}),{isToggle:!0,shouldPropagateOnKeydown:!1,ariaLabelDefault:jt(_t.enableScrollSnap),ariaLabelActive:jt(_t.disableScrollSnap)}),e.domModel().overlayModel().addEventListener(n.OverlayModel.Events.PersistentContainerQueryOverlayStateChanged,(e=>{const{nodeId:n,enabled:i}=e.data;n===t&&s.toggle(i)})),s}}const Gt=500,qt=new Set(["area","base","basefont","br","canvas","col","command","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),$t=new Set(["html","head","body"]);function Qt(e,t){const n=h.AdornerManager.compareAdornerNamesByCategory(t.name,t.name);return 0===n?e.name.localeCompare(t.name):n}var Xt=Object.freeze({__proto__:null,ElementsTreeElement:Kt,InitialChildrenLimit:Gt,ForbiddenClosingTagElements:qt,EditTagBlocklist:$t,adornerComparator:Qt});class Jt{throttler;treeOutline;currentHighlightedElement;alreadyExpandedParentElement;pendingHighlightNode;isModifyingTreeOutline;constructor(t){this.throttler=new e.Throttler.Throttler(100),this.treeOutline=t,this.treeOutline.addEventListener(i.TreeOutline.Events.ElementExpanded,this.clearState,this),this.treeOutline.addEventListener(i.TreeOutline.Events.ElementCollapsed,this.clearState,this),this.treeOutline.addEventListener(It.Events.SelectedNodeChanged,this.clearState,this),n.TargetManager.TargetManager.instance().addModelListener(n.OverlayModel.OverlayModel,n.OverlayModel.Events.HighlightNodeRequested,this.highlightNode,this),n.TargetManager.TargetManager.instance().addModelListener(n.OverlayModel.OverlayModel,n.OverlayModel.Events.InspectModeWillBeToggled,this.clearState,this),this.currentHighlightedElement=null,this.alreadyExpandedParentElement=null,this.pendingHighlightNode=null,this.isModifyingTreeOutline=!1}highlightNode(t){if(!e.Settings.Settings.instance().moduleSetting("highlightNodeOnHoverInOverlay").get())return;const n=t.data;this.throttler.schedule((async()=>{this.highlightNodeInternal(this.pendingHighlightNode),this.pendingHighlightNode=null})),this.pendingHighlightNode=this.treeOutline===It.forDOMModel(n.domModel())?n:null}highlightNodeInternal(e){this.isModifyingTreeOutline=!0;let t=null;if(this.currentHighlightedElement){let e=this.currentHighlightedElement;for(;e&&e!==this.alreadyExpandedParentElement;){e.expanded&&e.collapse();const t=e.parent;e=t instanceof Kt?t:null}}if(this.currentHighlightedElement=null,this.alreadyExpandedParentElement=null,e){let n=e;const i=this.treeOutline.treeElementByNode,s=e=>{const t=i.get(e);return!t||!t.expanded};for(;n&&s(n);)n=n.parentNode;this.alreadyExpandedParentElement=n?i.get(n):this.treeOutline.rootElement(),t=this.treeOutline.createTreeElementFor(e)}this.currentHighlightedElement=t,this.treeOutline.setHoverEffect(t),t&&t.reveal(!0),this.isModifyingTreeOutline=!1}clearState(){this.isModifyingTreeOutline||(this.currentHighlightedElement=null,this.alreadyExpandedParentElement=null,this.pendingHighlightNode=null)}}var Yt=Object.freeze({__proto__:null,ElementsTreeElementHighlighter:Jt});const Zt=new CSSStyleSheet;Zt.replaceSync(".metrics{padding:8px;font-size:10px;text-align:center;white-space:nowrap;min-height:var(--metrics-height);display:flex;flex-direction:column;align-items:center;justify-content:center;--override-box-model-separator-color:#000;--override-box-model-text-color:#222}:host{--metrics-height:190px;height:var(--metrics-height);contain:strict}:host(.invisible){visibility:hidden;height:0}:host(.collapsed){visibility:collapse;height:0}:host-context(.platform-windows){--metrics-height:214px}.metrics .label{position:absolute;font-size:10px;left:4px}.metrics .position{border:1px var(--color-text-secondary) dotted;background-color:var(--color-background);display:inline-block;text-align:center;padding:3px;margin:3px;position:relative}.metrics .margin{border:1px dashed var(--override-box-model-separator-color);background-color:var(--color-background);display:inline-block;text-align:center;vertical-align:middle;padding:3px 6px;margin:3px;position:relative}.metrics .border{border:1px solid var(--override-box-model-separator-color);background-color:var(--color-background);display:inline-block;text-align:center;vertical-align:middle;padding:3px 6px;margin:3px;position:relative}.metrics .padding{border:1px dashed var(--override-box-model-separator-color);background-color:var(--color-background);display:inline-block;text-align:center;vertical-align:middle;padding:3px 6px;margin:3px;position:relative;min-width:120px}.metrics .content{position:static;border:1px solid var(--override-box-model-separator-color);background-color:var(--color-background);display:inline-block;text-align:center;vertical-align:middle;padding:3px;margin:3px;min-width:80px;overflow:visible}.metrics .content span{display:inline-block}.metrics .editing{position:relative;z-index:100;cursor:text}.metrics .left{display:inline-block;vertical-align:middle}.metrics .right{display:inline-block;vertical-align:middle}.metrics .top{display:inline-block}.metrics .bottom{display:inline-block}:host-context(.-theme-with-dark-background) .margin:hover,:host-context(.-theme-with-dark-background) .margin:hover *{border-color:var(--color-text-secondary)}.metrics .highlighted:not(.position)>:not(.border):not(.padding):not(.content){color:var(--override-box-model-text-color)}\n/*# sourceURL=metricsSidebarPane.css */\n");class en extends me{originalPropertyData;previousPropertyDataCandidate;inlineStyle;highlightMode;boxElements;isEditingMetrics;constructor(){super(),this.originalPropertyData=null,this.previousPropertyDataCandidate=null,this.inlineStyle=null,this.highlightMode="",this.boxElements=[]}doUpdate(){if(this.isEditingMetrics)return Promise.resolve();const e=this.node(),t=this.cssModel();if(!e||e.nodeType()!==Node.ELEMENT_NODE||!t)return this.contentElement.removeChildren(),this.element.classList.add("collapsed"),Promise.resolve();if(!e.id)return Promise.resolve();const n=[t.computedStylePromise(e.id).then(function(t){t&&this.node()===e&&this.updateMetrics(t)}.bind(this)),t.inlineStylesPromise(e.id).then((t=>{t&&this.node()===e&&(this.inlineStyle=t.inlineStyle)}))];return Promise.all(n)}onCSSModelChanged(){this.update()}toggleVisibility(e){this.element.classList.toggle("invisible",!e)}getPropertyValueAsPx(e,t){const n=e.get(t);return n?Number(n.replace(/px$/,"")||0):0}getBox(e,t){const n="border"===t?"-width":"";return{left:this.getPropertyValueAsPx(e,t+"-left"+n),top:this.getPropertyValueAsPx(e,t+"-top"+n),right:this.getPropertyValueAsPx(e,t+"-right"+n),bottom:this.getPropertyValueAsPx(e,t+"-bottom"+n)}}highlightDOMNode(e,t,i){i.consume();const s=this.node();if(e&&s){if(this.highlightMode===t)return;this.highlightMode=t,s.highlight(t)}else this.highlightMode="",n.OverlayModel.OverlayModel.hideDOMNodeHighlight();for(const{element:e,name:n,backgroundColor:i}of this.boxElements){const o=!s||"all"===t||n===t;e.style.backgroundColor=o?i:"",e.classList.toggle("highlighted",o)}}updateMetrics(t){const n=document.createElement("div");n.className="metrics";const i=this;function s(e,t,n,i){const s=document.createElement("div");s.className=n;const o=("position"!==t?t+"-":"")+n+i;let r=e.get(o);return void 0===r||((""===r||"position"!==t&&"0px"===r||"position"===t&&"auto"===r)&&(r="‒"),r=r.replace(/px$/,""),r=p.NumberUtilities.toFixedIfFloating(r),s.textContent=r,s.addEventListener("dblclick",this.startEditing.bind(this,s,t,o,e),!1)),s}function o(e){let t=e.get("width");if(!t)return"";t=t.replace(/px$/,"");const n=Number(t);if(!isNaN(n)&&"border-box"===e.get("box-sizing")){const s=i.getBox(e,"border"),o=i.getBox(e,"padding");t=(n-s.left-s.right-o.left-o.right).toString()}return p.NumberUtilities.toFixedIfFloating(t)}function r(e){let t=e.get("height");if(!t)return"";t=t.replace(/px$/,"");const n=Number(t);if(!isNaN(n)&&"border-box"===e.get("box-sizing")){const s=i.getBox(e,"border"),o=i.getBox(e,"padding");t=(n-s.top-s.bottom-o.top-o.bottom).toString()}return p.NumberUtilities.toFixedIfFloating(t)}const l=new Set(["table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group"]),a=new Set(["table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group"]),d=new Set(["static"]),h=["content","padding","border","margin","position"],c=[e.Color.PageHighlight.Content,e.Color.PageHighlight.Padding,e.Color.PageHighlight.Border,e.Color.PageHighlight.Margin,e.Color.Color.fromRGBA([0,0,0,0])],u=["content","padding","border","margin","position"];let m=null;this.boxElements=[];for(let n=0;n<h.length;++n){const i=h[n],p=t.get("display"),g=t.get("position");if(!p||!g)continue;if("margin"===i&&l.has(p))continue;if("padding"===i&&a.has(p))continue;if("position"===i&&d.has(g))continue;const y=document.createElement("div");y.className=`${i} highlighted`;const f=c[n].asString(e.Color.Format.RGBA)||"";if(y.style.backgroundColor=f,y.addEventListener("mouseover",this.highlightDOMNode.bind(this,!0,"position"===i?"all":i),!1),this.boxElements.push({element:y,name:i,backgroundColor:f}),"content"===i){const e=document.createElement("span");e.textContent=o(t),e.addEventListener("dblclick",this.startEditing.bind(this,e,"width","width",t),!1);const n=document.createElement("span");n.textContent=r(t),n.addEventListener("dblclick",this.startEditing.bind(this,n,"height","height",t),!1);const i=document.createElement("span");i.textContent=" × ",y.appendChild(e),y.appendChild(i),y.appendChild(n)}else{const e="border"===i?"-width":"",o=document.createElement("div");o.className="label",o.textContent=u[n],y.appendChild(o),y.appendChild(s.call(this,t,i,"top",e)),y.appendChild(document.createElement("br")),y.appendChild(s.call(this,t,i,"left",e)),m&&y.appendChild(m),y.appendChild(s.call(this,t,i,"right",e)),y.appendChild(document.createElement("br")),y.appendChild(s.call(this,t,i,"bottom",e))}m=y}n.appendChild(m),n.addEventListener("mouseover",this.highlightDOMNode.bind(this,!1,"all"),!1),n.addEventListener("mouseleave",this.highlightDOMNode.bind(this,!1,"all"),!1),this.contentElement.removeChildren(),this.contentElement.appendChild(n),this.element.classList.remove("collapsed")}startEditing(e,t,n,s){if(i.UIUtils.isBeingEdited(e))return;const o={box:t,styleProperty:n,computedStyle:s,keyDownHandler:()=>{}},r=this.handleKeyDown.bind(this,o);o.keyDownHandler=r,e.addEventListener("keydown",r,!1),this.isEditingMetrics=!0;const l=new i.InplaceEditor.Config(this.editingCommitted.bind(this),this.editingCancelled.bind(this),o);i.InplaceEditor.InplaceEditor.startEditing(e,l);const a=e.getComponentSelection();a&&a.selectAllChildren(e)}handleKeyDown(e,t){const n=t.currentTarget;i.UIUtils.handleElementValueModifications(t,n,function(t,i){this.applyUserInput(n,i,t,e,!1)}.bind(this),void 0,(function(t,n,i){return"margin"!==e.styleProperty&&n<0&&(n=0),t+n+i}))}editingEnded(e,t){this.originalPropertyData=null,this.previousPropertyDataCandidate=null,e.removeEventListener("keydown",t.keyDownHandler,!1),delete this.isEditingMetrics}editingCancelled(e,t){if(this.inlineStyle)if(this.originalPropertyData)this.inlineStyle.allProperties()[this.originalPropertyData.index].setText(this.originalPropertyData.propertyText||"",!1);else{const e=this.inlineStyle.pastLastSourcePropertyIndex();e&&this.inlineStyle.allProperties()[e-1].setText("",!1)}this.editingEnded(e,t),this.update()}applyUserInput(t,n,i,s,o){if(!this.inlineStyle)return this.editingCancelled(t,s);if(o&&n===i)return this.editingCancelled(t,s);"position"===s.box||n&&"‒"!==n?"position"!==s.box||n&&"‒"!==n||(n="auto"):n="0px",n=n.toLowerCase(),/^\d+$/.test(n)&&(n+="px");const r=s.styleProperty,l=s.computedStyle;if("border-box"===l.get("box-sizing")&&("width"===r||"height"===r)){if(!n.match(/px$/))return void e.Console.Console.instance().error("For elements with box-sizing: border-box, only absolute content area dimensions can be applied");const t=this.getBox(l,"border"),i=this.getBox(l,"padding");let s=Number(n.replace(/px$/,""));if(isNaN(s))return;s+="width"===r?t.left+t.right+i.left+i.right:t.top+t.bottom+i.top+i.bottom,n=s+"px"}this.previousPropertyDataCandidate=null;const a=this.inlineStyle.allProperties();for(let e=0;e<a.length;++e){const t=a[e];if(t.name===s.styleProperty&&t.activeInStyle())return this.previousPropertyDataCandidate=t,void t.setValue(n,o,!0,d.bind(this))}function d(e){if(e){if(this.originalPropertyData||(this.originalPropertyData=this.previousPropertyDataCandidate),this.highlightMode){const e=this.node();if(!e)return;e.highlight(this.highlightMode)}o&&this.update()}}this.inlineStyle.appendProperty(s.styleProperty,n,d.bind(this))}editingCommitted(e,t,n,i){this.editingEnded(e,i),this.applyUserInput(e,t,n,i,!0)}wasShown(){super.wasShown(),this.registerCSSFiles([Zt])}}var tn=Object.freeze({__proto__:null,MetricsSidebarPane:en});const nn={findByStringSelectorOrXpath:"Find by string, selector, or `XPath`",switchToAccessibilityTreeView:"Switch to Accessibility Tree view",switchToDomTreeView:"Switch to DOM Tree view",frame:"Frame",showComputedStylesSidebar:"Show Computed Styles sidebar",hideComputedStylesSidebar:"Hide Computed Styles sidebar",computed:"Computed",styles:"Styles",revealInElementsPanel:"Reveal in Elements panel",nodeCannotBeFoundInTheCurrent:"Node cannot be found in the current page.",theRemoteObjectCouldNotBe:"The remote object could not be resolved to a valid node.",theDeferredDomNodeCouldNotBe:"The deferred `DOM` Node could not be resolved to a valid node.",elementStateS:"Element state: {PH1}",sidePanelToolbar:"Side panel toolbar",sidePanelContent:"Side panel content",domTreeExplorer:"DOM tree explorer"},sn=o.i18n.registerUIStrings("panels/elements/ElementsPanel.ts",nn),on=o.i18n.getLocalizedString.bind(void 0,sn),rn=e=>{const t=document.createElement("button");e?t.classList.add("axtree-button","axtree-button-active"):t.classList.add("axtree-button"),t.tabIndex=0,t.title=on(e?nn.switchToDomTreeView:nn.switchToAccessibilityTreeView);const n=new l.Icon.Icon,i=e?"var(--color-primary)":"var(--color-text-secondary)";return n.data={iconName:"accessibility-icon",color:i,width:"16px",height:"16px"},t.appendChild(n),t};let ln;class an extends i.Panel.Panel{splitWidget;searchableViewInternal;contentElementInternal;splitMode;accessibilityTreeView;breadcrumbs;stylesWidget;computedStyleWidget;metricsWidget;treeOutlines=new Set;treeOutlineHeaders=new Map;searchResults;currentSearchResultIndex;pendingNodeReveal;adornerManager;adornerSettingsPane;adornersByName;accessibilityTreeButton;domTreeButton;selectedNodeOnReset;hasNonDefaultSelectedNode;searchConfig;omitDefaultSelection;notFirstInspectElement;sidebarPaneView;stylesViewToReveal;cssStyleTrackerByCSSModel;constructor(){super("elements"),this.splitWidget=new i.SplitWidget.SplitWidget(!0,!0,"elementsPanelSplitViewState",325,325),this.splitWidget.addEventListener(i.SplitWidget.Events.SidebarSizeChanged,this.updateTreeOutlineVisibleWidth.bind(this)),this.splitWidget.show(this.element),this.searchableViewInternal=new i.SearchableView.SearchableView(this,null),this.searchableViewInternal.setMinimumSize(25,28),this.searchableViewInternal.setPlaceholder(on(nn.findByStringSelectorOrXpath));const s=this.searchableViewInternal.element;this.contentElementInternal=document.createElement("div");const o=document.createElement("div");t.Runtime.experiments.isEnabled("fullAccessibilityTree")&&this.initializeFullAccessibilityTreeView(s),s.appendChild(this.contentElementInternal),s.appendChild(o),i.ARIAUtils.markAsMain(this.contentElementInternal),i.ARIAUtils.setAccessibleName(this.contentElementInternal,on(nn.domTreeExplorer)),this.splitWidget.setMainWidget(this.searchableViewInternal),this.splitMode=null,this.contentElementInternal.id="elements-content",e.Settings.Settings.instance().moduleSetting("domWordWrap").get()&&this.contentElementInternal.classList.add("elements-wrap"),e.Settings.Settings.instance().moduleSetting("domWordWrap").addChangeListener(this.domWordWrapSettingChanged.bind(this)),o.id="elements-crumbs",this.domTreeButton&&(this.accessibilityTreeView=new k(this.domTreeButton)),this.breadcrumbs=new h.ElementsBreadcrumbs.ElementsBreadcrumbs,this.breadcrumbs.addEventListener("breadcrumbsnodeselected",(e=>{this.crumbNodeSelected(e)})),o.appendChild(this.breadcrumbs),this.stylesWidget=We.instance(),this.computedStyleWidget=new at,this.metricsWidget=new en,e.Settings.Settings.instance().moduleSetting("sidebarPosition").addChangeListener(this.updateSidebarPosition.bind(this)),this.updateSidebarPosition(),this.cssStyleTrackerByCSSModel=new Map,n.TargetManager.TargetManager.instance().observeModels(n.DOMModel.DOMModel,this),n.TargetManager.TargetManager.instance().addEventListener(n.TargetManager.Events.NameChanged,(e=>this.targetNameChanged(e.data))),e.Settings.Settings.instance().moduleSetting("showUAShadowDOM").addChangeListener(this.showUAShadowDOMChanged.bind(this)),n.TargetManager.TargetManager.instance().addModelListener(n.DOMModel.DOMModel,n.DOMModel.Events.DocumentUpdated,this.documentUpdatedEvent,this),r.ExtensionServer.ExtensionServer.instance().addEventListener(r.ExtensionServer.Events.SidebarPaneAdded,this.extensionSidebarPaneAdded,this),this.currentSearchResultIndex=-1,this.pendingNodeReveal=!1,this.adornerManager=new h.AdornerManager.AdornerManager(e.Settings.Settings.instance().moduleSetting("adornerSettings")),this.adornerSettingsPane=null,this.adornersByName=new Map}initializeFullAccessibilityTreeView(e){this.accessibilityTreeButton=rn(!1),this.accessibilityTreeButton.addEventListener("click",this.showAccessibilityTree.bind(this)),this.domTreeButton=rn(!0),this.domTreeButton.addEventListener("click",this.showDOMTree.bind(this)),e.appendChild(this.accessibilityTreeButton)}showAccessibilityTree(){this.accessibilityTreeView&&this.splitWidget.setMainWidget(this.accessibilityTreeView)}showDOMTree(){this.splitWidget.setMainWidget(this.searchableViewInternal)}static instance(e={forceNew:null}){const{forceNew:t}=e;return ln&&!t||(ln=new an),ln}revealProperty(e){return this.sidebarPaneView&&this.stylesViewToReveal?this.sidebarPaneView.showView(this.stylesViewToReveal).then((()=>{this.stylesWidget.revealProperty(e)})):Promise.resolve()}resolveLocation(e){return this.sidebarPaneView||null}showToolbarPane(e,t){this.stylesWidget.showToolbarPane(e,t)}modelAdded(t){const n=t.parentModel();let i=n?It.forDOMModel(n):null;if(!i&&(i=new It(!0,!0),i.setWordWrap(e.Settings.Settings.instance().moduleSetting("domWordWrap").get()),i.addEventListener(It.Events.SelectedNodeChanged,this.selectedNodeChanged,this),i.addEventListener(It.Events.ElementsTreeUpdated,this.updateBreadcrumbIfNeeded,this),new Jt(i),this.treeOutlines.add(i),t.target().parentTarget())){const e=document.createElement("div");e.classList.add("elements-tree-header"),this.treeOutlineHeaders.set(i,e),this.targetNameChanged(t.target())}i.wireToDOMModel(t),this.setupStyleTracking(t.cssModel()),this.isShowing()&&this.wasShown()}modelRemoved(e){const t=It.forDOMModel(e);if(!t)return;if(t.unwireFromDOMModel(e),e.parentModel())return;this.treeOutlines.delete(t);const n=this.treeOutlineHeaders.get(t);n&&n.remove(),this.treeOutlineHeaders.delete(t),t.element.remove(),this.removeStyleTracking(e.cssModel())}targetNameChanged(e){const t=e.model(n.DOMModel.DOMModel);if(!t)return;const i=It.forDOMModel(t);if(!i)return;const s=this.treeOutlineHeaders.get(i);s&&(s.removeChildren(),s.createChild("div","elements-tree-header-frame").textContent=on(nn.frame),s.appendChild(a.Linkifier.Linkifier.linkifyURL(e.inspectedURL(),{text:e.name()})))}updateTreeOutlineVisibleWidth(){if(!this.treeOutlines.size)return;let e=this.splitWidget.element.offsetWidth;this.splitWidget.isVertical()&&(e-=this.splitWidget.sidebarSize());for(const t of this.treeOutlines)t.setVisibleWidth(e)}focus(){this.treeOutlines.size&&this.treeOutlines.values().next().value.focus()}searchableView(){return this.searchableViewInternal}wasShown(){super.wasShown(),i.Context.Context.instance().setFlavor(an,this),this.registerCSSFiles([x]);for(const e of this.treeOutlines)if(e.element.parentElement!==this.contentElementInternal){const t=this.treeOutlineHeaders.get(e);t&&this.contentElementInternal.appendChild(t),this.contentElementInternal.appendChild(e.element)}const e=n.TargetManager.TargetManager.instance().models(n.DOMModel.DOMModel);for(const t of e){if(t.parentModel())continue;const e=It.forDOMModel(t);e&&(e.setVisible(!0),e.rootDOMNode||(t.existingDocument()?(e.rootDOMNode=t.existingDocument(),this.documentUpdated(t)):t.requestDocument()))}}willHide(){n.OverlayModel.OverlayModel.hideDOMNodeHighlight();for(const e of this.treeOutlines){e.setVisible(!1),this.contentElementInternal.removeChild(e.element);const t=this.treeOutlineHeaders.get(e);t&&this.contentElementInternal.removeChild(t)}super.willHide(),i.Context.Context.instance().setFlavor(an,null)}onResize(){this.element.window().requestAnimationFrame(this.updateSidebarPosition.bind(this)),this.updateTreeOutlineVisibleWidth()}selectedNodeChanged(e){let t=e.data.node;t&&t.pseudoType()&&!t.parentNode&&(t=null);const{focus:s}=e.data;for(const e of this.treeOutlines)t&&It.forDOMModel(t.domModel())===e||e.selectDOMNode(null);if(t){const e=[h.Helper.legacyNodeToElementsComponentsNode(t)];for(let n=t.parentNode;n;n=n.parentNode)e.push(h.Helper.legacyNodeToElementsComponentsNode(n));this.breadcrumbs.data={crumbs:e,selectedNode:h.Helper.legacyNodeToElementsComponentsNode(t)},this.accessibilityTreeView&&this.accessibilityTreeView.selectedNodeChanged(t)}else this.breadcrumbs.data={crumbs:[],selectedNode:null};if(i.Context.Context.instance().setFlavor(n.DOMModel.DOMNode,t),!t)return;t.setAsInspectedNode(),s&&(this.selectedNodeOnReset=t,this.hasNonDefaultSelectedNode=!0);const o=t.domModel().runtimeModel().executionContexts(),r=t.frameId();for(const e of o)if(e.frameId===r){i.Context.Context.instance().setFlavor(n.RuntimeModel.ExecutionContext,e);break}}documentUpdatedEvent(e){const t=e.data;this.documentUpdated(t),this.removeStyleTracking(t.cssModel()),this.setupStyleTracking(t.cssModel())}documentUpdated(e){if(this.searchableViewInternal.resetSearch(),!e.existingDocument())return void(this.isShowing()&&e.requestDocument());if(this.hasNonDefaultSelectedNode=!1,this.omitDefaultSelection)return;const t=this.selectedNodeOnReset;(async function(e,n){const i=n?n.path():null,s=i?await e.pushNodeByPathToFrontend(i):null;if(t!==this.selectedNodeOnReset)return;let o=s?e.nodeForId(s):null;if(!o){const t=e.existingDocument();o=t?t.body||t.documentElement:null}o&&(this.setDefaultSelectedNode(o),this.lastSelectedNodeSelectedForTest())}).call(this,e,this.selectedNodeOnReset||null)}lastSelectedNodeSelectedForTest(){}setDefaultSelectedNode(e){if(!e||this.hasNonDefaultSelectedNode||this.pendingNodeReveal)return;const t=It.forDOMModel(e.domModel());t&&(this.selectDOMNode(e),t.selectedTreeElement&&t.selectedTreeElement.expand())}searchCanceled(){this.searchConfig=void 0,this.hideSearchHighlights(),this.searchableViewInternal.updateSearchMatchesCount(0),this.currentSearchResultIndex=-1,delete this.searchResults,n.DOMModel.DOMModel.cancelSearch()}performSearch(t,i,s){const o=t.query,r=o.trim();if(!r.length)return;this.searchConfig&&this.searchConfig.query===o?this.hideSearchHighlights():this.searchCanceled(),this.searchConfig=t;const l=e.Settings.Settings.instance().moduleSetting("showUAShadowDOM").get(),a=n.TargetManager.TargetManager.instance().models(n.DOMModel.DOMModel),d=a.map((e=>e.performSearch(r,l)));Promise.all(d).then((e=>{this.searchResults=[];for(let t=0;t<e.length;++t){const n=e[t];for(let e=0;e<n;++e)this.searchResults.push({domModel:a[t],index:e,node:void 0})}if(this.searchableViewInternal.updateSearchMatchesCount(this.searchResults.length),!this.searchResults.length)return;this.currentSearchResultIndex>=this.searchResults.length&&(this.currentSearchResultIndex=-1);let t=this.currentSearchResultIndex;i&&(t=-1===this.currentSearchResultIndex?s?-1:0:s?t-1:t+1,this.jumpToSearchResult(t))}))}domWordWrapSettingChanged(e){this.contentElementInternal.classList.toggle("elements-wrap",e.data);for(const t of this.treeOutlines)t.setWordWrap(e.data)}switchToAndFocus(e){this.searchableViewInternal.cancelSearch(),i.ViewManager.ViewManager.instance().showView("elements").then((()=>this.selectDOMNode(e,!0)))}jumpToSearchResult(e){this.searchResults&&(this.currentSearchResultIndex=(e+this.searchResults.length)%this.searchResults.length,this.highlightCurrentSearchResult())}jumpToNextSearchResult(){this.searchResults&&this.searchConfig&&this.performSearch(this.searchConfig,!0)}jumpToPreviousSearchResult(){this.searchResults&&this.searchConfig&&this.performSearch(this.searchConfig,!0,!0)}supportsCaseSensitiveSearch(){return!1}supportsRegexSearch(){return!1}highlightCurrentSearchResult(){const e=this.currentSearchResultIndex,t=this.searchResults;if(!t)return;const n=t[e];if(this.searchableViewInternal.updateCurrentMatchIndex(e),null===n.node)return;if(void 0===n.node)return void n.domModel.searchResult(n.index).then((e=>{n.node=e;this.searchConfig&&this.searchResults&&-1!==this.currentSearchResultIndex&&this.highlightCurrentSearchResult()}));const s=this.treeElementForNode(n.node);if(n.node.scrollIntoView(),s){this.searchConfig&&s.highlightSearchResults(this.searchConfig.query),s.reveal();const e=s.listItemElement.getElementsByClassName(i.UIUtils.highlightedSearchResultClassName);e.length&&e[0].scrollIntoViewIfNeeded(!1)}}hideSearchHighlights(){if(!this.searchResults||!this.searchResults.length||-1===this.currentSearchResultIndex)return;const e=this.searchResults[this.currentSearchResultIndex];if(!e.node)return;const t=this.treeElementForNode(e.node);t&&t.hideSearchHighlights()}selectedDOMNode(){for(const e of this.treeOutlines)if(e.selectedDOMNode())return e.selectedDOMNode();return null}selectDOMNode(e,t){for(const n of this.treeOutlines){It.forDOMModel(e.domModel())===n?n.selectDOMNode(e,t):n.selectDOMNode(null)}}updateBreadcrumbIfNeeded(e){const t=e.data,n=this.selectedDOMNode();if(!n)return void(this.breadcrumbs.data={crumbs:[],selectedNode:null});const i=h.Helper.legacyNodeToElementsComponentsNode(n),s=[i];for(let e=n.parentNode;e;e=e.parentNode)s.push(h.Helper.legacyNodeToElementsComponentsNode(e));const o=t.map(h.Helper.legacyNodeToElementsComponentsNode),r=new Map;o.forEach((e=>r.set(e.id,e)));const l=s.map((e=>r.get(e.id)||e));this.breadcrumbs.data={crumbs:l,selectedNode:i}}crumbNodeSelected(e){this.selectDOMNode(e.legacyDomNode,!0)}treeOutlineForNode(e){return e?It.forDOMModel(e.domModel()):null}treeElementForNode(e){const t=this.treeOutlineForNode(e);return t?t.findTreeElement(e):null}leaveUserAgentShadowDOM(e){let t;for(;(t=e.ancestorUserAgentShadowRoot())&&t.parentNode;)e=t.parentNode;return e}async revealAndSelectNode(t,n,o){this.omitDefaultSelection=!0,t=e.Settings.Settings.instance().moduleSetting("showUAShadowDOM").get()?t:this.leaveUserAgentShadowDOM(t),o||t.highlightForTwoSeconds(),this.accessibilityTreeView&&this.accessibilityTreeView.revealAndSelectNode(t),await i.ViewManager.ViewManager.instance().showView("elements",!1,!n),this.selectDOMNode(t,n),delete this.omitDefaultSelection,this.notFirstInspectElement||(an.firstInspectElementNodeNameForTest=t.nodeName(),an.firstInspectElementCompletedForTest(),s.InspectorFrontendHost.InspectorFrontendHostInstance.inspectElementCompleted()),this.notFirstInspectElement=!0}showUAShadowDOMChanged(){for(const e of this.treeOutlines)e.update()}setupTextSelectionHack(e){const t=i.bind(this),n=e=>{0===e.buttons&&i.call(this)};function i(){this.splitWidget.element.classList.remove("disable-resizer-for-elements-hack"),e.style.removeProperty("left"),e.style.removeProperty("padding-left"),e.style.removeProperty("width"),e.style.removeProperty("position"),e.window().removeEventListener("blur",t),e.window().removeEventListener("contextmenu",t,!0),e.window().removeEventListener("dragstart",t,!0),e.window().removeEventListener("mousemove",n,!0),e.window().removeEventListener("mouseup",t,!0),e.window().removeEventListener("visibilitychange",t)}e.addEventListener("mousedown",(i=>{if(0!==i.button)return;this.splitWidget.element.classList.add("disable-resizer-for-elements-hack"),e.style.setProperty("height",`${e.offsetHeight}px`);e.style.setProperty("left","-1000000px"),e.style.setProperty("padding-left","1000000px"),e.style.setProperty("width","calc(100% + 1000000px)"),e.style.setProperty("position","fixed"),e.window().addEventListener("blur",t),e.window().addEventListener("contextmenu",t,!0),e.window().addEventListener("dragstart",t,!0),e.window().addEventListener("mousemove",n,!0),e.window().addEventListener("mouseup",t,!0),e.window().addEventListener("visibilitychange",t)}),!0)}initializeSidebarPanes(e){this.splitWidget.setVertical("Vertical"===e),this.showToolbarPane(null,null);const t=new i.Widget.VBox;t.element.classList.add("style-panes-wrapper"),this.stylesWidget.show(t.element),this.setupTextSelectionHack(t.element);const n=new i.Widget.VBox;n.element.classList.add("style-panes-wrapper"),this.computedStyleWidget.show(n.element);const o=new i.SplitWidget.SplitWidget(!0,!0,"elements.styles.sidebar.width",100);o.setMainWidget(t),o.hideSidebar(),o.enableShowModeSaving(),o.addEventListener(i.SplitWidget.Events.ShowModeChanged,(()=>{a()})),this.stylesWidget.addEventListener("InitialUpdateCompleted",(()=>{this.stylesWidget.appendToolbarItem(o.createShowHideSidebarButton(on(nn.showComputedStylesSidebar),on(nn.hideComputedStylesSidebar)))}));const l=()=>{this.metricsWidget.show(n.element,this.computedStyleWidget.element),this.metricsWidget.toggleVisibility(!0),this.stylesWidget.removeEventListener("StylesUpdateCompleted",h)},a=()=>{o.showMode()===i.SplitWidget.ShowMode.Both?l():(this.metricsWidget.show(t.element),this.stylesWidget.hasMatchedStyles||this.metricsWidget.toggleVisibility(!1),this.stylesWidget.addEventListener("StylesUpdateCompleted",h))};let d=!1;const h=e=>{this.metricsWidget.toggleVisibility(e.data.hasMatchedStyles)};this.sidebarPaneView=i.ViewManager.ViewManager.instance().createTabbedLocation((()=>i.ViewManager.ViewManager.instance().showView("elements")));const c=this.sidebarPaneView.tabbedPane();"Vertical"!==this.splitMode&&this.splitWidget.installResizer(c.headerElement());const p=c.headerElement();i.ARIAUtils.markAsNavigation(p),i.ARIAUtils.setAccessibleName(p,on(nn.sidePanelToolbar));const u=c.tabbedPaneContentElement();i.ARIAUtils.markAsComplementary(u),i.ARIAUtils.setAccessibleName(u,on(nn.sidePanelContent));const m=new i.View.SimpleView(on(nn.styles));this.sidebarPaneView.appendView(m),m.element.classList.add("flex-auto"),o.show(m.element);const g=new i.View.SimpleView(on(nn.computed));g.element.classList.add("composite","fill"),c.addEventListener(i.TabbedPane.Events.TabSelected,(e=>{const{tabId:t}=e.data;t===on(nn.computed)?(n.show(g.element),l()):t===on(nn.styles)&&(o.setSidebarWidget(n),a()),d?s.userMetrics.sidebarPaneShown(t):d=!0}),this),this.sidebarPaneView.appendView(g),this.stylesViewToReveal=m,this.sidebarPaneView.appendApplicableItems("elements-sidebar");const y=r.ExtensionServer.ExtensionServer.instance().sidebarPanes();for(let e=0;e<y.length;++e)this.addExtensionSidebarPane(y[e]);this.splitWidget.setSidebarWidget(this.sidebarPaneView.tabbedPane())}updateSidebarPosition(){if(this.sidebarPaneView&&this.sidebarPaneView.tabbedPane().shouldHideOnDetach())return;const t=e.Settings.Settings.instance().moduleSetting("sidebarPosition").get();let n="Horizontal";if(("right"===t||"auto"===t&&i.InspectorView.InspectorView.instance().element.offsetWidth>680)&&(n="Vertical"),!this.sidebarPaneView)return void this.initializeSidebarPanes(n);if(n===this.splitMode)return;this.splitMode=n;const s=this.sidebarPaneView.tabbedPane();this.splitWidget.uninstallResizer(s.headerElement()),this.splitWidget.setVertical("Vertical"===this.splitMode),this.showToolbarPane(null,null),"Vertical"!==this.splitMode&&this.splitWidget.installResizer(s.headerElement())}extensionSidebarPaneAdded(e){this.addExtensionSidebarPane(e.data)}addExtensionSidebarPane(e){this.sidebarPaneView&&e.panelName()===this.name&&this.sidebarPaneView.appendView(e)}getComputedStyleWidget(){return this.computedStyleWidget}setupStyleTracking(e){const t=e.createCSSPropertyTracker(dn);t.start(),this.cssStyleTrackerByCSSModel.set(e,t),t.addEventListener(n.CSSModel.CSSPropertyTrackerEvents.TrackedCSSPropertiesUpdated,this.trackedCSSPropertiesUpdated,this)}removeStyleTracking(e){const t=this.cssStyleTrackerByCSSModel.get(e);t&&(t.stop(),this.cssStyleTrackerByCSSModel.delete(e),t.removeEventListener(n.CSSModel.CSSPropertyTrackerEvents.TrackedCSSPropertiesUpdated,this.trackedCSSPropertiesUpdated,this))}trackedCSSPropertiesUpdated({data:e}){for(const t of e){if(!t)continue;const e=this.treeElementForNode(t);e&&e.updateStyleAdorners()}}showAdornerSettingsPane(){this.adornerSettingsPane||(this.adornerSettingsPane=new h.AdornerSettingsPane.AdornerSettingsPane,this.adornerSettingsPane.addEventListener("adornersettingupdated",(e=>{const{adornerName:t,isEnabledNow:n,newSettings:i}=e.data,s=this.adornersByName.get(t);if(s)for(const e of s)n?e.show():e.hide();this.adornerManager.updateSettings(i)})),this.searchableViewInternal.element.prepend(this.adornerSettingsPane));const e=this.adornerManager.getSettings();this.adornerSettingsPane.data={settings:e},this.adornerSettingsPane.show()}isAdornerEnabled(e){return this.adornerManager.isAdornerEnabled(e)}registerAdorner(e){let t=this.adornersByName.get(e.name);t||(t=new Set,this.adornersByName.set(e.name,t)),t.add(e),this.isAdornerEnabled(e.name)||e.hide()}deregisterAdorner(e){const t=this.adornersByName.get(e.name);t&&t.delete(e)}static firstInspectElementCompletedForTest=function(){};static firstInspectElementNodeNameForTest=""}globalThis.Elements=globalThis.Elements||{},globalThis.Elements.ElementsPanel=an;const dn=[{name:"display",value:"grid"},{name:"display",value:"inline-grid"},{name:"display",value:"flex"},{name:"display",value:"inline-flex"},{name:"container-type",value:"inline-size"},{name:"container-type",value:"block-size"},{name:"container-type",value:"size"}];let hn,cn,pn,un,mn;class gn{appendApplicableItems(t,i,s){if(!(s instanceof n.RemoteObject.RemoteObject&&s.isNode()||s instanceof n.DOMModel.DOMNode||s instanceof n.DOMModel.DeferredDOMNode))return;if(an.instance().element.isAncestor(t.target))return;const o=e.Revealer.reveal.bind(e.Revealer.Revealer,s);i.revealSection().appendItem(on(nn.revealInElementsPanel),o)}static instance(){return hn||(hn=new gn),hn}}class yn{static instance(e={forceNew:null}){const{forceNew:t}=e;return cn&&!t||(cn=new yn),cn}reveal(t,i){const s=an.instance();return s.pendingNodeReveal=!0,new Promise((function(o,r){if(t instanceof n.DOMModel.DOMNode)l(t);else if(t instanceof n.DOMModel.DeferredDOMNode)t.resolve((function(t){if(!t){const t=on(nn.theDeferredDomNodeCouldNotBe);return e.Console.Console.instance().warn(t),void r(new Error(t))}l(t)}));else if(t instanceof n.RemoteObject.RemoteObject){const i=t.runtimeModel().target().model(n.DOMModel.DOMModel);i?i.pushObjectAsNodeToFrontend(t).then((function(t){if(!t){const t=on(nn.theRemoteObjectCouldNotBe);return e.Console.Console.instance().warn(t),void r(new Error(t))}l(t)})):r(new Error("Could not resolve a node to reveal."))}else r(new Error("Can't reveal a non-node.")),s.pendingNodeReveal=!1;function l(l){s.pendingNodeReveal=!1;let a=l;for(;a.parentNode;)a=a.parentNode;const d=!(a instanceof n.DOMModel.DOMDocument);if(!(t instanceof n.DOMModel.DOMDocument)&&d){const t=on(nn.nodeCannotBeFoundInTheCurrent);return e.Console.Console.instance().warn(t),void r(new Error(t))}l?s.revealAndSelectNode(l,!i).then(o):r(new Error("Could not resolve node to reveal."))}}))}}class fn{static instance(e={forceNew:null}){const{forceNew:t}=e;return pn&&!t||(pn=new fn),pn}reveal(e){return an.instance().revealProperty(e)}}class Sn{handleAction(e,t){const s=i.Context.Context.instance().flavor(n.DOMModel.DOMNode);if(!s)return!0;const o=It.forDOMModel(s.domModel());if(!o)return!0;switch(t){case"elements.hide-element":return o.toggleHideElement(s),!0;case"elements.edit-as-html":return o.toggleEditAsHTML(s),!0;case"elements.duplicate-element":return o.duplicateNode(s),!0;case"elements.copy-styles":return o.findTreeElement(s)?.copyStyles(),!0;case"elements.undo":return n.DOMModel.DOMModelUndoStack.instance().undo(),an.instance().stylesWidget.forceUpdate(),!0;case"elements.redo":return n.DOMModel.DOMModelUndoStack.instance().redo(),an.instance().stylesWidget.forceUpdate(),!0}return!1}static instance(e={forceNew:null}){const{forceNew:t}=e;return un&&!t||(un=new Sn),un}}class bn{static instance(e={forceNew:null}){const{forceNew:t}=e;return mn&&!t||(mn=new bn),mn}decorate(e){const t=e.domModel().cssModel().pseudoState(e);return t?{color:"orange",title:on(nn.elementStateS,{PH1:":"+t.join(", :")})}:null}}var vn=Object.freeze({__proto__:null,ElementsPanel:an,ContextMenuProvider:gn,DOMNodeRevealer:yn,CSSPropertyRevealer:fn,ElementsActionDelegate:Sn,PseudoStateMarkerDecorator:bn});let En,Cn;class wn{toggleSearchAction;mode;showDetailedInspectTooltipSetting;constructor(){this.toggleSearchAction=i.ActionRegistry.ActionRegistry.instance().action("elements.toggle-element-search"),this.mode="none",n.TargetManager.TargetManager.instance().addEventListener(n.TargetManager.Events.SuspendStateChanged,this.suspendStateChanged,this),n.TargetManager.TargetManager.instance().addModelListener(n.OverlayModel.OverlayModel,n.OverlayModel.Events.ExitedInspectMode,(()=>this.setMode("none"))),n.OverlayModel.OverlayModel.setInspectNodeHandler(this.inspectNode.bind(this)),n.TargetManager.TargetManager.instance().observeModels(n.OverlayModel.OverlayModel,this),this.showDetailedInspectTooltipSetting=e.Settings.Settings.instance().moduleSetting("showDetailedInspectTooltip"),this.showDetailedInspectTooltipSetting.addChangeListener(this.showDetailedInspectTooltipChanged.bind(this)),document.addEventListener("keydown",(e=>{e.keyCode===i.KeyboardShortcut.Keys.Esc.code&&this.isInInspectElementMode()&&(this.setMode("none"),e.consume(!0))}),!0)}static instance({forceNew:e}={forceNew:!1}){return En&&!e||(En=new wn),En}modelAdded(e){"none"!==this.mode&&e.setInspectMode(this.mode,this.showDetailedInspectTooltipSetting.get())}modelRemoved(e){}isInInspectElementMode(){return"none"!==this.mode}toggleInspectMode(){let t;t=this.isInInspectElementMode()?"none":e.Settings.Settings.instance().moduleSetting("showUAShadowDOM").get()?"searchForUAShadowDOM":"searchForNode",this.setMode(t)}captureScreenshotMode(){this.setMode("captureAreaScreenshot")}setMode(e){if(!n.TargetManager.TargetManager.instance().allTargetsSuspended()){this.mode=e;for(const t of n.TargetManager.TargetManager.instance().models(n.OverlayModel.OverlayModel))t.setInspectMode(e,this.showDetailedInspectTooltipSetting.get());this.toggleSearchAction&&this.toggleSearchAction.setToggled(this.isInInspectElementMode())}}suspendStateChanged(){n.TargetManager.TargetManager.instance().allTargetsSuspended()&&(this.mode="none",this.toggleSearchAction&&this.toggleSearchAction.setToggled(!1))}inspectNode(e){an.instance().revealAndSelectNode(e,!0,!0)}showDetailedInspectTooltipChanged(){this.setMode(this.mode)}}class xn{handleAction(e,n){return!t.Runtime.Runtime.queryParam("isSharedWorker")&&(En=wn.instance(),!!En&&("elements.toggle-element-search"===n?En.toggleInspectMode():"elements.capture-area-screenshot"===n&&En.captureScreenshotMode(),!0))}static instance(e={forceNew:null}){const{forceNew:t}=e;return Cn&&!t||(Cn=new xn),Cn}}var Mn=Object.freeze({__proto__:null,InspectElementModeController:wn,ToggleSearchActionDelegate:xn});const Tn={frameworkListeners:"`Framework` listeners",refresh:"Refresh",showListenersOnTheAncestors:"Show listeners on the ancestors",ancestors:"Ancestors",eventListenersCategory:"Event listeners category",all:"All",passive:"Passive",blocking:"Blocking",resolveEventListenersBoundWith:"Resolve event listeners bound with framework"},In=o.i18n.registerUIStrings("panels/elements/EventListenersWidget.ts",Tn),Nn=o.i18n.getLocalizedString.bind(void 0,In);let Pn;class On extends i.ThrottledWidget.ThrottledWidget{toolbarItemsInternal;showForAncestorsSetting;dispatchFilterBySetting;showFrameworkListenersSetting;eventListenersView;lastRequestedNode;constructor(){super(),this.toolbarItemsInternal=[],this.showForAncestorsSetting=e.Settings.Settings.instance().moduleSetting("showEventListenersForAncestors"),this.showForAncestorsSetting.addChangeListener(this.update.bind(this)),this.dispatchFilterBySetting=e.Settings.Settings.instance().createSetting("eventListenerDispatchFilterType",kn.All),this.dispatchFilterBySetting.addChangeListener(this.update.bind(this)),this.showFrameworkListenersSetting=e.Settings.Settings.instance().createSetting("showFrameowkrListeners",!0),this.showFrameworkListenersSetting.setTitle(Nn(Tn.frameworkListeners)),this.showFrameworkListenersSetting.addChangeListener(this.showFrameworkListenersChanged.bind(this)),this.eventListenersView=new C.EventListenersView.EventListenersView(this.update.bind(this)),this.eventListenersView.show(this.element);const t=new i.Toolbar.ToolbarButton(Nn(Tn.refresh),"largeicon-refresh");t.addEventListener(i.Toolbar.ToolbarButton.Events.Click,this.update.bind(this)),this.toolbarItemsInternal.push(t),this.toolbarItemsInternal.push(new i.Toolbar.ToolbarSettingCheckbox(this.showForAncestorsSetting,Nn(Tn.showListenersOnTheAncestors),Nn(Tn.ancestors)));const s=new i.Toolbar.ToolbarComboBox(this.onDispatchFilterTypeChanged.bind(this),Nn(Tn.eventListenersCategory));function o(e,t){const n=s.createOption(e,t);t===this.dispatchFilterBySetting.get()&&s.select(n)}o.call(this,Nn(Tn.all),kn.All),o.call(this,Nn(Tn.passive),kn.Passive),o.call(this,Nn(Tn.blocking),kn.Blocking),s.setMaxWidth(200),this.toolbarItemsInternal.push(s),this.toolbarItemsInternal.push(new i.Toolbar.ToolbarSettingCheckbox(this.showFrameworkListenersSetting,Nn(Tn.resolveEventListenersBoundWith))),i.Context.Context.instance().addFlavorChangeListener(n.DOMModel.DOMNode,this.update,this),this.update()}static instance(e={forceNew:null}){const{forceNew:t}=e;return Pn&&!t||(Pn=new On),Pn}doUpdate(){this.lastRequestedNode&&(this.lastRequestedNode.domModel().runtimeModel().releaseObjectGroup(Ln),delete this.lastRequestedNode);const e=i.Context.Context.instance().flavor(n.DOMModel.DOMNode);if(!e)return this.eventListenersView.reset(),this.eventListenersView.addEmptyHolderIfNeeded(),Promise.resolve();this.lastRequestedNode=e;const t=!this.showForAncestorsSetting.get(),s=[];if(s.push(e.resolveToObject(Ln)),!t){let t=e.parentNode;for(;t;)s.push(t.resolveToObject(Ln)),t=t.parentNode;s.push(this.windowObjectInNodeContext(e))}return Promise.all(s).then(this.eventListenersView.addObjects.bind(this.eventListenersView)).then(this.showFrameworkListenersChanged.bind(this))}toolbarItems(){return this.toolbarItemsInternal}onDispatchFilterTypeChanged(e){const t=e.target;this.dispatchFilterBySetting.set(t.value)}showFrameworkListenersChanged(){const e=this.dispatchFilterBySetting.get(),t=e===kn.All||e===kn.Passive,n=e===kn.All||e===kn.Blocking;this.eventListenersView.showFrameworkListeners(this.showFrameworkListenersSetting.get(),t,n)}windowObjectInNodeContext(e){const t=e.domModel().runtimeModel().executionContexts();let n=t[0];if(e.frameId())for(let i=0;i<t.length;++i){const s=t[i];s.frameId===e.frameId()&&s.isDefault&&(n=s)}return n.evaluate({expression:"self",objectGroup:Ln,includeCommandLineAPI:!1,silent:!0,returnByValue:!1,generatePreview:!1,throwOnSideEffect:void 0,timeout:void 0,disableBreaks:void 0,replMode:void 0,allowUnsafeEvalBlockedByCSP:void 0},!1,!1).then((e=>"object"in e?e.object:null))}eventListenersArrivedForTest(){}}const kn={All:"All",Blocking:"Blocking",Passive:"Passive"},Ln="event-listeners-panel";var Dn=Object.freeze({__proto__:null,EventListenersWidget:On,DispatchFilterBy:kn});const An=new CSSStyleSheet;An.replaceSync(".properties-widget-section{padding:2px 0 2px 5px;flex:none}\n/*# sourceURL=propertiesWidget.css */\n");let Rn;class Fn extends i.ThrottledWidget.ThrottledWidget{node;treeOutline;expandController;lastRequestedNode;constructor(){super(!0),n.TargetManager.TargetManager.instance().addModelListener(n.DOMModel.DOMModel,n.DOMModel.Events.AttrModified,this.onNodeChange,this),n.TargetManager.TargetManager.instance().addModelListener(n.DOMModel.DOMModel,n.DOMModel.Events.AttrRemoved,this.onNodeChange,this),n.TargetManager.TargetManager.instance().addModelListener(n.DOMModel.DOMModel,n.DOMModel.Events.CharacterDataModified,this.onNodeChange,this),n.TargetManager.TargetManager.instance().addModelListener(n.DOMModel.DOMModel,n.DOMModel.Events.ChildNodeCountUpdated,this.onNodeChange,this),i.Context.Context.instance().addFlavorChangeListener(n.DOMModel.DOMNode,this.setNode,this),this.node=i.Context.Context.instance().flavor(n.DOMModel.DOMNode),this.treeOutline=new w.ObjectPropertiesSection.ObjectPropertiesSectionsTreeOutline({readOnly:!0}),this.treeOutline.setShowSelectionOnKeyboardFocus(!0,!1),this.expandController=new w.ObjectPropertiesSection.ObjectPropertiesSectionsTreeExpandController(this.treeOutline),this.contentElement.appendChild(this.treeOutline.element),this.treeOutline.addEventListener(i.TreeOutline.Events.ElementExpanded,(()=>{s.userMetrics.actionTaken(s.UserMetrics.Action.DOMPropertiesExpanded)})),this.update()}static instance(e={forceNew:null}){const{forceNew:t}=e;return Rn&&!t||(Rn=new Fn),Rn}setNode(e){this.node=e.data,this.update()}async doUpdate(){if(this.lastRequestedNode&&(this.lastRequestedNode.domModel().runtimeModel().releaseObjectGroup("properties-sidebar-pane"),delete this.lastRequestedNode),!this.node)return void this.treeOutline.removeChildren();this.lastRequestedNode=this.node;const e=await this.node.resolveToObject("properties-sidebar-pane");e&&await w.ObjectPropertiesSection.ObjectPropertyTreeElement.populate(this.treeOutline.rootElement(),e,!0,!0,void 0,void 0)}onNodeChange(e){if(!this.node)return;const t=e.data,i=t instanceof n.DOMModel.DOMNode?t:t.node;this.node===i&&this.update()}wasShown(){super.wasShown(),this.registerCSSFiles([An])}}var Un=Object.freeze({__proto__:null,PropertiesWidget:Fn});const Hn=new CSSStyleSheet;Hn.replaceSync(".stack-trace{font-size:11px!important;font-family:Menlo,monospace}\n/*# sourceURL=nodeStackTraceWidget.css */\n");const Bn={noStackTraceAvailable:"No stack trace available"},Vn=o.i18n.registerUIStrings("panels/elements/NodeStackTraceWidget.ts",Bn),Wn=o.i18n.getLocalizedString.bind(void 0,Vn);let _n;class zn extends i.ThrottledWidget.ThrottledWidget{noStackTraceElement;creationStackTraceElement;linkifier;constructor(){super(!0),this.noStackTraceElement=this.contentElement.createChild("div","gray-info-message"),this.noStackTraceElement.textContent=Wn(Bn.noStackTraceAvailable),this.creationStackTraceElement=this.contentElement.createChild("div","stack-trace"),this.linkifier=new a.Linkifier.Linkifier(jn)}static instance(e={forceNew:null}){const{forceNew:t}=e;return _n&&!t||(_n=new zn),_n}wasShown(){super.wasShown(),i.Context.Context.instance().addFlavorChangeListener(n.DOMModel.DOMNode,this.update,this),this.registerCSSFiles([Hn]),this.update()}willHide(){i.Context.Context.instance().removeFlavorChangeListener(n.DOMModel.DOMNode,this.update,this)}async doUpdate(){const e=i.Context.Context.instance().flavor(n.DOMModel.DOMNode);if(!e)return this.noStackTraceElement.classList.remove("hidden"),void this.creationStackTraceElement.classList.add("hidden");const t=await e.creationStackTrace();if(t){this.noStackTraceElement.classList.add("hidden"),this.creationStackTraceElement.classList.remove("hidden");const n=a.JSPresentationUtils.buildStackTracePreviewContents(e.domModel().target(),this.linkifier,{stackTrace:t,tabStops:void 0});this.creationStackTraceElement.removeChildren(),this.creationStackTraceElement.appendChild(n.element)}else this.noStackTraceElement.classList.remove("hidden"),this.creationStackTraceElement.classList.add("hidden")}}const jn=40;var Kn=Object.freeze({__proto__:null,NodeStackTraceWidget:zn,MaxLengthForLinks:jn});const Gn=new CSSStyleSheet;Gn.replaceSync(".styles-element-classes-pane{background-color:var(--color-background-elevation-1);border-bottom:1px solid var(--color-details-hairline);padding:6px 2px 2px}.styles-element-classes-container{display:flex;flex-wrap:wrap;justify-content:flex-start}.styles-element-classes-pane [is=dt-checkbox]{margin-right:15px}.styles-element-classes-pane .title-container{padding-bottom:2px}.styles-element-classes-pane .new-class-input{padding-left:3px;padding-right:3px;overflow:hidden;border:1px solid var(--input-outline);line-height:15px;margin-left:3px;width:calc(100% - 7px);background-color:var(--color-background);cursor:text}\n/*# sourceURL=classesPaneWidget.css */\n");const qn={addNewClass:"Add new class",classesSAdded:"Classes {PH1} added",classSAdded:"Class {PH1} added",elementClasses:"Element Classes"},$n=o.i18n.registerUIStrings("panels/elements/ClassesPaneWidget.ts",qn),Qn=o.i18n.getLocalizedString.bind(void 0,$n);class Xn extends i.Widget.Widget{input;classesContainer;prompt;mutatingNodes;pendingNodeClasses;updateNodeThrottler;previousTarget;constructor(){super(!0),this.contentElement.className="styles-element-classes-pane";const t=this.contentElement.createChild("div","title-container");this.input=t.createChild("div","new-class-input monospace"),this.setDefaultFocusedElement(this.input),this.classesContainer=this.contentElement.createChild("div","source-code"),this.classesContainer.classList.add("styles-element-classes-container"),this.prompt=new ei(this.nodeClasses.bind(this)),this.prompt.setAutocompletionTimeout(0),this.prompt.renderAsBlock();const s=this.prompt.attach(this.input);this.prompt.setPlaceholder(Qn(qn.addNewClass)),this.prompt.addEventListener(i.TextPrompt.Events.TextChanged,this.onTextChanged,this),s.addEventListener("keydown",this.onKeyDown.bind(this),!1),n.TargetManager.TargetManager.instance().addModelListener(n.DOMModel.DOMModel,n.DOMModel.Events.DOMMutated,this.onDOMMutated,this),this.mutatingNodes=new Set,this.pendingNodeClasses=new Map,this.updateNodeThrottler=new e.Throttler.Throttler(0),this.previousTarget=null,i.Context.Context.instance().addFlavorChangeListener(n.DOMModel.DOMNode,this.onSelectedNodeChanged,this)}splitTextIntoClasses(e){return e.split(/[,\s]/).map((e=>e.trim())).filter((e=>e.length))}onKeyDown(e){if("Enter"!==e.key&&!isEscKey(e))return;if("Enter"===e.key&&(e.consume(),this.prompt.acceptAutoComplete()))return;const t=e.target;let s=t.textContent;isEscKey(e)&&(p.StringUtilities.isWhitespace(s)||e.consume(!0),s=""),this.prompt.clearAutocomplete(),t.textContent="";const o=i.Context.Context.instance().flavor(n.DOMModel.DOMNode);if(!o)return;const r=this.splitTextIntoClasses(s);if(!r.length)return void this.installNodeClasses(o);for(const e of r)this.toggleClass(o,e,!0);const l=r.join(" "),a=r.length>1?Qn(qn.classesSAdded,{PH1:l}):Qn(qn.classSAdded,{PH1:l});i.ARIAUtils.alert(a),this.installNodeClasses(o),this.update()}onTextChanged(){const e=i.Context.Context.instance().flavor(n.DOMModel.DOMNode);e&&this.installNodeClasses(e)}onDOMMutated(e){const t=e.data;this.mutatingNodes.has(t)||(Jn.delete(t),this.update())}onSelectedNodeChanged(e){this.previousTarget&&this.prompt.text()&&(this.input.textContent="",this.installNodeClasses(this.previousTarget)),this.previousTarget=e.data,this.update()}wasShown(){super.wasShown(),this.update(),this.registerCSSFiles([Gn])}update(){if(!this.isShowing())return;let e=i.Context.Context.instance().flavor(n.DOMModel.DOMNode);if(e&&(e=e.enclosingElementOrSelf()),this.classesContainer.removeChildren(),this.input.disabled=!e,!e)return;const t=this.nodeClasses(e),s=[...t.keys()];s.sort(p.StringUtilities.caseInsensetiveComparator);for(const e of s){const n=i.UIUtils.CheckboxLabel.create(e,t.get(e));n.classList.add("monospace"),n.checkboxElement.addEventListener("click",this.onClick.bind(this,e),!1),this.classesContainer.appendChild(n)}}onClick(e,t){const s=i.Context.Context.instance().flavor(n.DOMModel.DOMNode);if(!s)return;const o=t.target.checked;this.toggleClass(s,e,o),this.installNodeClasses(s)}nodeClasses(e){let t=Jn.get(e);if(!t){const n=(e.getAttribute("class")||"").split(/\s/);t=new Map;for(let e=0;e<n.length;++e){const i=n[e].trim();i.length&&t.set(i,!0)}Jn.set(e,t)}return t}toggleClass(e,t,n){this.nodeClasses(e).set(t,n)}installNodeClasses(e){const t=this.nodeClasses(e),n=new Set;for(const e of t.keys())t.get(e)&&n.add(e);const i=this.splitTextIntoClasses(this.prompt.textWithCurrentSuggestion());for(const e of i)n.add(e);const s=[...n.values()].sort();this.pendingNodeClasses.set(e,s.join(" ")),this.updateNodeThrottler.schedule(this.flushPendingClasses.bind(this))}async flushPendingClasses(){const e=[];for(const n of this.pendingNodeClasses.keys()){this.mutatingNodes.add(n);const i=n.setAttributeValuePromise("class",this.pendingNodeClasses.get(n)).then(t.bind(this,n));e.push(i)}function t(e){this.mutatingNodes.delete(e)}this.pendingNodeClasses.clear(),await Promise.all(e)}}const Jn=new WeakMap;let Yn;class Zn{button;view;constructor(){this.button=new i.Toolbar.ToolbarToggle(Qn(qn.elementClasses),""),this.button.setText(".cls"),this.button.element.classList.add("monospace"),this.button.addEventListener(i.Toolbar.ToolbarButton.Events.Click,this.clicked,this),this.view=new Xn}static instance(e={forceNew:null}){const{forceNew:t}=e;return Yn&&!t||(Yn=new Zn),Yn}clicked(){an.instance().showToolbarPane(this.view.isShowing()?null:this.view,this.button)}item(){return this.button}}class ei extends i.TextPrompt.TextPrompt{nodeClasses;selectedFrameId;classNamesPromise;constructor(e){super(),this.nodeClasses=e,this.initialize(this.buildClassNameCompletions.bind(this)," "),this.disableDefaultSuggestionForEmptyInput(),this.selectedFrameId="",this.classNamesPromise=null}async getClassNames(e){const t=[],n=new Set;this.selectedFrameId=e.frameId();const i=e.domModel().cssModel(),s=i.allStyleSheets();for(const e of s){if(e.frameId!==this.selectedFrameId)continue;const s=i.classNamesPromise(e.id).then((e=>{for(const t of e)n.add(t)}));t.push(s)}const o=e.ownerDocument.id,r=e.domModel().classNamesPromise(o).then((e=>{for(const t of e)n.add(t)}));return t.push(r),await Promise.all(t),[...n]}async buildClassNameCompletions(e,t,s){t&&!s||(this.classNamesPromise=null);const o=i.Context.Context.instance().flavor(n.DOMModel.DOMNode);if(!o||!t&&!s&&!e.trim())return[];this.classNamesPromise&&this.selectedFrameId===o.frameId()||(this.classNamesPromise=this.getClassNames(o));let r=await this.classNamesPromise;const l=this.nodeClasses(o);return r=r.filter((e=>!l.get(e))),"."===t[0]&&(r=r.map((e=>"."+e))),r.filter((e=>e.startsWith(t))).sort().map((e=>({text:e,title:void 0,subtitle:void 0,iconType:void 0,priority:void 0,isSecondary:void 0,subtitleRenderer:void 0,selectionRange:void 0,hideGhostText:void 0,iconElement:void 0})))}}var ti=Object.freeze({__proto__:null,ClassesPaneWidget:Xn,ButtonProvider:Zn,ClassNamePrompt:ei});const ni=new CSSStyleSheet;ni.replaceSync(".styles-element-state-pane{overflow:hidden;padding-left:2px;background-color:var(--color-background-elevation-1);border-bottom:1px solid var(--color-background-highlight);margin-top:0;padding-bottom:2px}.styles-element-state-pane>div{margin:8px 4px 6px}.styles-element-state-pane>table{width:100%;border-spacing:0}.styles-element-state-pane td{padding:0}\n/*# sourceURL=elementStatePaneWidget.css */\n");const ii={forceElementState:"Force element state",toggleElementState:"Toggle Element State"},si=o.i18n.registerUIStrings("panels/elements/ElementStatePaneWidget.ts",ii),oi=o.i18n.getLocalizedString.bind(void 0,si);class ri extends i.Widget.Widget{inputs;inputStates;cssModel;constructor(){super(!0),this.contentElement.className="styles-element-state-pane",i.UIUtils.createTextChild(this.contentElement.createChild("div"),oi(ii.forceElementState));const e=document.createElement("table");e.classList.add("source-code"),i.ARIAUtils.markAsPresentation(e);const t=[];this.inputs=t,this.inputStates=new WeakMap;const s=e=>{const t=i.Context.Context.instance().flavor(n.DOMModel.DOMNode);if(!(t&&e.target instanceof HTMLInputElement))return;const s=this.inputStates.get(e.target);s&&t.domModel().cssModel().forcePseudoState(t,s,e.target.checked)},o=e=>{const n=document.createElement("td"),o=i.UIUtils.CheckboxLabel.create(":"+e),r=o.checkboxElement;return this.inputStates.set(r,e),r.addEventListener("click",s,!1),t.push(r),n.appendChild(o),n};let r=e.createChild("tr");r.appendChild(o("active")),r.appendChild(o("hover")),r=e.createChild("tr"),r.appendChild(o("focus")),r.appendChild(o("visited")),r=e.createChild("tr"),r.appendChild(o("focus-within")),r.appendChild(o("focus-visible")),r=e.createChild("tr"),r.appendChild(o("target")),this.contentElement.appendChild(e),i.Context.Context.instance().addFlavorChangeListener(n.DOMModel.DOMNode,this.update,this)}updateModel(e){this.cssModel!==e&&(this.cssModel&&this.cssModel.removeEventListener(n.CSSModel.Events.PseudoStateForced,this.update,this),this.cssModel=e,this.cssModel&&this.cssModel.addEventListener(n.CSSModel.Events.PseudoStateForced,this.update,this))}wasShown(){super.wasShown(),this.registerCSSFiles([ni]),this.update()}update(){if(!this.isShowing())return;let e=i.Context.Context.instance().flavor(n.DOMModel.DOMNode);if(e&&(e=e.enclosingElementOrSelf()),this.updateModel(e?e.domModel().cssModel():null),e){const t=e.domModel().cssModel().pseudoState(e);for(const n of this.inputs){n.disabled=Boolean(e.pseudoType());const i=this.inputStates.get(n);n.checked=!(!t||void 0===i)&&t.indexOf(i)>=0}}else for(const e of this.inputs)e.disabled=!0,e.checked=!1}}let li;class ai{button;view;constructor(){this.button=new i.Toolbar.ToolbarToggle(oi(ii.toggleElementState),""),this.button.setText(o.i18n.lockedString(":hov")),this.button.addEventListener(i.Toolbar.ToolbarButton.Events.Click,this.clicked,this),this.button.element.classList.add("monospace"),this.view=new ri}static instance(e={forceNew:null}){const{forceNew:t}=e;return li&&!t||(li=new ai),li}clicked(){an.instance().showToolbarPane(this.view.isShowing()?null:this.view,this.button)}item(){return this.button}}var di=Object.freeze({__proto__:null,ElementStatePaneWidget:ri,ButtonProvider:ai});const hi=e=>{const t=e.getAttribute("class");return{id:e.id,color:"#000",name:e.localName(),domId:e.getAttribute("id"),domClasses:t?t.split(/\s+/).filter((e=>Boolean(e))):void 0,enabled:!1,reveal:()=>{an.instance().revealAndSelectNode(e,!0,!0),e.scrollIntoView()},highlight:()=>{e.highlight()},hideHighlight:()=>{n.OverlayModel.OverlayModel.hideDOMNodeHighlight()},toggle:e=>{throw new Error("Not implemented")},setColor(e){throw new Error("Not implemented")}}},ci=e=>e.map((e=>{const t=hi(e),n=e.id;return{...t,color:e.domModel().overlayModel().colorOfGridInPersistentOverlay(n)||"#000",enabled:e.domModel().overlayModel().isHighlightedGridInPersistentOverlay(n),toggle:t=>{t?e.domModel().overlayModel().highlightGridInPersistentOverlay(n):e.domModel().overlayModel().hideGridInPersistentOverlay(n)},setColor(t){this.color=t,e.domModel().overlayModel().setColorOfGridInPersistentOverlay(n,t)}}}));let pi;const ui=e=>e.map((e=>{const t=hi(e),n=e.id;return{...t,color:e.domModel().overlayModel().colorOfFlexInPersistentOverlay(n)||"#000",enabled:e.domModel().overlayModel().isHighlightedFlexContainerInPersistentOverlay(n),toggle:t=>{t?e.domModel().overlayModel().highlightFlexContainerInPersistentOverlay(n):e.domModel().overlayModel().hideFlexContainerInPersistentOverlay(n)},setColor(t){this.color=t,e.domModel().overlayModel().setColorOfFlexInPersistentOverlay(n,t)}}}));class mi extends i.ThrottledWidget.ThrottledWidget{layoutPane;settings;uaShadowDOMSetting;boundOnSettingChanged;domModels;constructor(){super(!0),this.layoutPane=new h.LayoutPane.LayoutPane,this.contentElement.appendChild(this.layoutPane),this.settings=["showGridLineLabels","showGridTrackSizes","showGridAreas","extendGridLines"],this.uaShadowDOMSetting=e.Settings.Settings.instance().moduleSetting("showUAShadowDOM"),this.boundOnSettingChanged=this.onSettingChanged.bind(this),this.domModels=[]}static instance(e={forceNew:null}){const{forceNew:t}=e;return pi&&!t||(pi=new mi),pi}modelAdded(e){const t=e.overlayModel();t.addEventListener(n.OverlayModel.Events.PersistentGridOverlayStateChanged,this.update,this),t.addEventListener(n.OverlayModel.Events.PersistentFlexContainerOverlayStateChanged,this.update,this),this.domModels.push(e)}modelRemoved(e){const t=e.overlayModel();t.removeEventListener(n.OverlayModel.Events.PersistentGridOverlayStateChanged,this.update,this),t.removeEventListener(n.OverlayModel.Events.PersistentFlexContainerOverlayStateChanged,this.update,this),this.domModels=this.domModels.filter((t=>t!==e))}async fetchNodesByStyle(e){const t=this.uaShadowDOMSetting.get(),n=[];for(const i of this.domModels)try{const s=await i.getNodesByStyle(e,!0);for(const e of s){const s=i.nodeForId(e);null===s||!t&&s.ancestorUserAgentShadowRoot()||n.push(s)}}catch(e){console.warn(e)}return n}async fetchGridNodes(){return await this.fetchNodesByStyle([{name:"display",value:"grid"},{name:"display",value:"inline-grid"}])}async fetchFlexContainerNodes(){return await this.fetchNodesByStyle([{name:"display",value:"flex"},{name:"display",value:"inline-flex"}])}mapSettings(){const t=[];for(const n of this.settings){const i=e.Settings.Settings.instance().moduleSetting(n),s=i.get(),o=i.type();if(!o)throw new Error("A setting provided to LayoutSidebarPane does not have a setting type");if(o!==e.Settings.SettingType.BOOLEAN&&o!==e.Settings.SettingType.ENUM)throw new Error("A setting provided to LayoutSidebarPane does not have a supported setting type");const r={type:o,name:i.name,title:i.title()};("boolean"==typeof s||"string"==typeof s)&&t.push({...r,value:s,options:i.options().map((e=>({...e,value:e.value})))})}return t}async doUpdate(){this.layoutPane.data={gridElements:ci(await this.fetchGridNodes()),flexContainerElements:ui(await this.fetchFlexContainerNodes()),settings:this.mapSettings()}}onSettingChanged(t){e.Settings.Settings.instance().moduleSetting(t.data.setting).set(t.data.value)}wasShown(){for(const t of this.settings)e.Settings.Settings.instance().moduleSetting(t).addChangeListener(this.update,this);this.layoutPane.addEventListener("settingchanged",this.boundOnSettingChanged);for(const e of this.domModels)this.modelRemoved(e);this.domModels=[],n.TargetManager.TargetManager.instance().observeModels(n.DOMModel.DOMModel,this),i.Context.Context.instance().addFlavorChangeListener(n.DOMModel.DOMNode,this.update,this),this.uaShadowDOMSetting.addChangeListener(this.update,this),this.update()}willHide(){for(const t of this.settings)e.Settings.Settings.instance().moduleSetting(t).removeChangeListener(this.update,this);this.layoutPane.removeEventListener("settingchanged",this.boundOnSettingChanged),n.TargetManager.TargetManager.instance().unobserveModels(n.DOMModel.DOMModel,this),i.Context.Context.instance().removeFlavorChangeListener(n.DOMModel.DOMNode,this.update,this),this.uaShadowDOMSetting.removeChangeListener(this.update,this)}}var gi=Object.freeze({__proto__:null,LayoutSidebarPane:mi});export{ti as ClassesPaneWidget,ie as ColorSwatchPopoverIcon,F as ComputedStyleModel,ct as ComputedStyleWidget,ue as DOMLinkifier,vt as DOMPath,di as ElementStatePaneWidget,vn as ElementsPanel,ge as ElementsSidebarPane,Xt as ElementsTreeElement,Yt as ElementsTreeElementHighlighter,Dt as ElementsTreeOutline,Dn as EventListenersWidget,Mn as InspectElementModeController,gi as LayoutSidebarPane,Wt as MarkerDecorator,tn as MetricsSidebarPane,Kn as NodeStackTraceWidget,j as PlatformFontsWidget,Un as PropertiesWidget,ke as StyleEditorWidget,De as StylePropertyHighlighter,Me as StylePropertyTreeElement,fe as StylePropertyUtils,et as StylesSidebarPane};
