import*as e from"../../../core/i18n/i18n.js";import*as t from"../../../ui/components/data_grid/data_grid.js";import*as i from"../../../ui/components/helpers/helpers.js";import*as r from"../../../ui/lit-html/lit-html.js";import*as a from"../../../ui/components/expandable_list/expandable_list.js";import*as o from"../../../ui/legacy/components/utils/utils.js";import*as n from"../../../core/sdk/sdk.js";import*as s from"../../network/forward/forward.js";import*as l from"../../../ui/components/icon_button/icon_button.js";import*as d from"../../../ui/components/render_coordinator/render_coordinator.js";import*as c from"../../../ui/components/report_view/report_view.js";import*as h from"../../../core/common/common.js";import*as m from"../../../models/bindings/bindings.js";import*as p from"../../../core/root/root.js";import*as u from"../../../ui/legacy/legacy.js";import*as g from"../../../models/workspace/workspace.js";import*as w from"../../../ui/components/adorners/adorners.js";import*as T from"../../../ui/components/tree_outline/tree_outline.js";const f=new CSSStyleSheet;f.replaceSync(":host{overflow:auto;height:100%}.reporting-container{height:100%;display:flex;flex-direction:column}.reporting-header{font-size:15px;background-color:var(--color-background-elevation-1);padding:1px 4px}.reporting-placeholder{flex-grow:1;display:flex;align-items:center;justify-content:center;font-size:13px;color:var(--color-text-secondary)}devtools-data-grid-controller{border:1px solid var(--color-details-hairline)}.inline-icon{vertical-align:text-bottom}\n/*# sourceURL=reportingApiGrid.css */\n");const S={noEndpointsToDisplay:"No endpoints to display"},v=e.i18n.registerUIStrings("panels/application/components/EndpointsGrid.ts",S),R=e.i18n.getLocalizedString.bind(void 0,v),{render:k,html:$}=r;class b extends HTMLElement{static litTagName=r.literal`devtools-resources-endpoints-grid`;shadow=this.attachShadow({mode:"open"});endpoints=new Map;connectedCallback(){this.shadow.adoptedStyleSheets=[f],this.render()}set data(e){this.endpoints=e.endpoints,this.render()}render(){const i={columns:[{id:"origin",title:e.i18n.lockedString("Origin"),widthWeighting:30,hideable:!1,visible:!0},{id:"name",title:e.i18n.lockedString("Name"),widthWeighting:20,hideable:!1,visible:!0},{id:"url",title:e.i18n.lockedString("URL"),widthWeighting:30,hideable:!1,visible:!0}],rows:this.buildReportRows()};k($` <div class="reporting-container"> <div class="reporting-header">${e.i18n.lockedString("Endpoints")}</div> ${this.endpoints.size>0?$` <${t.DataGridController.DataGridController.litTagName} .data="${i}"> </${t.DataGridController.DataGridController.litTagName}> `:$` <div class="reporting-placeholder"> <div>${R(S.noEndpointsToDisplay)}</div> </div> `} </div> `,this.shadow)}buildReportRows(){return Array.from(this.endpoints).map((([e,t])=>t.map((t=>({cells:[{columnId:"origin",value:e},{columnId:"name",value:t.groupName},{columnId:"url",value:t.url}]}))))).flat()}}i.CustomElements.defineComponent("devtools-resources-endpoints-grid",b);var y=Object.freeze({__proto__:null,i18nString:R,EndpointsGrid:b});const N=new CSSStyleSheet;N.replaceSync(".stack-trace-row{display:flex}.stack-trace-function-name{width:100px}.stack-trace-source-location{display:flex;overflow:hidden}.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ignore-list-link{opacity:60%}.devtools-link,.link{color:var(--color-link);text-decoration:underline;cursor:pointer;padding:2px 0}\n/*# sourceURL=stackTraceRow.css */\n");const x=new CSSStyleSheet;x.replaceSync("button.link{color:var(--color-link);text-decoration:underline;cursor:pointer;padding:2px 0;border:none;background:0 0;font-family:inherit;font-size:inherit}\n/*# sourceURL=stackTraceLinkButton.css */\n");const C={cannotRenderStackTrace:"Cannot render stack trace",showSMoreFrames:"{n, plural, =1 {Show # more frame} other {Show # more frames}}"},I=e.i18n.registerUIStrings("panels/application/components/StackTrace.ts",C),V=e.i18n.getLocalizedString.bind(void 0,I);class D extends HTMLElement{static litTagName=r.literal`devtools-stack-trace-row`;shadow=this.attachShadow({mode:"open"});stackTraceRowItem=null;set data(e){this.stackTraceRowItem=e.stackTraceRowItem,this.render()}connectedCallback(){this.shadow.adoptedStyleSheets=[N]}render(){this.stackTraceRowItem&&r.render(r.html` <div class="stack-trace-row"> <div class="stack-trace-function-name text-ellipsis" title="${this.stackTraceRowItem.functionName}"> ${this.stackTraceRowItem.functionName} </div> <div class="stack-trace-source-location"> ${this.stackTraceRowItem.link?r.html`<div class="text-ellipsis">\xA0@\xA0${this.stackTraceRowItem.link}</div>`:r.nothing} </div> </div> `,this.shadow,{host:this})}}class E extends HTMLElement{static litTagName=r.literal`devtools-stack-trace-link-button`;shadow=this.attachShadow({mode:"open"});onShowAllClick=()=>{};hiddenCallFramesCount=null;set data(e){this.onShowAllClick=e.onShowAllClick,this.hiddenCallFramesCount=e.hiddenCallFramesCount,this.render()}connectedCallback(){this.shadow.adoptedStyleSheets=[x]}render(){this.hiddenCallFramesCount&&r.render(r.html` <div class="stack-trace-row"> <button class="link" @click="${()=>this.onShowAllClick()}"> ${V(C.showSMoreFrames,{n:this.hiddenCallFramesCount})} </button> </div> `,this.shadow,{host:this})}}class A extends HTMLElement{static litTagName=r.literal`devtools-resources-stack-trace`;shadow=this.attachShadow({mode:"open"});linkifier=new o.Linkifier.Linkifier;stackTraceRows=[];showHidden=!1;set data(e){const t=e.frame,{creationStackTrace:i,creationStackTraceTarget:r}=t.getCreationStackTraceData();i&&(this.stackTraceRows=e.buildStackTraceRows(i,r,this.linkifier,!0,this.onStackTraceRowsUpdated.bind(this))),this.render()}onStackTraceRowsUpdated(e){this.stackTraceRows=e,this.render()}onShowAllClick(){this.showHidden=!0,this.render()}createRowTemplates(){const e=[];let t=0;for(const i of this.stackTraceRows)(this.showHidden||!i.ignoreListHide&&!i.rowCountHide)&&("functionName"in i&&e.push(r.html` <${D.litTagName} data-stack-trace-row .data="${{stackTraceRowItem:i}}"></${D.litTagName}>`),"asyncDescription"in i&&e.push(r.html` <div>${i.asyncDescription}</div> `)),!this.showHidden&&"functionName"in i&&(i.ignoreListHide||i.rowCountHide)&&t++;return t&&e.push(r.html` <${E.litTagName} data-stack-trace-row .data="${{onShowAllClick:this.onShowAllClick.bind(this),hiddenCallFramesCount:t}}"></${E.litTagName}> `),e}render(){if(!this.stackTraceRows.length)return void r.render(r.html` <span>${V(C.cannotRenderStackTrace)}</span> `,this.shadow,{host:this});const e=this.createRowTemplates();r.render(r.html` <${a.ExpandableList.ExpandableList.litTagName} .data="${{rows:e}}"> </${a.ExpandableList.ExpandableList.litTagName}> `,this.shadow,{host:this})}}i.CustomElements.defineComponent("devtools-stack-trace-row",D),i.CustomElements.defineComponent("devtools-stack-trace-link-button",E),i.CustomElements.defineComponent("devtools-resources-stack-trace",A);var L=Object.freeze({__proto__:null,StackTraceRow:D,StackTraceLinkButton:E,StackTrace:A});const P=new CSSStyleSheet;P.replaceSync(":host{display:contents}.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.devtools-link,.link{color:var(--color-link);text-decoration:underline;cursor:pointer;padding:2px 0}button.link{border:none;background:0 0;font-family:inherit;font-size:inherit}.policies-list{padding-top:3px}.permissions-row{display:flex;line-height:22px}.permissions-row div{padding-right:5px}.feature-name{width:135px}.allowed-icon{padding:2.5px 0}.block-reason{width:215px}\n/*# sourceURL=permissionsPolicySection.css */\n");const F={showDetails:"Show details",hideDetails:"Hide details",allowedFeatures:"Allowed Features",disabledFeatures:"Disabled Features",clickToShowHeader:'Click to reveal the request whose "`Permissions-Policy`" HTTP header disables this feature.',clickToShowIframe:"Click to reveal the top-most iframe which does not allow this feature in the elements panel.",disabledByIframe:'missing in iframe "`allow`" attribute',disabledByHeader:'disabled by "`Permissions-Policy`" header'},U=e.i18n.registerUIStrings("panels/application/components/PermissionsPolicySection.ts",F),O=e.i18n.getLocalizedString.bind(void 0,U),H=d.RenderCoordinator.RenderCoordinator.instance();function M(e,t,i){return r.html` <button class="link" role="link" tabindex="0" @click="${i}" title="${t}"> <${l.Icon.Icon.litTagName} .data="${{iconName:e,color:"var(--color-primary)",width:"16px",height:"16px"}}"> </${l.Icon.Icon.litTagName}> </button> `}class _ extends HTMLElement{static litTagName=r.literal`devtools-resources-permissions-policy-section`;shadow=this.attachShadow({mode:"open"});permissionsPolicySectionData={policies:[],showDetails:!1};set data(e){this.permissionsPolicySectionData=e,this.render()}connectedCallback(){this.shadow.adoptedStyleSheets=[P]}toggleShowPermissionsDisallowedDetails(){this.permissionsPolicySectionData.showDetails=!this.permissionsPolicySectionData.showDetails,this.render()}renderAllowed(){const e=this.permissionsPolicySectionData.policies.filter((e=>e.allowed)).map((e=>e.feature)).sort();return e.length?r.html` <${c.ReportView.ReportKey.litTagName}>${O(F.allowedFeatures)}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> ${e.join(", ")} </${c.ReportView.ReportValue.litTagName}> `:r.nothing}async renderDisallowed(){const e=this.permissionsPolicySectionData.policies.filter((e=>!e.allowed)).sort(((e,t)=>e.feature.localeCompare(t.feature)));if(!e.length)return r.nothing;if(!this.permissionsPolicySectionData.showDetails)return r.html` <${c.ReportView.ReportKey.litTagName}>${O(F.disabledFeatures)}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> ${e.map((e=>e.feature)).join(", ")} <button class="link" @click="${()=>this.toggleShowPermissionsDisallowedDetails()}"> ${O(F.showDetails)} </button> </${c.ReportView.ReportValue.litTagName}> `;const t=n.FrameManager.FrameManager.instance(),i=await Promise.all(e.map((async e=>{const i=e.locator?t.getFrame(e.locator.frameId):null,a=e.locator?.blockReason,o=await("IframeAttribute"===a&&i&&i.getOwnerDOMNodeOrDocument()),n=i&&i.resourceForURL(i.url),d="Header"===a&&n&&n.request,c="IframeAttribute"===a?O(F.disabledByIframe):"Header"===a?O(F.disabledByHeader):"";return r.html` <div class="permissions-row"> <div> <${l.Icon.Icon.litTagName} class="allowed-icon" .data="${{color:"",iconName:"error_icon",width:"14px"}}"> </${l.Icon.Icon.litTagName}> </div> <div class="feature-name text-ellipsis"> ${e.feature} </div> <div class="block-reason">${c}</div> <div> ${o?M("elements_panel_icon",O(F.clickToShowIframe),(()=>h.Revealer.reveal(o))):r.nothing} ${d?M("network_panel_icon",O(F.clickToShowHeader),(async()=>{if(!d)return;const e=d.responseHeaderValue("permissions-policy")?"permissions-policy":"feature-policy",t=s.UIRequestLocation.UIRequestLocation.responseHeaderMatch(d,{name:e,value:""});await h.Revealer.reveal(t)})):r.nothing} </div> </div> `})));return r.html` <${c.ReportView.ReportKey.litTagName}>${O(F.disabledFeatures)}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName} class="policies-list"> ${i} <div class="permissions-row"> <button class="link" @click="${()=>this.toggleShowPermissionsDisallowedDetails()}"> ${O(F.hideDetails)} </button> </div> </${c.ReportView.ReportValue.litTagName}> `}async render(){await H.write("PermissionsPolicySection render",(()=>{r.render(r.html` <${c.ReportView.ReportSectionHeader.litTagName}>${e.i18n.lockedString("Permissions Policy")}</${c.ReportView.ReportSectionHeader.litTagName}> ${this.renderAllowed()} ${r.Directives.until(this.renderDisallowed(),r.nothing)} <${c.ReportView.ReportSectionDivider.litTagName}></${c.ReportView.ReportSectionDivider.litTagName}> `,this.shadow,{host:this})}))}}i.CustomElements.defineComponent("devtools-resources-permissions-policy-section",_);const W=new CSSStyleSheet;W.replaceSync(":host .badge-error{--override-adorner-text-color:var(--color-red);--override-adorner-border-color:var(--color-red)}:host .badge-success{--override-adorner-text-color:var(--color-accent-green);--override-adorner-border-color:var(--color-accent-green)}:host .badge-secondary{--override-adorner-text-color:var(--color-text-secondary);--override-adorner-border-color:var(--color-text-secondary)}:host{font-family:var(--source-code-font-family)}\n/*# sourceURL=badge.css */\n");const j=new CSSStyleSheet;j.replaceSync(".content{display:grid;grid-template-columns:min-content 1fr}.key{color:var(--color-text-secondary);padding:0 6px;text-align:right;white-space:pre}.value{color:var(--color-text-primary);margin-inline-start:0;padding:0 6px}.error-text{color:var(--color-red);font-weight:700}\n/*# sourceURL=originTrialTokenRows.css */\n");const B=new CSSStyleSheet;B.replaceSync(":host{--legacy-item-selection-bg-color:transparent}\n/*# sourceURL=originTrialTreeView.css */\n");const K={origin:"Origin",trialName:"Trial Name",expiryTime:"Expiry Time",usageRestriction:"Usage Restriction",isThirdParty:"Third Party",matchSubDomains:"Subdomain Matching",rawTokenText:"Raw Token",status:"Token Status",token:"Token",tokens:"{PH1} tokens"},G=e.i18n.registerUIStrings("panels/application/components/OriginTrialTreeView.ts",K),q=e.i18n.getLocalizedString.bind(void 0,G);class z extends HTMLElement{static litTagName=r.literal`devtools-resources-origin-trial-tree-view-badge`;shadow=this.attachShadow({mode:"open"});adorner=new w.Adorner.Adorner;set data(e){this.render(e)}connectedCallback(){this.shadow.adoptedStyleSheets=[W]}render(e){const t=document.createElement("span");t.textContent=e.badgeContent,this.adorner.data={name:"badge",content:t},this.adorner.classList.add(`badge-${e.style}`),r.render(r.html` ${this.adorner} `,this.shadow,{host:this})}}function J(e){return{treeNodeData:e,id:"OriginTrialTreeNode#"+e.trialName,children:async()=>e.tokensWithStatus.length>1?e.tokensWithStatus.map(Y):X(e.tokensWithStatus[0]),renderer:e=>{const t=e.treeNodeData,i=r.html` <${z.litTagName} .data="${{badgeContent:q(K.tokens,{PH1:t.tokensWithStatus.length}),style:"secondary"}}"></${z.litTagName}> `;return r.html` ${t.trialName} <${z.litTagName} .data="${{badgeContent:t.status,style:"Enabled"===t.status?"success":"error"}}"></${z.litTagName}> ${t.tokensWithStatus.length>1?i:r.nothing} `}}}function Y(e){return{treeNodeData:e.status,id:"TokenNode#"+e.rawTokenText,children:async()=>X(e),renderer:(e,t)=>{const i=e.treeNodeData,a=r.html` <${z.litTagName} .data="${{badgeContent:i,style:"Success"===i?"success":"error"}}"></${z.litTagName}> `;return r.html`${q(K.token)} ${t.isExpanded?r.nothing:a}`}}}function Q(e){return r.html` <${ee.litTagName} .data="${{node:e}}"> </${ee.litTagName}> `}function X(e){return[{treeNodeData:e,id:"TokenDetailsNode#"+e.rawTokenText,renderer:Q},(t=e.rawTokenText,{treeNodeData:q(K.rawTokenText),id:"TokenRawTextContainerNode#"+t,children:async()=>[{treeNodeData:t,id:"TokenRawTextNode#"+t,renderer:e=>{const t=e.treeNodeData;return r.html` <div style="overflow-wrap: break-word;"> ${t} </div> `}}]})];var t}function Z(e){return r.html`${String(e.treeNodeData)}`}i.CustomElements.defineComponent("devtools-resources-origin-trial-tree-view-badge",z);class ee extends HTMLElement{static litTagName=r.literal`devtools-resources-origin-trial-token-rows`;shadow=this.attachShadow({mode:"open"});tokenWithStatus=null;parsedTokenDetails=[];dateFormatter=new Intl.DateTimeFormat(e.DevToolsLocale.DevToolsLocale.instance().locale,{dateStyle:"long",timeStyle:"long"});set data(e){this.tokenWithStatus=e.node.treeNodeData,this.setTokenFields()}connectedCallback(){this.shadow.adoptedStyleSheets=[j],this.render()}renderTokenField=(e,t)=>r.html` <div class="${r.Directives.ifDefined(t?"error-text":void 0)}"> ${e} </div>`;setTokenFields(){this.tokenWithStatus?.parsedToken&&(this.parsedTokenDetails=[{name:q(K.origin),value:this.renderTokenField(this.tokenWithStatus.parsedToken.origin,"WrongOrigin"===this.tokenWithStatus.status)},{name:q(K.expiryTime),value:this.renderTokenField(this.dateFormatter.format(1e3*this.tokenWithStatus.parsedToken.expiryTime),"Expired"===this.tokenWithStatus.status)},{name:q(K.usageRestriction),value:this.renderTokenField(this.tokenWithStatus.parsedToken.usageRestriction)},{name:q(K.isThirdParty),value:this.renderTokenField(this.tokenWithStatus.parsedToken.isThirdParty.toString())},{name:q(K.matchSubDomains),value:this.renderTokenField(this.tokenWithStatus.parsedToken.matchSubDomains.toString())}],"UnknownTrial"===this.tokenWithStatus.status&&(this.parsedTokenDetails=[{name:q(K.trialName),value:this.renderTokenField(this.tokenWithStatus.parsedToken.trialName)},...this.parsedTokenDetails]))}render(){if(!this.tokenWithStatus)return;const e=[{name:q(K.status),value:r.html` <${z.litTagName} .data="${{badgeContent:this.tokenWithStatus.status,style:"Success"===this.tokenWithStatus.status?"success":"error"}}"></${z.litTagName}>`},...this.parsedTokenDetails].map((e=>r.html` <div class="key">${e.name}</div> <div class="value">${e.value}</div> `));r.render(r.html` <div class="content"> ${e} </div> `,this.shadow,{host:this})}}i.CustomElements.defineComponent("devtools-resources-origin-trial-token-rows",ee);class te extends HTMLElement{static litTagName=r.literal`devtools-resources-origin-trial-tree-view`;shadow=this.attachShadow({mode:"open"});set data(e){this.render(e.trials)}connectedCallback(){this.shadow.adoptedStyleSheets=[B]}render(e){e.length&&r.render(r.html` <${T.TreeOutline.TreeOutline.litTagName} .data="${{tree:e.map(J),defaultRenderer:Z}}"> </${T.TreeOutline.TreeOutline.litTagName}> `,this.shadow,{host:this})}}i.CustomElements.defineComponent("devtools-resources-origin-trial-tree-view",te);var ie=Object.freeze({__proto__:null,Badge:z,OriginTrialTokenRows:ee,OriginTrialTreeView:te});const re=new CSSStyleSheet;re.replaceSync('.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}button~.text-ellipsis{padding-left:2px}.devtools-link,.link{color:var(--color-link);text-decoration:underline;cursor:pointer;padding:2px 0}button.link{border:none;background:0 0;font-family:inherit;font-size:inherit}.inline-button{padding-left:1ex}.inline-comment{padding-left:1ex;white-space:pre-line}.inline-comment::before{content:"("}.inline-comment::after{content:")"}.inline-name{color:var(--color-text-secondary);padding-left:2ex;user-select:none;white-space:pre-line}.inline-name::after{content:":\\u00a0"}.inline-items{display:flex}.span-cols{grid-column-start:span 2;margin:0 0 8px 30px;line-height:28px}.button-icon-with-text{vertical-align:sub}.without-min-width{min-width:auto}\n/*# sourceURL=frameDetailsReportView.css */\n');const ae={additionalInformation:"Additional Information",thisAdditionalDebugging:"This additional (debugging) information is shown because the 'Protocol Monitor' experiment is enabled.",frameId:"Frame ID",document:"Document",clickToRevealInSourcesPanel:"Click to reveal in Sources panel",clickToRevealInNetworkPanel:"Click to reveal in Network panel",unreachableUrl:"Unreachable URL",clickToRevealInNetworkPanelMight:"Click to reveal in Network panel (might require page reload)",ownerElement:"Owner Element",clickToRevealInElementsPanel:"Click to reveal in Elements panel",adStatus:"Ad Status",rootDescription:"This frame has been identified as the root frame of an ad",root:"root",childDescription:"This frame has been identified as a child frame of an ad",child:"child",securityIsolation:"Security & Isolation",secureContext:"Secure Context",yes:"Yes",no:"No",crossoriginIsolated:"`Cross-Origin` Isolated",localhostIsAlwaysASecureContext:"`Localhost` is always a secure context",aFrameAncestorIsAnInsecure:"A frame ancestor is an insecure context",theFramesSchemeIsInsecure:"The frame's scheme is insecure",reportingTo:"reporting to",apiAvailability:"API availability",availabilityOfCertainApisDepends:"Availability of certain APIs depends on the document being `cross-origin` isolated.",availableTransferable:"available, transferable",availableNotTransferable:"available, not transferable",unavailable:"unavailable",sharedarraybufferConstructorIs:"`SharedArrayBuffer` constructor is available and `SABs` can be transferred via `postMessage`",sharedarraybufferConstructorIsAvailable:"`SharedArrayBuffer` constructor is available but `SABs` cannot be transferred via `postMessage`",willRequireCrossoriginIsolated:"⚠️ will require `cross-origin` isolated context in the future",requiresCrossoriginIsolated:"requires `cross-origin` isolated context",transferRequiresCrossoriginIsolatedPermission:"`SharedArrayBuffer` transfer requires enabling the permission policy:",available:"available",thePerformanceAPI:"The `performance.measureUserAgentSpecificMemory()` API is available",thePerformancemeasureuseragentspecificmemory:"The `performance.measureUserAgentSpecificMemory()` API is not available",measureMemory:"Measure Memory",learnMore:"Learn more",creationStackTrace:"Frame Creation `Stack Trace`",creationStackTraceExplanation:"This frame was created programmatically. The `stack trace` shows where this happened.",parentIsAdExplanation:"This frame is considered an ad frame because its parent frame is an ad frame.",matchedBlockingRuleExplanation:"This frame is considered an ad frame because its current (or previous) main document is an ad resource.",createdByAdScriptExplanation:"There was an ad script in the `(async) stack` when this frame was created. Examining the creation `stack trace` of this frame might provide more insight."},oe=e.i18n.registerUIStrings("panels/application/components/FrameDetailsView.ts",ae),ne=e.i18n.getLocalizedString.bind(void 0,oe);class se extends u.ThrottledWidget.ThrottledWidget{reportView=new de;frame;constructor(e){super(),this.frame=e,this.contentElement.classList.add("overflow-auto"),this.contentElement.appendChild(this.reportView),this.update()}async doUpdate(){this.reportView.data={frame:this.frame}}}const le=d.RenderCoordinator.RenderCoordinator.instance();class de extends HTMLElement{static litTagName=r.literal`devtools-resources-frame-details-view`;shadow=this.attachShadow({mode:"open"});frame;protocolMonitorExperimentEnabled=!1;permissionsPolicies=null;permissionsPolicySectionData={policies:[],showDetails:!1};originTrialTreeView=new te;connectedCallback(){this.protocolMonitorExperimentEnabled=p.Runtime.experiments.isEnabled("protocolMonitor"),this.shadow.adoptedStyleSheets=[re]}set data(e){this.frame=e.frame,!this.permissionsPolicies&&this.frame&&(this.permissionsPolicies=this.frame.getPermissionsPolicyState()),this.render()}async render(){await le.write("FrameDetailsView render",(()=>{this.frame&&r.render(r.html` <${c.ReportView.Report.litTagName} .data="${{reportTitle:this.frame.displayName()}}"> ${this.renderDocumentSection()} ${this.renderIsolationSection()} ${this.renderApiAvailabilitySection()} ${this.renderOriginTrial()} ${r.Directives.until(this.permissionsPolicies?.then((e=>(this.permissionsPolicySectionData.policies=e||[],r.html` <${_.litTagName} .data="${this.permissionsPolicySectionData}"> </${_.litTagName}> `))),r.nothing)} ${this.protocolMonitorExperimentEnabled?this.renderAdditionalInfoSection():r.nothing} </${c.ReportView.Report.litTagName}> `,this.shadow,{host:this})}))}renderOriginTrial(){if(!this.frame)return r.nothing;this.originTrialTreeView.classList.add("span-cols");const t=this.frame,i=()=>{t.getOriginTrials().then((e=>{this.originTrialTreeView.data={trials:e}}))};return i(),r.html` <${c.ReportView.ReportSectionHeader.litTagName}> ${e.i18n.lockedString("Origin Trials")} <${l.IconButton.IconButton.litTagName} class="inline-button" .data="${{clickHandler:i,groups:[{iconName:"refresh_12x12_icon",text:"Refresh"}]}}"> </${l.IconButton.IconButton.litTagName}> </${c.ReportView.ReportSectionHeader.litTagName}> ${this.originTrialTreeView} <${c.ReportView.ReportSectionDivider.litTagName}></${c.ReportView.ReportSectionDivider.litTagName}> `}renderDocumentSection(){return this.frame?r.html` <${c.ReportView.ReportSectionHeader.litTagName}>${ne(ae.document)}</${c.ReportView.ReportSectionHeader.litTagName}> <${c.ReportView.ReportKey.litTagName}>${e.i18n.lockedString("URL")}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> <div class="inline-items"> ${this.maybeRenderSourcesLinkForURL()} ${this.maybeRenderNetworkLinkForURL()} <div class="text-ellipsis" title="${this.frame.url}">${this.frame.url}</div> </div> </${c.ReportView.ReportValue.litTagName}> ${this.maybeRenderUnreachableURL()} ${this.maybeRenderOrigin()} ${r.Directives.until(this.renderOwnerElement(),r.nothing)} ${this.maybeRenderCreationStacktrace()} ${this.maybeRenderAdStatus()} <${c.ReportView.ReportSectionDivider.litTagName}></${c.ReportView.ReportSectionDivider.litTagName}> `:r.nothing}maybeRenderSourcesLinkForURL(){if(!this.frame||this.frame.unreachableUrl())return r.nothing;const e=this.uiSourceCodeForFrame(this.frame);return M("sources_panel_icon",ne(ae.clickToRevealInSourcesPanel),(()=>h.Revealer.reveal(e)))}maybeRenderNetworkLinkForURL(){if(this.frame){const e=this.frame.resourceForURL(this.frame.url);if(e&&e.request){const t=e.request;return M("network_panel_icon",ne(ae.clickToRevealInNetworkPanel),(()=>{const e=s.UIRequestLocation.UIRequestLocation.tab(t,s.UIRequestLocation.UIRequestTabs.Headers);return h.Revealer.reveal(e)}))}}return r.nothing}uiSourceCodeForFrame(e){for(const t of g.Workspace.WorkspaceImpl.instance().projects()){const i=m.NetworkProject.NetworkProject.getTargetForProject(t);if(i&&i===e.resourceTreeModel().target()){const i=t.uiSourceCodeForURL(e.url);if(i)return i}}return null}maybeRenderUnreachableURL(){return this.frame&&this.frame.unreachableUrl()?r.html` <${c.ReportView.ReportKey.litTagName}>${ne(ae.unreachableUrl)}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> <div class="inline-items"> ${this.renderNetworkLinkForUnreachableURL()} <div class="text-ellipsis" title="${this.frame.unreachableUrl()}">${this.frame.unreachableUrl()}</div> </div> </${c.ReportView.ReportValue.litTagName}> `:r.nothing}renderNetworkLinkForUnreachableURL(){if(this.frame){const e=h.ParsedURL.ParsedURL.fromString(this.frame.unreachableUrl());if(e)return M("network_panel_icon",ne(ae.clickToRevealInNetworkPanelMight),(()=>{h.Revealer.reveal(s.UIFilter.UIRequestFilter.filters([{filterType:s.UIFilter.FilterType.Domain,filterValue:e.domain()},{filterType:null,filterValue:e.path}]))}))}return r.nothing}maybeRenderOrigin(){return this.frame&&this.frame.securityOrigin&&"://"!==this.frame.securityOrigin?r.html` <${c.ReportView.ReportKey.litTagName}>${e.i18n.lockedString("Origin")}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> <div class="text-ellipsis" title="${this.frame.securityOrigin}">${this.frame.securityOrigin}</div> </${c.ReportView.ReportValue.litTagName}> `:r.nothing}async renderOwnerElement(){if(this.frame){const e=await this.frame.getOwnerDOMNodeOrDocument();if(e)return r.html` <${c.ReportView.ReportKey.litTagName}>${ne(ae.ownerElement)}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName} class="without-min-width"> <button class="link" role="link" tabindex="0" title="${ne(ae.clickToRevealInElementsPanel)}" @mouseenter="${()=>this.frame?.highlight()}" @mouseleave="${()=>n.OverlayModel.OverlayModel.hideDOMNodeHighlight()}" @click="${()=>h.Revealer.reveal(e)}"> <${l.Icon.Icon.litTagName} class="button-icon-with-text" .data="${{iconName:"elements_panel_icon",color:"var(--color-primary)",width:"16px",height:"16px"}}"></${l.Icon.Icon.litTagName}> &lt;${e.nodeName().toLocaleLowerCase()}> </button> </${c.ReportView.ReportValue.litTagName}> `}return r.nothing}maybeRenderCreationStacktrace(){const e=this.frame?.getCreationStackTraceData();return e&&e.creationStackTrace?r.html` <${c.ReportView.ReportKey.litTagName} title="${ne(ae.creationStackTraceExplanation)}">${ne(ae.creationStackTrace)}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> <${A.litTagName} .data="${{frame:this.frame,buildStackTraceRows:o.JSPresentationUtils.buildStackTraceRows}}"> </${A.litTagName}> </${c.ReportView.ReportValue.litTagName}> `:r.nothing}getAdFrameTypeStrings(e){switch(e){case"child":return{value:ne(ae.child),description:ne(ae.childDescription)};case"root":return{value:ne(ae.root),description:ne(ae.rootDescription)}}}getAdFrameExplanationString(e){switch(e){case"CreatedByAdScript":return ne(ae.createdByAdScriptExplanation);case"MatchedBlockingRule":return ne(ae.matchedBlockingRuleExplanation);case"ParentIsAd":return ne(ae.parentIsAdExplanation)}}maybeRenderAdStatus(){if(!this.frame)return r.nothing;const e=this.frame.adFrameType();if("none"===e)return r.nothing;const t=this.getAdFrameTypeStrings(e),i=[r.html`<div title="${t.description}">${t.value}</div>`];for(const e of this.frame.adFrameStatus()?.explanations||[])i.push(r.html`<div>${this.getAdFrameExplanationString(e)}</div>`);return r.html` <${c.ReportView.ReportKey.litTagName}>${ne(ae.adStatus)}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> <${a.ExpandableList.ExpandableList.litTagName} .data="${{rows:i}}"></${a.ExpandableList.ExpandableList.litTagName}></${c.ReportView.ReportValue.litTagName}> `}renderIsolationSection(){return this.frame?r.html` <${c.ReportView.ReportSectionHeader.litTagName}>${ne(ae.securityIsolation)}</${c.ReportView.ReportSectionHeader.litTagName}> <${c.ReportView.ReportKey.litTagName}>${ne(ae.secureContext)}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> ${this.frame.isSecureContext()?ne(ae.yes):ne(ae.no)}\xA0${this.maybeRenderSecureContextExplanation()} </${c.ReportView.ReportValue.litTagName}> <${c.ReportView.ReportKey.litTagName}>${ne(ae.crossoriginIsolated)}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> ${this.frame.isCrossOriginIsolated()?ne(ae.yes):ne(ae.no)} </${c.ReportView.ReportValue.litTagName}> ${r.Directives.until(this.maybeRenderCoopCoepStatus(),r.nothing)} <${c.ReportView.ReportSectionDivider.litTagName}></${c.ReportView.ReportSectionDivider.litTagName}> `:r.nothing}maybeRenderSecureContextExplanation(){const e=this.getSecureContextExplanation();return e?r.html`<span class="inline-comment">${e}</span>`:r.nothing}getSecureContextExplanation(){switch(this.frame?.getSecureContextType()){case"Secure":return null;case"SecureLocalhost":return ne(ae.localhostIsAlwaysASecureContext);case"InsecureAncestor":return ne(ae.aFrameAncestorIsAnInsecure);case"InsecureScheme":return ne(ae.theFramesSchemeIsInsecure)}return null}async maybeRenderCoopCoepStatus(){if(this.frame){const t=this.frame.resourceTreeModel().target().model(n.NetworkManager.NetworkManager),i=t&&await t.getSecurityIsolationStatus(this.frame.id);if(i)return r.html` ${this.maybeRenderCrossOriginStatus(i.coep,e.i18n.lockedString("Cross-Origin Embedder Policy (COEP)"),"None")} ${this.maybeRenderCrossOriginStatus(i.coop,e.i18n.lockedString("Cross-Origin Opener Policy (COOP)"),"UnsafeNone")} `}return r.nothing}maybeRenderCrossOriginStatus(e,t,i){if(!e)return r.nothing;const a=e.value!==i,o=!a&&e.reportOnlyValue!==i,n=a?e.reportingEndpoint:e.reportOnlyReportingEndpoint;return r.html` <${c.ReportView.ReportKey.litTagName}>${t}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> ${a?e.value:e.reportOnlyValue} ${o?r.html`<span class="inline-comment">report-only</span>`:r.nothing} ${n?r.html`<span class="inline-name">${ne(ae.reportingTo)}</span>${n}`:r.nothing} </${c.ReportView.ReportValue.litTagName}> `}renderApiAvailabilitySection(){return this.frame?r.html` <${c.ReportView.ReportSectionHeader.litTagName}>${ne(ae.apiAvailability)}</${c.ReportView.ReportSectionHeader.litTagName}> <div class="span-cols"> ${ne(ae.availabilityOfCertainApisDepends)} <x-link href="https://web.dev/why-coop-coep/" class="link">${ne(ae.learnMore)}</x-link> </div> ${this.renderSharedArrayBufferAvailability()} ${this.renderMeasureMemoryAvailability()} <${c.ReportView.ReportSectionDivider.litTagName}></${c.ReportView.ReportSectionDivider.litTagName}> `:r.nothing}renderSharedArrayBufferAvailability(){if(this.frame){const e=this.frame.getGatedAPIFeatures();if(e){const t=e.includes("SharedArrayBuffers"),i=t&&e.includes("SharedArrayBuffersTransferAllowed"),a=ne(i?ae.availableTransferable:t?ae.availableNotTransferable:ae.unavailable),o=i?ne(ae.sharedarraybufferConstructorIs):t?ne(ae.sharedarraybufferConstructorIsAvailable):"";function n(e){switch(e.getCrossOriginIsolatedContextType()){case"Isolated":return r.nothing;case"NotIsolated":return t?r.html`<span class="inline-comment">${ne(ae.willRequireCrossoriginIsolated)}</span>`:r.html`<span class="inline-comment">${ne(ae.requiresCrossoriginIsolated)}</span>`;case"NotIsolatedFeatureDisabled":if(!i)return r.html`<span class="inline-comment">${ne(ae.transferRequiresCrossoriginIsolatedPermission)} <code>cross-origin-isolated</code></span>`}return r.nothing}return r.html` <${c.ReportView.ReportKey.litTagName}>SharedArrayBuffers</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName} title="${o}"> ${a}\xA0${n(this.frame)} </${c.ReportView.ReportValue.litTagName}> `}}return r.nothing}renderMeasureMemoryAvailability(){if(this.frame){const e=this.frame.isCrossOriginIsolated(),t=ne(e?ae.available:ae.unavailable),i=ne(e?ae.thePerformanceAPI:ae.thePerformancemeasureuseragentspecificmemory);return r.html` <${c.ReportView.ReportKey.litTagName}>${ne(ae.measureMemory)}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> <span title="${i}">${t}</span>\xA0<x-link class="link" href="https://web.dev/monitor-total-page-memory-usage/">${ne(ae.learnMore)}</x-link> </${c.ReportView.ReportValue.litTagName}> `}return r.nothing}renderAdditionalInfoSection(){return this.frame?r.html` <${c.ReportView.ReportSectionHeader.litTagName} title="${ne(ae.thisAdditionalDebugging)}">${ne(ae.additionalInformation)}</${c.ReportView.ReportSectionHeader.litTagName}> <${c.ReportView.ReportKey.litTagName}>${ne(ae.frameId)}</${c.ReportView.ReportKey.litTagName}> <${c.ReportView.ReportValue.litTagName}> <div class="text-ellipsis" title="${this.frame.id}">${this.frame.id}</div> </${c.ReportView.ReportValue.litTagName}> <${c.ReportView.ReportSectionDivider.litTagName}></${c.ReportView.ReportSectionDivider.litTagName}> `:r.nothing}}i.CustomElements.defineComponent("devtools-resources-frame-details-view",de);var ce=Object.freeze({__proto__:null,FrameDetailsView:se,FrameDetailsReportView:de});const he={noReportsToDisplay:"No reports to display"},me=e.i18n.registerUIStrings("panels/application/components/ReportsGrid.ts",he),pe=e.i18n.getLocalizedString.bind(void 0,me),{render:ue,html:ge}=r;class we extends HTMLElement{static litTagName=r.literal`devtools-resources-reports-grid-status-header`;shadow=this.attachShadow({mode:"open"});connectedCallback(){this.shadow.adoptedStyleSheets=[f],this.render()}render(){ue(ge` ${e.i18n.lockedString("Status")} <x-link href="https://web.dev/reporting-api/#report-status"> <${l.Icon.Icon.litTagName} class="inline-icon" .data="${{iconName:"help_outline",color:"var(--color-primary)",width:"16px",height:"16px"}}"></${l.Icon.Icon.litTagName}> </x-link> `,this.shadow,{host:this})}}class Te extends HTMLElement{static litTagName=r.literal`devtools-resources-reports-grid`;shadow=this.attachShadow({mode:"open"});reports=[];protocolMonitorExperimentEnabled=!1;connectedCallback(){this.shadow.adoptedStyleSheets=[f],this.protocolMonitorExperimentEnabled=p.Runtime.experiments.isEnabled("protocolMonitor"),this.render()}set data(e){this.reports=e.reports,this.render()}render(){const i={columns:[{id:"url",title:e.i18n.lockedString("URL"),widthWeighting:30,hideable:!1,visible:!0},{id:"type",title:e.i18n.lockedString("Type"),widthWeighting:20,hideable:!1,visible:!0},{id:"status",title:e.i18n.lockedString("Status"),widthWeighting:20,hideable:!1,visible:!0,titleElement:ge` <${we.litTagName}></${we.litTagName}> `},{id:"destination",title:e.i18n.lockedString("Destination"),widthWeighting:20,hideable:!1,visible:!0},{id:"timestamp",title:e.i18n.lockedString("Timestamp"),widthWeighting:20,hideable:!1,visible:!0},{id:"body",title:e.i18n.lockedString("Body"),widthWeighting:20,hideable:!1,visible:!0}],rows:this.buildReportRows()};this.protocolMonitorExperimentEnabled&&i.columns.unshift({id:"id",title:"ID",widthWeighting:30,hideable:!1,visible:!0}),ue(ge` <div class="reporting-container"> <div class="reporting-header">${e.i18n.lockedString("Reports")}</div> ${this.reports.length>0?ge` <${t.DataGridController.DataGridController.litTagName} .data="${i}"> </${t.DataGridController.DataGridController.litTagName}> `:ge` <div class="reporting-placeholder"> <div>${pe(he.noReportsToDisplay)}</div> </div> `} </div> `,this.shadow,{host:this})}buildReportRows(){return this.reports.map((e=>({cells:[{columnId:"id",value:e.id},{columnId:"url",value:e.initiatorUrl},{columnId:"type",value:e.type},{columnId:"status",value:e.status},{columnId:"destination",value:e.destination},{columnId:"timestamp",value:new Date(1e3*e.timestamp).toLocaleString()},{columnId:"body",value:JSON.stringify(e.body)}]})))}}i.CustomElements.defineComponent("devtools-resources-reports-grid-status-header",we),i.CustomElements.defineComponent("devtools-resources-reports-grid",Te);var fe=Object.freeze({__proto__:null,i18nString:pe,ReportsGridStatusHeader:we,ReportsGrid:Te});const Se=new CSSStyleSheet;Se.replaceSync(":host{padding:20px}.heading{font-size:15px}devtools-data-grid-controller{border:1px solid var(--color-details-hairline);margin-top:20px}.info-icon{vertical-align:text-bottom;height:14px}.no-tt-message{margin-top:20px}\n/*# sourceURL=trustTokensView.css */\n");const ve=new CSSStyleSheet;ve.replaceSync(".delete-button{width:16px;height:16px;background:0 0;overflow:hidden;border:none;padding:0;outline:0;cursor:pointer}.delete-button:hover devtools-icon{--icon-color:var(--color-text-primary)}.delete-button:focus devtools-icon{--icon-color:var(--color-text-secondary)}.button-container{display:block;text-align:center}\n/*# sourceURL=trustTokensViewDeleteButton.css */\n");const Re={issuer:"Issuer",storedTokenCount:"Stored token count",allStoredTrustTokensAvailableIn:"All stored Trust Tokens available in this browser instance.",noTrustTokensStored:"No Trust Tokens are currently stored.",deleteTrustTokens:"Delete all stored Trust Tokens issued by {PH1}."},ke=e.i18n.registerUIStrings("panels/application/components/TrustTokensView.ts",Re),$e=e.i18n.getLocalizedString.bind(void 0,ke);class be extends HTMLElement{static litTagName=r.literal`devtools-trust-tokens-delete-button`;shadow=this.attachShadow({mode:"open"});issuer=null;deleteClickHandler=()=>{};connectedCallback(){this.shadow.adoptedStyleSheets=[ve]}set data(e){this.issuer=e.issuer,this.deleteClickHandler=e.deleteClickHandler,this.render()}render(){this.issuer&&r.render(r.html` <span class="button-container"> <button class="delete-button" title="${$e(Re.deleteTrustTokens,{PH1:this.issuer})}" @click="${()=>this.deleteClickHandler(this.issuer)}"> <${l.Icon.Icon.litTagName} .data="${{iconName:"trash_bin_icon",color:"var(--color-text-secondary)",width:"9px",height:"14px"}}"> </${l.Icon.Icon.litTagName}> </button> </span>`,this.shadow,{host:this})}}class ye extends HTMLElement{static litTagName=r.literal`devtools-trust-tokens-storage-view`;shadow=this.attachShadow({mode:"open"});tokens=[];deleteClickHandler=()=>{};connectedCallback(){this.shadow.adoptedStyleSheets=[Se],this.render()}set data(e){this.tokens=e.tokens,this.deleteClickHandler=e.deleteClickHandler,this.render()}render(){r.render(r.html` <div> <span class="heading">Trust Tokens</span> <${l.Icon.Icon.litTagName} class="info-icon" title="${$e(Re.allStoredTrustTokensAvailableIn)}" .data="${{iconName:"ic_info_black_18dp",color:"var(--color-link)",width:"14px"}}"> </${l.Icon.Icon.litTagName}> ${this.renderGridOrNoDataMessage()} </div> `,this.shadow,{host:this})}renderGridOrNoDataMessage(){if(0===this.tokens.length)return r.html`<div class="no-tt-message">${$e(Re.noTrustTokensStored)}</div>`;const e={columns:[{id:"issuer",title:$e(Re.issuer),widthWeighting:10,hideable:!1,visible:!0,sortable:!0},{id:"count",title:$e(Re.storedTokenCount),widthWeighting:5,hideable:!1,visible:!0,sortable:!0},{id:"delete-button",title:"",widthWeighting:1,hideable:!1,visible:!0,sortable:!1}],rows:this.buildRowsFromTokens(),initialSort:{columnId:"issuer",direction:"ASC"}};return r.html` <${t.DataGridController.DataGridController.litTagName} .data="${e}"></${t.DataGridController.DataGridController.litTagName}> `}buildRowsFromTokens(){return this.tokens.filter((e=>e.count>0)).map((e=>({cells:[{columnId:"delete-button",value:Ne(e.issuerOrigin),renderer:this.deleteButtonRendererForDataGridCell.bind(this)},{columnId:"issuer",value:Ne(e.issuerOrigin)},{columnId:"count",value:e.count}]})))}deleteButtonRendererForDataGridCell(e){return r.html`<${be.litTagName} .data="${{issuer:e,deleteClickHandler:this.deleteClickHandler}}"></${be.litTagName}>`}}function Ne(e){return e.replace(/\/$/,"")}i.CustomElements.defineComponent("devtools-trust-tokens-delete-button",be),i.CustomElements.defineComponent("devtools-trust-tokens-storage-view",ye);var xe=Object.freeze({__proto__:null,i18nString:$e,TrustTokensView:ye});export{y as EndpointsGrid,ce as FrameDetailsView,ie as OriginTrialTreeView,fe as ReportsGrid,L as StackTrace,xe as TrustTokensView};
