import*as e from"../../models/issues_manager/issues_manager.js";import*as t from"../../core/i18n/i18n.js";import*as s from"../../ui/legacy/legacy.js";import*as i from"../../ui/components/data_grid/data_grid.js";import*as n from"../../ui/components/linkifier/linkifier.js";import*as a from"../../ui/lit-html/lit-html.js";import*as r from"../../core/common/common.js";import*as o from"../../core/root/root.js";import*as d from"../../ui/components/issue_counter/issue_counter.js";import*as l from"../../ui/components/adorners/adorners.js";import*as u from"../../core/host/host.js";import*as c from"../../ui/components/icon_button/icon_button.js";import*as p from"../../ui/components/markdown_view/markdown_view.js";import*as h from"../network/forward/forward.js";import*as g from"./components/components.js";import*as f from"../../core/sdk/sdk.js";import*as m from"../elements/components/components.js";import*as C from"../../models/logs/logs.js";import*as I from"../../ui/legacy/components/utils/utils.js";import*as y from"../../ui/components/request_link_icon/request_link_icon.js";import*as w from"../../core/platform/platform.js";const b=new CSSStyleSheet;b.replaceSync(".csp-violations-pane{overflow:hidden}.csp-violations-toolbar{border-bottom:var(--color-details-hairline)}\n/*# sourceURL=cspViolationsView.css */\n");class v extends s.Toolbar.ToolbarButton{options=new Array;headers=new Array;onOptionClicked=()=>{};constructor(e){super(e),this.turnIntoSelect(),this.addEventListener(s.Toolbar.ToolbarButton.Events.Click,this.showLevelContextMenu.bind(this)),s.ARIAUtils.markAsMenuButton(this.element)}addOption(e,t,s){this.options.push({title:e,value:t,default:s,enabled:s})}setOptionEnabled(e,t){const s=this.options[e];s&&(s.enabled=t,this.onOptionClicked())}addHeader(e,t){this.headers.push({title:e,callback:t})}setOnOptionClicked(e){this.onOptionClicked=e}getOptions(){return this.options}showLevelContextMenu({data:e}){const t=new s.ContextMenu.ContextMenu(e,{useSoftMenu:!0,x:this.element.totalOffsetLeft(),y:this.element.totalOffsetTop()+this.element.offsetHeight});for(const{title:e,callback:s}of this.headers)t.headerSection().appendCheckboxItem(e,(()=>s()));for(const[e,{title:s,enabled:i}]of this.options.entries())t.defaultSection().appendCheckboxItem(s,(()=>{this.setOptionEnabled(e,!i)}),i);t.show()}}const k=new CSSStyleSheet;k.replaceSync("\n/*# sourceURL=cspViolationsListView.css */\n");class R extends s.Widget.VBox{table=new i.DataGridController.DataGridController;categoryFilter=new Set;issueRows=new Map;constructor(){super(!0),this.table.data={columns:[{id:"sourceCode",title:"Source Code",sortable:!1,widthWeighting:1,visible:!0,hideable:!1},{id:"violatedDirective",title:"Violated Directive",sortable:!1,widthWeighting:1,visible:!0,hideable:!1},{id:"category",title:"Category",sortable:!1,widthWeighting:1,visible:!0,hideable:!1},{id:"status",title:"Status",sortable:!1,widthWeighting:1,visible:!0,hideable:!1}],rows:[]},this.contentElement.appendChild(this.table)}updateTextFilter(e){0===e.length?this.table.data={...this.table.data,filters:[]}:this.table.data={...this.table.data,filters:[{text:e,key:void 0,regex:void 0,negative:!1}]}}updateCategoryFilter(e){this.categoryFilter=e;const t=[];for(const[e,s]of this.issueRows.entries())this.isIssueInFilterCategories(e)&&t.push(s);this.table.data={...this.table.data,rows:t}}isIssueInFilterCategories(e){return this.categoryFilter.has(e.code())||0===this.categoryFilter.size}addIssue(t){const s=e.Issue.toZeroBasedLocation(t.details().sourceCodeLocation);if(!s)return;const i=t.details().isReportOnly?"report-only":"blocked",r=this.issueViolationCodeToCategoryName(t.code()),o={cells:[{columnId:"sourceCode",value:s.url,renderer:()=>a.html`<${n.Linkifier.Linkifier.litTagName} .data="${s}"></${n.Linkifier.Linkifier.litTagName}>`},{columnId:"violatedDirective",value:t.details().violatedDirective},{columnId:"category",value:r},{columnId:"status",value:i}]};this.issueRows.set(t,o),this.isIssueInFilterCategories(t)&&(this.table.data.rows.push(o),this.table.data={...this.table.data})}clearIssues(){this.issueRows.clear(),this.table.data={...this.table.data,rows:[]}}issueViolationCodeToCategoryName(t){return t===e.ContentSecurityPolicyIssue.inlineViolationCode?"Inline Violation":t===e.ContentSecurityPolicyIssue.urlViolationCode?"URL Violation":t===e.ContentSecurityPolicyIssue.evalViolationCode?"Eval Violation":t===e.ContentSecurityPolicyIssue.trustedTypesSinkViolationCode?"Sink Violation":t===e.ContentSecurityPolicyIssue.trustedTypesPolicyViolationCode?"Policy Violation":"unknown"}wasShown(){super.wasShown(),this.registerCSSFiles([k])}}const S={filter:"Filter"},T=t.i18n.registerUIStrings("panels/issues/CSPViolationsView.ts",S),x=t.i18n.getLocalizedString.bind(void 0,T);let A;class E extends s.Widget.VBox{listView=new R;issuesManager=e.IssuesManager.IssuesManager.instance();constructor(){super(!0),this.contentElement.classList.add("csp-violations-pane");const t=new s.Toolbar.Toolbar("csp-violations-toolbar",this.contentElement),i=new s.Toolbar.ToolbarInput(x(S.filter),"",1,.2,"");i.addEventListener(s.Toolbar.ToolbarInput.Event.TextChanged,(()=>{this.listView.updateTextFilter(i.value())})),t.appendToolbarItem(i);const n=new v("Categories");n.setText("Categories"),n.addOption("Trusted Type Policy",e.ContentSecurityPolicyIssue.trustedTypesPolicyViolationCode,!0),n.addOption("Trusted Type Sink",e.ContentSecurityPolicyIssue.trustedTypesSinkViolationCode,!0),n.addOption("CSP Inline",e.ContentSecurityPolicyIssue.inlineViolationCode,!0),n.addOption("CSP Eval",e.ContentSecurityPolicyIssue.evalViolationCode,!0),n.addOption("CSP URL",e.ContentSecurityPolicyIssue.urlViolationCode,!0),n.addHeader("Reset",(()=>{n.getOptions().forEach(((e,t)=>n.setOptionEnabled(t,e.default)))})),n.setOnOptionClicked((()=>{const e=new Set(n.getOptions().filter((e=>e.enabled)).map((e=>e.value)));this.listView.updateCategoryFilter(e)})),t.appendToolbarItem(n),this.listView.show(this.contentElement),this.issuesManager.addEventListener("IssueAdded",this.onIssueAdded,this),this.issuesManager.addEventListener("FullUpdateRequired",this.onFullUpdateRequired,this),this.addAllIssues()}static instance(e={forceNew:null}){const{forceNew:t}=e;return A&&!t||(A=new E),A}onIssueAdded(t){const{issue:s}=t.data;s instanceof e.ContentSecurityPolicyIssue.ContentSecurityPolicyIssue&&this.listView.addIssue(s)}onFullUpdateRequired(){this.listView.clearIssues(),this.addAllIssues()}addAllIssues(){for(const t of this.issuesManager.issues())t instanceof e.ContentSecurityPolicyIssue.ContentSecurityPolicyIssue&&this.listView.addIssue(t)}wasShown(){super.wasShown(),this.registerCSSFiles([b])}}var L=Object.freeze({__proto__:null,CSPViolationsView:E});class M extends e.Issue.Issue{affectedCookies=new Map;affectedRawCookieLines=new Map;affectedRequests=new Map;affectedLocations=new Map;heavyAdIssues=new Set;blockedByResponseDetails=new Map;corsIssues=new Set;cspIssues=new Set;issueKind=e.Issue.IssueKind.Improvement;lowContrastIssues=new Set;mixedContentIssues=new Set;sharedArrayBufferIssues=new Set;trustedWebActivityIssues=new Set;quirksModeIssues=new Set;attributionReportingIssues=new Set;wasmCrossOriginModuleSharingIssues=new Set;genericIssues=new Set;representative;aggregatedIssuesCount=0;key;constructor(e,t){super(e),this.key=t}primaryKey(){throw new Error("This should never be called")}aggregationKey(){return this.key}getBlockedByResponseDetails(){return this.blockedByResponseDetails.values()}cookies(){return Array.from(this.affectedCookies.values()).map((e=>e.cookie))}getRawCookieLines(){return this.affectedRawCookieLines.values()}sources(){return this.affectedLocations.values()}cookiesWithRequestIndicator(){return this.affectedCookies.values()}getHeavyAdIssues(){return this.heavyAdIssues}getMixedContentIssues(){return this.mixedContentIssues}getTrustedWebActivityIssues(){return this.trustedWebActivityIssues}getCorsIssues(){return this.corsIssues}getCspIssues(){return this.cspIssues}getLowContrastIssues(){return this.lowContrastIssues}requests(){return this.affectedRequests.values()}getSharedArrayBufferIssues(){return this.sharedArrayBufferIssues}getQuirksModeIssues(){return this.quirksModeIssues}getAttributionReportingIssues(){return this.attributionReportingIssues}getWasmCrossOriginModuleSharingIssue(){return this.wasmCrossOriginModuleSharingIssues}getGenericIssues(){return this.genericIssues}getDescription(){return this.representative?this.representative.getDescription():null}getCategory(){return this.representative?this.representative.getCategory():e.Issue.IssueCategory.Other}getAggregatedIssuesCount(){return this.aggregatedIssuesCount}keyForCookie(e){const{domain:t,path:s,name:i}=e;return`${t};${s};${i}`}addInstance(t){this.aggregatedIssuesCount++,this.representative||(this.representative=t),this.issueKind=e.Issue.unionIssueKind(this.issueKind,t.getKind());let s=!1;for(const e of t.requests())s=!0,this.affectedRequests.has(e.requestId)||this.affectedRequests.set(e.requestId,e);for(const e of t.cookies()){const t=this.keyForCookie(e);this.affectedCookies.has(t)||this.affectedCookies.set(t,{cookie:e,hasRequest:s})}for(const e of t.rawCookieLines())this.affectedRawCookieLines.has(e)||this.affectedRawCookieLines.set(e,{rawCookieLine:e,hasRequest:s});for(const e of t.sources()){const t=JSON.stringify(e);this.affectedLocations.has(t)||this.affectedLocations.set(t,e)}t instanceof e.MixedContentIssue.MixedContentIssue&&this.mixedContentIssues.add(t),t instanceof e.HeavyAdIssue.HeavyAdIssue&&this.heavyAdIssues.add(t);for(const e of t.getBlockedByResponseDetails()){const t=JSON.stringify(e,["parentFrame","blockedFrame","requestId","frameId","reason","request"]);this.blockedByResponseDetails.set(t,e)}t instanceof e.TrustedWebActivityIssue.TrustedWebActivityIssue&&this.trustedWebActivityIssues.add(t),t instanceof e.ContentSecurityPolicyIssue.ContentSecurityPolicyIssue&&this.cspIssues.add(t),t instanceof e.SharedArrayBufferIssue.SharedArrayBufferIssue&&this.sharedArrayBufferIssues.add(t),t instanceof e.LowTextContrastIssue.LowTextContrastIssue&&this.lowContrastIssues.add(t),t instanceof e.CorsIssue.CorsIssue&&this.corsIssues.add(t),t instanceof e.QuirksModeIssue.QuirksModeIssue&&this.quirksModeIssues.add(t),t instanceof e.AttributionReportingIssue.AttributionReportingIssue&&this.attributionReportingIssues.add(t),t instanceof e.WasmCrossOriginModuleSharingIssue.WasmCrossOriginModuleSharingIssue&&this.wasmCrossOriginModuleSharingIssues.add(t),t instanceof e.GenericIssue.GenericIssue&&this.genericIssues.add(t)}getKind(){return this.issueKind}isHidden(){return this.representative?.isHidden()||!1}setHidden(e){throw new Error("Should not call setHidden on aggregatedIssue")}}class D extends r.ObjectWrapper.ObjectWrapper{issuesManager;aggregatedIssuesByKey=new Map;hiddenAggregatedIssuesByKey=new Map;constructor(e){super(),this.issuesManager=e,this.issuesManager.addEventListener("IssueAdded",this.onIssueAdded,this),this.issuesManager.addEventListener("FullUpdateRequired",this.onFullUpdateRequired,this);for(const e of this.issuesManager.issues())this.aggregateIssue(e)}onIssueAdded(e){this.aggregateIssue(e.data.issue)}onFullUpdateRequired(){this.aggregatedIssuesByKey.clear(),this.hiddenAggregatedIssuesByKey.clear();for(const e of this.issuesManager.issues())this.aggregateIssue(e);this.dispatchEventToListeners("FullUpdateRequired")}aggregateIssue(e){const t=e.isHidden()?this.hiddenAggregatedIssuesByKey:this.aggregatedIssuesByKey,s=this.aggregateIssueByStatus(t,e);return this.dispatchEventToListeners("AggregatedIssueUpdated",s),s}aggregateIssueByStatus(e,t){const s=t.code();let i=e.get(s);return i||(i=new M(t.code(),s),e.set(s,i)),i.addInstance(t),i}aggregatedIssues(){return[...this.aggregatedIssuesByKey.values(),...this.hiddenAggregatedIssuesByKey.values()]}hiddenAggregatedIssues(){return this.hiddenAggregatedIssuesByKey.values()}aggregatedIssueCodes(){return new Set([...this.aggregatedIssuesByKey.keys(),...this.hiddenAggregatedIssuesByKey.keys()])}aggregatedIssueCategories(){const e=new Set;for(const t of this.aggregatedIssuesByKey.values())e.add(t.getCategory());return e}aggregatedIssueKinds(){const e=new Set;for(const t of this.aggregatedIssuesByKey.values())e.add(t.getKind());return e}numberOfAggregatedIssues(){return this.aggregatedIssuesByKey.size}numberOfHiddenAggregatedIssues(){return this.hiddenAggregatedIssuesByKey.size}keyForIssue(e){return e.code()}}var P=Object.freeze({__proto__:null,AggregatedIssue:M,IssueAggregator:D});const O={hiddenIssues:"Hidden issues",unhideAll:"Unhide all"},q=t.i18n.registerUIStrings("panels/issues/HiddenIssuesRow.ts",O),V=t.i18n.getLocalizedString.bind(void 0,q);class U extends s.TreeOutline.TreeElement{numHiddenAggregatedIssues;constructor(){super(void 0,!0),this.numHiddenAggregatedIssues=document.createElement("span"),this.toggleOnClick=!0,this.listItemElement.classList.add("issue-category","hidden-issues"),this.childrenListElement.classList.add("hidden-issues-body"),this.appendHeader()}appendHeader(){const t=s.UIUtils.createTextButton(V(O.unhideAll),(()=>e.IssuesManager.IssuesManager.instance().unhideAllIssues()),"unhide-all-issues-button"),i=new l.Adorner.Adorner;i.data={name:"countWrapper",content:this.numHiddenAggregatedIssues},i.classList.add("aggregated-issues-count"),this.numHiddenAggregatedIssues.textContent="0";const n=document.createElement("div"),a=document.createElement("div");n.classList.add("header"),a.classList.add("title"),a.textContent=V(O.hiddenIssues),n.appendChild(i),n.appendChild(a),n.appendChild(t),this.listItemElement.appendChild(n)}update(e){this.numHiddenAggregatedIssues.textContent=`${e}`}}const F=new CSSStyleSheet;F.replaceSync(".issues-pane{overflow:hidden}.issues-pane-no-issues{align-items:center;background-color:var(--color-background);display:flex;flex:1 1 auto;font-size:18px;justify-content:center;padding:30px}.issues-toolbar-container{display:flex;flex:none}.issues-toolbar-container>.toolbar{background-color:var(--color-background-elevation-1);border-bottom:1px solid var(--color-details-hairline)}.issues-toolbar-left{flex:1 1 auto}.issues-toolbar-right{padding-right:6px}\n/*# sourceURL=issuesPane.css */\n");const H=new CSSStyleSheet;H.replaceSync('.issues,:host{padding:0;overflow:auto}.issues{--issue-indent:8px}.issues li{white-space:normal}.issues .always-parent::before{display:none}.issues li.parent::before{transition:transform .2s;transform-origin:25% 50%}.issues li.parent.expanded::before{-webkit-mask-position:0 0;transform:rotate(90deg)}.issue,.issue-category,.issue-kind{padding:0 8px;padding-left:var(--issue-indent);overflow:hidden;flex:none;transition:background-color .2s;border:1px solid var(--color-details-hairline-light);border-width:0 0 1px}.issue-category.hidden-issues.parent.expanded,.issue-kind.parent.expanded{border-width:0 0 1px;background-color:var(--color-background-elevation-1)}.issue-category+.children .issue,.issue.expanded{background:var(--color-background)}.issue.expanded{border-width:0}.issue.expanded.selected,.issue.selected{background-color:var(--legacy-focus-bg-color)}.unhide-all-issues-button{line-height:normal}p{margin-block-start:2px;margin-block-end:2px}.tree-outline-disclosure:not(.tree-outline-disclosure-hide-overflow) .tree-outline.hide-selection-when-blurred .issue-category.selected:focus-visible,.tree-outline-disclosure:not(.tree-outline-disclosure-hide-overflow) .tree-outline.hide-selection-when-blurred .issue-kind.selected:focus-visible,.tree-outline-disclosure:not(.tree-outline-disclosure-hide-overflow) .tree-outline.hide-selection-when-blurred .issue.selected:focus-visible{width:auto;padding-right:8px}.header{display:flex;flex-direction:row;align-items:center;padding:6px 0;cursor:pointer;width:100%}.header devtools-hide-issues-menu{display:none}.header:hover devtools-hide-issues-menu{display:block}.header devtools-hide-issues-menu.has-context-menu-opened{display:block}.issue-category .header,.issue-kind .header{line-height:24px;padding-left:2px}.title{flex:1;font-size:14px;color:var(--color-text-primary);font-weight:400;user-select:text}.issue.expanded .title{font-weight:450}.body.children{border-bottom:1px solid var(--color-details-hairline-light);padding:6px 0;position:relative;padding-left:calc(var(--issue-indent) + 43px);padding-bottom:26px;padding-right:8px}.issue-category+.children,.issue-kind+.children{--issue-indent:24px;padding-left:0}.body::before{content:"";display:block;position:absolute;left:calc(var(--issue-indent) + 23px);top:0;bottom:20px;width:2px}.issue-kind-breaking-change.body::before{border-left:2px solid var(--issue-color-yellow)}.issue-kind-page-error.body::before{border-left:2px solid var(--issue-color-red)}.issue-kind-improvement.body::before{border-left:2px solid var(--issue-color-blue)}devtools-icon.leading-issue-icon{margin:0 7px}.message{line-height:20px;font-size:14px;color:var(--color-text-secondary);margin-bottom:4px;user-select:text}.message p{margin-bottom:16px}.message li{margin-top:8px}.message code{color:var(--color-text-primary);font-size:12px;user-select:text;cursor:text;background:var(--color-background-elevation-1)}.separator::before{content:"·";padding-left:1ex;padding-right:1ex}.link{font-size:14px;color:var(--color-link)}.link-wrapper{margin-top:15px;user-select:text}.affected-resources-label,.resolutions-label{margin-top:5px;font-size:10px;font-weight:500;letter-spacing:.06em;text-transform:uppercase;color:var(--color-text-primary);display:inline-block}.link-list{list-style-type:none;list-style-position:inside;padding-inline-start:0}.resolutions-list{list-style-type:none;list-style-position:inside;padding-inline-start:0}.link-list li::before{content:none;-webkit-mask-image:none}.resolutions-list li::before{content:"→";-webkit-mask-image:none;padding-right:5px;position:relative;top:-1px}.resolutions-list li{display:list-item}ul>li.plain-enum{display:list-item}ul>li.plain-enum::before{content:"";padding:0;margin:0;max-width:0}.affected-resources-label+.affected-resources{padding:3px 0 0;position:relative;user-select:text}.affected-resource-label{font-size:14px;line-height:20px;color:var(--color-text-primary);position:relative;cursor:pointer}.affected-resource-cookie{font-size:14px;line-height:20px;border:0;border-collapse:collapse}.affected-resource-element{font-size:14px;line-height:20px;color:var(--color-link);border:0;border-collapse:collapse}.affected-resource-row{font-size:14px;line-height:20px;border:0;border-collapse:collapse;vertical-align:top}.affected-resource-mixed-content{font-size:14px;line-height:20px;border:0;border-collapse:collapse}.affected-resource-heavy-ad{font-size:14px;line-height:20px;border:0;border-collapse:collapse}.affected-resource-request{font-size:14px;line-height:20px;border:0;border-collapse:collapse}.affected-resource-source{font-size:14px;line-height:20px;color:var(--color-link);border:0;border-collapse:collapse}.affected-resource-list{border-spacing:10px 0;margin-left:-12px}.affected-resource-header{font-size:12px;color:var(--color-text-primary);padding-left:2px}.code-example{font-family:var(--monospace-font-family);font-size:var(--monospace-font-size)}.affected-resource-blocked-status{color:var(--issue-color-red)}.affected-resource-report-only-status{color:var(--issue-color-yellow)}.affected-resource-cookie-info{color:var(--color-text-secondary);padding:2px;text-align:right}.affected-resource-cookie-info-header{text-align:right}.affected-resource-mixed-content-info{color:var(--color-text-secondary);padding:2px}.affected-resource-heavy-ad-info{color:var(--color-text-secondary);padding:2px}.affected-resource-heavy-ad-info-frame{display:flex;align-items:center;color:var(--color-text-secondary);padding:2px}.affected-resource-cell{color:var(--color-text-secondary);padding:2px}.affected-resource-cell.link{color:var(--color-link)}.affected-resource-cell span.icon{margin-right:.5ex;vertical-align:sub}.affected-resources>.parent{margin-top:0;padding:2px 5px 0}.affected-resources>.parent.expanded{background:var(--color-background-elevation-0)}.affected-resources>.children.expanded{background:var(--color-background-elevation-0);padding:6px 0 9px 5px;margin-bottom:10px}.aggregated-issues-count{padding-right:7px}.affected-resource-directive-info-header{text-align:left}.affected-resource-directive{font-size:14px;line-height:20px;border:0;border-collapse:collapse}.affected-resource-directive-info{color:var(--color-text-secondary);padding:2px;text-align:left}.devtools-link{padding-top:4px}devtools-icon.link-icon{vertical-align:sub;margin-right:.5ch}devtools-icon.elements-panel,devtools-icon.network-panel{margin-right:.5ex;vertical-align:baseline;height:14px}@media (forced-colors:active){.title{color:ButtonText}.tree-outline.hide-selection-when-blurred .selected:focus-visible .header .title,.tree-outline:not(.hide-selection-when-blurred) .selected .header .title{color:HighlightText}}\n/*# sourceURL=issuesTree.css */\n');const B={unknown:"unknown",clickToRevealTheFramesDomNodeIn:"Click to reveal the frame's DOM node in the Elements panel",unavailable:"unavailable"},N=t.i18n.registerUIStrings("panels/issues/AffectedResourcesView.ts",B),W=t.i18n.getLocalizedString.bind(void 0,N);class K extends s.TreeOutline.TreeElement{parentView;issue;affectedResourcesCountElement;affectedResources;affectedResourcesCount;frameListeners;unresolvedFrameIds;requestResolver;constructor(e,t){super(),this.parentView=e,this.issue=t,this.toggleOnClick=!0,this.affectedResourcesCountElement=this.createAffectedResourcesCounter(),this.affectedResources=this.createAffectedResources(),this.affectedResourcesCount=0,this.requestResolver=new C.RequestResolver.RequestResolver,this.frameListeners=[],this.unresolvedFrameIds=new Set}setIssue(e){this.issue=e}createAffectedResourcesCounter(){const e=document.createElement("div");return e.classList.add("affected-resource-label"),this.listItemElement.appendChild(e),e}createAffectedResources(){const e=new s.TreeOutline.TreeElement,t=document.createElement("table");return t.classList.add("affected-resource-list"),e.listItemElement.appendChild(t),this.appendChild(e),t}updateAffectedResourceCount(e){this.affectedResourcesCount=e,this.affectedResourcesCountElement.textContent=this.getResourceNameWithCount(e),this.hidden=0===this.affectedResourcesCount,this.parentView.updateAffectedResourceVisibility()}isEmpty(){return 0===this.affectedResourcesCount}clear(){this.affectedResources.textContent="",this.requestResolver.clear()}expandIfOneResource(){1===this.affectedResourcesCount&&this.expand()}resolveFrameId(e){const t=f.FrameManager.FrameManager.instance().getFrame(e);if(!(t&&t.url||(this.unresolvedFrameIds.add(e),this.frameListeners.length))){const e=f.FrameManager.FrameManager.instance().addEventListener(f.FrameManager.Events.FrameAddedToTarget,this.onFrameChanged,this),t=f.FrameManager.FrameManager.instance().addEventListener(f.FrameManager.Events.FrameNavigated,this.onFrameChanged,this);this.frameListeners=[e,t]}return t}onFrameChanged(e){const t=e.data.frame;if(!t.url)return;const s=this.unresolvedFrameIds.delete(t.id);0===this.unresolvedFrameIds.size&&this.frameListeners.length&&(r.EventTarget.removeEventListeners(this.frameListeners),this.frameListeners=[]),s&&this.update()}createFrameCell(e,t){const s=this.resolveFrameId(e),i=s&&(s.unreachableUrl()||s.url)||W(B.unknown),n=document.createElement("td");if(n.classList.add("affected-resource-cell"),s){const s=new c.Icon.Icon;s.data={iconName:"elements_panel_icon",color:"var(--color-link)",width:"16px",height:"16px"},s.classList.add("link","elements-panel"),s.onclick=async()=>{u.userMetrics.issuesPanelResourceOpened(t,"Element");const s=f.FrameManager.FrameManager.instance().getFrame(e);if(s){const e=await s.getOwnerDOMNodeOrDocument();e&&r.Revealer.reveal(e)}},s.title=W(B.clickToRevealTheFramesDomNodeIn),n.appendChild(s)}return n.appendChild(document.createTextNode(i)),n.onmouseenter=()=>{const t=f.FrameManager.FrameManager.instance().getFrame(e);t&&t.highlight()},n.onmouseleave=()=>f.OverlayModel.OverlayModel.hideDOMNodeHighlight(),n}createRequestCell(e,t={}){const s=document.createElement("td");s.classList.add("affected-resource-cell");const i=new y.RequestLinkIcon.RequestLinkIcon;return i.data={...t,affectedRequest:e,requestResolver:this.requestResolver,displayURL:!0},s.appendChild(i),s}async createElementCell({backendNodeId:e,nodeName:t,target:s},i){if(!s){const e=document.createElement("td");return e.textContent=t||W(B.unavailable),e}function n(){u.userMetrics.issuesPanelResourceOpened(i,"Element")}const a=new f.DOMModel.DeferredDOMNode(s,e),o=await r.Linkifier.Linkifier.linkify(a);o.textContent=t,o.addEventListener("click",(()=>n())),o.addEventListener("keydown",(e=>{"Enter"===e.key&&n()}));const d=document.createElement("td");return d.classList.add("affected-resource-element","devtools-link"),d.appendChild(o),d}appendSourceLocation(e,t,s){const i=document.createElement("td");if(i.classList.add("affected-source-location"),t){const e=40,n=new I.Linkifier.Linkifier(e).linkifyScriptLocation(s||null,t.scriptId||null,t.url,t.lineNumber,{columnNumber:t.columnNumber,inlineFrameIndex:0,className:void 0,tabStop:void 0});i.appendChild(n)}e.appendChild(i)}appendColumnTitle(e,t,s=null){const i=document.createElement("td");i.classList.add("affected-resource-header"),s&&i.classList.add(s),i.textContent=t,e.appendChild(i)}createIssueDetailCell(e,t=null){const s=document.createElement("td");return s.textContent=e,t&&s.classList.add(t),s}appendIssueDetailCell(e,t,s=null){const i=this.createIssueDetailCell(t,s);return e.appendChild(i),i}}const z={nDirectives:"{n, plural, =1 {# directive} other {# directives}}",reportonly:"report-only",blocked:"blocked",clickToRevealTheViolatingDomNode:"Click to reveal the violating DOM node in the Elements panel",directiveC:"Directive",element:"Element",sourceLocation:"Source Location",status:"Status",resourceC:"Resource"},_=t.i18n.registerUIStrings("panels/issues/AffectedDirectivesView.ts",z),j=t.i18n.getLocalizedString.bind(void 0,_);class G extends K{appendStatus(e,t){const s=document.createElement("td");t?(s.classList.add("affected-resource-report-only-status"),s.textContent=j(z.reportonly)):(s.classList.add("affected-resource-blocked-status"),s.textContent=j(z.blocked)),e.appendChild(s)}getResourceNameWithCount(e){return j(z.nDirectives,{n:e})}appendViolatedDirective(e,t){const s=document.createElement("td");s.textContent=t,e.appendChild(s)}appendBlockedURL(e,t){const s=document.createElement("td");s.classList.add("affected-resource-directive-info"),s.textContent=t,e.appendChild(s)}appendBlockedElement(e,t,s){const i=new m.ElementsPanelLink.ElementsPanelLink;if(t){const e=t;i.title=j(z.clickToRevealTheViolatingDomNode);const n=()=>{const t=s.getTargetIfNotDisposed();if(t){u.userMetrics.issuesPanelResourceOpened(this.issue.getCategory(),"Element");const s=new f.DOMModel.DeferredDOMNode(t,e);r.Revealer.reveal(s)}},a=()=>{const t=s.getTargetIfNotDisposed();if(t){const s=new f.DOMModel.DeferredDOMNode(t,e);s&&s.highlight()}},o=()=>{f.OverlayModel.OverlayModel.hideDOMNodeHighlight()};i.data={onElementRevealIconClick:n,onElementRevealIconMouseEnter:a,onElementRevealIconMouseLeave:o}}const n=document.createElement("td");n.classList.add("affected-resource-csp-info-node"),n.appendChild(i),e.appendChild(n)}appendAffectedContentSecurityPolicyDetails(t){const s=document.createElement("tr");if(this.issue.code()===e.ContentSecurityPolicyIssue.inlineViolationCode)this.appendColumnTitle(s,j(z.directiveC)),this.appendColumnTitle(s,j(z.element)),this.appendColumnTitle(s,j(z.sourceLocation)),this.appendColumnTitle(s,j(z.status));else if(this.issue.code()===e.ContentSecurityPolicyIssue.urlViolationCode)this.appendColumnTitle(s,j(z.resourceC),"affected-resource-directive-info-header"),this.appendColumnTitle(s,j(z.status)),this.appendColumnTitle(s,j(z.directiveC)),this.appendColumnTitle(s,j(z.sourceLocation));else if(this.issue.code()===e.ContentSecurityPolicyIssue.evalViolationCode)this.appendColumnTitle(s,j(z.sourceLocation)),this.appendColumnTitle(s,j(z.directiveC)),this.appendColumnTitle(s,j(z.status));else if(this.issue.code()===e.ContentSecurityPolicyIssue.trustedTypesSinkViolationCode)this.appendColumnTitle(s,j(z.sourceLocation)),this.appendColumnTitle(s,j(z.status));else{if(this.issue.code()!==e.ContentSecurityPolicyIssue.trustedTypesPolicyViolationCode)return void this.updateAffectedResourceCount(0);this.appendColumnTitle(s,j(z.sourceLocation)),this.appendColumnTitle(s,j(z.directiveC)),this.appendColumnTitle(s,j(z.status))}this.affectedResources.appendChild(s);let i=0;for(const e of t)i++,this.appendAffectedContentSecurityPolicyDetail(e);this.updateAffectedResourceCount(i)}appendAffectedContentSecurityPolicyDetail(t){const s=document.createElement("tr");s.classList.add("affected-resource-directive");const i=t.details(),n=e.Issue.toZeroBasedLocation(i.sourceCodeLocation),a=t.model(),r=t.model()?.getTargetIfNotDisposed();if(this.issue.code()===e.ContentSecurityPolicyIssue.inlineViolationCode&&a)this.appendViolatedDirective(s,i.violatedDirective),this.appendBlockedElement(s,i.violatingNodeId,a),this.appendSourceLocation(s,n,r),this.appendStatus(s,i.isReportOnly);else if(this.issue.code()===e.ContentSecurityPolicyIssue.urlViolationCode){const e=i.blockedURL?i.blockedURL:"";this.appendBlockedURL(s,e),this.appendStatus(s,i.isReportOnly),this.appendViolatedDirective(s,i.violatedDirective),this.appendSourceLocation(s,n,r)}else if(this.issue.code()===e.ContentSecurityPolicyIssue.evalViolationCode)this.appendSourceLocation(s,n,r),this.appendViolatedDirective(s,i.violatedDirective),this.appendStatus(s,i.isReportOnly);else if(this.issue.code()===e.ContentSecurityPolicyIssue.trustedTypesSinkViolationCode)this.appendSourceLocation(s,n,r),this.appendStatus(s,i.isReportOnly);else{if(this.issue.code()!==e.ContentSecurityPolicyIssue.trustedTypesPolicyViolationCode)return;this.appendSourceLocation(s,n,r),this.appendViolatedDirective(s,i.violatedDirective),this.appendStatus(s,i.isReportOnly)}this.affectedResources.appendChild(s)}update(){this.clear(),this.appendAffectedContentSecurityPolicyDetails(this.issue.getCspIssues())}}const $={nRequests:"{n, plural, =1 {# request} other {# requests}}",requestC:"Request",parentFrame:"Parent Frame",blockedResource:"Blocked Resource"},Q=t.i18n.registerUIStrings("panels/issues/AffectedBlockedByResponseView.ts",$),Z=t.i18n.getLocalizedString.bind(void 0,Q);class J extends K{appendDetails(e){const t=document.createElement("tr");this.appendColumnTitle(t,Z($.requestC)),this.appendColumnTitle(t,Z($.parentFrame)),this.appendColumnTitle(t,Z($.blockedResource)),this.affectedResources.appendChild(t);let s=0;for(const t of e)this.appendDetail(t),s++;this.updateAffectedResourceCount(s)}getResourceNameWithCount(e){return Z($.nRequests,{n:e})}appendDetail(t){const s=document.createElement("tr");s.classList.add("affected-resource-row");const i=this.createRequestCell(t.request,{additionalOnClickAction(){u.userMetrics.issuesPanelResourceOpened(e.Issue.IssueCategory.CrossOriginEmbedderPolicy,"Request")}});if(s.appendChild(i),t.parentFrame){const e=this.createFrameCell(t.parentFrame.frameId,this.issue.getCategory());s.appendChild(e)}else s.appendChild(document.createElement("td"));if(t.blockedFrame){const e=this.createFrameCell(t.blockedFrame.frameId,this.issue.getCategory());s.appendChild(e)}else s.appendChild(document.createElement("td"));this.affectedResources.appendChild(s)}update(){this.clear(),this.appendDetails(this.issue.getBlockedByResponseDetails())}}const X={nCookies:"{n, plural, =1 {# cookie} other {# cookies}}",name:"Name",domain:"Domain",path:"Path",nRawCookieLines:"{n, plural, =1 {1 Raw `Set-Cookie` header} other {# Raw `Set-Cookie` headers}}",filterSetCookieTitle:"Show network requests that include this `Set-Cookie` header in the network panel"},Y=t.i18n.registerUIStrings("panels/issues/AffectedCookiesView.ts",X),ee=t.i18n.getLocalizedString.bind(void 0,Y);class te extends K{getResourceNameWithCount(e){return ee(X.nCookies,{n:e})}appendAffectedCookies(e){const t=document.createElement("tr");this.appendColumnTitle(t,ee(X.name)),this.appendColumnTitle(t,ee(X.domain)+" & "+ee(X.path),"affected-resource-cookie-info-header"),this.affectedResources.appendChild(t);let s=0;for(const t of e)s++,this.appendAffectedCookie(t.cookie,t.hasRequest);this.updateAffectedResourceCount(s)}appendAffectedCookie(e,t){const i=document.createElement("tr");i.classList.add("affected-resource-cookie");const n=document.createElement("td");t?n.appendChild(s.UIUtils.createTextButton(e.name,(()=>{u.userMetrics.issuesPanelResourceOpened(this.issue.getCategory(),"Cookie"),r.Revealer.reveal(h.UIFilter.UIRequestFilter.filters([{filterType:h.UIFilter.FilterType.CookieDomain,filterValue:e.domain},{filterType:h.UIFilter.FilterType.CookieName,filterValue:e.name},{filterType:h.UIFilter.FilterType.CookiePath,filterValue:e.path}]))}),"link-style devtools-link")):n.textContent=e.name,i.appendChild(n),this.appendIssueDetailCell(i,`${e.domain}${e.path}`,"affected-resource-cookie-info"),this.affectedResources.appendChild(i)}update(){this.clear(),this.appendAffectedCookies(this.issue.cookiesWithRequestIndicator())}}class se extends K{getResourceNameWithCount(e){return ee(X.nRawCookieLines,{n:e})}update(){this.clear();const e=this.issue.getRawCookieLines();let t=0;for(const i of e){const e=document.createElement("tr");if(e.classList.add("affected-resource-directive"),i.hasRequest){const t=document.createElement("td"),n=s.UIUtils.createTextButton(i.rawCookieLine,(()=>{r.Revealer.reveal(h.UIFilter.UIRequestFilter.filters([{filterType:h.UIFilter.FilterType.ResponseHeaderValueSetCookie,filterValue:i.rawCookieLine}]))}),"link-style devtools-link");n.title=ee(X.filterSetCookieTitle),t.appendChild(n),e.appendChild(t)}else this.appendIssueDetailCell(e,i.rawCookieLine);this.affectedResources.appendChild(e),t++}this.updateAffectedResourceCount(t)}}const ie={nElements:"{n, plural, =1 {# element} other {# elements}}"},ne=t.i18n.registerUIStrings("panels/issues/AffectedElementsView.ts",ie),ae=t.i18n.getLocalizedString.bind(void 0,ne);class re extends K{async appendAffectedElements(e){let t=0;for(const s of e)await this.appendAffectedElement(s),t++;this.updateAffectedResourceCount(t)}getResourceNameWithCount(e){return ae(ie.nElements,{n:e})}async appendAffectedElement(e){const t=await this.createElementCell(e,this.issue.getCategory()),s=document.createElement("tr");s.appendChild(t),this.affectedResources.appendChild(s)}update(){this.clear(),this.appendAffectedElements(this.issue.elements())}}const oe={nDocuments:"{n, plural, =1 { document} other { documents}}",documentInTheDOMTree:"Document in the DOM tree",url:"URL",mode:"Mode"},de=t.i18n.registerUIStrings("panels/issues/AffectedDocumentsInQuirksModeView.ts",oe),le=t.i18n.getLocalizedString.bind(void 0,de);class ue extends re{runningUpdatePromise=Promise.resolve();update(){this.runningUpdatePromise=this.runningUpdatePromise.then(this.doUpdate.bind(this))}getResourceName(e){return le(oe.nDocuments,{n:e})}async doUpdate(){this.clear(),await this.appendQuirksModeDocuments(this.issue.getQuirksModeIssues())}async appendQuirksModeDocument(e){const t=document.createElement("tr");t.classList.add("affected-resource-quirks-mode");const s=e.details(),i=f.FrameManager.FrameManager.instance().getFrame(s.frameId)?.resourceTreeModel().target()||null;t.appendChild(await this.createElementCell({nodeName:"document",backendNodeId:s.documentNodeId,target:i},e.getCategory())),this.appendIssueDetailCell(t,s.isLimitedQuirksMode?"Limited Quirks Mode":"Quirks Mode"),this.appendIssueDetailCell(t,s.url),this.affectedResources.appendChild(t)}async appendQuirksModeDocuments(e){const t=document.createElement("tr");this.appendColumnTitle(t,le(oe.documentInTheDOMTree)),this.appendColumnTitle(t,le(oe.mode)),this.appendColumnTitle(t,le(oe.url)),this.affectedResources.appendChild(t);let s=0;for(const t of e)s++,await this.appendQuirksModeDocument(t);this.updateAffectedResourceCount(s)}}class ce extends re{runningUpdatePromise=Promise.resolve();update(){this.runningUpdatePromise=this.runningUpdatePromise.then(this.doUpdate.bind(this))}async doUpdate(){this.clear(),await this.appendLowContrastElements(this.issue.getLowContrastIssues())}async appendLowContrastElement(e){const t=document.createElement("tr");t.classList.add("affected-resource-low-contrast");const s=e.details(),i=e.model()?.target()||null;t.appendChild(await this.createElementCell({nodeName:s.violatingNodeSelector,backendNodeId:s.violatingNodeId,target:i},e.getCategory())),this.appendIssueDetailCell(t,String(w.NumberUtilities.floor(s.contrastRatio,2))),this.appendIssueDetailCell(t,String(s.thresholdAA)),this.appendIssueDetailCell(t,String(s.thresholdAAA)),this.appendIssueDetailCell(t,s.fontSize),this.appendIssueDetailCell(t,s.fontWeight),this.affectedResources.appendChild(t)}async appendLowContrastElements(e){const t=document.createElement("tr");this.appendColumnTitle(t,ge(pe.element)),this.appendColumnTitle(t,ge(pe.contrastRatio)),this.appendColumnTitle(t,ge(pe.minimumAA)),this.appendColumnTitle(t,ge(pe.minimumAAA)),this.appendColumnTitle(t,ge(pe.textSize)),this.appendColumnTitle(t,ge(pe.textWeight)),this.affectedResources.appendChild(t);let s=0;for(const t of e)s++,await this.appendLowContrastElement(t);this.updateAffectedResourceCount(s)}}const pe={element:"Element",contrastRatio:"Contrast ratio",minimumAA:"Minimum AA ratio",minimumAAA:"Minimum AAA ratio",textSize:"Text size",textWeight:"Text weight"},he=t.i18n.registerUIStrings("panels/issues/AffectedElementsWithLowContrastView.ts",pe),ge=t.i18n.getLocalizedString.bind(void 0,he),fe={nResources:"{n, plural, =1 {# resource} other {# resources}}",limitExceeded:"Limit exceeded",resolutionStatus:"Resolution Status",frameUrl:"Frame URL",removed:"Removed",warned:"Warned",cpuPeakLimit:"CPU peak limit",cpuTotalLimit:"CPU total limit",networkLimit:"Network limit"},me=t.i18n.registerUIStrings("panels/issues/AffectedHeavyAdView.ts",fe),Ce=t.i18n.getLocalizedString.bind(void 0,me);class Ie extends K{appendAffectedHeavyAds(e){const t=document.createElement("tr");this.appendColumnTitle(t,Ce(fe.limitExceeded)),this.appendColumnTitle(t,Ce(fe.resolutionStatus)),this.appendColumnTitle(t,Ce(fe.frameUrl)),this.affectedResources.appendChild(t);let s=0;for(const t of e)this.appendAffectedHeavyAd(t.details()),s++;this.updateAffectedResourceCount(s)}getResourceNameWithCount(e){return Ce(fe.nResources,{n:e})}statusToString(e){switch(e){case"HeavyAdBlocked":return Ce(fe.removed);case"HeavyAdWarning":return Ce(fe.warned)}return""}limitToString(e){switch(e){case"CpuPeakLimit":return Ce(fe.cpuPeakLimit);case"CpuTotalLimit":return Ce(fe.cpuTotalLimit);case"NetworkTotalLimit":return Ce(fe.networkLimit)}return""}appendAffectedHeavyAd(e){const t=document.createElement("tr");t.classList.add("affected-resource-heavy-ad");const s=document.createElement("td");s.classList.add("affected-resource-heavy-ad-info"),s.textContent=this.limitToString(e.reason),t.appendChild(s);const i=document.createElement("td");i.classList.add("affected-resource-heavy-ad-info"),i.textContent=this.statusToString(e.resolution),t.appendChild(i);const n=e.frame.frameId,a=this.createFrameCell(n,this.issue.getCategory());t.appendChild(a),this.affectedResources.appendChild(t)}update(){this.clear(),this.appendAffectedHeavyAds(this.issue.getHeavyAdIssues())}}const ye={nViolations:"{n, plural, =1 {# violation} other {# violations}}",warning:"warning",blocked:"blocked",instantiation:"Instantiation",aSharedarraybufferWas:"A `SharedArrayBuffer` was instantiated in a context that is not cross-origin isolated",transfer:"Transfer",sharedarraybufferWasTransferedTo:"`SharedArrayBuffer` was transfered to a context that is not cross-origin isolated",sourceLocation:"Source Location",trigger:"Trigger",status:"Status"},we=t.i18n.registerUIStrings("panels/issues/AffectedSharedArrayBufferIssueDetailsView.ts",ye),be=t.i18n.getLocalizedString.bind(void 0,we);class ve extends K{getResourceNameWithCount(e){return be(ye.nViolations,{n:e})}appendStatus(e,t){const s=document.createElement("td");t?(s.classList.add("affected-resource-report-only-status"),s.textContent=be(ye.warning)):(s.classList.add("affected-resource-blocked-status"),s.textContent=be(ye.blocked)),e.appendChild(s)}appendType(e,t){const s=document.createElement("td");switch(t){case"CreationIssue":s.textContent=be(ye.instantiation),s.title=be(ye.aSharedarraybufferWas);break;case"TransferIssue":s.textContent=be(ye.transfer),s.title=be(ye.sharedarraybufferWasTransferedTo)}e.appendChild(s)}appendDetails(e){const t=document.createElement("tr");this.appendColumnTitle(t,be(ye.sourceLocation)),this.appendColumnTitle(t,be(ye.trigger)),this.appendColumnTitle(t,be(ye.status)),this.affectedResources.appendChild(t);let s=0;for(const t of e)s++,this.appendDetail(t);this.updateAffectedResourceCount(s)}appendDetail(t){const s=document.createElement("tr");s.classList.add("affected-resource-directive");const i=t.details(),n=e.Issue.toZeroBasedLocation(i.sourceCodeLocation);this.appendSourceLocation(s,n,t.model()?.getTargetIfNotDisposed()),this.appendType(s,i.type),this.appendStatus(s,i.isWarning),this.affectedResources.appendChild(s)}update(){this.clear(),this.appendDetails(this.issue.getSharedArrayBufferIssues())}}const ke={nSources:"{n, plural, =1 {# source} other {# sources}}"},Re=t.i18n.registerUIStrings("panels/issues/AffectedSourcesView.ts",ke),Se=t.i18n.getLocalizedString.bind(void 0,Re);class Te extends K{appendAffectedSources(e){let t=0;for(const s of e)this.appendAffectedSource(s),t++;this.updateAffectedResourceCount(t)}getResourceNameWithCount(e){return Se(ke.nSources,{n:e})}appendAffectedSource({url:e,lineNumber:t,columnNumber:s}){const i=document.createElement("td"),n={columnNumber:s,lineNumber:t,tabStop:!0},a=I.Linkifier.Linkifier.linkifyURL(e,n);i.appendChild(a);const r=document.createElement("tr");r.classList.add("affected-resource-source"),r.appendChild(i),this.affectedResources.appendChild(r)}update(){this.clear(),this.appendAffectedSources(this.issue.sources())}}const xe={nResources:"{n, plural, =1 {# resource} other {# resources}}",statusCode:"Status code",url:"Url",packageName:"Package name",packageSignature:"Package signature"},Ae=t.i18n.registerUIStrings("panels/issues/AffectedTrustedWebActivityIssueDetailsView.ts",xe),Ee=t.i18n.getLocalizedString.bind(void 0,Ae);class Le extends K{getResourceNameWithCount(e){return Ee(xe.nResources,{n:e})}appendDetail(t){const s=document.createElement("tr");s.classList.add("affected-resource-row");const i=t.details();this.issue.code()===e.TrustedWebActivityIssue.httpViolationCode&&i.httpStatusCode?(this.appendIssueDetailCell(s,i.httpStatusCode.toString()),this.appendIssueDetailCell(s,i.url)):this.issue.code()===e.TrustedWebActivityIssue.offlineViolationCode?this.appendIssueDetailCell(s,i.url):this.issue.code()===e.TrustedWebActivityIssue.assetlinkViolationCode&&(this.appendIssueDetailCell(s,i.packageName||""),this.appendIssueDetailCell(s,i.url),this.appendIssueDetailCell(s,i.signature||"")),this.affectedResources.appendChild(s)}appendDetails(t){const s=document.createElement("tr");this.issue.code()===e.TrustedWebActivityIssue.httpViolationCode?(this.appendColumnTitle(s,Ee(xe.statusCode)),this.appendColumnTitle(s,Ee(xe.url))):this.issue.code()===e.TrustedWebActivityIssue.offlineViolationCode?this.appendColumnTitle(s,Ee(xe.url)):this.issue.code()===e.TrustedWebActivityIssue.assetlinkViolationCode&&(this.appendColumnTitle(s,Ee(xe.packageName)),this.appendColumnTitle(s,Ee(xe.url)),this.appendColumnTitle(s,Ee(xe.packageSignature))),this.affectedResources.appendChild(s);let i=0;for(const e of t)this.appendDetail(e),i++;this.updateAffectedResourceCount(i)}update(){this.clear(),this.appendDetails(this.issue.getTrustedWebActivityIssues())}}const Me={nRequests:"{n, plural, =1 {# request} other {# requests}}",warning:"warning",blocked:"blocked",status:"Status",request:"Request",resourceAddressSpace:"Resource Address",initiatorAddressSpace:"Initiator Address",secure:"secure",insecure:"insecure",initiatorContext:"Initiator Context",preflightRequestIfProblematic:"Preflight Request (if problematic)",preflightRequest:"Preflight Request",header:"Header",problem:"Problem",invalidValue:"Invalid Value (if available)",problemMissingHeader:"Missing Header",problemMultipleValues:"Multiple Values",problemInvalidValue:"Invalid Value",preflightDisallowedRedirect:"Response to preflight was a redirect",preflightInvalidStatus:"HTTP status of preflight request didn't indicate success",allowedOrigin:"Allowed Origin (from header)",allowCredentialsValueFromHeader:"`Access-Control-Allow-Credentials` Header Value",disallowedRequestMethod:"Disallowed Request Method",disallowedRequestHeader:"Disallowed Request Header",sourceLocation:"Source Location",unsupportedScheme:"Unsupported Scheme"},De=t.i18n.registerUIStrings("panels/issues/CorsIssueDetailsView.ts",Me),Pe=t.i18n.getLocalizedString.bind(void 0,De);class Oe extends K{constructor(e,t){super(e,t),this.affectedResourcesCountElement.classList.add("cors-issue-affected-resource-label")}appendStatus(e,t){const s=document.createElement("td");t?(s.classList.add("affected-resource-report-only-status"),s.textContent=Pe(Me.warning)):(s.classList.add("affected-resource-blocked-status"),s.textContent=Pe(Me.blocked)),e.appendChild(s)}getResourceNameWithCount(e){return Pe(Me.nRequests,{n:e})}appendDetails(t,s){const i=document.createElement("tr");switch(this.appendColumnTitle(i,Pe(Me.request)),this.appendColumnTitle(i,Pe(Me.status)),t){case e.CorsIssue.IssueCode.InvalidHeaderValues:this.appendColumnTitle(i,Pe(Me.preflightRequestIfProblematic)),this.appendColumnTitle(i,Pe(Me.header)),this.appendColumnTitle(i,Pe(Me.problem)),this.appendColumnTitle(i,Pe(Me.invalidValue));break;case e.CorsIssue.IssueCode.WildcardOriginNotAllowed:this.appendColumnTitle(i,Pe(Me.preflightRequestIfProblematic));break;case e.CorsIssue.IssueCode.PreflightResponseInvalid:this.appendColumnTitle(i,Pe(Me.preflightRequest)),this.appendColumnTitle(i,Pe(Me.problem));break;case e.CorsIssue.IssueCode.OriginMismatch:this.appendColumnTitle(i,Pe(Me.preflightRequestIfProblematic)),this.appendColumnTitle(i,Pe(Me.initiatorContext)),this.appendColumnTitle(i,Pe(Me.allowedOrigin));break;case e.CorsIssue.IssueCode.AllowCredentialsRequired:this.appendColumnTitle(i,Pe(Me.preflightRequestIfProblematic)),this.appendColumnTitle(i,Pe(Me.allowCredentialsValueFromHeader));break;case e.CorsIssue.IssueCode.InsecurePrivateNetwork:case e.CorsIssue.IssueCode.InsecurePrivateNetworkPreflight:this.appendColumnTitle(i,Pe(Me.resourceAddressSpace)),this.appendColumnTitle(i,Pe(Me.initiatorAddressSpace)),this.appendColumnTitle(i,Pe(Me.initiatorContext));break;case e.CorsIssue.IssueCode.MethodDisallowedByPreflightResponse:this.appendColumnTitle(i,Pe(Me.preflightRequest)),this.appendColumnTitle(i,Pe(Me.disallowedRequestMethod));break;case e.CorsIssue.IssueCode.HeaderDisallowedByPreflightResponse:this.appendColumnTitle(i,Pe(Me.preflightRequest)),this.appendColumnTitle(i,Pe(Me.disallowedRequestHeader));break;case e.CorsIssue.IssueCode.RedirectContainsCredentials:break;case e.CorsIssue.IssueCode.DisallowedByMode:this.appendColumnTitle(i,Pe(Me.initiatorContext)),this.appendColumnTitle(i,Pe(Me.sourceLocation));break;case e.CorsIssue.IssueCode.CorsDisabledScheme:this.appendColumnTitle(i,Pe(Me.initiatorContext)),this.appendColumnTitle(i,Pe(Me.sourceLocation)),this.appendColumnTitle(i,Pe(Me.unsupportedScheme));break;case e.CorsIssue.IssueCode.NoCorsRedirectModeNotFollow:this.appendColumnTitle(i,Pe(Me.sourceLocation));break;default:w.assertUnhandled(t)}this.affectedResources.appendChild(i);let n=0;for(const e of s)n++,this.appendDetail(t,e);this.updateAffectedResourceCount(n)}appendSecureContextCell(e,t){void 0!==t?this.appendIssueDetailCell(e,Pe(t?Me.secure:Me.insecure)):this.appendIssueDetailCell(e,"")}static getHeaderFromError(e){switch(e){case"InvalidAllowHeadersPreflightResponse":return"Access-Control-Allow-Headers";case"InvalidAllowMethodsPreflightResponse":case"MethodDisallowedByPreflightResponse":return"Access-Control-Allow-Methods";case"PreflightMissingAllowOriginHeader":case"PreflightMultipleAllowOriginValues":case"PreflightInvalidAllowOriginValue":case"MissingAllowOriginHeader":case"MultipleAllowOriginValues":case"InvalidAllowOriginValue":case"WildcardOriginNotAllowed":case"PreflightWildcardOriginNotAllowed":case"AllowOriginMismatch":case"PreflightAllowOriginMismatch":return"Access-Control-Allow-Origin";case"InvalidAllowCredentials":case"PreflightInvalidAllowCredentials":return"Access-Control-Allow-Credentials";case"RedirectContainsCredentials":case"PreflightDisallowedRedirect":return"Location";case"PreflightInvalidStatus":return"Status-Code"}return""}static getProblemFromError(e){switch(e.corsError){case"InvalidAllowHeadersPreflightResponse":case"InvalidAllowMethodsPreflightResponse":case"PreflightInvalidAllowOriginValue":case"InvalidAllowOriginValue":return Pe(Me.problemInvalidValue);case"PreflightMultipleAllowOriginValues":case"MultipleAllowOriginValues":return Pe(Me.problemMultipleValues);case"MissingAllowOriginHeader":case"PreflightMissingAllowOriginHeader":return Pe(Me.problemMissingHeader);case"PreflightInvalidStatus":return Pe(Me.preflightInvalidStatus);case"PreflightDisallowedRedirect":return Pe(Me.preflightDisallowedRedirect)}throw new Error("Invalid Argument")}appendDetail(t,s){const i=document.createElement("tr");i.classList.add("affected-resource-directive");const n=s.details(),a=n.corsErrorStatus,r=n.corsErrorStatus.corsError,o={section:h.UIRequestLocation.UIHeaderSection.Response,name:Oe.getHeaderFromError(r)},d={additionalOnClickAction(){u.userMetrics.issuesPanelResourceOpened(e.Issue.IssueCategory.Cors,"Request")}};switch(t){case e.CorsIssue.IssueCode.InvalidHeaderValues:i.appendChild(this.createRequestCell(n.request,d)),this.appendStatus(i,n.isWarning),r.includes("Preflight")?i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})):this.appendIssueDetailCell(i,""),this.appendIssueDetailCell(i,Oe.getHeaderFromError(r),"code-example"),this.appendIssueDetailCell(i,Oe.getProblemFromError(n.corsErrorStatus)),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter,"code-example");break;case e.CorsIssue.IssueCode.WildcardOriginNotAllowed:i.appendChild(this.createRequestCell(n.request,d)),this.appendStatus(i,n.isWarning),r.includes("Preflight")?i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})):this.appendIssueDetailCell(i,"");break;case e.CorsIssue.IssueCode.PreflightResponseInvalid:{i.appendChild(this.createRequestCell(n.request,d)),this.appendStatus(i,n.isWarning);const e="PreflightInvalidStatus"===r?{section:h.UIRequestLocation.UIHeaderSection.General,name:"Status-Code"}:o;i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:e})),this.appendIssueDetailCell(i,Oe.getProblemFromError(n.corsErrorStatus));break}case e.CorsIssue.IssueCode.OriginMismatch:i.appendChild(this.createRequestCell(n.request,d)),this.appendStatus(i,n.isWarning),r.includes("Preflight")?i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})):this.appendIssueDetailCell(i,""),this.appendIssueDetailCell(i,n.initiatorOrigin??"","code-example"),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter,"code-example");break;case e.CorsIssue.IssueCode.AllowCredentialsRequired:i.appendChild(this.createRequestCell(n.request,d)),this.appendStatus(i,n.isWarning),r.includes("Preflight")?i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})):this.appendIssueDetailCell(i,""),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter,"code-example");break;case e.CorsIssue.IssueCode.InsecurePrivateNetwork:case e.CorsIssue.IssueCode.InsecurePrivateNetworkPreflight:i.appendChild(this.createRequestCell(n.request,d)),this.appendStatus(i,n.isWarning),this.appendIssueDetailCell(i,n.resourceIPAddressSpace??""),this.appendIssueDetailCell(i,n.clientSecurityState?.initiatorIPAddressSpace??""),this.appendSecureContextCell(i,n.clientSecurityState?.initiatorIsSecureContext);break;case e.CorsIssue.IssueCode.MethodDisallowedByPreflightResponse:i.appendChild(this.createRequestCell(n.request,d)),this.appendStatus(i,n.isWarning),i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter,"code-example");break;case e.CorsIssue.IssueCode.HeaderDisallowedByPreflightResponse:i.appendChild(this.createRequestCell(n.request,{...d,highlightHeader:{section:h.UIRequestLocation.UIHeaderSection.Request,name:a.failedParameter}})),this.appendStatus(i,n.isWarning),i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:{section:h.UIRequestLocation.UIHeaderSection.Response,name:"Access-Control-Allow-Headers"}})),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter,"code-example");break;case e.CorsIssue.IssueCode.RedirectContainsCredentials:i.appendChild(this.createRequestCell(n.request,{...d,highlightHeader:{section:h.UIRequestLocation.UIHeaderSection.Response,name:Oe.getHeaderFromError(r)}})),this.appendStatus(i,n.isWarning);break;case e.CorsIssue.IssueCode.DisallowedByMode:i.appendChild(this.createRequestCell(n.request,d)),this.appendStatus(i,n.isWarning),this.appendIssueDetailCell(i,n.initiatorOrigin??"","code-example"),this.appendSourceLocation(i,n.location,s.model()?.getTargetIfNotDisposed());break;case e.CorsIssue.IssueCode.CorsDisabledScheme:i.appendChild(this.createRequestCell(n.request,{...d,highlightHeader:{section:h.UIRequestLocation.UIHeaderSection.Response,name:Oe.getHeaderFromError(r)}})),this.appendStatus(i,n.isWarning),this.appendIssueDetailCell(i,n.initiatorOrigin??"","code-example"),this.appendSourceLocation(i,n.location,s.model()?.getTargetIfNotDisposed()),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter??"","code-example");break;case e.CorsIssue.IssueCode.NoCorsRedirectModeNotFollow:i.appendChild(this.createRequestCell(n.request,d)),this.appendStatus(i,n.isWarning),this.appendSourceLocation(i,n.location,s.model()?.getTargetIfNotDisposed());break;default:i.appendChild(this.createRequestCell(n.request,d)),this.appendStatus(i,n.isWarning),w.assertUnhandled(t)}this.affectedResources.appendChild(i)}update(){this.clear();const e=this.issue.getCorsIssues();e.size>0?this.appendDetails(e.values().next().value.code(),e):this.updateAffectedResourceCount(0)}}const qe={nResources:"{n, plural, =1 {# resource} other {# resources}}",frameId:"Frame"},Ve=t.i18n.registerUIStrings("panels/issues/GenericIssueDetailsView.ts",qe),Ue=t.i18n.getLocalizedString.bind(void 0,Ve);class Fe extends K{getResourceNameWithCount(e){return Ue(qe.nResources,{n:e})}appendDetails(e){const t=document.createElement("tr");e.values().next().value.details().frameId&&this.appendColumnTitle(t,Ue(qe.frameId)),this.affectedResources.appendChild(t);let s=0;for(const t of e)s++,this.appendDetail(t);this.updateAffectedResourceCount(s)}appendDetail(e){const t=document.createElement("tr");t.classList.add("affected-resource-directive");const s=e.details();s.frameId&&t.appendChild(this.createFrameCell(s.frameId,e.getCategory())),this.affectedResources.appendChild(t)}update(){this.clear();const e=this.issue.getGenericIssues();e.size>0?this.appendDetails(e):this.updateAffectedResourceCount(0)}}const He={nModuleTransfers:"{n, plural, =1 {# module} other {# modules}}",wasmModuleUrl:"Wasm Module URL",sourceOrigin:"Source Origin",targetOrigin:"Target Origin",status:"Status",blocked:"blocked",warned:"warning"},Be=t.i18n.registerUIStrings("panels/issues/WasmCrossOriginModuleSharingAffectedResourcesView.ts",He),Ne=t.i18n.getLocalizedString.bind(void 0,Be);class We extends K{appendIssues(e){const t=document.createElement("tr");this.appendColumnTitle(t,Ne(He.wasmModuleUrl)),this.appendColumnTitle(t,Ne(He.sourceOrigin)),this.appendColumnTitle(t,Ne(He.targetOrigin)),this.appendColumnTitle(t,Ne(He.status)),this.affectedResources.appendChild(t);let s=0;for(const t of e)this.appendDetails(t.details()),s++;this.updateAffectedResourceCount(s)}getResourceNameWithCount(e){return Ne(He.nModuleTransfers,{n:e})}appendDetails(e){const t=document.createElement("tr");t.appendChild(this.createIssueDetailCell(e.wasmModuleUrl)),t.appendChild(this.createIssueDetailCell(e.sourceOrigin)),t.appendChild(this.createIssueDetailCell(e.targetOrigin)),t.appendChild(this.createIssueDetailCell(e.isWarning?Ne(He.warned):Ne(He.blocked))),this.affectedResources.appendChild(t)}update(){this.clear(),this.appendIssues(this.issue.getWasmCrossOriginModuleSharingIssue())}}const Ke={nViolations:"{n, plural, =1 {# violation} other {# violations}}",frame:"Frame",element:"Element",request:"Request",invalidSourceEventId:"Invalid `attributionsourceeventid`",untrustworthyOrigin:"Untrustworthy origin",invalidTriggerData:"Invalid `trigger-data`",invalidEventSourceTriggerData:"Invalid `event-source-trigger-data`"},ze=t.i18n.registerUIStrings("panels/issues/AttributionReportingIssueDetailsView.ts",Ke),_e=t.i18n.getLocalizedString.bind(void 0,ze);class je extends K{getResourceNameWithCount(e){return _e(Ke.nViolations,{n:e})}update(){this.clear();const e=this.issue.getAttributionReportingIssues();e.size>0?this.appendDetails(e.values().next().value.code(),e):this.updateAffectedResourceCount(0)}appendDetails(e,t){const s=document.createElement("tr");switch(e){case"AttributionReportingIssue::AttributionUntrustworthyFrameOrigin":this.appendColumnTitle(s,_e(Ke.frame)),this.appendColumnTitle(s,_e(Ke.request)),this.appendColumnTitle(s,_e(Ke.untrustworthyOrigin));break;case"AttributionReportingIssue::AttributionUntrustworthyOrigin":this.appendColumnTitle(s,_e(Ke.request)),this.appendColumnTitle(s,_e(Ke.untrustworthyOrigin));break;case"AttributionReportingIssue::AttributionSourceUntrustworthyFrameOrigin":this.appendColumnTitle(s,_e(Ke.frame)),this.appendColumnTitle(s,_e(Ke.element)),this.appendColumnTitle(s,_e(Ke.untrustworthyOrigin));break;case"AttributionReportingIssue::AttributionSourceUntrustworthyOrigin":this.appendColumnTitle(s,_e(Ke.element)),this.appendColumnTitle(s,_e(Ke.untrustworthyOrigin));break;case"AttributionReportingIssue::InvalidAttributionData":case"AttrubtionReportingIssue::AttributionTriggerDataTooLarge":this.appendColumnTitle(s,_e(Ke.request)),this.appendColumnTitle(s,_e(Ke.invalidTriggerData));break;case"AttrubtionReportingIssue::AttributionEventSourceTriggerDataTooLarge":this.appendColumnTitle(s,_e(Ke.request)),this.appendColumnTitle(s,_e(Ke.invalidEventSourceTriggerData));break;case"AttributionReportingIssue::InvalidAttributionSourceEventId":this.appendColumnTitle(s,_e(Ke.frame)),this.appendColumnTitle(s,_e(Ke.element)),this.appendColumnTitle(s,_e(Ke.invalidSourceEventId));break;case"AttributionReportingIssue::MissingAttributionData":this.appendColumnTitle(s,_e(Ke.request));break;case"AttributionReportingIssue::PermissionPolicyDisabled":this.appendColumnTitle(s,_e(Ke.frame)),this.appendColumnTitle(s,_e(Ke.element)),this.appendColumnTitle(s,_e(Ke.request))}this.affectedResources.appendChild(s);let i=0;for(const s of t)i++,this.appendDetail(e,s);this.updateAffectedResourceCount(i)}async appendDetail(e,t){const s=document.createElement("tr");s.classList.add("affected-resource-directive");const i=t.issueDetails;switch(e){case"AttributionReportingIssue::AttributionUntrustworthyFrameOrigin":this.appendFrameOrEmptyCell(s,t),this.appendRequestOrEmptyCell(s,i.request),this.appendIssueDetailCell(s,i.invalidParameter||"");break;case"AttributionReportingIssue::AttributionSourceUntrustworthyOrigin":await this.appendElementOrEmptyCell(s,t),this.appendIssueDetailCell(s,i.invalidParameter||"");break;case"AttrubtionReportingIssue::AttributionTriggerDataTooLarge":case"AttrubtionReportingIssue::AttributionEventSourceTriggerDataTooLarge":case"AttributionReportingIssue::AttributionUntrustworthyOrigin":case"AttributionReportingIssue::InvalidAttributionData":this.appendRequestOrEmptyCell(s,i.request),this.appendIssueDetailCell(s,i.invalidParameter||"");break;case"AttributionReportingIssue::AttributionSourceUntrustworthyFrameOrigin":case"AttributionReportingIssue::InvalidAttributionSourceEventId":this.appendFrameOrEmptyCell(s,t),await this.appendElementOrEmptyCell(s,t),this.appendIssueDetailCell(s,i.invalidParameter||"");break;case"AttributionReportingIssue::MissingAttributionData":this.appendRequestOrEmptyCell(s,i.request);break;case"AttributionReportingIssue::PermissionPolicyDisabled":this.appendFrameOrEmptyCell(s,t),await this.appendElementOrEmptyCell(s,t),this.appendRequestOrEmptyCell(s,i.request)}this.affectedResources.appendChild(s)}appendFrameOrEmptyCell(e,t){const s=t.issueDetails;s.frame?e.appendChild(this.createFrameCell(s.frame.frameId,t.getCategory())):this.appendIssueDetailCell(e,"")}async appendElementOrEmptyCell(e,t){const s=t.issueDetails;if(void 0!==s.violatingNodeId){const i=t.model()?.target()||null;e.appendChild(await this.createElementCell({backendNodeId:s.violatingNodeId,target:i,nodeName:"Attribution source element"},t.getCategory()))}else this.appendIssueDetailCell(e,"")}appendRequestOrEmptyCell(t,s){if(!s)return void this.appendIssueDetailCell(t,"");const i={additionalOnClickAction(){u.userMetrics.issuesPanelResourceOpened(e.Issue.IssueCategory.AttributionReporting,"Request")}};t.appendChild(this.createRequestCell(s,i))}}const Ge={name:"Name",blocked:"blocked",nRequests:"{n, plural, =1 {# request} other {# requests}}",nResources:"{n, plural, =1 {# resource} other {# resources}}",restrictionStatus:"Restriction Status",warned:"Warned",affectedResources:"Affected Resources",learnMoreS:"Learn more: {PH1}",automaticallyUpgraded:"automatically upgraded",hideIssuesLikeThis:"Hide issues like this",unhideIssuesLikeThis:"Unhide issues like this"},$e=t.i18n.registerUIStrings("panels/issues/IssueView.ts",Ge),Qe=t.i18n.getLocalizedString.bind(void 0,$e);class Ze extends K{appendAffectedRequests(e){let t=0;for(const s of e){const e=document.createElement("tr");e.classList.add("affected-resource-request");const i=this.issue.getCategory(),n=Je.get(i)||h.UIRequestLocation.UIRequestTabs.Headers;e.appendChild(this.createRequestCell(s,{networkTab:n,additionalOnClickAction(){u.userMetrics.issuesPanelResourceOpened(i,"Request")}})),this.affectedResources.appendChild(e),t++}this.updateAffectedResourceCount(t)}getResourceNameWithCount(e){return Qe(Ge.nRequests,{n:e})}update(){this.clear();for(const e of this.issue.getBlockedByResponseDetails())return void this.updateAffectedResourceCount(0);this.issue.getCategory()!==e.Issue.IssueCategory.MixedContent?this.appendAffectedRequests(this.issue.requests()):this.updateAffectedResourceCount(0)}}const Je=new Map([[e.Issue.IssueCategory.SameSiteCookie,h.UIRequestLocation.UIRequestTabs.Cookies],[e.Issue.IssueCategory.CrossOriginEmbedderPolicy,h.UIRequestLocation.UIRequestTabs.Headers],[e.Issue.IssueCategory.MixedContent,h.UIRequestLocation.UIRequestTabs.Headers]]);class Xe extends K{appendAffectedMixedContentDetails(e){const t=document.createElement("tr");this.appendColumnTitle(t,Qe(Ge.name)),this.appendColumnTitle(t,Qe(Ge.restrictionStatus)),this.affectedResources.appendChild(t);let s=0;for(const t of e){const e=t.getDetails();this.appendAffectedMixedContent(e),s++}this.updateAffectedResourceCount(s)}getResourceNameWithCount(e){return Qe(Ge.nResources,{n:e})}appendAffectedMixedContent(t){const s=document.createElement("tr");if(s.classList.add("affected-resource-mixed-content"),t.request){const i=Je.get(this.issue.getCategory())||h.UIRequestLocation.UIRequestTabs.Headers;s.appendChild(this.createRequestCell(t.request,{networkTab:i,additionalOnClickAction(){u.userMetrics.issuesPanelResourceOpened(e.Issue.IssueCategory.MixedContent,"Request")}}))}else{const e=(i=t.insecureURL,(/[^/]+$/.exec(i)||/[^/]+\/$/.exec(i)||[""])[0]);this.appendIssueDetailCell(s,e,"affected-resource-mixed-content-info").title=t.insecureURL}var i;this.appendIssueDetailCell(s,Xe.translateStatus(t.resolutionStatus),"affected-resource-mixed-content-info"),this.affectedResources.appendChild(s)}static translateStatus(e){switch(e){case"MixedContentBlocked":return Qe(Ge.blocked);case"MixedContentAutomaticallyUpgraded":return Qe(Ge.automaticallyUpgraded);case"MixedContentWarning":return Qe(Ge.warned)}}update(){this.clear(),this.appendAffectedMixedContentDetails(this.issue.getMixedContentIssues())}}class Ye extends s.TreeOutline.TreeElement{issue;description;toggleOnClick;affectedResources;affectedResourceViews;aggregatedIssuesCount;issueKindIcon=null;hasBeenExpandedBefore;throttle;needsUpdateOnExpand=!0;hiddenIssuesMenu;contentCreated=!1;constructor(e,t){super(),this.issue=e,this.description=t,this.throttle=new r.Throttler.Throttler(250),this.toggleOnClick=!0,this.listItemElement.classList.add("issue"),this.childrenListElement.classList.add("body"),this.childrenListElement.classList.add(Ye.getBodyCSSClass(this.issue.getKind())),this.affectedResources=this.createAffectedResources(),this.affectedResourceViews=[new te(this,this.issue),new re(this,this.issue),new Ze(this,this.issue),new Xe(this,this.issue),new Te(this,this.issue),new Ie(this,this.issue),new G(this,this.issue),new J(this,this.issue),new ve(this,this.issue),new ce(this,this.issue),new Le(this,this.issue),new Oe(this,this.issue),new Fe(this,this.issue),new ue(this,this.issue),new je(this,this.issue),new We(this,this.issue),new se(this,this.issue)],o.Runtime.experiments.isEnabled("hideIssuesFeature")&&(this.hiddenIssuesMenu=new g.HideIssuesMenu.HideIssuesMenu),this.aggregatedIssuesCount=null,this.hasBeenExpandedBefore=!1}setIssue(e){this.issue!==e&&(this.needsUpdateOnExpand=!0),this.issue=e,this.affectedResourceViews.forEach((t=>t.setIssue(e)))}static getBodyCSSClass(t){switch(t){case e.Issue.IssueKind.BreakingChange:return"issue-kind-breaking-change";case e.Issue.IssueKind.PageError:return"issue-kind-page-error";case e.Issue.IssueKind.Improvement:return"issue-kind-improvement"}}getIssueTitle(){return this.description.title}onattach(){this.contentCreated?this.update():this.createContent()}createContent(){this.appendHeader(),this.createBody(),this.appendChild(this.affectedResources);for(const e of this.affectedResourceViews)this.appendAffectedResource(e),e.update();this.createReadMoreLinks(),this.updateAffectedResourceVisibility(),this.contentCreated=!0}appendAffectedResource(e){this.affectedResources.appendChild(e)}appendHeader(){const e=document.createElement("div");e.classList.add("header"),this.issueKindIcon=new c.Icon.Icon,this.issueKindIcon.classList.add("leading-issue-icon"),this.aggregatedIssuesCount=document.createElement("span");const t=new l.Adorner.Adorner;t.data={name:"countWrapper",content:this.aggregatedIssuesCount},t.classList.add("aggregated-issues-count"),e.appendChild(this.issueKindIcon),e.appendChild(t);const s=document.createElement("div");s.classList.add("title"),s.textContent=this.description.title,e.appendChild(s),this.hiddenIssuesMenu&&e.appendChild(this.hiddenIssuesMenu),this.updateFromIssue(),this.listItemElement.appendChild(e)}onexpand(){if(u.userMetrics.issuesPanelIssueExpanded(this.issue.getCategory()),this.needsUpdateOnExpand&&this.doUpdate(),!this.hasBeenExpandedBefore){this.hasBeenExpandedBefore=!0;for(const e of this.affectedResourceViews)e.expandIfOneResource()}}updateFromIssue(){if(this.issueKindIcon){const t=this.issue.getKind();this.issueKindIcon.data=d.IssueCounter.getIssueKindIconData(t),this.issueKindIcon.title=e.Issue.getIssueKindDescription(t)}if(this.aggregatedIssuesCount&&(this.aggregatedIssuesCount.textContent=`${this.issue.getAggregatedIssuesCount()}`),this.listItemElement.classList.toggle("hidden-issue",this.issue.isHidden()),this.hiddenIssuesMenu){const t={menuItemLabel:this.issue.isHidden()?Qe(Ge.unhideIssuesLikeThis):Qe(Ge.hideIssuesLikeThis),menuItemAction:()=>{const t=e.IssuesManager.getHideIssueByCodeSetting(),s=t.get();s[this.issue.code()]=this.issue.isHidden()?"Unhidden":"Hidden",t.set(s)}};this.hiddenIssuesMenu.data=t}}updateAffectedResourceVisibility(){const e=this.affectedResourceViews.every((e=>e.isEmpty()));this.affectedResources.hidden=e}createAffectedResources(){const e=new s.TreeOutline.TreeElement;return e.setCollapsible(!1),e.setExpandable(!0),e.expand(),e.selectable=!1,e.listItemElement.classList.add("affected-resources-label"),e.listItemElement.textContent=Qe(Ge.affectedResources),e.childrenListElement.classList.add("affected-resources"),e}createBody(){const e=new s.TreeOutline.TreeElement;e.setCollapsible(!1),e.selectable=!1;const t=new p.MarkdownView.MarkdownView;t.data={tokens:this.description.markdown},e.listItemElement.appendChild(t),this.appendChild(e)}createReadMoreLinks(){if(0===this.description.links.length)return;const e=new s.TreeOutline.TreeElement;e.setCollapsible(!1),e.listItemElement.classList.add("link-wrapper");const t=e.listItemElement.createChild("ul","link-list");for(const e of this.description.links){const i=s.Fragment.html`<x-link class="link devtools-link" tabindex="0" href="${e.link}">${Qe(Ge.learnMoreS,{PH1:e.linkTitle})}</x-link>`,n=new c.Icon.Icon;n.data={iconName:"link_icon",color:"var(--color-link)",width:"16px",height:"16px"},n.classList.add("link-icon"),i.prepend(n),i.addEventListener("x-link-invoke",(()=>{u.userMetrics.issuesPanelResourceOpened(this.issue.getCategory(),"LearnMore")}));t.createChild("li").appendChild(i)}this.appendChild(e)}doUpdate(){this.expanded&&(this.affectedResourceViews.forEach((e=>e.update())),this.updateAffectedResourceVisibility()),this.needsUpdateOnExpand=!this.expanded,this.updateFromIssue()}update(){this.throttle.schedule((async()=>this.doUpdate()))}getIssueKind(){return this.issue.getKind()}isForHiddenIssue(){return this.issue.isHidden()}toggle(e){e||void 0===e&&!this.expanded?this.expand():this.collapse()}}const et={hideAllCurrentPageErrors:"Hide all current Page Errors",hideAllCurrentBreakingChanges:"Hide all current Breaking Changes",hideAllCurrentImprovements:"Hide all current Improvements"},tt=t.i18n.registerUIStrings("panels/issues/IssueKindView.ts",et),st=t.i18n.getLocalizedString.bind(void 0,tt);function it(){return r.Settings.Settings.instance().createSetting("groupIssuesByKind",!1)}class nt extends s.TreeOutline.TreeElement{kind;issueCount;constructor(t){super(void 0,!0),this.kind=t,this.issueCount=document.createElement("span"),this.toggleOnClick=!0,this.listItemElement.classList.add("issue-kind"),this.listItemElement.classList.add(function(t){switch(t){case e.Issue.IssueKind.BreakingChange:return"breaking-changes";case e.Issue.IssueKind.Improvement:return"improvements";case e.Issue.IssueKind.PageError:return"page-errors"}}(t)),this.childrenListElement.classList.add("issue-kind-body")}getKind(){return this.kind}getHideAllCurrentKindString(){switch(this.kind){case e.Issue.IssueKind.PageError:return st(et.hideAllCurrentPageErrors);case e.Issue.IssueKind.Improvement:return st(et.hideAllCurrentImprovements);case e.Issue.IssueKind.BreakingChange:return st(et.hideAllCurrentBreakingChanges)}}appendHeader(){const t=document.createElement("div");t.classList.add("header");const s=new c.Icon.Icon;s.data=d.IssueCounter.getIssueKindIconData(this.kind),s.classList.add("leading-issue-icon");const i=new l.Adorner.Adorner;i.data={name:"countWrapper",content:this.issueCount},i.classList.add("aggregated-issues-count"),this.issueCount.textContent="0";const n=document.createElement("div");n.classList.add("title"),n.textContent=e.Issue.getIssueKindName(this.kind);const a=new g.HideIssuesMenu.HideIssuesMenu;a.classList.add("hide-available-issues"),a.data={menuItemLabel:this.getHideAllCurrentKindString(),menuItemAction:()=>{const t=e.IssuesManager.getHideIssueByCodeSetting(),s=t.get();for(const t of e.IssuesManager.IssuesManager.instance().issues())t.getKind()===this.kind&&(s[t.code()]="Hidden");t.set(s)}},t.appendChild(s),t.appendChild(i),t.appendChild(n),t.appendChild(a),this.listItemElement.appendChild(t)}onattach(){this.appendHeader(),this.expand()}update(e){this.issueCount.textContent=`${e}`}}const at={crossOriginEmbedderPolicy:"Cross Origin Embedder Policy",mixedContent:"Mixed Content",samesiteCookie:"SameSite Cookie",heavyAds:"Heavy Ads",contentSecurityPolicy:"Content Security Policy",trustedWebActivity:"Trusted Web Activity",other:"Other",lowTextContrast:"Low Text Contrast",cors:"Cross Origin Resource Sharing",groupDisplayedIssuesUnder:"Group displayed issues under associated categories",groupByCategory:"Group by category",groupDisplayedIssuesUnderKind:"Group displayed issues as Page errors, Breaking changes and Improvements",groupByKind:"Group by kind",includeCookieIssuesCausedBy:"Include cookie Issues caused by third-party sites",includeThirdpartyCookieIssues:"Include third-party cookie issues",onlyThirdpartyCookieIssues:"Only third-party cookie issues detected so far",noIssuesDetectedSoFar:"No issues detected so far",attributionReporting:"Attribution Reporting `API`",quirksMode:"Quirks Mode",generic:"Generic"},rt=t.i18n.registerUIStrings("panels/issues/IssuesPane.ts",at),ot=t.i18n.getLocalizedString.bind(void 0,rt);class dt extends s.TreeOutline.TreeElement{category;issues;constructor(e){super(),this.category=e,this.issues=[],this.toggleOnClick=!0,this.listItemElement.classList.add("issue-category"),this.childrenListElement.classList.add("issue-category-body")}getCategoryName(){switch(this.category){case e.Issue.IssueCategory.CrossOriginEmbedderPolicy:return ot(at.crossOriginEmbedderPolicy);case e.Issue.IssueCategory.MixedContent:return ot(at.mixedContent);case e.Issue.IssueCategory.SameSiteCookie:return ot(at.samesiteCookie);case e.Issue.IssueCategory.HeavyAd:return ot(at.heavyAds);case e.Issue.IssueCategory.ContentSecurityPolicy:return ot(at.contentSecurityPolicy);case e.Issue.IssueCategory.TrustedWebActivity:return ot(at.trustedWebActivity);case e.Issue.IssueCategory.LowTextContrast:return ot(at.lowTextContrast);case e.Issue.IssueCategory.Cors:return ot(at.cors);case e.Issue.IssueCategory.AttributionReporting:return ot(at.attributionReporting);case e.Issue.IssueCategory.QuirksMode:return ot(at.quirksMode);case e.Issue.IssueCategory.Generic:return ot(at.generic);case e.Issue.IssueCategory.Other:return ot(at.other)}}onattach(){this.appendHeader()}appendHeader(){const e=document.createElement("div");e.classList.add("header");const t=document.createElement("div");t.classList.add("title"),t.textContent=this.getCategoryName(),e.appendChild(t),this.listItemElement.appendChild(e)}}function lt(){return r.Settings.Settings.instance().createSetting("groupIssuesByCategory",!1)}let ut;class ct extends s.Widget.VBox{categoryViews;issueViews;kindViews;showThirdPartyCheckbox;issuesTree;hiddenIssuesRow;noIssuesMessageDiv;issuesManager;aggregator;issueViewUpdatePromise=Promise.resolve();constructor(){super(!0),this.contentElement.classList.add("issues-pane"),this.categoryViews=new Map,this.kindViews=new Map,this.issueViews=new Map,this.showThirdPartyCheckbox=null,this.createToolbars(),this.issuesTree=new s.TreeOutline.TreeOutlineInShadow,this.issuesTree.setShowSelectionOnKeyboardFocus(!0),this.issuesTree.contentElement.classList.add("issues"),this.contentElement.appendChild(this.issuesTree.element),this.hiddenIssuesRow=new U,this.issuesTree.appendChild(this.hiddenIssuesRow),this.noIssuesMessageDiv=document.createElement("div"),this.noIssuesMessageDiv.classList.add("issues-pane-no-issues"),this.contentElement.appendChild(this.noIssuesMessageDiv),this.issuesManager=e.IssuesManager.IssuesManager.instance(),this.aggregator=new D(this.issuesManager),this.aggregator.addEventListener("AggregatedIssueUpdated",this.issueUpdated,this),this.aggregator.addEventListener("FullUpdateRequired",this.onFullUpdate,this),this.hiddenIssuesRow.hidden=0===this.issuesManager.numberOfHiddenIssues(),this.onFullUpdate(),this.issuesManager.addEventListener("IssuesCountUpdated",this.updateCounts,this)}static instance(e={forceNew:null}){const{forceNew:t}=e;return ut&&!t||(ut=new ct),ut}elementsToRestoreScrollPositionsFor(){return[this.issuesTree.element]}createToolbars(){const t=this.contentElement.createChild("div","issues-toolbar-container");new s.Toolbar.Toolbar("issues-toolbar-left",t);const i=new s.Toolbar.Toolbar("issues-toolbar-right",t),n=lt(),a=new s.Toolbar.ToolbarSettingCheckbox(n,ot(at.groupDisplayedIssuesUnder),ot(at.groupByCategory));a.setVisible(!1),i.appendToolbarItem(a),n.addChangeListener((()=>{this.fullUpdate(!0)}));const r=it(),l=new s.Toolbar.ToolbarSettingCheckbox(r,ot(at.groupDisplayedIssuesUnderKind),ot(at.groupByKind));i.appendToolbarItem(l),r.addChangeListener((()=>{this.fullUpdate(!0)})),l.setVisible(o.Runtime.experiments.isEnabled("groupAndHideIssuesByKind"));const u=e.Issue.getShowThirdPartyIssuesSetting();this.showThirdPartyCheckbox=new s.Toolbar.ToolbarSettingCheckbox(u,ot(at.includeCookieIssuesCausedBy),ot(at.includeThirdpartyCookieIssues)),i.appendToolbarItem(this.showThirdPartyCheckbox),this.setDefaultFocusedElement(this.showThirdPartyCheckbox.inputElement),i.appendSeparator();const c=new d.IssueCounter.IssueCounter;c.data={tooltipCallback:()=>{const t=d.IssueCounter.getIssueCountsEnumeration(e.IssuesManager.IssuesManager.instance(),!1);c.title=t},displayMode:"ShowAlways",issuesManager:e.IssuesManager.IssuesManager.instance()},c.id="console-issues-counter";const p=new s.Toolbar.ToolbarItem(c);return i.appendToolbarItem(p),{toolbarContainer:t}}issueUpdated(e){this.scheduleIssueViewUpdate(e.data)}scheduleIssueViewUpdate(e){this.issueViewUpdatePromise=this.issueViewUpdatePromise.then((()=>this.updateIssueView(e)))}async updateIssueView(t){let i=this.issueViews.get(t.aggregationKey());if(i){i.setIssue(t);const e=this.getIssueViewParent(t);i.parent===e||e instanceof s.TreeOutline.TreeOutline&&i.parent===e.rootElement()||(i.parent?.removeChild(i),this.appendIssueViewToParent(i,e))}else{const s=t.getDescription();if(!s)return void console.warn("Could not find description for issue code:",t.code());const n=await e.MarkdownIssueDescription.createIssueDescriptionFromMarkdown(s);i=new Ye(t,n),this.issueViews.set(t.aggregationKey(),i);const a=this.getIssueViewParent(t);this.appendIssueViewToParent(i,a)}i.update(),this.updateCounts()}appendIssueViewToParent(e,t){t.appendChild(e,((e,t)=>e instanceof U?1:t instanceof U?-1:e instanceof Ye&&t instanceof Ye?e.getIssueTitle().localeCompare(t.getIssueTitle()):(console.error("The issues tree should only contain IssueView objects as direct children"),0)))}getIssueViewParent(t){const s=o.Runtime.experiments.isEnabled("groupAndHideIssuesByKind");if(t.isHidden())return this.hiddenIssuesRow;if(s&&it().get()){const s=t.getKind(),i=this.kindViews.get(s);if(i)return i;const n=new nt(s);return this.issuesTree.appendChild(n,((t,s)=>t instanceof nt&&s instanceof nt?function(t,s){return t.getKind()===s.getKind()?0:t.getKind()===e.Issue.IssueKind.PageError||t.getKind()===e.Issue.IssueKind.BreakingChange&&s.getKind()===e.Issue.IssueKind.Improvement?-1:1}(t,s):0)),this.kindViews.set(s,n),n}if(lt().get()){const e=t.getCategory(),s=this.categoryViews.get(e);if(s)return s;const i=new dt(e);return this.issuesTree.appendChild(i,((e,t)=>e instanceof dt&&t instanceof dt?e.getCategoryName().localeCompare(t.getCategoryName()):0)),this.categoryViews.set(e,i),i}return this.issuesTree}clearViews(e,t){for(const[s,i]of Array.from(e.entries()))t?.has(s)||(i.parent&&i.parent.removeChild(i),e.delete(s))}onFullUpdate(){this.fullUpdate(!1)}fullUpdate(e){if(this.clearViews(this.categoryViews,e?void 0:this.aggregator.aggregatedIssueCategories()),this.clearViews(this.kindViews,e?void 0:this.aggregator.aggregatedIssueKinds()),this.clearViews(this.issueViews,e?void 0:this.aggregator.aggregatedIssueCodes()),this.aggregator)for(const e of this.aggregator.aggregatedIssues())this.scheduleIssueViewUpdate(e);this.updateCounts()}updateIssueKindViewsCount(){for(const e of this.kindViews.values()){const t=this.issuesManager.numberOfIssues(e.getKind());e.update(t)}}updateCounts(){const e=o.Runtime.experiments.isEnabled("groupAndHideIssuesByKind");this.showIssuesTreeOrNoIssuesDetectedMessage(this.issuesManager.numberOfIssues(),this.issuesManager.numberOfHiddenIssues()),e&&it().get()&&this.updateIssueKindViewsCount()}showIssuesTreeOrNoIssuesDetectedMessage(e,t){if(e>0||t>0){this.hiddenIssuesRow.hidden=0===t,this.hiddenIssuesRow.update(t),this.issuesTree.element.hidden=!1,this.noIssuesMessageDiv.style.display="none";const e=this.issuesTree.firstChild();e&&(e.select(!0),this.setDefaultFocusedElement(e.listItemElement))}else{this.issuesTree.element.hidden=!0,this.showThirdPartyCheckbox&&this.setDefaultFocusedElement(this.showThirdPartyCheckbox.inputElement);const e=this.issuesManager.numberOfAllStoredIssues()>0;this.noIssuesMessageDiv.textContent=ot(e?at.onlyThirdpartyCookieIssues:at.noIssuesDetectedSoFar),this.noIssuesMessageDiv.style.display="flex"}}async reveal(e){await this.issueViewUpdatePromise;const t=this.aggregator.keyForIssue(e),s=this.issueViews.get(t),i=o.Runtime.experiments.isEnabled("groupAndHideIssuesByKind");if(s){if(s.isForHiddenIssue()&&(this.hiddenIssuesRow.expand(),this.hiddenIssuesRow.reveal()),i&&it().get()&&!s.isForHiddenIssue()){const e=this.kindViews.get(s.getIssueKind());e?.expand(),e?.reveal()}s.expand(),s.reveal(),s.select(!1,!0)}}wasShown(){super.wasShown(),this.issuesTree.registerCSSFiles([H]),this.registerCSSFiles([F])}}var pt=Object.freeze({__proto__:null,getGroupIssuesByCategorySetting:lt,IssuesPane:ct});let ht;class gt{static instance(e={forceNew:null}){const{forceNew:t}=e;return ht&&!t||(ht=new gt),ht}async reveal(t){if(!(t instanceof e.Issue.Issue))throw new Error("Internal error: not a issue");await s.ViewManager.ViewManager.instance().showView("issues-pane");const i=s.ViewManager.ViewManager.instance().view("issues-pane");if(i){const e=await i.widget();if(!(e instanceof ct))throw new Error("Expected issues pane to be an instance of IssuesPane");await e.reveal(t)}}}var ft=Object.freeze({__proto__:null,IssueRevealer:gt});export{L as CSPViolationsView,P as IssueAggregator,ft as IssueRevealer,pt as IssuesPane};
