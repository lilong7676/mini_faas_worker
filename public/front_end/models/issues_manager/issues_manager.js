import*as e from"../../core/common/common.js";import*as s from"../../core/host/host.js";import*as t from"../../core/i18n/i18n.js";import*as i from"../../third_party/marked/marked.js";import*as r from"../../core/root/root.js";import*as n from"../../core/sdk/sdk.js";import*as o from"../bindings/bindings.js";import*as a from"../text_utils/text_utils.js";import*as u from"../workspace/workspace.js";const l={improvements:"Improvements",pageErrors:"Page Errors",breakingChanges:"Breaking Changes",pageErrorIssue:"A page error issue: the page is not working correctly",breakingChangeIssue:"A breaking change issue: the page may stop working in an upcoming version of Chrome",improvementIssue:"An improvement issue: there is an opportunity to improve the page"},d=t.i18n.registerUIStrings("models/issues_manager/Issue.ts",l),c=t.i18n.getLocalizedString.bind(void 0,d);var g,m;!function(e){e.CrossOriginEmbedderPolicy="CrossOriginEmbedderPolicy",e.Generic="Generic",e.MixedContent="MixedContent",e.SameSiteCookie="SameSiteCookie",e.HeavyAd="HeavyAd",e.ContentSecurityPolicy="ContentSecurityPolicy",e.TrustedWebActivity="TrustedWebActivity",e.LowTextContrast="LowTextContrast",e.Cors="Cors",e.AttributionReporting="AttributionReporting",e.QuirksMode="QuirksMode",e.Other="Other"}(g||(g={})),function(e){e.PageError="PageError",e.BreakingChange="BreakingChange",e.Improvement="Improvement"}(m||(m={}));class h{issueCode;issuesModel;issueId=void 0;hidden;constructor(e,t=null,i){this.issueCode="object"==typeof e?e.code:e,this.issuesModel=t,this.issueId=i,s.userMetrics.issueCreated("string"==typeof e?e:e.umaCode),this.hidden=!1}code(){return this.issueCode}getBlockedByResponseDetails(){return[]}cookies(){return[]}rawCookieLines(){return[]}elements(){return[]}requests(){return[]}sources(){return[]}isAssociatedWithRequestId(e){for(const s of this.requests())if(s.requestId===e)return!0;return!1}model(){return this.issuesModel}isCausedByThirdParty(){return!1}getIssueId(){return this.issueId}isHidden(){return this.hidden}setHidden(e){this.hidden=e}}function p(e){if(e)return{url:e.url,scriptId:e.scriptId,lineNumber:e.lineNumber,columnNumber:0===e.columnNumber?void 0:e.columnNumber-1}}var I=Object.freeze({__proto__:null,get IssueCategory(){return g},get IssueKind(){return m},getIssueKindName:function(e){switch(e){case m.BreakingChange:return c(l.breakingChanges);case m.Improvement:return c(l.improvements);case m.PageError:return c(l.pageErrors)}},getIssueKindDescription:function(e){switch(e){case m.PageError:return c(l.pageErrorIssue);case m.BreakingChange:return c(l.breakingChangeIssue);case m.Improvement:return c(l.improvementIssue)}},unionIssueKind:function(e,s){return e===m.PageError||s===m.PageError?m.PageError:e===m.BreakingChange||s===m.BreakingChange?m.BreakingChange:m.Improvement},getShowThirdPartyIssuesSetting:function(){return e.Settings.Settings.instance().createSetting("showThirdPartyIssues",!1)},Issue:h,toZeroBasedLocation:p});class S extends h{issueDetails;constructor(e,s){super(function(e){switch(e.violationType){case"PermissionPolicyDisabled":return"AttributionReportingIssue::PermissionPolicyDisabled";case"InvalidAttributionSourceEventId":return"AttributionReportingIssue::InvalidAttributionSourceEventId";case"InvalidAttributionData":return void 0!==e.invalidParameter?"AttributionReportingIssue::InvalidAttributionData":"AttributionReportingIssue::MissingAttributionData";case"AttributionSourceUntrustworthyOrigin":return void 0!==e.frame?"AttributionReportingIssue::AttributionSourceUntrustworthyFrameOrigin":"AttributionReportingIssue::AttributionSourceUntrustworthyOrigin";case"AttributionUntrustworthyOrigin":return void 0!==e.frame?"AttributionReportingIssue::AttributionUntrustworthyFrameOrigin":"AttributionReportingIssue::AttributionUntrustworthyOrigin";case"AttributionTriggerDataTooLarge":return"AttrubtionReportingIssue::AttributionTriggerDataTooLarge";case"AttributionEventSourceTriggerDataTooLarge":return"AttrubtionReportingIssue::AttributionEventSourceTriggerDataTooLarge"}}(e),s),this.issueDetails=e}getCategory(){return g.AttributionReporting}getDescription(){switch(this.code()){case"AttributionReportingIssue::PermissionPolicyDisabled":return{file:"arPermissionPolicyDisabled.md",links:[]};case"AttributionReportingIssue::InvalidAttributionSourceEventId":return{file:"arInvalidAttributionSourceEventId.md",links:[]};case"AttributionReportingIssue::InvalidAttributionData":return{file:"arInvalidAttributionData.md",links:[]};case"AttributionReportingIssue::MissingAttributionData":return{file:"arMissingAttributionData.md",links:[]};case"AttributionReportingIssue::AttributionSourceUntrustworthyFrameOrigin":return{file:"arAttributionSourceUntrustworthyFrameOrigin.md",links:[]};case"AttributionReportingIssue::AttributionSourceUntrustworthyOrigin":return{file:"arAttributionSourceUntrustworthyOrigin.md",links:[]};case"AttributionReportingIssue::AttributionUntrustworthyFrameOrigin":return{file:"arAttributionUntrustworthyFrameOrigin.md",links:[]};case"AttributionReportingIssue::AttributionUntrustworthyOrigin":return{file:"arAttributionUntrustworthyOrigin.md",links:[]};case"AttrubtionReportingIssue::AttributionTriggerDataTooLarge":return{file:"arAttributionTriggerDataTooLarge.md",links:[]};case"AttrubtionReportingIssue::AttributionEventSourceTriggerDataTooLarge":return{file:"arAttributionEventSourceTriggerDataTooLarge.md",links:[]}}}primaryKey(){return JSON.stringify(this.issueDetails)}getKind(){return m.PageError}static fromInspectorIssue(e,s){const{attributionReportingIssueDetails:t}=s.details;return t?[new S(t,e)]:(console.warn("Attribution Reporting issue without details received."),[])}}var f=Object.freeze({__proto__:null,AttributionReportingIssue:S});function C(e){const s=new Map;e.substitutions?.forEach(((e,t)=>{s.set(t,e())}));return{file:e.file,links:e.links.map((function(e){return{link:e.link,linkTitle:e.linkTitle()}})),substitutions:s}}async function k(e){try{return(await fetch(e.toString())).text()}catch(s){throw new Error(`Markdown file ${e.toString()} not found. Make sure it is correctly listed in the relevant BUILD.gn files.`)}}async function v(e){return k(new URL(`descriptions/${e}`,import.meta.url))}function w(e,s){const t=i.Marked.lexer(e),r=D(t);if(!r)throw new Error("Markdown issue descriptions must start with a heading");return{title:r,markdown:t.slice(1),links:s.links}}const y=/\{(PLACEHOLDER_[a-zA-Z][a-zA-Z0-9]*)\}/g,b=/PLACEHOLDER_[a-zA-Z][a-zA-Z0-9]*/;function A(e,s){const t=new Set(s?s.keys():[]);!function(e){const s=[...e].filter((e=>!b.test(e)));if(s.length>0)throw new Error(`Invalid placeholders provided in the substitutions map: ${s}`)}(t);const i=e.replace(y,((e,i)=>{const r=s?s.get(i):void 0;if(!r)throw new Error(`No replacment provided for placeholder '${i}'.`);return t.delete(i),r}));if(t.size>0)throw new Error(`Unused replacements provided: ${[...t]}`);return i}function D(e){return 0===e.length||"heading"!==e[0].type||1!==e[0].depth?null:e[0].text}async function P(e){const s=await v(e.file);return D(i.Marked.lexer(s))}var T=Object.freeze({__proto__:null,resolveLazyDescription:C,getFileContent:k,getMarkdownFileContent:v,createIssueDescriptionFromMarkdown:async function(e){return w(A(await v(e.file),e.substitutions),e)},createIssueDescriptionFromRawMarkdown:w,substitutePlaceholders:A,findTitleFromMarkdownAst:D,getIssueTitleFromMarkdownDescription:P});const M={contentSecurityPolicySource:"Content Security Policy - Source Allowlists",contentSecurityPolicyInlineCode:"Content Security Policy - Inline Code",contentSecurityPolicyEval:"Content Security Policy - Eval",trustedTypesFixViolations:"Trusted Types - Fix violations",trustedTypesPolicyViolation:"Trusted Types - Policy violation"},R=t.i18n.registerUIStrings("models/issues_manager/ContentSecurityPolicyIssue.ts",M),x=t.i18n.getLazilyComputedLocalizedString.bind(void 0,R);class E extends h{issueDetails;constructor(e,s,t){super(["ContentSecurityPolicyIssue",e.contentSecurityPolicyViolationType].join("::"),s,t),this.issueDetails=e}getCategory(){return g.ContentSecurityPolicy}primaryKey(){return JSON.stringify(this.issueDetails,["blockedURL","contentSecurityPolicyViolationType","violatedDirective","isReportOnly","sourceCodeLocation","url","lineNumber","columnNumber","violatingNodeId"])}getDescription(){const e=z.get(this.issueDetails.contentSecurityPolicyViolationType);return e?C(e):null}details(){return this.issueDetails}getKind(){return this.issueDetails.isReportOnly?m.Improvement:m.PageError}static fromInspectorIssue(e,s){const t=s.details.contentSecurityPolicyIssueDetails;return t?[new E(t,e,s.issueId)]:(console.warn("Content security policy issue without details received."),[])}}const O={file:"cspURLViolation.md",links:[{link:"https://developers.google.com/web/fundamentals/security/csp#source_allowlists",linkTitle:x(M.contentSecurityPolicySource)}]},L={file:"cspInlineViolation.md",links:[{link:"https://developers.google.com/web/fundamentals/security/csp#inline_code_is_considered_harmful",linkTitle:x(M.contentSecurityPolicyInlineCode)}]},N={file:"cspEvalViolation.md",links:[{link:"https://developers.google.com/web/fundamentals/security/csp#eval_too",linkTitle:x(M.contentSecurityPolicyEval)}]},_={file:"cspTrustedTypesSinkViolation.md",links:[{link:"https://web.dev/trusted-types/#fix-the-violations",linkTitle:x(M.trustedTypesFixViolations)}]},F={file:"cspTrustedTypesPolicyViolation.md",links:[{link:"https://web.dev/trusted-types/",linkTitle:x(M.trustedTypesPolicyViolation)}]},U=["ContentSecurityPolicyIssue","kURLViolation"].join("::"),W=["ContentSecurityPolicyIssue","kInlineViolation"].join("::"),B=["ContentSecurityPolicyIssue","kEvalViolation"].join("::"),H=["ContentSecurityPolicyIssue","kTrustedTypesSinkViolation"].join("::"),j=["ContentSecurityPolicyIssue","kTrustedTypesPolicyViolation"].join("::"),z=new Map([["kURLViolation",O],["kInlineViolation",L],["kEvalViolation",N],["kTrustedTypesSinkViolation",_],["kTrustedTypesPolicyViolation",F]]);var K=Object.freeze({__proto__:null,ContentSecurityPolicyIssue:E,urlViolationCode:U,inlineViolationCode:W,evalViolationCode:B,trustedTypesSinkViolationCode:H,trustedTypesPolicyViolationCode:j});let q=null;class V{pageLoadListeners=new WeakMap;frameAddedListeners=new WeakMap;constructor(){n.TargetManager.TargetManager.instance().observeModels(n.ResourceTreeModel.ResourceTreeModel,this)}static instance({forceNew:e}={forceNew:!1}){return q&&!e||(q=new V),q}async modelAdded(e){this.pageLoadListeners.set(e,e.addEventListener(n.ResourceTreeModel.Events.Load,this.pageLoaded,this)),this.frameAddedListeners.set(e,e.addEventListener(n.ResourceTreeModel.Events.FrameAdded,this.frameAdded,this))}modelRemoved(s){const t=this.pageLoadListeners.get(s);t&&e.EventTarget.removeEventListeners([t]);const i=this.frameAddedListeners.get(s);i&&e.EventTarget.removeEventListeners([i])}checkContrast(e){r.Runtime.experiments.isEnabled("contrastIssues")&&e.target().auditsAgent().invoke_checkContrast({})}pageLoaded(e){const{resourceTreeModel:s}=e.data;this.checkContrast(s)}async frameAdded(e){if(!r.Runtime.experiments.isEnabled("contrastIssues"))return;const s=e.data;if(!s.isMainFrame())return;const t=await s.resourceTreeModel().target().runtimeAgent().invoke_evaluate({expression:"document.readyState",returnByValue:!0});t.result&&"complete"===t.result.value&&this.checkContrast(s.resourceTreeModel())}}var $=Object.freeze({__proto__:null,ContrastCheckTrigger:V});const Q={corsForPrivateNetworksRfc:"CORS for private networks (RFC1918)",CORS:"Cross-Origin Resource Sharing (`CORS`)"},G=t.i18n.registerUIStrings("models/issues_manager/CorsIssue.ts",Q),J=t.i18n.getLocalizedString.bind(void 0,G);var Z;function X(e){switch(e.corsErrorStatus.corsError){case"InvalidAllowMethodsPreflightResponse":case"InvalidAllowHeadersPreflightResponse":case"PreflightMissingAllowOriginHeader":case"PreflightMultipleAllowOriginValues":case"PreflightInvalidAllowOriginValue":case"MissingAllowOriginHeader":case"MultipleAllowOriginValues":case"InvalidAllowOriginValue":return Z.InvalidHeaderValues;case"PreflightWildcardOriginNotAllowed":case"WildcardOriginNotAllowed":return Z.WildcardOriginNotAllowed;case"PreflightInvalidStatus":case"PreflightDisallowedRedirect":return Z.PreflightResponseInvalid;case"AllowOriginMismatch":case"PreflightAllowOriginMismatch":return Z.OriginMismatch;case"InvalidAllowCredentials":case"PreflightInvalidAllowCredentials":return Z.AllowCredentialsRequired;case"MethodDisallowedByPreflightResponse":return Z.MethodDisallowedByPreflightResponse;case"HeaderDisallowedByPreflightResponse":return Z.HeaderDisallowedByPreflightResponse;case"RedirectContainsCredentials":return Z.RedirectContainsCredentials;case"DisallowedByMode":return Z.DisallowedByMode;case"CorsDisabledScheme":return Z.CorsDisabledScheme;case"PreflightMissingAllowExternal":return Z.PreflightMissingAllowExternal;case"PreflightInvalidAllowExternal":return Z.PreflightInvalidAllowExternal;case"InvalidResponse":return Z.InvalidResponse;case"InsecurePrivateNetwork":return e.clientSecurityState?.initiatorIsSecureContext?Z.InsecurePrivateNetworkPreflight:Z.InsecurePrivateNetwork;case"NoCorsRedirectModeNotFollow":return Z.NoCorsRedirectModeNotFollow;case"InvalidPrivateNetworkAccess":return Z.InvalidPrivateNetworkAccess;case"UnexpectedPrivateNetworkAccess":return Z.UnexpectedPrivateNetworkAccess;case"PreflightMissingAllowPrivateNetwork":return Z.PreflightMissingAllowPrivateNetwork;case"PreflightInvalidAllowPrivateNetwork":return Z.PreflightInvalidAllowPrivateNetwork}}!function(e){e.InsecurePrivateNetwork="CorsIssue::InsecurePrivateNetwork",e.InsecurePrivateNetworkPreflight="CorsIssue::InsecurePrivateNetworkPreflight",e.InvalidHeaderValues="CorsIssue::InvalidHeaders",e.WildcardOriginNotAllowed="CorsIssue::WildcardOriginWithCredentials",e.PreflightResponseInvalid="CorsIssue::PreflightResponseInvalid",e.OriginMismatch="CorsIssue::OriginMismatch",e.AllowCredentialsRequired="CorsIssue::AllowCredentialsRequired",e.MethodDisallowedByPreflightResponse="CorsIssue::MethodDisallowedByPreflightResponse",e.HeaderDisallowedByPreflightResponse="CorsIssue::HeaderDisallowedByPreflightResponse",e.RedirectContainsCredentials="CorsIssue::RedirectContainsCredentials",e.DisallowedByMode="CorsIssue::DisallowedByMode",e.CorsDisabledScheme="CorsIssue::CorsDisabledScheme",e.PreflightMissingAllowExternal="CorsIssue::PreflightMissingAllowExternal",e.PreflightInvalidAllowExternal="CorsIssue::PreflightInvalidAllowExternal",e.InvalidResponse="CorsIssue::InvalidResponse",e.NoCorsRedirectModeNotFollow="CorsIssue::NoCorsRedirectModeNotFollow",e.InvalidPrivateNetworkAccess="CorsIssue::InvalidPrivateNetworkAccess",e.UnexpectedPrivateNetworkAccess="CorsIssue::UnexpectedPrivateNetworkAccess",e.PreflightMissingAllowPrivateNetwork="CorsIssue::PreflightMissingAllowPrivateNetwork",e.PreflightInvalidAllowPrivateNetwork="CorsIssue::PreflightInvalidAllowPrivateNetwork"}(Z||(Z={}));class Y extends h{issueDetails;constructor(e,s,t){super(X(e),s,t),this.issueDetails=e}getCategory(){return g.Cors}details(){return this.issueDetails}getDescription(){switch(X(this.issueDetails)){case Z.InsecurePrivateNetwork:return{file:"corsInsecurePrivateNetwork.md",links:[{link:"https://developer.chrome.com/blog/private-network-access-update",linkTitle:J(Q.corsForPrivateNetworksRfc)}]};case Z.InsecurePrivateNetworkPreflight:return{file:"corsInsecurePrivateNetworkPreflight.md",links:[{link:"https://developer.chrome.com/blog/private-network-access-update",linkTitle:J(Q.corsForPrivateNetworksRfc)}]};case Z.InvalidHeaderValues:return{file:"corsInvalidHeaderValues.md",links:[{link:"https://web.dev/cross-origin-resource-sharing",linkTitle:J(Q.CORS)}]};case Z.WildcardOriginNotAllowed:return{file:"corsWildcardOriginNotAllowed.md",links:[{link:"https://web.dev/cross-origin-resource-sharing",linkTitle:J(Q.CORS)}]};case Z.PreflightResponseInvalid:return{file:"corsPreflightResponseInvalid.md",links:[{link:"https://web.dev/cross-origin-resource-sharing",linkTitle:J(Q.CORS)}]};case Z.OriginMismatch:return{file:"corsOriginMismatch.md",links:[{link:"https://web.dev/cross-origin-resource-sharing",linkTitle:J(Q.CORS)}]};case Z.AllowCredentialsRequired:return{file:"corsAllowCredentialsRequired.md",links:[{link:"https://web.dev/cross-origin-resource-sharing",linkTitle:J(Q.CORS)}]};case Z.MethodDisallowedByPreflightResponse:return{file:"corsMethodDisallowedByPreflightResponse.md",links:[{link:"https://web.dev/cross-origin-resource-sharing",linkTitle:J(Q.CORS)}]};case Z.HeaderDisallowedByPreflightResponse:return{file:"corsHeaderDisallowedByPreflightResponse.md",links:[{link:"https://web.dev/cross-origin-resource-sharing",linkTitle:J(Q.CORS)}]};case Z.RedirectContainsCredentials:return{file:"corsRedirectContainsCredentials.md",links:[{link:"https://web.dev/cross-origin-resource-sharing",linkTitle:J(Q.CORS)}]};case Z.DisallowedByMode:return{file:"corsDisallowedByMode.md",links:[{link:"https://web.dev/cross-origin-resource-sharing",linkTitle:J(Q.CORS)}]};case Z.CorsDisabledScheme:return{file:"corsDisabledScheme.md",links:[{link:"https://web.dev/cross-origin-resource-sharing",linkTitle:J(Q.CORS)}]};case Z.NoCorsRedirectModeNotFollow:return{file:"corsNoCorsRedirectModeNotFollow.md",links:[{link:"https://web.dev/cross-origin-resource-sharing",linkTitle:J(Q.CORS)}]};case Z.PreflightMissingAllowExternal:case Z.PreflightInvalidAllowExternal:case Z.InvalidResponse:case Z.InvalidPrivateNetworkAccess:case Z.UnexpectedPrivateNetworkAccess:case Z.PreflightMissingAllowPrivateNetwork:case Z.PreflightInvalidAllowPrivateNetwork:return null}}primaryKey(){return JSON.stringify(this.issueDetails)}getKind(){return this.issueDetails.isWarning&&"InsecurePrivateNetwork"===this.issueDetails.corsErrorStatus.corsError?m.BreakingChange:m.PageError}static fromInspectorIssue(e,s){const t=s.details.corsIssueDetails;return t?[new Y(t,e,s.issueId)]:(console.warn("Cors issue without details received."),[])}}var ee=Object.freeze({__proto__:null,get IssueCode(){return Z},CorsIssue:Y});const se={coopAndCoep:"COOP and COEP",samesiteAndSameorigin:"Same-Site and Same-Origin"},te=t.i18n.registerUIStrings("models/issues_manager/CrossOriginEmbedderPolicyIssue.ts",se),ie=t.i18n.getLazilyComputedLocalizedString.bind(void 0,te);function re(e){switch(e){case"CoepFrameResourceNeedsCoepHeader":case"CoopSandboxedIFrameCannotNavigateToCoopPage":case"CorpNotSameOrigin":case"CorpNotSameOriginAfterDefaultedToSameOriginByCoep":case"CorpNotSameSite":return!0}return!1}class ne extends h{issueDetails;constructor(e,s){super(`CrossOriginEmbedderPolicyIssue::${e.reason}`,s),this.issueDetails=e}primaryKey(){return`${this.code()}-(${this.issueDetails.request.requestId})`}getBlockedByResponseDetails(){return[this.issueDetails]}requests(){return[this.issueDetails.request]}getCategory(){return g.CrossOriginEmbedderPolicy}getDescription(){const e=oe.get(this.code());return e?C(e):null}getKind(){return m.PageError}}const oe=new Map([["CrossOriginEmbedderPolicyIssue::CorpNotSameOriginAfterDefaultedToSameOriginByCoep",{file:"CoepCorpNotSameOriginAfterDefaultedToSameOriginByCoep.md",links:[{link:"https://web.dev/coop-coep/",linkTitle:ie(se.coopAndCoep)},{link:"https://web.dev/same-site-same-origin/",linkTitle:ie(se.samesiteAndSameorigin)}]}],["CrossOriginEmbedderPolicyIssue::CoepFrameResourceNeedsCoepHeader",{file:"CoepFrameResourceNeedsCoepHeader.md",links:[{link:"https://web.dev/coop-coep/",linkTitle:ie(se.coopAndCoep)}]}],["CrossOriginEmbedderPolicyIssue::CoopSandboxedIframeCannotNavigateToCoopPage",{file:"CoepCoopSandboxedIframeCannotNavigateToCoopPage.md",links:[{link:"https://web.dev/coop-coep/",linkTitle:ie(se.coopAndCoep)}]}],["CrossOriginEmbedderPolicyIssue::CorpNotSameSite",{file:"CoepCorpNotSameSite.md",links:[{link:"https://web.dev/coop-coep/",linkTitle:ie(se.coopAndCoep)},{link:"https://web.dev/same-site-same-origin/",linkTitle:ie(se.samesiteAndSameorigin)}]}],["CrossOriginEmbedderPolicyIssue::CorpNotSameOrigin",{file:"CoepCorpNotSameOrigin.md",links:[{link:"https://web.dev/coop-coep/",linkTitle:ie(se.coopAndCoep)},{link:"https://web.dev/same-site-same-origin/",linkTitle:ie(se.samesiteAndSameorigin)}]}]]);var ae=Object.freeze({__proto__:null,isCrossOriginEmbedderPolicyIssue:re,CrossOriginEmbedderPolicyIssue:ne});class ue extends h{issueDetails;constructor(e,s){super("DeprecationIssue",s),this.issueDetails=e}getCategory(){return g.Other}details(){return this.issueDetails}getDescription(){return{file:"deprecation.md",substitutions:new Map([["PLACEHOLDER_message",String(this.issueDetails.message)]]),links:[]}}sources(){return this.issueDetails.sourceCodeLocation?[this.issueDetails.sourceCodeLocation]:[]}primaryKey(){return JSON.stringify(this.issueDetails)}getKind(){return m.BreakingChange}static fromInspectorIssue(e,s){const t=s.details.deprecationIssueDetails;return t?[new ue(t,e)]:(console.warn("Deprecation issue without details received."),[])}}var le=Object.freeze({__proto__:null,DeprecationIssue:ue});const de={crossOriginPortalPostMessage:"Portals - Same-origin communication channels"},ce=t.i18n.registerUIStrings("models/issues_manager/GenericIssue.ts",de),ge=t.i18n.getLazilyComputedLocalizedString.bind(void 0,ce);class me extends h{issueDetails;constructor(e,s,t){super(["GenericIssue",e.errorType].join("::"),s,t),this.issueDetails=e}getCategory(){return g.Generic}primaryKey(){return`${this.code()}-(${this.issueDetails.frameId})`}getDescription(){const e=Ie.get(this.issueDetails.errorType);return e?C(e):null}details(){return this.issueDetails}getKind(){return m.Improvement}static fromInspectorIssue(e,s){const t=s.details.genericIssueDetails;return t?[new me(t,e,s.issueId)]:(console.warn("Generic issue without details received."),[])}}const he={file:"genericCrossOriginPortalPostMessageError.md",links:[{link:"https://github.com/WICG/portals#same-origin-communication-channels",linkTitle:ge(de.crossOriginPortalPostMessage)}]},pe=["GenericIssue","CrossOriginPortalPostMessageError"].join("::"),Ie=new Map([["CrossOriginPortalPostMessageError",he]]);var Se=Object.freeze({__proto__:null,GenericIssue:me,genericCrossOriginPortalPostMessageError:he,genericCrossOriginPortalPostMessageCode:pe});const fe={handlingHeavyAdInterventions:"Handling Heavy Ad Interventions"},Ce=t.i18n.registerUIStrings("models/issues_manager/HeavyAdIssue.ts",fe),ke=t.i18n.getLocalizedString.bind(void 0,Ce);class ve extends h{issueDetails;constructor(e,s){super({code:"HeavyAdIssue",umaCode:["HeavyAdIssue",e.reason].join("::")},s),this.issueDetails=e}details(){return this.issueDetails}primaryKey(){return`HeavyAdIssue-${JSON.stringify(this.issueDetails)}`}getDescription(){return{file:"heavyAd.md",links:[{link:"https://developers.google.com/web/updates/2020/05/heavy-ad-interventions",linkTitle:ke(fe.handlingHeavyAdInterventions)}]}}getCategory(){return g.HeavyAd}getKind(){switch(this.issueDetails.resolution){case"HeavyAdBlocked":return m.PageError;case"HeavyAdWarning":return m.BreakingChange}}static fromInspectorIssue(e,s){const t=s.details.heavyAdIssueDetails;return t?[new ve(t,e)]:(console.warn("Heavy Ad issue without details received."),[])}}var we=Object.freeze({__proto__:null,HeavyAdIssue:ve});const ye={colorAndContrastAccessibility:"Color and contrast accessibility"},be=t.i18n.registerUIStrings("models/issues_manager/LowTextContrastIssue.ts",ye),Ae=t.i18n.getLocalizedString.bind(void 0,be);class De extends h{issueDetails;constructor(e,s){super("LowTextContrastIssue",s),this.issueDetails=e}primaryKey(){return`${this.code()}-(${this.issueDetails.violatingNodeId})`}getCategory(){return g.LowTextContrast}details(){return this.issueDetails}getDescription(){return{file:"LowTextContrast.md",links:[{link:"https://web.dev/color-and-contrast-accessibility/",linkTitle:Ae(ye.colorAndContrastAccessibility)}]}}getKind(){return m.Improvement}static fromInspectorIssue(e,s){const t=s.details.lowTextContrastIssueDetails;return t?[new De(t,e)]:(console.warn("LowTextContrast issue without details received."),[])}}var Pe=Object.freeze({__proto__:null,LowTextContrastIssue:De});const Te={preventingMixedContent:"Preventing mixed content"},Me=t.i18n.registerUIStrings("models/issues_manager/MixedContentIssue.ts",Te),Re=t.i18n.getLocalizedString.bind(void 0,Me);class xe extends h{issueDetails;constructor(e,s){super("MixedContentIssue",s),this.issueDetails=e}requests(){return this.issueDetails.request?[this.issueDetails.request]:[]}getDetails(){return this.issueDetails}getCategory(){return g.MixedContent}getDescription(){return{file:"mixedContent.md",links:[{link:"https://web.dev/what-is-mixed-content/",linkTitle:Re(Te.preventingMixedContent)}]}}primaryKey(){return JSON.stringify(this.issueDetails)}getKind(){switch(this.issueDetails.resolutionStatus){case"MixedContentAutomaticallyUpgraded":return m.Improvement;case"MixedContentBlocked":return m.PageError;case"MixedContentWarning":return m.Improvement}}static fromInspectorIssue(e,s){const t=s.details.mixedContentIssueDetails;return t?[new xe(t,e)]:(console.warn("Mixed content issue without details received."),[])}}var Ee=Object.freeze({__proto__:null,MixedContentIssue:xe});const Oe={samesiteCookiesExplained:"SameSite cookies explained",howSchemefulSamesiteWorks:"How Schemeful Same-Site Works",aSecure:"a secure",anInsecure:"an insecure",firstPartySetsExplained:"`First-Party Sets` and the `SameParty` attribute"},Le=t.i18n.registerUIStrings("models/issues_manager/SameSiteCookieIssue.ts",Oe),Ne=t.i18n.getLazilyComputedLocalizedString.bind(void 0,Le);class _e extends h{issueDetails;constructor(e,s,t){super(e,t),this.issueDetails=s}cookieId(){if(this.issueDetails.cookie){const{domain:e,path:s,name:t}=this.issueDetails.cookie;return`${e};${s};${t}`}return this.issueDetails.rawCookieLine??"no-cookie-info"}primaryKey(){const e=this.issueDetails.request?this.issueDetails.request.requestId:"no-request";return`${this.code()}-(${this.cookieId()})-(${e})`}static createIssuesFromSameSiteDetails(e,s){const t=[];if(e.cookieExclusionReasons&&e.cookieExclusionReasons.length>0){for(const i of e.cookieExclusionReasons){const r=_e.codeForSameSiteDetails(i,e.cookieWarningReasons,e.operation,e.cookieUrl);r&&t.push(new _e(r,e,s))}return t}if(e.cookieWarningReasons)for(const i of e.cookieWarningReasons){const r=_e.codeForSameSiteDetails(i,[],e.operation,e.cookieUrl);r&&t.push(new _e(r,e,s))}return t}static codeForSameSiteDetails(e,s,t,i){const r=i&&(i.startsWith("https://")||i.startsWith("wss://"))?"Secure":"Insecure";if("ExcludeSameSiteStrict"===e||"ExcludeSameSiteLax"===e||"ExcludeSameSiteUnspecifiedTreatedAsLax"===e){if(s&&s.length>0){if(s.includes("WarnSameSiteStrictLaxDowngradeStrict"))return["SameSiteCookieIssue","ExcludeNavigationContextDowngrade",r].join("::");if(s.includes("WarnSameSiteStrictCrossDowngradeStrict")||s.includes("WarnSameSiteStrictCrossDowngradeLax")||s.includes("WarnSameSiteLaxCrossDowngradeStrict")||s.includes("WarnSameSiteLaxCrossDowngradeLax"))return["SameSiteCookieIssue","ExcludeContextDowngrade",t,r].join("::")}return"ExcludeSameSiteUnspecifiedTreatedAsLax"===e?["SameSiteCookieIssue",e,t].join("::"):null}return"WarnSameSiteStrictLaxDowngradeStrict"===e?["SameSiteCookieIssue",e,r].join("::"):"WarnSameSiteStrictCrossDowngradeStrict"===e||"WarnSameSiteStrictCrossDowngradeLax"===e||"WarnSameSiteLaxCrossDowngradeLax"===e||"WarnSameSiteLaxCrossDowngradeStrict"===e?["SameSiteCookieIssue","WarnCrossDowngrade",t,r].join("::"):["SameSiteCookieIssue",e,t].join("::")}cookies(){return this.issueDetails.cookie?[this.issueDetails.cookie]:[]}rawCookieLines(){return this.issueDetails.rawCookieLine?[this.issueDetails.rawCookieLine]:[]}requests(){return this.issueDetails.request?[this.issueDetails.request]:[]}getCategory(){return g.SameSiteCookie}getDescription(){const e=ts.get(this.code());return e?C(e):null}isCausedByThirdParty(){return Fe(n.FrameManager.FrameManager.instance().getTopFrame(),this.issueDetails.cookieUrl)}getKind(){return this.issueDetails.cookieExclusionReasons?.length>0?m.PageError:m.BreakingChange}static fromInspectorIssue(e,s){const t=s.details.sameSiteCookieIssueDetails;return t?_e.createIssuesFromSameSiteDetails(t,e):(console.warn("SameSite issue without details received."),[])}}function Fe(s,t){if(!s)return!0;if(!t||""===s.domainAndRegistry())return!1;const i=e.ParsedURL.ParsedURL.fromString(t);return!!i&&!function(e,s){if(e.length<=s.length)return e===s;if(!e.endsWith(s))return!1;return e.substr(0,e.length-s.length).endsWith(".")}(i.domain(),s.domainAndRegistry())}const Ue={file:"SameSiteUnspecifiedTreatedAsLaxRead.md",links:[{link:"https://web.dev/samesite-cookies-explained/",linkTitle:Ne(Oe.samesiteCookiesExplained)}]},We={file:"SameSiteUnspecifiedTreatedAsLaxSet.md",links:[{link:"https://web.dev/samesite-cookies-explained/",linkTitle:Ne(Oe.samesiteCookiesExplained)}]},Be={file:"SameSiteUnspecifiedLaxAllowUnsafeRead.md",links:[{link:"https://web.dev/samesite-cookies-explained/",linkTitle:Ne(Oe.samesiteCookiesExplained)}]},He={file:"SameSiteUnspecifiedLaxAllowUnsafeSet.md",links:[{link:"https://web.dev/samesite-cookies-explained/",linkTitle:Ne(Oe.samesiteCookiesExplained)}]},je={file:"SameSiteNoneInsecureErrorRead.md",links:[{link:"https://web.dev/samesite-cookies-explained/",linkTitle:Ne(Oe.samesiteCookiesExplained)}]},ze={file:"SameSiteNoneInsecureErrorSet.md",links:[{link:"https://web.dev/samesite-cookies-explained/",linkTitle:Ne(Oe.samesiteCookiesExplained)}]},Ke={file:"SameSiteNoneInsecureWarnRead.md",links:[{link:"https://web.dev/samesite-cookies-explained/",linkTitle:Ne(Oe.samesiteCookiesExplained)}]},qe={file:"SameSiteNoneInsecureWarnSet.md",links:[{link:"https://web.dev/samesite-cookies-explained/",linkTitle:Ne(Oe.samesiteCookiesExplained)}]},Ve=[{link:"https://web.dev/schemeful-samesite/",linkTitle:Ne(Oe.howSchemefulSamesiteWorks)}];function $e({isDestinationSecure:e,isOriginSecure:s}){return new Map([["PLACEHOLDER_destination",()=>e?"a secure":"an insecure"],["PLACEHOLDER_origin",()=>s?"a secure":"an insecure"]])}function Qe(e){return{file:"SameSiteWarnStrictLaxDowngradeStrict.md",substitutions:$e({isDestinationSecure:e,isOriginSecure:!e}),links:Ve}}function Ge(e){return{file:"SameSiteExcludeNavigationContextDowngrade.md",substitutions:$e({isDestinationSecure:e,isOriginSecure:!e}),links:Ve}}function Je(e){return{file:"SameSiteWarnCrossDowngradeRead.md",substitutions:$e({isDestinationSecure:e,isOriginSecure:!e}),links:Ve}}function Ze(e){return{file:"SameSiteExcludeContextDowngradeRead.md",substitutions:$e({isDestinationSecure:e,isOriginSecure:!e}),links:Ve}}function Xe(e){return{file:"SameSiteWarnCrossDowngradeSet.md",substitutions:$e({isDestinationSecure:!e,isOriginSecure:e}),links:Ve}}function Ye(e){return{file:"SameSiteExcludeContextDowngradeSet.md",substitutions:$e({isDestinationSecure:e,isOriginSecure:!e}),links:Ve}}const es={file:"SameSiteInvalidSameParty.md",links:[{link:"https://developer.chrome.com/blog/first-party-sets-sameparty/",linkTitle:Ne(Oe.firstPartySetsExplained)}]},ss={file:"SameSiteSamePartyCrossPartyContextSet.md",links:[{link:"https://developer.chrome.com/blog/first-party-sets-sameparty/",linkTitle:Ne(Oe.firstPartySetsExplained)}]},ts=new Map([["SameSiteCookieIssue::ExcludeSameSiteUnspecifiedTreatedAsLax::ReadCookie",Ue],["SameSiteCookieIssue::ExcludeSameSiteUnspecifiedTreatedAsLax::SetCookie",We],["SameSiteCookieIssue::WarnSameSiteUnspecifiedLaxAllowUnsafe::ReadCookie",Be],["SameSiteCookieIssue::WarnSameSiteUnspecifiedLaxAllowUnsafe::SetCookie",He],["SameSiteCookieIssue::WarnSameSiteUnspecifiedCrossSiteContext::ReadCookie",Be],["SameSiteCookieIssue::WarnSameSiteUnspecifiedCrossSiteContext::SetCookie",He],["SameSiteCookieIssue::ExcludeSameSiteNoneInsecure::ReadCookie",je],["SameSiteCookieIssue::ExcludeSameSiteNoneInsecure::SetCookie",ze],["SameSiteCookieIssue::WarnSameSiteNoneInsecure::ReadCookie",Ke],["SameSiteCookieIssue::WarnSameSiteNoneInsecure::SetCookie",qe],["SameSiteCookieIssue::WarnSameSiteStrictLaxDowngradeStrict::Secure",Qe(!0)],["SameSiteCookieIssue::WarnSameSiteStrictLaxDowngradeStrict::Insecure",Qe(!1)],["SameSiteCookieIssue::WarnCrossDowngrade::ReadCookie::Secure",Je(!0)],["SameSiteCookieIssue::WarnCrossDowngrade::ReadCookie::Insecure",Je(!1)],["SameSiteCookieIssue::WarnCrossDowngrade::SetCookie::Secure",Xe(!0)],["SameSiteCookieIssue::WarnCrossDowngrade::SetCookie::Insecure",Xe(!1)],["SameSiteCookieIssue::ExcludeNavigationContextDowngrade::Secure",Ge(!0)],["SameSiteCookieIssue::ExcludeNavigationContextDowngrade::Insecure",Ge(!1)],["SameSiteCookieIssue::ExcludeContextDowngrade::ReadCookie::Secure",Ze(!0)],["SameSiteCookieIssue::ExcludeContextDowngrade::ReadCookie::Insecure",Ze(!1)],["SameSiteCookieIssue::ExcludeContextDowngrade::SetCookie::Secure",Ye(!0)],["SameSiteCookieIssue::ExcludeContextDowngrade::SetCookie::Insecure",Ye(!1)],["SameSiteCookieIssue::ExcludeInvalidSameParty::SetCookie",es],["SameSiteCookieIssue::ExcludeSamePartyCrossPartyContext::SetCookie",ss]]);var is=Object.freeze({__proto__:null,SameSiteCookieIssue:_e,isCausedByThirdParty:Fe});const rs={userAgentReduction:"User-Agent String Reduction"},ns=t.i18n.registerUIStrings("models/issues_manager/NavigatorUserAgentIssue.ts",rs),os=t.i18n.getLocalizedString.bind(void 0,ns);var as;!function(e){e.NavigatorUserAgentIssue="DeprecationIssue::NavigatorUserAgentIssue"}(as||(as={}));class us extends h{issueDetails;constructor(e,s){super(as.NavigatorUserAgentIssue,s),this.issueDetails=e}getCategory(){return g.Other}details(){return this.issueDetails}getDescription(){return{file:"deprecationNavigatorUserAgent.md",links:[{link:"https://blog.chromium.org/2021/09/user-agent-reduction-origin-trial-and-dates.html",linkTitle:os(rs.userAgentReduction)}]}}sources(){return this.issueDetails.location?[this.issueDetails.location]:[]}primaryKey(){return JSON.stringify(this.issueDetails)}getKind(){return m.Improvement}isCausedByThirdParty(){return Fe(n.FrameManager.FrameManager.instance().getTopFrame(),this.issueDetails.url)}static fromInspectorIssue(e,s){const t=s.details.navigatorUserAgentIssueDetails;return t?[new us(t,e)]:(console.warn("NavigatorUserAgent issue without details received."),[])}}var ls=Object.freeze({__proto__:null,get IssueCode(){return as},NavigatorUserAgentIssue:us});const ds={documentCompatibilityMode:"Document compatibility mode"},cs=t.i18n.registerUIStrings("models/issues_manager/QuirksModeIssue.ts",ds),gs=t.i18n.getLocalizedString.bind(void 0,cs);class ms extends h{issueDetails;constructor(e,s){super({code:"QuirksModeIssue",umaCode:["QuirksModeIssue",e.isLimitedQuirksMode?"LimitedQuirksMode":"QuirksMode"].join("::")},s),this.issueDetails=e}primaryKey(){return`${this.code()}-(${this.issueDetails.documentNodeId})-(${this.issueDetails.url})`}getCategory(){return g.QuirksMode}details(){return this.issueDetails}getDescription(){return{file:"CompatibilityModeQuirks.md",links:[{link:"https://web.dev/doctype/",linkTitle:gs(ds.documentCompatibilityMode)}]}}getKind(){return m.Improvement}static fromInspectorIssue(e,s){const t=s.details.quirksModeIssueDetails;return t?[new ms(t,e)]:(console.warn("Quirks Mode issue without details received."),[])}}var hs=Object.freeze({__proto__:null,QuirksModeIssue:ms});const ps={enablingSharedArrayBuffer:"Enabling `SharedArrayBuffer`"},Is=t.i18n.registerUIStrings("models/issues_manager/SharedArrayBufferIssue.ts",ps),Ss=t.i18n.getLocalizedString.bind(void 0,Is);class fs extends h{issueDetails;constructor(e,s){super({code:"SharedArrayBufferIssue",umaCode:["SharedArrayBufferIssue",e.type].join("::")},s),this.issueDetails=e}getCategory(){return g.Other}details(){return this.issueDetails}getDescription(){return{file:"sharedArrayBuffer.md",links:[{link:"https://developer.chrome.com/blog/enabling-shared-array-buffer/",linkTitle:Ss(ps.enablingSharedArrayBuffer)}]}}primaryKey(){return JSON.stringify(this.issueDetails)}getKind(){return this.issueDetails.isWarning?m.BreakingChange:m.PageError}static fromInspectorIssue(e,s){const t=s.details.sharedArrayBufferIssueDetails;return t?[new fs(t,e)]:(console.warn("SAB transfer issue without details received."),[])}}var Cs=Object.freeze({__proto__:null,SharedArrayBufferIssue:fs});class ks{issuesManager;locationPool=new o.LiveLocation.LiveLocationPool;issueMessages=new Array;constructor(e){this.issuesManager=e,this.issuesManager.addEventListener("IssueAdded",this.onIssueAdded,this),this.issuesManager.addEventListener("FullUpdateRequired",this.onFullUpdateRequired,this)}onIssueAdded(e){const{issue:s}=e.data;this.addIssue(s)}addIssue(e){if(!this.isTrustedTypeIssue(e))return;const s=e.model();if(!s)return;const t=s.target().model(n.DebuggerModel.DebuggerModel),i=p(e.details().sourceCodeLocation);if(i&&t){const s=t.createRawLocationByURL(i.url,i.lineNumber,i.columnNumber);s&&this.addIssueMessageToScript(e,s)}}onFullUpdateRequired(){this.resetMessages();const e=this.issuesManager.issues();for(const s of e)this.addIssue(s)}async addIssueMessageToScript(s,t){const i=s.getDescription();if(i){const r=await P(i);if(r){const i=()=>{e.Revealer.reveal(s)};this.issueMessages.push(new vs(r,s.getKind(),t,this.locationPool,i))}}}isTrustedTypeIssue(e){return e instanceof E&&e.code()===H||e.code()===j}resetMessages(){for(const e of this.issueMessages)e.dispose();this.issueMessages=[],this.locationPool.disposeAll()}}class vs extends u.UISourceCode.Message{uiSourceCode=void 0;kind;constructor(e,s,t,i,r){super(u.UISourceCode.Message.Level.Issue,e,r),this.kind=s,o.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().createLiveLocation(t,this.updateLocation.bind(this),i)}async updateLocation(e){this.uiSourceCode&&this.uiSourceCode.removeMessage(this);const s=await e.uiLocation();s&&(this.range=a.TextRange.TextRange.createFromLocation(s.lineNumber,s.columnNumber||0),this.uiSourceCode=s.uiSourceCode,this.uiSourceCode.addMessage(this))}getIssueKind(){return this.kind}dispose(){this.uiSourceCode&&this.uiSourceCode.removeMessage(this)}}var ws=Object.freeze({__proto__:null,SourceFrameIssuesManager:ks,IssueMessage:vs});const ys={changesToQualityCriteriaForPwas:"Changes to quality criteria for PWAs using Trusted Web Activity"},bs=t.i18n.registerUIStrings("models/issues_manager/TrustedWebActivityIssue.ts",ys),As=t.i18n.getLazilyComputedLocalizedString.bind(void 0,bs);class Ds extends h{issueDetails;constructor(e){super(["TrustedWebActivityIssue",e.violationType].join("::")),this.issueDetails=e}details(){return this.issueDetails}getDescription(){const e=Os.get(this.issueDetails.violationType);return e?C(e):null}getCategory(){return g.TrustedWebActivity}primaryKey(){return`TrustedWebActivityIssue-${JSON.stringify(this.issueDetails)}`}getKind(){return m.PageError}static fromInspectorIssue(e,s){const t=s.details.twaQualityEnforcementDetails;return t?[new Ds(t)]:(console.warn("TWA Quality Enforcement issue without details received."),[])}}const Ps={file:"TwaDigitalAssetLinksFailed.md",links:[{link:"https://blog.chromium.org/2020/06/changes-to-quality-criteria-for-pwas.html",linkTitle:As(ys.changesToQualityCriteriaForPwas)}]},Ts={file:"TwaHttpError.md",links:[{link:"https://blog.chromium.org/2020/06/changes-to-quality-criteria-for-pwas.html",linkTitle:As(ys.changesToQualityCriteriaForPwas)}]},Ms={file:"TwaPageUnavailableOffline.md",links:[{link:"https://blog.chromium.org/2020/06/changes-to-quality-criteria-for-pwas.html",linkTitle:As(ys.changesToQualityCriteriaForPwas)}]},Rs=["TrustedWebActivityIssue","kHttpError"].join("::"),xs=["TrustedWebActivityIssue","kUnavailableOffline"].join("::"),Es=["TrustedWebActivityIssue","kDigitalAssetLinks"].join("::"),Os=new Map([["kHttpError",Ts],["kUnavailableOffline",Ms],["kDigitalAssetLinks",Ps]]);var Ls=Object.freeze({__proto__:null,TrustedWebActivityIssue:Ds,httpViolationCode:Rs,offlineViolationCode:xs,assetlinkViolationCode:Es});const Ns={linkTitle:"Restricting Wasm module sharing to same-origin"},_s=t.i18n.registerUIStrings("models/issues_manager/WasmCrossOriginModuleSharingIssue.ts",Ns),Fs=t.i18n.getLocalizedString.bind(void 0,_s);class Us extends h{issueDetails;constructor(e,s){super("WasmCrossOriginModuleSharingIssue",s),this.issueDetails=e}getCategory(){return g.Other}details(){return this.issueDetails}getDescription(){return{file:"wasmCrossOriginModuleSharing.md",links:[{link:"https://developer.chrome.com/blog/wasm-module-sharing-restricted-to-same-origin/",linkTitle:Fs(Ns.linkTitle)}]}}primaryKey(){return JSON.stringify(this.issueDetails)}getKind(){return this.issueDetails.isWarning?m.BreakingChange:m.PageError}static fromInspectorIssue(e,s){const t=s.details.wasmCrossOriginModuleSharingIssue;return t?[new Us(t,e)]:(console.warn("WasmCrossOriginModuleSharing issue without details received."),[])}}var Ws=Object.freeze({__proto__:null,WasmCrossOriginModuleSharingIssue:Us});let Bs=null;const Hs=new Map([["SameSiteCookieIssue",_e.fromInspectorIssue],["MixedContentIssue",xe.fromInspectorIssue],["HeavyAdIssue",ve.fromInspectorIssue],["ContentSecurityPolicyIssue",E.fromInspectorIssue],["BlockedByResponseIssue",function(e,s){const t=s.details.blockedByResponseIssueDetails;return t?re(t.reason)?[new ne(t,e)]:[]:(console.warn("BlockedByResponse issue without details received."),[])}],["SharedArrayBufferIssue",fs.fromInspectorIssue],["TrustedWebActivityIssue",Ds.fromInspectorIssue],["LowTextContrastIssue",De.fromInspectorIssue],["CorsIssue",Y.fromInspectorIssue],["QuirksModeIssue",ms.fromInspectorIssue],["NavigatorUserAgentIssue",us.fromInspectorIssue],["AttributionReportingIssue",S.fromInspectorIssue],["WasmCrossOriginModuleSharingIssue",Us.fromInspectorIssue],["GenericIssue",me.fromInspectorIssue],["DeprecationIssue",ue.fromInspectorIssue]]);function js(){return{}}class zs extends e.ObjectWrapper.ObjectWrapper{showThirdPartyIssuesSetting;hideIssueSetting;eventListeners=new WeakMap;allIssues=new Map;filteredIssues=new Map;issueCounts=new Map;hiddenIssueCount=new Map;hasSeenTopFrameNavigated=!1;sourceFrameIssuesManager=new ks(this);issuesById=new Map;constructor(e,s){super(),this.showThirdPartyIssuesSetting=e,this.hideIssueSetting=s,n.TargetManager.TargetManager.instance().observeModels(n.IssuesModel.IssuesModel,this),n.FrameManager.FrameManager.instance().addEventListener(n.FrameManager.Events.TopFrameNavigated,this.onTopFrameNavigated,this),n.FrameManager.FrameManager.instance().addEventListener(n.FrameManager.Events.FrameAddedToTarget,this.onFrameAddedToTarget,this),this.showThirdPartyIssuesSetting?.addChangeListener((()=>this.updateFilteredIssues())),r.Runtime.experiments.isEnabled("hideIssuesFeature")&&this.hideIssueSetting?.addChangeListener((()=>this.updateFilteredIssues()))}static instance(e={forceNew:!1,ensureFirst:!1}){if(Bs&&e.ensureFirst)throw new Error('IssuesManager was already created. Either set "ensureFirst" to false or make sure that this invocation is really the first one.');return Bs&&!e.forceNew||(Bs=new zs(e.showThirdPartyIssuesSetting,e.hideIssueSetting)),Bs}reloadForAccurateInformationRequired(){return!this.hasSeenTopFrameNavigated}onTopFrameNavigated(e){const{frame:s}=e.data,t=new Map;for(const[e,i]of this.allIssues.entries())i.isAssociatedWithRequestId(s.loaderId)&&t.set(e,i);this.allIssues=t,this.hasSeenTopFrameNavigated=!0,this.updateFilteredIssues()}onFrameAddedToTarget(e){const{frame:s}=e.data;s.isTopFrame()&&this.updateFilteredIssues()}modelAdded(e){const s=e.addEventListener("IssueAdded",this.onIssueAddedEvent,this);this.eventListeners.set(e,s)}modelRemoved(s){const t=this.eventListeners.get(s);t&&e.EventTarget.removeEventListeners([t])}onIssueAddedEvent(e){const{issuesModel:s,inspectorIssue:t}=e.data,i=function(e,s){const t=Hs.get(s.code);return t?t(e,s):(console.warn(`No handler registered for issue code ${s.code}`),[])}(s,t);for(const e of i)this.addIssue(s,e)}addIssue(e,s){if(!s.getDescription())return;const t=s.primaryKey();if(!this.allIssues.has(t)){if(this.allIssues.set(t,s),this.issueFilter(s)){this.filteredIssues.set(t,s),this.issueCounts.set(s.getKind(),1+(this.issueCounts.get(s.getKind())||0));const i=s.getIssueId();i&&this.issuesById.set(i,s);const n=this.hideIssueSetting?.get();r.Runtime.experiments.isEnabled("hideIssuesFeature")&&this.updateIssueHiddenStatus(s,n),s.isHidden()&&this.hiddenIssueCount.set(s.getKind(),1+(this.hiddenIssueCount.get(s.getKind())||0)),this.dispatchEventToListeners("IssueAdded",{issuesModel:e,issue:s})}this.dispatchEventToListeners("IssuesCountUpdated")}}issues(){return this.filteredIssues.values()}numberOfIssues(e){return e?(this.issueCounts.get(e)??0)-this.numberOfHiddenIssues(e):this.filteredIssues.size-this.numberOfHiddenIssues()}numberOfHiddenIssues(e){if(e)return this.hiddenIssueCount.get(e)??0;let s=0;for(const e of this.hiddenIssueCount.values())s+=e;return s}numberOfAllStoredIssues(){return this.allIssues.size}issueFilter(e){return this.showThirdPartyIssuesSetting?.get()||!e.isCausedByThirdParty()}updateIssueHiddenStatus(e,s){const t=e.code();if(s&&s[t])return"Hidden"===s[t]?void e.setHidden(!0):void e.setHidden(!1)}updateFilteredIssues(){this.filteredIssues.clear(),this.issueCounts.clear(),this.issuesById.clear(),this.hiddenIssueCount.clear();const e=this.hideIssueSetting?.get(),s=r.Runtime.experiments.isEnabled("hideIssuesFeature");for(const[t,i]of this.allIssues)if(this.issueFilter(i)){s&&this.updateIssueHiddenStatus(i,e),this.filteredIssues.set(t,i),this.issueCounts.set(i.getKind(),1+(this.issueCounts.get(i.getKind())??0)),i.isHidden()&&this.hiddenIssueCount.set(i.getKind(),1+(this.hiddenIssueCount.get(i.getKind())||0));const r=i.getIssueId();r&&this.issuesById.set(r,i)}this.dispatchEventToListeners("FullUpdateRequired"),this.dispatchEventToListeners("IssuesCountUpdated")}unhideAllIssues(){for(const e of this.allIssues.values())e.setHidden(!1);this.hideIssueSetting?.set({})}getIssueById(e){return this.issuesById.get(e)}}globalThis.addIssueForTest=e=>{const s=n.TargetManager.TargetManager.instance().mainTarget()?.model(n.IssuesModel.IssuesModel);s?.issueAdded({issue:e})};var Ks=Object.freeze({__proto__:null,defaultHideIssueByCodeSetting:js,getHideIssueByCodeSetting:function(){return e.Settings.Settings.instance().createSetting("HideIssueByCodeSetting-Experiment-2021",{})},IssuesManager:zs});class qs extends e.ResolverBase.ResolverBase{issuesListener=null;issuesManager;constructor(e=zs.instance()){super(),this.issuesManager=e}getForId(e){return this.issuesManager.getIssueById(e)||null}onIssueAdded(e){const{issue:s}=e.data,t=s.getIssueId();t&&this.onResolve(t,s)}startListening(){this.issuesListener||(this.issuesListener=this.issuesManager.addEventListener("IssueAdded",this.onIssueAdded,this))}stopListening(){this.issuesListener&&(e.EventTarget.removeEventListeners([this.issuesListener]),this.issuesListener=null)}}var Vs=Object.freeze({__proto__:null,IssueResolver:qs});function $s(e,s){if(s instanceof n.NetworkRequest.NetworkRequest)return function(e,s){return e.filter((e=>{for(const t of e.requests())if(t.requestId===s.requestId())return!0;return!1}))}(e,s);if(s instanceof n.Cookie.Cookie)return function(e,s,t,i){return e.filter((e=>{for(const r of e.cookies())if(r.domain===s&&r.name===t&&r.path===i)return!0;return!1}))}(e,s.domain(),s.name(),s.path());throw new Error(`issues can not be associated with ${JSON.stringify(s)}`)}var Qs=Object.freeze({__proto__:null,issuesAssociatedWith:$s,hasIssues:function(e){return $s(Array.from(zs.instance().issues()),e).length>0},hasIssueOfCategory:function(e,s){return $s(Array.from(zs.instance().issues()),e).some((e=>e.getCategory()===s))},reveal:async function(s,t){if("string"==typeof s){const t=zs.instance().getIssueById(s);if(t)return e.Revealer.reveal(t)}const i=$s(Array.from(zs.instance().issues()),s).filter((e=>!t||e.getCategory()===t));if(i.length>0)return e.Revealer.reveal(i[0])}});export{f as AttributionReportingIssue,K as ContentSecurityPolicyIssue,$ as ContrastCheckTrigger,ee as CorsIssue,ae as CrossOriginEmbedderPolicyIssue,le as DeprecationIssue,Se as GenericIssue,we as HeavyAdIssue,I as Issue,Vs as IssueResolver,Ks as IssuesManager,Pe as LowTextContrastIssue,T as MarkdownIssueDescription,Ee as MixedContentIssue,ls as NavigatorUserAgentIssue,hs as QuirksModeIssue,Qs as RelatedIssue,is as SameSiteCookieIssue,Cs as SharedArrayBufferIssue,ws as SourceFrameIssuesManager,Ls as TrustedWebActivityIssue,Ws as WasmCrossOriginModuleSharingIssue};
