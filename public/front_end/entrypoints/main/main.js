import*as e from"../../core/sdk/sdk.js";import*as t from"../../core/common/common.js";import*as n from"../../core/host/host.js";import*as o from"../../core/i18n/i18n.js";import*as s from"../../core/platform/platform.js";import*as r from"../../core/protocol_client/protocol_client.js";import*as i from"../../core/root/root.js";import*as a from"../../models/bindings/bindings.js";import*as c from"../../models/extensions/extensions.js";import*as l from"../../models/issues_manager/issues_manager.js";import*as d from"../../models/logs/logs.js";import*as g from"../../models/persistence/persistence.js";import*as u from"../../models/workspace/workspace.js";import*as m from"../../panels/snippets/snippets.js";import*as p from"../../panels/timeline/timeline.js";import*as h from"../../ui/components/icon_button/icon_button.js";import*as f from"../../ui/legacy/components/perf_ui/perf_ui.js";import*as w from"../../ui/legacy/components/utils/utils.js";import*as v from"../../ui/legacy/legacy.js";class S{targetManager;context;lastSelectedContextId;ignoreContextChanged;constructor(t,n){n.addFlavorChangeListener(e.RuntimeModel.ExecutionContext,this.executionContextChanged,this),n.addFlavorChangeListener(e.Target.Target,this.targetChanged,this),t.addModelListener(e.RuntimeModel.RuntimeModel,e.RuntimeModel.Events.ExecutionContextCreated,this.onExecutionContextCreated,this),t.addModelListener(e.RuntimeModel.RuntimeModel,e.RuntimeModel.Events.ExecutionContextDestroyed,this.onExecutionContextDestroyed,this),t.addModelListener(e.RuntimeModel.RuntimeModel,e.RuntimeModel.Events.ExecutionContextOrderChanged,this.onExecutionContextOrderChanged,this),this.targetManager=t,this.context=n,t.observeModels(e.RuntimeModel.RuntimeModel,this)}modelAdded(t){queueMicrotask(function(){this.context.flavor(e.Target.Target)||this.context.setFlavor(e.Target.Target,t.target())}.bind(this))}modelRemoved(t){const n=this.context.flavor(e.RuntimeModel.ExecutionContext);n&&n.runtimeModel===t&&this.currentExecutionContextGone();const o=this.targetManager.models(e.RuntimeModel.RuntimeModel);this.context.flavor(e.Target.Target)===t.target()&&o.length&&this.context.setFlavor(e.Target.Target,o[0].target())}executionContextChanged({data:t}){t&&(this.context.setFlavor(e.Target.Target,t.target()),this.ignoreContextChanged||(this.lastSelectedContextId=this.contextPersistentId(t)))}contextPersistentId(e){return e.isDefault?e.target().name()+":"+e.frameId:""}targetChanged({data:t}){const n=this.context.flavor(e.RuntimeModel.ExecutionContext);if(!t||n&&n.target()===t)return;const o=t.model(e.RuntimeModel.RuntimeModel),s=o?o.executionContexts():[];if(!s.length)return;let r=null;for(let e=0;e<s.length&&!r;++e)this.shouldSwitchToContext(s[e])&&(r=s[e]);for(let e=0;e<s.length&&!r;++e)this.isDefaultContext(s[e])&&(r=s[e]);this.ignoreContextChanged=!0,this.context.setFlavor(e.RuntimeModel.ExecutionContext,r||s[0]),this.ignoreContextChanged=!1}shouldSwitchToContext(e){return!(!this.lastSelectedContextId||this.lastSelectedContextId!==this.contextPersistentId(e))||!this.lastSelectedContextId&&this.isDefaultContext(e)}isDefaultContext(t){if(!t.isDefault||!t.frameId)return!1;if(t.target().parentTarget())return!1;const n=t.target().model(e.ResourceTreeModel.ResourceTreeModel),o=n&&n.frameForId(t.frameId);return Boolean(o?.isTopFrame())}onExecutionContextCreated(e){this.switchContextIfNecessary(e.data)}onExecutionContextDestroyed(t){const n=t.data;this.context.flavor(e.RuntimeModel.ExecutionContext)===n&&this.currentExecutionContextGone()}onExecutionContextOrderChanged(e){const t=e.data.executionContexts();for(let e=0;e<t.length&&!this.switchContextIfNecessary(t[e]);e++);}switchContextIfNecessary(t){return!(this.context.flavor(e.RuntimeModel.ExecutionContext)&&!this.shouldSwitchToContext(t))&&(this.ignoreContextChanged=!0,this.context.setFlavor(e.RuntimeModel.ExecutionContext,t),this.ignoreContextChanged=!1,!0)}currentExecutionContextGone(){const t=this.targetManager.models(e.RuntimeModel.RuntimeModel);let n=null;for(let e=0;e<t.length&&!n;++e){const o=t[e].executionContexts();for(const e of o)if(this.isDefaultContext(e)){n=e;break}}if(!n)for(let e=0;e<t.length&&!n;++e){const o=t[e].executionContexts();if(o.length){n=o[0];break}}this.ignoreContextChanged=!0,this.context.setFlavor(e.RuntimeModel.ExecutionContext,n),this.ignoreContextChanged=!1}}var b=Object.freeze({__proto__:null,ExecutionContextSelector:S});const I={theSystempreferredColorSchemeHas:"The system-preferred color scheme has changed. To apply this change to DevTools, reload.",customizeAndControlDevtools:"Customize and control DevTools",dockSide:"Dock side",placementOfDevtoolsRelativeToThe:"Placement of DevTools relative to the page. ({PH1} to restore last position)",undockIntoSeparateWindow:"Undock into separate window",dockToBottom:"Dock to bottom",dockToRight:"Dock to right",dockToLeft:"Dock to left",focusDebuggee:"Focus debuggee",hideConsoleDrawer:"Hide console drawer",showConsoleDrawer:"Show console drawer",moreTools:"More tools",help:"Help"},x=o.i18n.registerUIStrings("entrypoints/main/MainImpl.ts",I),M=o.i18n.getLocalizedString.bind(void 0,x);class C{lateInitDonePromise;constructor(){C.instanceForTest=this,s.runOnWindowLoad((()=>{this.loaded()}))}static time(e){n.InspectorFrontendHost.isUnderTest()||console.time(e)}static timeEnd(e){n.InspectorFrontendHost.isUnderTest()||console.timeEnd(e)}async loaded(){console.timeStamp("Main._loaded"),await i.Runtime.appStarted,i.Runtime.Runtime.setPlatform(n.Platform.platform());const e=await new Promise((e=>{n.InspectorFrontendHost.InspectorFrontendHostInstance.getPreferences(e)}));console.timeStamp("Main._gotPreferences"),this.initializeGlobalsForLayoutTests(),this.createSettings(e),await this.requestAndRegisterLocaleData(),i.Runtime.experiments.isEnabled(i.Runtime.ExperimentName.SYNC_SETTINGS)&&n.userMetrics.syncSetting(t.Settings.Settings.instance().moduleSetting("sync_preferences").get()),this.createAppUI()}initializeGlobalsForLayoutTests(){self.Common=self.Common||{},self.UI=self.UI||{},self.UI.panels=self.UI.panels||{},self.SDK=self.SDK||{},self.Bindings=self.Bindings||{},self.Persistence=self.Persistence||{},self.Workspace=self.Workspace||{},self.Extensions=self.Extensions||{},self.Host=self.Host||{},self.Host.userMetrics=self.Host.userMetrics||n.userMetrics,self.Host.UserMetrics=self.Host.UserMetrics||n.UserMetrics}async requestAndRegisterLocaleData(){const e=t.Settings.Settings.instance().moduleSetting("language").get(),s=o.DevToolsLocale.DevToolsLocale.instance({create:!0,data:{navigatorLanguage:navigator.language,settingLanguage:e,lookupClosestDevToolsLocale:o.i18n.lookupClosestSupportedDevToolsLocale}});n.userMetrics.language(s.locale),"en-US"!==s.locale&&await o.i18n.fetchAndRegisterLocaleData("en-US");try{await o.i18n.fetchAndRegisterLocaleData(s.locale)}catch(e){console.error(e),s.forceFallbackLocale()}}createSettings(e){this.initializeExperiments();let o,s="";if(n.Platform.isCustomDevtoolsFrontend()?s="__custom__":i.Runtime.Runtime.queryParam("can_dock")||!Boolean(i.Runtime.Runtime.queryParam("debugFrontend"))||n.InspectorFrontendHost.isUnderTest()||(s="__bundled__"),!n.InspectorFrontendHost.isUnderTest()&&window.localStorage){const e={...t.Settings.NOOP_STORAGE,clear:()=>window.localStorage.clear()};o=new t.Settings.SettingsStorage(window.localStorage,e,s)}else o=new t.Settings.SettingsStorage({},t.Settings.NOOP_STORAGE,s);const r={register:e=>n.InspectorFrontendHost.InspectorFrontendHostInstance.registerPreference(e,{synced:!1}),set:n.InspectorFrontendHost.InspectorFrontendHostInstance.setPreference,remove:n.InspectorFrontendHost.InspectorFrontendHostInstance.removePreference,clear:n.InspectorFrontendHost.InspectorFrontendHostInstance.clearPreferences},a={...r,register:e=>n.InspectorFrontendHost.InspectorFrontendHostInstance.registerPreference(e,{synced:!0})},c=new t.Settings.SettingsStorage(e,a,s),l=new t.Settings.SettingsStorage(e,r,s);t.Settings.Settings.instance({forceNew:!0,syncedStorage:c,globalStorage:l,localStorage:o}),self.Common.settings=t.Settings.Settings.instance(),n.InspectorFrontendHost.isUnderTest()||(new t.Settings.VersionController).updateVersion()}initializeExperiments(){i.Runtime.experiments.register("applyCustomStylesheet","Allow extensions to load custom stylesheets"),i.Runtime.experiments.register("captureNodeCreationStacks","Capture node creation stacks"),i.Runtime.experiments.register("sourcesPrettyPrint","Automatically pretty print in the Sources Panel"),i.Runtime.experiments.register("backgroundServices","Background web platform feature events",!0),i.Runtime.experiments.register("backgroundServicesNotifications","Background services section for Notifications"),i.Runtime.experiments.register("backgroundServicesPaymentHandler","Background services section for Payment Handler"),i.Runtime.experiments.register("backgroundServicesPushMessaging","Background services section for Push Messaging"),i.Runtime.experiments.register("ignoreListJSFramesOnTimeline","Ignore List for JavaScript frames on Timeline",!0),i.Runtime.experiments.register("inputEventsOnTimelineOverview","Input events on Timeline overview",!0),i.Runtime.experiments.register("liveHeapProfile","Live heap profile",!0),i.Runtime.experiments.register("protocolMonitor","Protocol Monitor",void 0,"https://developer.chrome.com/blog/new-in-devtools-92/#protocol-monitor"),i.Runtime.experiments.register("developerResourcesView","Show developer resources view"),i.Runtime.experiments.register("cspViolationsView","Show CSP Violations view",void 0,"https://developer.chrome.com/blog/new-in-devtools-89/#csp"),i.Runtime.experiments.register("recordCoverageWithPerformanceTracing","Record coverage while performance tracing"),i.Runtime.experiments.register("samplingHeapProfilerTimeline","Sampling heap profiler timeline",!0),i.Runtime.experiments.register("showOptionToNotTreatGlobalObjectsAsRoots","Show option to take heap snapshot where globals are not treated as root"),i.Runtime.experiments.register("sourceOrderViewer","Source order viewer",void 0,"https://developer.chrome.com/blog/new-in-devtools-92/#source-order"),i.Runtime.experiments.register("webauthnPane","WebAuthn Pane"),i.Runtime.experiments.register("keyboardShortcutEditor","Enable keyboard shortcut editor",!0,"https://developer.chrome.com/blog/new-in-devtools-88/#keyboard-shortcuts"),i.Runtime.experiments.register("timelineEventInitiators","Timeline: event initiators"),i.Runtime.experiments.register("timelineInvalidationTracking","Timeline: invalidation tracking",!0),i.Runtime.experiments.register("timelineShowAllEvents","Timeline: show all events",!0),i.Runtime.experiments.register("timelineV8RuntimeCallStats","Timeline: V8 Runtime Call Stats on Timeline",!0),i.Runtime.experiments.register("timelineWebGL","Timeline: WebGL-based flamechart"),i.Runtime.experiments.register("timelineReplayEvent","Timeline: Replay input events",!0),i.Runtime.experiments.register("wasmDWARFDebugging","WebAssembly Debugging: Enable DWARF support",void 0,"https://developer.chrome.com/blog/wasm-debugging-2020/"),i.Runtime.experiments.register("dualScreenSupport","Emulation: Support dual screen mode",void 0,"https://developer.chrome.com/blog/new-in-devtools-89#dual-screen"),i.Runtime.experiments.setEnabled("dualScreenSupport",!0),i.Runtime.experiments.register("APCA","Enable new Advanced Perceptual Contrast Algorithm (APCA) replacing previous contrast ratio and AA/AAA guidelines",void 0,"https://developer.chrome.com/blog/new-in-devtools-89/#apca"),i.Runtime.experiments.register("fullAccessibilityTree","Enable full accessibility tree view in the Elements panel",void 0,"https://developer.chrome.com/blog/new-in-devtools-90/#accesibility-tree"),i.Runtime.experiments.register("fontEditor","Enable new Font Editor tool within the Styles Pane.",void 0,"https://developer.chrome.com/blog/new-in-devtools-89/#font"),i.Runtime.experiments.register("contrastIssues","Enable automatic contrast issue reporting via the Issues panel",void 0,"https://developer.chrome.com/blog/new-in-devtools-90/#low-contrast"),i.Runtime.experiments.register("experimentalCookieFeatures","Enable experimental cookie features"),i.Runtime.experiments.register("hideIssuesFeature","Enable experimental hide issues menu",void 0,"https://developer.chrome.com/blog/new-in-devtools-94/#hide-issues"),i.Runtime.experiments.register("groupAndHideIssuesByKind","Allow grouping and hiding of issues by IssueKind"),i.Runtime.experiments.register(i.Runtime.ExperimentName.SYNC_SETTINGS,"Sync DevTools settings with Chrome Sync"),i.Runtime.experiments.register("reportingApiDebugging","Enable Reporting API panel in the Application panel"),i.Runtime.experiments.register("cssTypeComponentLength","Enable CSS <length> authoring tool in the Styles pane (https://goo.gle/length-feedback)",void 0,"https://developer.chrome.com/blog/new-in-devtools-96/#length"),i.Runtime.experiments.register("preciseChanges","Display more precise changes in the Changes tab"),i.Runtime.experiments.enableExperimentsByDefault(["sourceOrderViewer","hideIssuesFeature","cssTypeComponentLength","preciseChanges",i.Runtime.ExperimentName.SYNC_SETTINGS]),i.Runtime.experiments.cleanUpStaleExperiments();const e=i.Runtime.Runtime.queryParam("enabledExperiments");if(e&&i.Runtime.experiments.setServerEnabledExperiments(e.split(";")),i.Runtime.experiments.enableExperimentsTransiently(["backgroundServices","backgroundServicesNotifications","backgroundServicesPushMessaging","backgroundServicesPaymentHandler","webauthnPane","developerResourcesView"]),n.InspectorFrontendHost.isUnderTest()){const e=i.Runtime.Runtime.queryParam("test");e&&e.includes("live-line-level-heap-profile.js")&&i.Runtime.experiments.enableForTest("liveHeapProfile")}for(const e of i.Runtime.experiments.enabledExperiments())n.userMetrics.experimentEnabledAtLaunch(e.name)}async createAppUI(){C.time("Main._createAppUI"),self.UI.viewManager=v.ViewManager.ViewManager.instance(),self.Persistence.isolatedFileSystemManager=g.IsolatedFileSystemManager.IsolatedFileSystemManager.instance();const o="systemPreferred",s=t.Settings.Settings.instance().createSetting("uiTheme",o);if(v.UIUtils.initializeUIUtils(document,s),s.get()===o){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(()=>{v.InspectorView.InspectorView.instance().displayReloadRequiredWarning(M(I.theSystempreferredColorSchemeHas))}))}v.UIUtils.installComponentRootStyles(document.body),this.addMainEventListeners(document);const r=Boolean(i.Runtime.Runtime.queryParam("can_dock"));self.UI.zoomManager=v.ZoomManager.ZoomManager.instance({forceNew:!0,win:window,frontendHost:n.InspectorFrontendHost.InspectorFrontendHostInstance}),self.UI.inspectorView=v.InspectorView.InspectorView.instance(),v.ContextMenu.ContextMenu.initialize(),v.ContextMenu.ContextMenu.installHandler(document),d.NetworkLog.NetworkLog.instance(),e.FrameManager.FrameManager.instance(),d.LogManager.LogManager.instance(),l.IssuesManager.IssuesManager.instance({forceNew:!0,ensureFirst:!0,showThirdPartyIssuesSetting:l.Issue.getShowThirdPartyIssuesSetting(),hideIssueSetting:l.IssuesManager.getHideIssueByCodeSetting()}),l.ContrastCheckTrigger.ContrastCheckTrigger.instance(),self.SDK.consoleModel=e.ConsoleModel.ConsoleModel.instance(),self.UI.dockController=v.DockController.DockController.instance({forceNew:!0,canDock:r}),self.SDK.multitargetNetworkManager=e.NetworkManager.MultitargetNetworkManager.instance({forceNew:!0}),self.SDK.domDebuggerManager=e.DOMDebuggerModel.DOMDebuggerManager.instance({forceNew:!0}),e.TargetManager.TargetManager.instance().addEventListener(e.TargetManager.Events.SuspendStateChanged,this.onSuspendStateChanged.bind(this)),self.Workspace.fileManager=u.FileManager.FileManager.instance({forceNew:!0}),self.Workspace.workspace=u.Workspace.WorkspaceImpl.instance(),self.Bindings.networkProjectManager=a.NetworkProject.NetworkProjectManager.instance(),self.Bindings.resourceMapping=a.ResourceMapping.ResourceMapping.instance({forceNew:!0,targetManager:e.TargetManager.TargetManager.instance(),workspace:u.Workspace.WorkspaceImpl.instance()}),new a.PresentationConsoleMessageHelper.PresentationConsoleMessageManager,self.Bindings.cssWorkspaceBinding=a.CSSWorkspaceBinding.CSSWorkspaceBinding.instance({forceNew:!0,targetManager:e.TargetManager.TargetManager.instance(),workspace:u.Workspace.WorkspaceImpl.instance()}),self.Bindings.debuggerWorkspaceBinding=a.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance({forceNew:!0,targetManager:e.TargetManager.TargetManager.instance(),workspace:u.Workspace.WorkspaceImpl.instance()}),self.Bindings.breakpointManager=a.BreakpointManager.BreakpointManager.instance({forceNew:!0,workspace:u.Workspace.WorkspaceImpl.instance(),targetManager:e.TargetManager.TargetManager.instance(),debuggerWorkspaceBinding:a.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance()}),self.Extensions.extensionServer=c.ExtensionServer.ExtensionServer.instance({forceNew:!0}),new g.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding(g.IsolatedFileSystemManager.IsolatedFileSystemManager.instance(),u.Workspace.WorkspaceImpl.instance()),g.IsolatedFileSystemManager.IsolatedFileSystemManager.instance().addPlatformFileSystem("snippet://",new m.ScriptSnippetFileSystem.SnippetFileSystem),self.Persistence.persistence=g.Persistence.PersistenceImpl.instance({forceNew:!0,workspace:u.Workspace.WorkspaceImpl.instance(),breakpointManager:a.BreakpointManager.BreakpointManager.instance()}),self.Persistence.networkPersistenceManager=g.NetworkPersistenceManager.NetworkPersistenceManager.instance({forceNew:!0,workspace:u.Workspace.WorkspaceImpl.instance()}),new S(e.TargetManager.TargetManager.instance(),v.Context.Context.instance()),self.Bindings.ignoreListManager=a.IgnoreListManager.IgnoreListManager.instance({forceNew:!0,debuggerWorkspaceBinding:a.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance()}),new A;const p=v.ActionRegistry.ActionRegistry.instance({forceNew:!0});self.UI.actionRegistry=p,self.UI.shortcutRegistry=v.ShortcutRegistry.ShortcutRegistry.instance({forceNew:!0,actionRegistry:p}),this.registerMessageSinkListener(),C.timeEnd("Main._createAppUI");const h=t.AppProvider.getRegisteredAppProviders()[0];if(!h)throw new Error("Unable to boot DevTools, as the appprovider is missing");await this.showAppUI(await h.loadAppProvider())}async showAppUI(e){C.time("Main._showAppUI");const t=e.createApp();v.DockController.DockController.instance().initialize(),t.presentUI(document);const o=v.ActionRegistry.ActionRegistry.instance().action("elements.toggle-element-search");o&&n.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(n.InspectorFrontendHostAPI.Events.EnterInspectElementMode,(()=>{o.execute()}),this),n.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(n.InspectorFrontendHostAPI.Events.RevealSourceLine,this.revealSourceLine,this),await v.InspectorView.InspectorView.instance().createToolbars(),n.InspectorFrontendHost.InspectorFrontendHostInstance.loadCompleted();const s=i.Runtime.Runtime.queryParam("loadTimelineFromURL");null!==s&&p.TimelinePanel.LoadTimelineHandler.instance().handleQueryParam(s),v.ARIAUtils.alertElementInstance(),setTimeout(this.initializeTarget.bind(this),0),C.timeEnd("Main._showAppUI")}async initializeTarget(){C.time("Main._initializeTarget");for(const e of t.Runnable.earlyInitializationRunnables())await e().run();n.InspectorFrontendHost.InspectorFrontendHostInstance.readyForTest(),setTimeout(this.lateInitialization.bind(this),100),C.timeEnd("Main._initializeTarget")}lateInitialization(){C.time("Main._lateInitialization"),c.ExtensionServer.ExtensionServer.instance().initializeExtensions();const e=t.Runnable.lateInitializationRunnables().map((async e=>(await e()).run()));if(i.Runtime.experiments.isEnabled("liveHeapProfile")){const n="memoryLiveHeapProfile";if(t.Settings.Settings.instance().moduleSetting(n).get())e.push(f.LiveHeapProfile.LiveHeapProfile.instance().run());else{const e=async o=>{o.data&&(t.Settings.Settings.instance().moduleSetting(n).removeChangeListener(e),f.LiveHeapProfile.LiveHeapProfile.instance().run())};t.Settings.Settings.instance().moduleSetting(n).addChangeListener(e)}}this.lateInitDonePromise=Promise.all(e).then((()=>{})),C.timeEnd("Main._lateInitialization")}lateInitDonePromiseForTest(){return this.lateInitDonePromise}registerMessageSinkListener(){t.Console.Console.instance().addEventListener(t.Console.Events.MessageAdded,(function({data:e}){e.show&&t.Console.Console.instance().show()}))}revealSourceLine(e){const{url:n,lineNumber:o,columnNumber:s}=e.data,r=u.Workspace.WorkspaceImpl.instance().uiSourceCodeForURL(n);r?t.Revealer.reveal(r.uiLocation(o,s)):u.Workspace.WorkspaceImpl.instance().addEventListener(u.Workspace.Events.UISourceCodeAdded,(function e(r){const i=r.data;i.url()===n&&(t.Revealer.reveal(i.uiLocation(o,s)),u.Workspace.WorkspaceImpl.instance().removeEventListener(u.Workspace.Events.UISourceCodeAdded,e))}))}postDocumentKeyDown(e){e.handled||v.ShortcutRegistry.ShortcutRegistry.instance().handleShortcut(e)}redispatchClipboardEvent(e){const t=new CustomEvent("clipboard-"+e.type,{bubbles:!0});t.original=e;const n=e.target&&e.target.ownerDocument,o=n?n.deepActiveElement():null;o&&o.dispatchEvent(t),t.handled&&e.preventDefault()}contextMenuEventFired(e){(e.handled||e.target.classList.contains("popup-glasspane"))&&e.preventDefault()}addMainEventListeners(e){e.addEventListener("keydown",this.postDocumentKeyDown.bind(this),!1),e.addEventListener("beforecopy",this.redispatchClipboardEvent.bind(this),!0),e.addEventListener("copy",this.redispatchClipboardEvent.bind(this),!1),e.addEventListener("cut",this.redispatchClipboardEvent.bind(this),!1),e.addEventListener("paste",this.redispatchClipboardEvent.bind(this),!1),e.addEventListener("contextmenu",this.contextMenuEventFired.bind(this),!0)}onSuspendStateChanged(){const t=e.TargetManager.TargetManager.instance().allTargetsSuspended();v.InspectorView.InspectorView.instance().onSuspendStateChanged(t)}static instanceForTest=null}let T,k,R,E,D;globalThis.Main=globalThis.Main||{},globalThis.Main.Main=C;class y{static instance(e={forceNew:null}){const{forceNew:t}=e;return T&&!t||(T=new y),T}handleAction(e,t){if(n.InspectorFrontendHost.InspectorFrontendHostInstance.isHostedMode())return!1;switch(t){case"main.zoom-in":return n.InspectorFrontendHost.InspectorFrontendHostInstance.zoomIn(),!0;case"main.zoom-out":return n.InspectorFrontendHost.InspectorFrontendHostInstance.zoomOut(),!0;case"main.zoom-reset":return n.InspectorFrontendHost.InspectorFrontendHostInstance.resetZoom(),!0}return!1}}class P{static instance(e={forceNew:null}){const{forceNew:t}=e;return k&&!t||(k=new P),k}handleAction(e,t){let n=v.SearchableView.SearchableView.fromElement(document.deepActiveElement());if(!n){const e=v.InspectorView.InspectorView.instance().currentPanelDeprecated();if(e&&e.searchableView&&(n=e.searchableView()),!n)return!1}switch(t){case"main.search-in-panel.find":return n.handleFindShortcut();case"main.search-in-panel.cancel":return n.handleCancelSearchShortcut();case"main.search-in-panel.find-next":return n.handleFindNextShortcut();case"main.search-in-panel.find-previous":return n.handleFindPreviousShortcut()}return!1}}class F{itemInternal;constructor(){this.itemInternal=new v.Toolbar.ToolbarMenuButton(this.handleContextMenu.bind(this),!0),this.itemInternal.element.classList.add("main-menu"),this.itemInternal.setTitle(M(I.customizeAndControlDevtools))}static instance(e={forceNew:null}){const{forceNew:t}=e;return R&&!t||(R=new F),R}item(){return this.itemInternal}handleContextMenu(t){if(v.DockController.DockController.instance().canDock()){const e=document.createElement("div");e.classList.add("flex-centered"),e.classList.add("flex-auto"),e.tabIndex=-1,v.ARIAUtils.setAccessibleName(e,I.dockSide);const n=e.createChild("span","flex-auto");n.textContent=M(I.dockSide);const o=v.ShortcutRegistry.ShortcutRegistry.instance().shortcutsForAction("main.toggle-dock");v.Tooltip.Tooltip.install(n,M(I.placementOfDevtoolsRelativeToThe,{PH1:o[0].title()})),e.appendChild(n);const i=new v.Toolbar.Toolbar("",e);i.makeBlueOnHover();const a=new v.Toolbar.ToolbarToggle(M(I.undockIntoSeparateWindow),"largeicon-undock"),c=new v.Toolbar.ToolbarToggle(M(I.dockToBottom),"largeicon-dock-to-bottom"),l=new v.Toolbar.ToolbarToggle(M(I.dockToRight),"largeicon-dock-to-right"),d=new v.Toolbar.ToolbarToggle(M(I.dockToLeft),"largeicon-dock-to-left");a.addEventListener(v.Toolbar.ToolbarButton.Events.MouseDown,(e=>e.data.consume())),c.addEventListener(v.Toolbar.ToolbarButton.Events.MouseDown,(e=>e.data.consume())),l.addEventListener(v.Toolbar.ToolbarButton.Events.MouseDown,(e=>e.data.consume())),d.addEventListener(v.Toolbar.ToolbarButton.Events.MouseDown,(e=>e.data.consume())),a.addEventListener(v.Toolbar.ToolbarButton.Events.Click,r.bind(null,"undocked")),c.addEventListener(v.Toolbar.ToolbarButton.Events.Click,r.bind(null,"bottom")),l.addEventListener(v.Toolbar.ToolbarButton.Events.Click,r.bind(null,"right")),d.addEventListener(v.Toolbar.ToolbarButton.Events.Click,r.bind(null,"left")),a.setToggled("undocked"===v.DockController.DockController.instance().dockSide()),c.setToggled("bottom"===v.DockController.DockController.instance().dockSide()),l.setToggled("right"===v.DockController.DockController.instance().dockSide()),d.setToggled("left"===v.DockController.DockController.instance().dockSide()),i.appendToolbarItem(a),i.appendToolbarItem(d),i.appendToolbarItem(c),i.appendToolbarItem(l),e.addEventListener("keydown",(e=>{let t=0;if("ArrowLeft"===e.key)t=-1;else{if("ArrowRight"!==e.key)return;t=1}const n=[a,d,c,l];let o=n.findIndex((e=>e.element.hasFocus()));o=s.NumberUtilities.clamp(o+t,0,n.length-1),n[o].element.focus(),e.consume(!0)})),t.headerSection().appendCustomItem(e)}const o=this.itemInternal.element;function r(e){v.DockController.DockController.instance().once("AfterDockSideChanged").then((()=>{o.focus()})),v.DockController.DockController.instance().setDockSide(e),t.discard()}if("undocked"===v.DockController.DockController.instance().dockSide()){const n=e.TargetManager.TargetManager.instance().mainTarget();n&&n.type()===e.Target.Type.Frame&&t.defaultSection().appendAction("inspector_main.focus-debuggee",M(I.focusDebuggee))}t.defaultSection().appendAction("main.toggle-drawer",v.InspectorView.InspectorView.instance().drawerVisible()?M(I.hideConsoleDrawer):M(I.showConsoleDrawer)),t.appendItemsAtLocation("mainMenu");const i=t.defaultSection().appendSubMenuItem(M(I.moreTools)),a=v.ViewManager.getRegisteredViewExtensions();a.sort(((e,t)=>{const n=e.title(),o=t.title();return n.localeCompare(o)}));for(const e of a){const t=e.location(),o=e.persistence(),s=e.title(),r=e.viewId();if("issues-pane"!==r){if("closeable"===o&&("drawer-view"===t||"panel"===t))if(e.isPreviewFeature()){const e=new h.Icon.Icon;e.data={iconName:"ic_preview_feature",color:"var(--icon-color)",width:"14px",height:"14px"},i.defaultSection().appendItem(s,(()=>{v.ViewManager.ViewManager.instance().showView(r,!0,!1)}),!1,e)}else i.defaultSection().appendItem(s,(()=>{v.ViewManager.ViewManager.instance().showView(r,!0,!1)}))}else i.defaultSection().appendItem(s,(()=>{n.userMetrics.issuesPanelOpenedFrom(n.UserMetrics.IssueOpener.HamburgerMenu),v.ViewManager.ViewManager.instance().showView("issues-pane",!0)}))}t.footerSection().appendSubMenuItem(M(I.help)).appendItemsAtLocation("mainMenuHelp")}}class L{settingsButton;constructor(){this.settingsButton=v.Toolbar.Toolbar.createActionButtonForId("settings.show",{showLabel:!1,userActionCode:void 0})}static instance(e={forceNew:null}){const{forceNew:t}=e;return E&&!t||(E=new L),E}item(){return this.settingsButton}}class A{constructor(){e.TargetManager.TargetManager.instance().addModelListener(e.DebuggerModel.DebuggerModel,e.DebuggerModel.Events.DebuggerPaused,this.debuggerPaused,this)}debuggerPaused(n){e.TargetManager.TargetManager.instance().removeModelListener(e.DebuggerModel.DebuggerModel,e.DebuggerModel.Events.DebuggerPaused,this.debuggerPaused,this);const o=n.data,s=o.debuggerPausedDetails();v.Context.Context.instance().setFlavor(e.Target.Target,o.target()),t.Revealer.reveal(s)}}class H{static instance(e={forceNew:null}){const{forceNew:t}=e;return D&&!t||(D=new H),D}handleAction(e,t){return"main.debug-reload"===t&&(w.Reload.reload(),!0)}}var N=Object.freeze({__proto__:null,MainImpl:C,ZoomActionDelegate:y,SearchActionDelegate:P,MainMenuItem:F,SettingsButtonProvider:L,PauseListener:A,sendOverProtocol:function(e,t){return new Promise(((n,o)=>{const s=r.InspectorBackend.test.sendRawMessage;if(!s)return o("Unable to send message to test client");s(e,t,((e,...t)=>e?o(e):n(t)))}))},ReloadActionDelegate:H});class B{presentUI(e){const t=new v.RootView.RootView;v.InspectorView.InspectorView.instance().show(t.element),t.attachToDocument(e),t.focus()}}let W;class U{static instance(e={forceNew:null}){const{forceNew:t}=e;return W&&!t||(W=new U),W}createApp(){return new B}}var _=Object.freeze({__proto__:null,SimpleApp:B,SimpleAppProvider:U});export{b as ExecutionContextSelector,N as MainImpl,_ as SimpleApp};
