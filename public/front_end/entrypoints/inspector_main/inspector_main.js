import*as e from"../../core/common/common.js";import*as t from"../../core/i18n/i18n.js";import*as a from"../../ui/legacy/legacy.js";import*as n from"../../core/host/host.js";import*as s from"../../core/root/root.js";import*as o from"../../core/sdk/sdk.js";import*as i from"../../panels/mobile_throttling/mobile_throttling.js";import*as r from"../../ui/legacy/components/utils/utils.js";const c=new CSSStyleSheet;c.replaceSync(":host{padding:12px}[is=dt-checkbox]{margin:0 0 10px;flex:none}.panel-section-separator{height:1px;margin-bottom:10px;background:var(--color-details-hairline);flex:none}.panel-section-separator:last-child{background:0 0}.chrome-select-label{margin-bottom:16px}\n/*# sourceURL=renderingOptions.css */\n");const l={paintFlashing:"Paint flashing",highlightsAreasOfThePageGreen:"Highlights areas of the page (green) that need to be repainted. May not be suitable for people prone to photosensitive epilepsy.",layoutShiftRegions:"Layout Shift Regions",highlightsAreasOfThePageBlueThat:"Highlights areas of the page (blue) that were shifted. May not be suitable for people prone to photosensitive epilepsy.",layerBorders:"Layer borders",showsLayerBordersOrangeoliveAnd:"Shows layer borders (orange/olive) and tiles (cyan).",frameRenderingStats:"Frame Rendering Stats",plotsFrameThroughputDropped:"Plots frame throughput, dropped frames distribution, and GPU memory.",scrollingPerformanceIssues:"Scrolling performance issues",highlightsElementsTealThatCan:"Highlights elements (teal) that can slow down scrolling, including touch & wheel event handlers and other main-thread scrolling situations.",highlightAdFrames:"Highlight ad frames",highlightsFramesRedDetectedToBe:"Highlights frames (red) detected to be ads.",coreWebVitals:"Core Web Vitals",showsAnOverlayWithCoreWebVitals:"Shows an overlay with Core Web Vitals.",disableLocalFonts:"Disable local fonts",disablesLocalSourcesInFontface:"Disables `local()` sources in `@font-face` rules. Requires a page reload to apply.",emulateAFocusedPage:"Emulate a focused page",emulatesAFocusedPage:"Emulates a focused page.",emulatesAutoDarkMode:"Enables automatic dark mode for the inspected page.",forcesMediaTypeForTestingPrint:"Forces media type for testing print and screen styles",forcesCssPreferscolorschemeMedia:"Forces CSS `prefers-color-scheme` media feature",forcesCssPrefersreducedmotion:"Forces CSS `prefers-reduced-motion` media feature",forcesCssPreferscontrastMedia:"Forces CSS `prefers-contrast` media feature",forcesCssPrefersreduceddataMedia:"Forces CSS `prefers-reduced-data` media feature",forcesCssColorgamutMediaFeature:"Forces CSS `color-gamut` media feature",forcesVisionDeficiencyEmulation:"Forces vision deficiency emulation",disableAvifImageFormat:"Disable `AVIF` image format",disableJpegXlImageFormat:"Disable `JPEG XL` image format",requiresAPageReloadToApplyAnd:"Requires a page reload to apply and disables caching for image requests.",disableWebpImageFormat:"Disable `WebP` image format",forcesCssForcedColors:"Forces CSS forced-colors media feature"},d=t.i18n.registerUIStrings("entrypoints/inspector_main/RenderingOptions.ts",l),g=t.i18n.getLocalizedString.bind(void 0,d);let u;class h extends a.Widget.VBox{constructor(){super(!0),this.appendCheckbox(g(l.paintFlashing),g(l.highlightsAreasOfThePageGreen),e.Settings.Settings.instance().moduleSetting("showPaintRects")),this.appendCheckbox(g(l.layoutShiftRegions),g(l.highlightsAreasOfThePageBlueThat),e.Settings.Settings.instance().moduleSetting("showLayoutShiftRegions")),this.appendCheckbox(g(l.layerBorders),g(l.showsLayerBordersOrangeoliveAnd),e.Settings.Settings.instance().moduleSetting("showDebugBorders")),this.appendCheckbox(g(l.frameRenderingStats),g(l.plotsFrameThroughputDropped),e.Settings.Settings.instance().moduleSetting("showFPSCounter")),this.appendCheckbox(g(l.scrollingPerformanceIssues),g(l.highlightsElementsTealThatCan),e.Settings.Settings.instance().moduleSetting("showScrollBottleneckRects")),this.appendCheckbox(g(l.highlightAdFrames),g(l.highlightsFramesRedDetectedToBe),e.Settings.Settings.instance().moduleSetting("showAdHighlights")),this.appendCheckbox(g(l.coreWebVitals),g(l.showsAnOverlayWithCoreWebVitals),e.Settings.Settings.instance().moduleSetting("showWebVitals")),this.appendCheckbox(g(l.disableLocalFonts),g(l.disablesLocalSourcesInFontface),e.Settings.Settings.instance().moduleSetting("localFontsDisabled")),this.appendCheckbox(g(l.emulateAFocusedPage),g(l.emulatesAFocusedPage),e.Settings.Settings.instance().moduleSetting("emulatePageFocus")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this.appendSelect(g(l.forcesMediaTypeForTestingPrint),e.Settings.Settings.instance().moduleSetting("emulatedCSSMedia")),this.appendSelect(g(l.forcesCssPreferscolorschemeMedia),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersColorScheme")),this.appendSelect(g(l.forcesCssForcedColors),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeatureForcedColors")),(()=>{const e="(prefers-contrast)";return window.matchMedia(e).media===e})()&&this.appendSelect(g(l.forcesCssPreferscontrastMedia),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersContrast")),this.appendSelect(g(l.forcesCssPrefersreducedmotion),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersReducedMotion")),(()=>{const e="(prefers-reduced-data)";return window.matchMedia(e).media===e})()&&this.appendSelect(g(l.forcesCssPrefersreduceddataMedia),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersReducedData")),this.appendSelect(g(l.forcesCssColorgamutMediaFeature),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeatureColorGamut")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this.appendSelect(g(l.forcesVisionDeficiencyEmulation),e.Settings.Settings.instance().moduleSetting("emulatedVisionDeficiency")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this.appendSelect(g(l.emulatesAutoDarkMode),e.Settings.Settings.instance().moduleSetting("emulateAutoDarkMode")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this.appendCheckbox(g(l.disableAvifImageFormat),g(l.requiresAPageReloadToApplyAnd),e.Settings.Settings.instance().moduleSetting("avifFormatDisabled"));const t=this.appendCheckbox(g(l.disableWebpImageFormat),g(l.requiresAPageReloadToApplyAnd),e.Settings.Settings.instance().moduleSetting("webpFormatDisabled"));this.contentElement.createChild("div").classList.add("panel-section-separator"),(async()=>new Promise((e=>{const t=document.createElement("img");t.onload=()=>e(!0),t.onerror=()=>e(!1),t.src="data:image/jxl;base64,/wr/BwiDBAwASyAY"})))().then((a=>{a&&t.before(this.createCheckbox(g(l.disableJpegXlImageFormat),g(l.requiresAPageReloadToApplyAnd),e.Settings.Settings.instance().moduleSetting("jpegXlFormatDisabled")))}))}static instance(e={forceNew:null}){const{forceNew:t}=e;return u&&!t||(u=new h),u}createCheckbox(e,t,n){const s=a.UIUtils.CheckboxLabel.create(e,!1,t);return a.SettingsUI.bindCheckbox(s.checkboxElement,n),s}appendCheckbox(e,t,a){const n=this.createCheckbox(e,t,a);return this.contentElement.appendChild(n),n}appendSelect(e,t){const n=a.SettingsUI.createControlForSetting(t,e);n&&this.contentElement.appendChild(n)}wasShown(){super.wasShown(),this.registerCSSFiles([c])}}var p=Object.freeze({__proto__:null,RenderingOptionsView:h});const m=new CSSStyleSheet;m.replaceSync(".node-icon{width:28px;height:26px;background-image:var(--image-file-nodeIcon);background-size:17px 17px;background-repeat:no-repeat;background-position:center;opacity:80%;cursor:auto}.node-icon:hover{opacity:100%}.node-icon.inactive{filter:grayscale(100%)}\n/*# sourceURL=nodeIcon.css */\n");const S={main:"Main",javascriptIsDisabled:"JavaScript is disabled",openDedicatedTools:"Open dedicated DevTools for `Node.js`"},b=t.i18n.registerUIStrings("entrypoints/inspector_main/InspectorMain.ts",S),f=t.i18n.getLocalizedString.bind(void 0,b);let C,F,T,w;class y{static instance(e={forceNew:null}){const{forceNew:t}=e;return C&&!t||(C=new y),C}async run(){let e=!0;await o.Connections.initMainConnection((async()=>{const t=s.Runtime.Runtime.queryParam("v8only")?o.Target.Type.Node:o.Target.Type.Frame,a=t===o.Target.Type.Frame&&"sources"===s.Runtime.Runtime.queryParam("panel"),n=o.TargetManager.TargetManager.instance().createTarget("main",f(S.main),t,null,void 0,a);if(e){if(e=!1,a){const e=n.model(o.DebuggerModel.DebuggerModel);e&&(e.isReadyToPause()||await e.once(o.DebuggerModel.Events.DebuggerIsReadyToPause),e.pause())}n.runtimeAgent().invoke_runIfWaitingForDebugger()}}),r.TargetDetachedDialog.TargetDetachedDialog.webSocketConnectionLost),new M,new k,new i.NetworkPanelIndicator.NetworkPanelIndicator,n.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(n.InspectorFrontendHostAPI.Events.ReloadInspectedPage,(({data:e})=>{o.ResourceTreeModel.ResourceTreeModel.reloadAllPages(e)}))}}e.Runnable.registerEarlyInitializationRunnable(y.instance);class A{static instance(e={forceNew:null}){const{forceNew:t}=e;return F&&!t||(F=new A),F}handleAction(e,t){switch(t){case"inspector_main.reload":return o.ResourceTreeModel.ResourceTreeModel.reloadAllPages(!1),!0;case"inspector_main.hard-reload":return o.ResourceTreeModel.ResourceTreeModel.reloadAllPages(!0),!0}return!1}}class P{static instance(e={forceNew:null}){const{forceNew:t}=e;return T&&!t||(T=new P),T}handleAction(e,t){const a=o.TargetManager.TargetManager.instance().mainTarget();return!!a&&(a.pageAgent().invoke_bringToFront(),!0)}}class v{element;button;constructor(){const e=document.createElement("div"),t=a.Utils.createShadowRootWithCoreStyles(e,{cssFile:[m],delegatesFocus:void 0});this.element=t.createChild("div","node-icon"),e.addEventListener("click",(()=>n.InspectorFrontendHost.InspectorFrontendHostInstance.openNodeFrontend()),!1),this.button=new a.Toolbar.ToolbarItem(e),this.button.setTitle(f(S.openDedicatedTools)),o.TargetManager.TargetManager.instance().addEventListener(o.TargetManager.Events.AvailableTargetsChanged,(e=>this.update(e.data))),this.button.setVisible(!1),this.update([])}static instance(e={forceNew:null}){const{forceNew:t}=e;return w&&!t||(w=new v),w}update(e){const t=Boolean(e.find((e=>"node"===e.type&&!e.attached)));this.element.classList.toggle("inactive",!t),t&&this.button.setVisible(!0)}item(){return this.button}}class M{constructor(){function t(){let t=null;e.Settings.Settings.instance().moduleSetting("javaScriptDisabled").get()&&(t=a.Icon.Icon.create("smallicon-warning"),a.Tooltip.Tooltip.install(t,f(S.javascriptIsDisabled))),a.InspectorView.InspectorView.instance().setPanelIcon("sources",t)}e.Settings.Settings.instance().moduleSetting("javaScriptDisabled").addChangeListener(t),t()}}class k{autoAttachSetting;adBlockEnabledSetting;emulatePageFocusSetting;constructor(){this.autoAttachSetting=e.Settings.Settings.instance().moduleSetting("autoAttachToCreatedPages"),this.autoAttachSetting.addChangeListener(this.updateAutoAttach,this),this.updateAutoAttach(),this.adBlockEnabledSetting=e.Settings.Settings.instance().moduleSetting("network.adBlockingEnabled"),this.adBlockEnabledSetting.addChangeListener(this.update,this),this.emulatePageFocusSetting=e.Settings.Settings.instance().moduleSetting("emulatePageFocus"),this.emulatePageFocusSetting.addChangeListener(this.update,this),o.TargetManager.TargetManager.instance().observeTargets(this)}updateTarget(e){e.type()!==o.Target.Type.Frame||e.parentTarget()||(e.pageAgent().invoke_setAdBlockingEnabled({enabled:this.adBlockEnabledSetting.get()}),e.emulationAgent().invoke_setFocusEmulationEnabled({enabled:this.emulatePageFocusSetting.get()}))}updateAutoAttach(){n.InspectorFrontendHost.InspectorFrontendHostInstance.setOpenNewWindowForPopups(this.autoAttachSetting.get())}update(){for(const e of o.TargetManager.TargetManager.instance().targets())this.updateTarget(e)}targetAdded(e){this.updateTarget(e)}targetRemoved(e){}}o.ChildTargetManager.ChildTargetManager.install();var I=Object.freeze({__proto__:null,InspectorMainImpl:y,ReloadActionDelegate:A,FocusDebuggeeActionDelegate:P,NodeIndicator:v,SourcesPanelIndicator:M,BackendSettingsSync:k});export{I as InspectorMain,p as RenderingOptions};
